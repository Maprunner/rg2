// Version 1.2.1 2015-07-04T14:13:35;
var rg2=function(a,b){"use strict";function c(){a.location.hash&&!rg2.config.managing&&rg2.requestedHash.parseHash(a.location.hash),rg2.getEvents(),setTimeout(function(){b("#rg2-container").show()},500)}function d(a){var b,c,d;return c=rg2.results.getResultsInfo(),d=rg2.courses.getCoursesForEvent(),b="<p><strong>"+rg2.t("Courses")+":</strong> "+d.length+". <strong>"+rg2.t("Controls")+":</strong> "+a,b+=". <strong> "+rg2.t("Results")+":</strong> "+c.results+".</p>",b+="<p><strong>"+rg2.t("Routes")+":</strong> "+c.totalroutes+" ("+c.percent+"%). ",b+="<strong>"+rg2.t("Drawn routes")+":</strong> "+c.drawnroutes+". <strong>"+rg2.t("GPS routes")+":</strong> "+c.gpsroutes+".</p>",b+="<p><strong>"+rg2.t("Total time")+":</strong> "+c.time+".</p>"}function e(a){var b,c;return c=rg2.getMapSize(),b="<p><strong>"+rg2.t("Map ")+":</strong> ID "+rg2.events.getActiveMapID()+", "+c.width+" x "+c.height+" pixels",b+=a?". "+rg2.t("Map is georeferenced")+".</p>":".</p>"}function f(){var a,b,c,f;return f=rg2.events.getActiveEventID(),null===f?"":(f=rg2.events.getKartatEventID(),c=rg2.events.getEventInfo(parseInt(f,10)),b=rg2.results.getComments(),a="<h3>"+rg2.t("Event statistics")+": "+c.name+": "+c.date+"</h3>",a+=d(c.controls),c.comment&&(a+="<p>"+c.comment+"</p>"),a+=e(c.worldfile.valid),b&&(a+="<p><strong>"+rg2.t("Comments")+":</strong></p>"+b),a=a.replace(/&amp;/g,"&"))}function g(){0!==b("#rg2-manage-login").length?(rg2.config.managing=!0,rg2.manager=new rg2.Manager(rg2Config.keksi),rg2.managerUI.initialiseUI()):rg2.config.managing=!1}function h(a){b("#rg2-event-list > li").removeClass("rg2-active-event").filter("#"+a).addClass("rg2-active-event"),b("body").css("cursor","wait"),b("#rg2-load-progress-label").text(rg2.t("Loading courses")),b("#rg2-load-progress").show()}function i(a){h(a),rg2.courses.deleteAllCourses(),rg2.controls.deleteAllControls(),rg2.animation.resetAnimation(),rg2.results.deleteAllResults(),rg2.events.setActiveEventID(a),rg2.drawing.initialiseDrawing(rg2.events.hasResults(a)),rg2.loadNewMap(rg2Config.maps_url+rg2.events.getMapFileName()),rg2.ui.setTitleBar(),rg2.redraw(!1),rg2.getCourses()}function j(){rg2.events=new rg2.Events,rg2.courses=new rg2.Courses,rg2.colours=new rg2.Colours,rg2.results=new rg2.Results,rg2.controls=new rg2.Controls,rg2.animation=new rg2.Animation,rg2.drawing=new rg2.Draw,rg2.requestedHash=new rg2.RequestedHash}function k(){b("#rg2-container").hide(),b.ajaxSetup({cache:!1}),rg2.loadConfigOptions(),rg2.ui.configureUI(),rg2.setLanguageOptions(),j(),g(),rg2.setUpCanvas(),c()}return{init:k,loadEvent:i,getEventStats:f}}(window,window.jQuery);!function(){function a(){"use strict";this.runners=[],this.timer=null,this.animationSecs=0,this.deltaSecs=5,this.timerInterval=100,this.realTime=!1,this.earliestStartSecs=0,this.latestFinishSecs=0,this.tailLength=0,this.useFullTails=!1,this.massStartControl=0,this.massStartByControl=!1,this.displayNames=!0,this.displayInitials=!1}a.prototype={Constructor:a,resetAnimation:function(){this.runners.length=0,clearInterval(this.timer),this.timer=null,this.massStartControl=0,this.massStartByControl=!1,this.updateAnimationDetails(),$("#btn-start-stop").removeClass("fa-pause").addClass("fa-play"),$("#btn-start-stop").prop("title",rg2.t("Run"))},animateRunners:function(a,b){var c;for(c=0;c<a.length;c+=1)b?this.addRunner(new rg2.Runner(a[c]),!1):this.removeRunner(a[c],!1);this.updateAnimationDetails()},addRunner:function(a,b){var c;for(c=0;c<this.runners.length;c+=1)if(this.runners[c].runnerid===a.runnerid)return;this.runners.push(a),b&&this.updateAnimationDetails()},updateAnimationDetails:function(){var a=this.getAnimationNames();""!==a?($("#rg2-track-names").empty().append(a).show(),$("#rg2-animation-controls").show()):($("#rg2-track-names").hide(),$("#rg2-animation-controls").hide()),this.calculateAnimationRange(),$("#rg2-clock").text(rg2.utils.formatSecsAsHHMMSS(this.animationSecs))},clockSliderMoved:function(a){this.resetAnimationTime(a),rg2.redraw(!1)},getAnimationNames:function(){var a,b;if(b="",this.runners.length<1)return b;for(a=0;a<this.runners.length;a+=1)b+="<p style='color:"+this.runners[a].colour+";'>"+this.runners[a].coursename+":&nbsp;"+this.runners[a].name.trim()+"</p>";return b},getMaxControls:function(){var a,b;for(a=0,b=0;b<this.runners.length;b+=1)a=Math.max(a,this.runners[b].splits.length);return a-2},getSplitsTableHeader:function(a){var b,c;for(b="<table class='splitstable'><tr><th>"+rg2.t("Course")+"</th><th>"+rg2.t("Name")+"</th>",c=1;a>=c;c+=1)b+="<th>"+c+"</th>";return b+"<th>F</th></tr>"},getSplitsTable:function(){var a,b,c,d,e,f,g,h,i,j;if(this.runners.length<1)return"<p>"+rg2.t("Select runners on Results tab")+".</p>";for(h=[],i=0,j=rg2.events.getMetresPerPixel(),e=j.metresPerPixel,f=j.units,g=this.getMaxControls(),a=this.getSplitsTableHeader(g),b=0;b<this.runners.length;b+=1){for(d=this.runners[b],i=0,a+="<tr class='splitsname-row'><td>"+d.coursename+"</td><td>"+d.name+"</td>",c=1;c<d.splits.length;c+=1)a+="<td>"+rg2.utils.formatSecsAsMMSS(d.splits[c])+"</td>",h[c]=d.splits[c]-i,i=d.splits[c];for(a+="</tr><tr class='splitstime-row'><td></td><td></td>",c=1;c<d.splits.length;c+=1)a+="<td>"+rg2.utils.formatSecsAsMMSS(h[c])+"</td>";for(a+=isNaN(d.cumulativeTrackDistance[d.cumulativeTrackDistance.length-1])?"</tr><tr class='splitsdistance-row'><td></td><td>--</td>":"</tr><tr class='splitsdistance-row'><td></td><td>"+Math.round(e*d.cumulativeTrackDistance[d.cumulativeTrackDistance.length-1])+" "+f+"</td>",c=1;c<d.splits.length;c+=1)a+=isNaN(d.legTrackDistance[c])?"<td>--</td>":"<td>"+Math.round(e*d.legTrackDistance[c])+"</td>"}return a+="</tr></table>"},removeRunner:function(a,b){var c;for(c=0;c<this.runners.length;c+=1)this.runners[c].runnerid===a&&this.runners.splice(c,1);b&&this.updateAnimationDetails()},toggleAnimation:function(){null===this.timer?(this.startAnimation(),$("#btn-start-stop").removeClass("fa-play").addClass("fa-pause").prop("title",rg2.t("Pause"))):(this.stopAnimation(),$("#btn-start-stop").removeClass("fa-pause").addClass("fa-play").prop("title",rg2.t("Run")))},startAnimation:function(){null===this.timer&&(this.timer=setInterval(this.timerExpired.bind(this),this.timerInterval))},calculateAnimationRange:function(){var a;for(this.earliestStartSecs=86400,this.latestFinishSecs=0,this.slowestTimeSecs=0,a=0;a<this.runners.length;a+=1)this.runners[a].starttime<this.earliestStartSecs&&(this.earliestStartSecs=this.runners[a].starttime),this.runners[a].starttime+this.runners[a].x.length>this.latestFinishSecs&&(this.latestFinishSecs=this.runners[a].starttime+this.runners[a].x.length),this.runners[a].x.length>this.slowestTimeSecs&&(this.slowestTimeSecs=this.runners[a].x.length);this.resetAnimationTime(0)},stopAnimation:function(){clearInterval(this.timer),this.timer=null},timerExpired:function(){rg2.redraw(!0)},setFullTails:function(a){this.useFullTails=a?!0:!1,rg2.redraw(!1)},setTailLength:function(a){this.tailLength=60*a,rg2.redraw(!1)},setStartControl:function(a){var b;if(this.massStartControl=parseInt(a,10),this.massStartControl===rg2.config.MASS_START_BY_CONTROL)for(this.massStartControl=0,this.massStartByControl=!0,b=0;b<this.runners.length;b+=1)this.runners[b].nextStopTime=this.runners[b].splits[1];else for(this.massStartByControl=!1,b=0;b<this.runners.length;b+=1)this.runners[b].nextStopTime=rg2.config.VERY_HIGH_TIME_IN_SECS;this.resetAnimationTime(0)},setReplayType:function(a){a===rg2.config.MASS_START_REPLAY?(this.realTime=!1,$("#btn-mass-start").addClass("active"),$("#btn-real-time").removeClass("active"),rg2.courses.getHighestControlNumber()>0&&$("#rg2-control-select").prop("disabled",!1)):(this.realTime=!0,$("#btn-mass-start").removeClass("active"),$("#btn-real-time").addClass("active"),$("#rg2-control-select").prop("disabled",!0)),this.resetAnimationTime(0)},resetAnimationTime:function(a){this.realTime?(this.animationSecs=a>0?a:this.earliestStartSecs,this.startSecs=this.earliestStartSecs,$("#rg2-clock-slider").slider("option","max",this.latestFinishSecs),$("#rg2-clock-slider").slider("option","min",this.earliestStartSecs)):(this.animationSecs=a>0?a:0,this.startSecs=0,$("#rg2-clock-slider").slider("option","max",this.slowestTimeSecs),$("#rg2-clock-slider").slider("option","min",0)),$("#rg2-clock-slider").slider("value",this.animationSecs),$("#rg2-clock").text(rg2.utils.formatSecsAsHHMMSS(this.animationSecs))},toggleNameDisplay:function(){var a="";this.displayNames?this.displayInitials?(this.displayNames=!1,this.displayInitials=!1,a="Show names"):(this.displayInitials=!0,a="Hide names"):(this.displayNames=!0,a="Show initials"),$("#btn-toggle-names").prop("title",rg2.t(a))},displayName:function(a,b){var c;this.displayNames&&(rg2.ctx.fillStyle="black",rg2.ctx.font=rg2.options.replayFontSize+"pt Arial",rg2.ctx.globalAlpha=rg2.config.FULL_INTENSITY,rg2.ctx.textAlign="left",c=this.displayInitials?a.initials:a.name,rg2.ctx.fillText(c,a.x[b]+15,a.y[b]+7))},setAnimationTime:function(a){return this.realTime?this.animationSecs<this.latestFinishSecs&&a&&(this.animationSecs+=this.deltaSecs):this.animationSecs<this.slowestTimeSecs&&a&&(this.animationSecs+=this.deltaSecs),this.useFullTails?this.startSecs+1:Math.max(this.animationSecs-this.tailLength,this.startSecs+1)},runAnimation:function(a){var b,c,d,e,f;for(f=this.setAnimationTime(a),$("#rg2-clock-slider").slider("value",this.animationSecs),$("#rg2-clock").text(rg2.utils.formatSecsAsHHMMSS(this.animationSecs)),rg2.ctx.lineWidth=rg2.options.routeWidth,e=rg2.options.routeWidth,rg2.ctx.globalAlpha=1,d=0;d<this.runners.length;d+=1){for(b=this.runners[d],c=this.realTime?b.starttime:0===this.massStartControl||b.splits.length<this.massStartControl?0:-1*b.splits[this.massStartControl],rg2.ctx.strokeStyle=b.colour,rg2.ctx.globalAlpha=rg2.options.routeIntensity,rg2.ctx.beginPath(),rg2.ctx.moveTo(b.x[f-c],b.y[f-c]),e=f;e<=this.animationSecs;e+=1)e>c&&e-c<b.nextStopTime&&rg2.ctx.lineTo(b.x[e-c],b.y[e-c]);rg2.ctx.stroke(),rg2.ctx.fillStyle=b.colour,rg2.ctx.beginPath(),e-c<b.nextStopTime?e-=c:e=b.nextStopTime,rg2.ctx.arc(b.x[e]+rg2.config.RUNNER_DOT_RADIUS/2,b.y[e],rg2.config.RUNNER_DOT_RADIUS,0,2*Math.PI,!1),rg2.ctx.fill(),this.displayName(b,e)}this.massStartByControl&&this.checkForStopControl(this.animationSecs)},checkForStopControl:function(a){var b,c,d;for(d=!0,b=0;b<this.runners.length;b+=1)if(c=this.runners[b].splits[this.massStartControl+1]-this.runners[b].splits[this.massStartControl],c>a){d=!1;break}if(d){for(this.massStartControl+=1,b=0;b<this.runners.length;b+=1)this.runners[b].nextStopTime=this.massStartControl<this.runners[b].splits.length?this.runners[b].splits[this.massStartControl+1]:rg2.config.VERY_HIGH_TIME_IN_SECS;this.resetAnimationTime(0)}},goSlower:function(){this.deltaSecs>0&&(this.deltaSecs-=1)},goFaster:function(){this.deltaSecs+=1}},rg2.Animation=a}(),function(){function a(a){$("#rg2-map-load-progress-label").text(rg2.t("Loading map")),$("#rg2-map-load-progress").show(),p.src=a}function b(){rg2.config.managing||(o.font="30pt Arial",o.textAlign="center",o.fillStyle=rg2.config.BLACK,o.fillText(rg2.t("Select an event"),rg2.canvas.width/2,rg2.canvas.height/2))}function c(a){if(o.save(),o.setTransform(1,0,0,1,0,0),o.globalAlpha=rg2.config.FULL_INTENSITY,o.fillStyle=rg2.config.WHITE,o.fillRect(0,0,o.canvas.width,o.canvas.height),o.restore(),o.globalAlpha=rg2.options.mapIntensity,p.height>0){o.drawImage(p,0,0);var c=$("#rg2-info-panel").tabs("option","active");c===rg2.config.TAB_DRAW?(rg2.courses.drawCourses(rg2.config.DIM),rg2.controls.drawControls(!1),rg2.results.drawTracks(),rg2.drawing.drawNewTrack()):c===rg2.config.TAB_CREATE?rg2.manager.drawControls():(rg2.courses.drawCourses(rg2.config.DIM),rg2.results.drawTracks(),rg2.controls.drawControls(!1),rg2.animation.runAnimation(a?!0:!1))}else b()}function d(){var a,b;b=n.height/p.height,rg2.input.lastX=n.width/2,rg2.input.lastY=n.height/2,rg2.input.zoomSize=1,rg2.input.dragStart=null,rg2.input.dragged=!0,a=1>b?b:1,rg2.input.infoPanelMaximised||window.innerWidth>=rg2.config.BIG_SCREEN_BREAK_POINT?o.setTransform(a,0,0,a,$("#rg2-info-panel").outerWidth(),0):o.setTransform(a,0,0,a,0,0),o.save(),c(!1)}function e(a,b,c){var d,e;rg2.input.infoPanelMaximised=a,$("#rg2-resize-info").prop("title",rg2.t(b)),$("#rg2-hide-info-panel-control").css("left",c),a?($("#rg2-info-panel").show(),d="fa-chevron-right",e="fa-chevron-left"):($("#rg2-info-panel").hide(),d="fa-chevron-left",e="fa-chevron-right"),$("#rg2-hide-info-panel-icon").removeClass(d).addClass(e).prop("title",rg2.t(b))}function f(){rg2.input.infoPanelMaximised?e(!1,"Show info panel","0px"):e(!0,"Hide info panel","366px"),d()}function g(a){var b,d,e;d=Math.pow(rg2.input.scaleFactor,a),e=rg2.input.zoomSize*d,50>e&&e>.05&&(rg2.input.zoomSize=e,b=o.transformedPoint(rg2.input.lastX,rg2.input.lastY),o.translate(b.x,b.y),o.scale(d,d),o.translate(-b.x,-b.y),o.save(),c(!1))}function h(a){var b,c,d,e,f,g,h,i,j;c=document.createElementNS("http://www.w3.org/2000/svg","svg"),b=c.createSVGMatrix(),d=[],e=a.save,a.save=function(){return d.push(b.translate(0,0)),e.call(a)},f=a.restore,a.restore=function(){return b=d.pop(),f.call(a)},g=a.scale,a.scale=function(c,d){return b=b.scaleNonUniform(c,d),g.call(a,c,d)},h=a.translate,a.translate=function(c,d){return b=b.translate(c,d),h.call(a,c,d)},i=a.setTransform,a.setTransform=function(c,d,e,f,g,h){return b.a=c,b.b=d,b.c=e,b.d=f,b.e=g,b.f=h,i.call(a,c,d,e,f,g,h)},j=c.createSVGPoint(),a.transformedPoint=function(a,c){return j.x=a,j.y=c,j.matrixTransform(b.inverse())}}function i(){return{height:p.height,width:p.width}}function j(){rg2.input.scaleFactor=rg2.config.DEFAULT_SCALE_FACTOR,$("#rg2-container").css("height",window.innerHeight-36),n.width=window.innerWidth,n.height=window.innerHeight-36,rg2.ui.setTitleBar(),d()}function k(){$("#rg2-map-load-progress").hide(),d(),rg2.config.managing&&rg2.manager.mapLoadCallback()}function l(){n.addEventListener("touchstart",rg2.handleTouchStart,!1),n.addEventListener("touchmove",rg2.handleTouchMove,!1),n.addEventListener("touchend",rg2.handleTouchEnd,!1),n.addEventListener("DOMMouseScroll",rg2.handleScroll,!1),n.addEventListener("mousewheel",rg2.handleScroll,!1),n.addEventListener("mousedown",rg2.handleMouseDown,!1),n.addEventListener("mousemove",rg2.handleMouseMove,!1),n.addEventListener("mouseup",rg2.handleMouseUp,!1),window.addEventListener("resize",j,!1),p.addEventListener("load",function(){k()},!1)}function m(){l(),h(o),j()}var n,o,p;n=$("#rg2-map-canvas")[0],o=n.getContext("2d"),p=new Image,rg2.zoom=g,rg2.redraw=c,rg2.canvas=n,rg2.setUpCanvas=m,rg2.ctx=o,rg2.addListeners=l,rg2.resetMapState=d,rg2.getMapSize=i,rg2.loadNewMap=a,rg2.resizeInfoDisplay=f}(),function(){function a(a){return r.hasOwnProperty(a)?r[a]:a}function b(){var b,c,d;for(c=["#rg2-events-tab a","#rg2-courses-tab a","#rg2-results-tab a","#rg2-draw-tab a","#rg2-draw-title","#draw-text-1","#draw-text-2","#draw-text-3","#draw-text-4","#draw-text-5","#rg2-load-gps-title",".rg2-options-dialog .ui-dialog-title"],d=["Events","Courses","Results","Draw","Draw route","Left click to add/lock/unlock a handle","Green - draggable","Red - locked","Right click to delete a handle","Drag a handle to adjust track around locked point(s)","Load GPS file (GPX or TCX)","Configuration options"],b=0;b<c.length;b+=1)$(c[b]).text(a(d[b]))}function c(){var b,c,d;for(c=["#rg2-hide-info-panel-icon","#btn-about","#btn-options","#btn-zoom-out","#btn-zoom-in","#btn-reset","#btn-show-splits","#rg2-splits-table","#btn-slower","#btn-faster","#btn-real-time","#btn-mass-start"],d=["Hide info panel","Help","Options","Zoom out","Zoom in","Reset","Splits","Splits table","Slower","Faster","Real time","Mass start"],b=0;b<c.length;b+=1)$(c[b]).prop("title",a(d[b]))}function d(){var b,c,d;for(c=["label[for=rg2-control-select]","label[for=btn-full-tails]","label[for=spn-tail-length]","label[for=rg2-select-language]","label[for=spn-map-intensity]","label[for=spn-route-intensity]","label[for=spn-route-width]","label[for=spn-name-font-size]","label[for=spn-course-width]","label[for=spn-control-circle]","label[for=chk-snap-toggle]","label[for=chk-show-three-seconds]","label[for=chk-show-GPS-speed]","label[for=rg2-course-select]","label[for=rg2-name-select]","label[for=btn-move-all]"],d=["Start at","Full tails","Length","Language","Map intensity %","Route intensity %","Route width","Replay label font size","Course overprint width","Control circle size","Snap to control when drawing","Show +3 time loss for GPS routes","Show GPS speed colours","Select course","Select name","Move track and map together (or right click-drag)"],b=0;b<c.length;b+=1)$(c[b]).prop("textContent",a(d[b]))}function e(){var b,c,d;for(c=["#btn-undo","#btn-undo-gps-adjust","#btn-save-route","#btn-reset-drawing","#btn-three-seconds","#btn-save-gps-route","#btn-autofit-gps"],d=["Undo","Undo","Save","Reset","+3 sec","Save GPS route","Autofit"],b=0;b<c.length;b+=1)$(c[b]).button("option","label",a(d[b]))}function f(){var f;b(),c(),d(),e(),f=$("#btn-toggle-controls").prop("title"),$("#btn-toggle-controls").prop("title",a(f)),f=$("#btn-toggle-names").prop("title"),$("#btn-toggle-names").prop("title",a(f)),f=$("#btn-start-stop").prop("title"),$("#btn-start-stop").prop("title",a(f))}function g(){var a,b,c;$("#rg2-select-language").empty(),c=document.getElementById("rg2-select-language"),b="en"===r.code,c.options.add(rg2.utils.generateOption("en","en: English",b));for(a in rg2Config.languages)rg2Config.languages.hasOwnProperty(a)&&(b=r.code===a,c.options.add(rg2.utils.generateOption(a,a+": "+rg2Config.languages[a],b)))}function h(){return r.code}function i(a){r=a,f()}function j(){void 0===rg2Config.dictionary.code?(r={},r.code="en"):r=rg2Config.dictionary,f(),g()}function k(a,b){this.options[a]=b}function l(){try{window.hasOwnProperty("localStorage")&&null!==window.localStorage&&(this.options.snap=$("#chk-snap-toggle").prop("checked"),this.options.showThreeSeconds=$("#chk-show-three-seconds").prop("checked"),this.options.showGPSSpeed=$("#chk-show-GPS-speed").prop("checked"),localStorage.setItem("rg2-options",JSON.stringify(this.options)))}catch(a){return}}function m(){try{window.hasOwnProperty("localStorage")&&null!==window.localStorage&&null!==localStorage.getItem("rg2-options")&&(this.options=JSON.parse(localStorage.getItem("rg2-options")),this.options.circleSize=20,0===this.options.mapIntensity&&rg2.utils.showWarningDialog("Warning","Your saved settings have 0% map intensity so the map is invisible. You can adjust this on the configuration menu"))}catch(a){console.log("Local storage not supported")}}function n(){var a,b,c,d;return a={},b=rg2.getMapSize(),c=Math.pow(Math.min(b.height,b.width)/1500,.5),c=Math.min(c,5),c=Math.max(c,.5),d=Math.round(rg2.options.circleSize*c),a.controlRadius=d,a.finishInnerRadius=d*(5/6),a.finishOuterRadius=d*(7/6),a.startTriangleLength=d*(7/6),a.overprintWidth=this.options.courseWidth,a.font=d+"pt Arial",a}function o(){var a;return a={},a.routeWidth=this.options.routeWidth,a.routeIntensity=this.options.routeIntensity,a.replayFontSize=this.options.replayFontSize,a.showThreeSeconds=$("#chk-show-three-seconds").prop("checked"),a.showGPSSpeed=$("#chk-show-GPS-speed").prop("checked"),a}var p,q,r;p={DEFAULT_SCALE_FACTOR:1.1,TAB_EVENTS:0,TAB_COURSES:1,TAB_RESULTS:2,TAB_DRAW:3,TAB_LOGIN:4,TAB_CREATE:5,TAB_EDIT:6,TAB_MAP:7,INVALID_MAP_ID:9999,DEFAULT_NEW_COMMENT:"Type your comment",DEFAULT_EVENT_COMMENT:"Comments (optional)",GPS_RESULT_OFFSET:5e4,MASS_START_REPLAY:1,REAL_TIME_REPLAY:2,MASS_START_BY_CONTROL:99999,VERY_HIGH_TIME_IN_SECS:99999,BIG_SCREEN_BREAK_POINT:800,SMALL_SCREEN_BREAK_POINT:500,PURPLE:"#b300ff",RED:"#ff0000",GREEN:"#00ff00",RED_30:"rgba(255,0,0,0.3)",GREEN_30:"rgba(0,255,0,0.3)",WHITE:"#ffffff",BLACK:"#ffoooo",RUNNER_DOT_RADIUS:6,HANDLE_DOT_RADIUS:7,HANDLE_COLOUR:"#ff0000",DIM:.75,FULL_INTENSITY:1,NORMAL_EVENT:1,EVENT_WITHOUT_RESULTS:2,SCORE_EVENT:3,RG2VERSION:"1.2.1",TIME_NOT_FOUND:9999,RIGHT_CLICK:3,DO_NOT_SAVE_COURSE:9999,FORMAT_NORMAL:1,FORMAT_NO_RESULTS:2,FORMAT_SCORE_EVENT:3,DISPLAY_ALL_COURSES:99999},q={mapIntensity:1,routeIntensity:1,replayFontSize:12,courseWidth:3,routeWidth:4,circleSize:20,snap:!0,showThreeSeconds:!1,showGPSSpeed:!1},rg2.t=a,rg2.options=q,rg2.config=p,rg2.saveConfigOptions=l,rg2.setConfigOption=k,rg2.loadConfigOptions=m,rg2.getReplayDetails=o,rg2.getOverprintDetails=n,rg2.setDictionary=i,rg2.getDictionaryCode=h,rg2.setLanguageOptions=j}(),function(){function a(a,b,c){this.code=a,this.x=b,this.y=c}a.prototype={Constructor:a},rg2.Control=a}(),function(){function a(){this.controls=[],this.displayControls=!1}a.prototype={Constructor:a,addControl:function(a,b,c){var d,e;for(e=!0,d=0;d<this.controls.length;d+=1)if(this.controls[d].code===a){e=!1;break}e&&this.controls.push(new rg2.Control(a,b,c))},deleteAllControls:function(){this.controls.length=0},drawControls:function(a){var b,c,d;if(this.displayControls)for(d=rg2.getOverprintDetails(),c=this.controls.length,b=0;c>b;b+=1)0===this.controls[b].code.indexOf("F")||0===this.controls[b].code.indexOf("M")?this.drawFinish(this.controls[b].x,this.controls[b].y,this.controls[b].code,d):0===this.controls[b].code.indexOf("S")?this.drawStart(this.controls[b].x,this.controls[b].y,this.controls[b].code,1.5*Math.PI,d):(this.drawSingleControl(this.controls[b].x,this.controls[b].y,this.controls[b].code,.25*Math.PI,d),a&&rg2.ctx.fillRect(this.controls[b].x-1,this.controls[b].y-1,3,3))},drawSingleControl:function(a,b,c,d,e){var f,g,h,i;rg2.ctx.beginPath(),rg2.ctx.strokeStyle="white",rg2.ctx.lineWidth=e.overprintWidth+2,rg2.ctx.arc(a,b,e.controlRadius,0,2*Math.PI,!1),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.textAlign="center",rg2.ctx.font=e.font,rg2.ctx.strokeStyle="white",rg2.ctx.miterLimit=2,rg2.ctx.lineJoin="circle",rg2.ctx.lineWidth=1.5,rg2.ctx.textBaseline="middle",g=rg2.ctx.measureText(c),h=d<Math.PI?g.width/2:-1*g.width/2,i=d>=Math.PI/2&&d<=1.5*Math.PI?-1*e.controlRadius/2:e.controlRadius/2,f=1.3,rg2.ctx.strokeText(c,a+e.controlRadius*f*Math.sin(d)+h,b+e.controlRadius*f*Math.cos(d)+i),rg2.ctx.beginPath(),rg2.ctx.font=e.font,rg2.ctx.fillStyle=rg2.config.PURPLE,rg2.ctx.strokeStyle=rg2.config.PURPLE,rg2.ctx.lineWidth=e.overprintWidth,rg2.ctx.arc(a,b,e.controlRadius,0,2*Math.PI,!1),rg2.ctx.fillText(c,a+e.controlRadius*f*Math.sin(d)+h,b+e.controlRadius*f*Math.cos(d)+i),rg2.ctx.stroke()},drawFinish:function(a,b,c,d){rg2.ctx.strokeStyle="white",rg2.ctx.lineWidth=d.overprintWidth+2,rg2.ctx.beginPath(),rg2.ctx.arc(a,b,d.finishInnerRadius,0,2*Math.PI,!1),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.arc(a,b,d.finishOuterRadius,0,2*Math.PI,!1),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.font=d.font,rg2.ctx.textAlign="left",rg2.ctx.strokeStyle="white",rg2.ctx.miterLimit=2,rg2.ctx.lineJoin="circle",rg2.ctx.lineWidth=1.5,rg2.ctx.strokeText(c,a+1.5*d.controlRadius,b+d.controlRadius),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.fillStyle=rg2.config.PURPLE,rg2.ctx.strokeStyle=rg2.config.PURPLE,rg2.ctx.lineWidth=d.overprintWidth,rg2.ctx.arc(a,b,d.finishInnerRadius,0,2*Math.PI,!1),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.arc(a,b,d.finishOuterRadius,0,2*Math.PI,!1),rg2.ctx.fillText(c,a+1.5*d.controlRadius,b+d.controlRadius),rg2.ctx.stroke()},drawStart:function(a,b,c,d,e){var f,g,h;f=[],g=[],h=2*Math.PI/3,d+=Math.PI/2,rg2.ctx.lineCap="round",rg2.ctx.strokeStyle="white",rg2.ctx.lineWidth=e.overprintWidth+2,rg2.ctx.beginPath(),f[0]=a+e.startTriangleLength*Math.sin(d),g[0]=b-e.startTriangleLength*Math.cos(d),rg2.ctx.moveTo(f[0],g[0]),f[1]=a+e.startTriangleLength*Math.sin(d+h),g[1]=b-e.startTriangleLength*Math.cos(d+h),rg2.ctx.lineTo(f[1],g[1]),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.moveTo(f[1],g[1]),f[2]=a+e.startTriangleLength*Math.sin(d-h),g[2]=b-e.startTriangleLength*Math.cos(d-h),rg2.ctx.lineTo(f[2],g[2]),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.moveTo(f[2],g[2]),rg2.ctx.lineTo(f[0],g[0]),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.font=e.font,rg2.ctx.textAlign="left",rg2.ctx.strokeStyle="white",rg2.ctx.miterLimit=2,rg2.ctx.lineJoin="circle",rg2.ctx.lineWidth=1.5,rg2.ctx.strokeText(c,f[0]+1.25*e.controlRadius,g[0]+1.25*e.controlRadius),rg2.ctx.stroke(),rg2.ctx.strokeStyle=rg2.config.PURPLE,rg2.ctx.lineWidth=e.overprintWidth,rg2.ctx.font=e.font,rg2.ctx.fillStyle=rg2.config.PURPLE,rg2.ctx.beginPath(),rg2.ctx.moveTo(f[0],g[0]),rg2.ctx.lineTo(f[1],g[1]),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.moveTo(f[1],g[1]),rg2.ctx.lineTo(f[2],g[2]),rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.moveTo(f[2],g[2]),rg2.ctx.lineTo(f[0],g[0]),rg2.ctx.fillText(c,f[0]+1.25*e.controlRadius,g[0]+1.25*e.controlRadius),rg2.ctx.stroke()},toggleControlDisplay:function(){this.displayControls?($("#btn-toggle-controls").removeClass("fa-ban").addClass("fa-circle-o"),$("#btn-toggle-controls").prop("title",rg2.t("Show controls"))):($("#btn-toggle-controls").removeClass("fa-circle-o").addClass("fa-ban"),$("#btn-toggle-controls").prop("title",rg2.t("Hide controls"))),this.displayControls=!this.displayControls},displayAllControls:function(){this.displayControls=!0},getControlCount:function(){return this.controls.length}},rg2.Controls=a}(),function(){function a(a,b){this.name=a.name,this.trackcount=0,this.display=!1,this.courseid=a.courseid,this.codes=a.codes,this.x=a.xpos,this.y=a.ypos,this.isScoreCourse=b,this.resultcount=0,this.angle=[],this.textAngle=[],this.setAngles()}a.prototype={Constructor:a,incrementTracksCount:function(){this.trackcount+=1},setAngles:function(){var a,b,c,d,e,f,g;for(a=0;a<this.x.length-1;a+=1)this.isScoreCourse?(this.angle[a]=1.5*Math.PI,this.textAngle[a]=.25*Math.PI):(this.angle[a]=rg2.utils.getAngle(this.x[a],this.y[a],this.x[a+1],this.y[a+1]),b=Math.sin(this.angle[a-1]),c=Math.cos(this.angle[a-1]),d=Math.sin(this.angle[a])+b,e=Math.cos(this.angle[a])+c,f=d/2,g=e/2,this.textAngle[a]=rg2.utils.getAngle(f,g,b,c));this.angle[this.x.length-1]=0,this.textAngle[this.x.length-1]=0},drawCourse:function(a){var b,c;if(this.display)if(c=rg2.getOverprintDetails(),rg2.ctx.globalAlpha=a,rg2.controls.drawStart(this.x[0],this.y[0],"",this.angle[0],c),this.isScoreCourse||this.drawLinesBetweenControls({x:this.x,y:this.y},this.angle,c),this.isScoreCourse)for(b=1;b<this.x.length;b+=1)0===this.codes[b].indexOf("F")||0===this.codes[b].indexOf("M")?rg2.controls.drawFinish(this.x[b],this.y[b],"",c):rg2.controls.drawSingleControl(this.x[b],this.y[b],this.codes[b],this.textAngle[b],c);else{for(b=1;b<this.x.length-1;b+=1)rg2.controls.drawSingleControl(this.x[b],this.y[b],b,this.textAngle[b],c);rg2.controls.drawFinish(this.x[this.x.length-1],this.y[this.y.length-1],"",c)}},drawLinesBetweenControls:function(a,b,c){var d,e,f,g,h,i;for(h=0;h<a.x.length-1;h+=1)i=0===h?c.startTriangleLength:c.controlRadius,d=a.x[h]+i*Math.cos(b[h]),e=a.y[h]+i*Math.sin(b[h]),i=h===this.x.length-2?c.finishOuterRadius:c.controlRadius,f=a.x[h+1]-i*Math.cos(b[h]),g=a.y[h+1]-i*Math.sin(b[h]),rg2.ctx.beginPath(),rg2.ctx.moveTo(d,e),rg2.ctx.lineTo(f,g),rg2.ctx.stroke()}},rg2.Course=a}(),function(){function a(a,b,c){return this.courses=[],this.newcontrols=new rg2.Controls,this.courses.length=0,this.fromCondes=!1,this.coursesGeoreferenced=!1,this.newcontrols.deleteAllControls(),this.localWorldfile=c,this.worldfile=b,this.processCoursesXML(a.target.result),{courses:this.courses,newcontrols:this.newcontrols,georeferenced:this.coursesGeoreferenced}}a.prototype={Constructor:a,processCoursesXML:function(a){var b,c,d;try{b=$.parseXML(a)}catch(e){return void rg2.utils.showWarningDialog("XML file error","File is not a valid XML course file.")}if(d=b.getElementsByTagName("CourseData"),0===d.length)return void rg2.utils.showWarningDialog("XML file error","File is not a valid XML course file. CourseData element missing.");switch(c=this.getVersion(b)){case"2.0.3":this.processIOFV2XMLCourses(b);break;case"3.0":this.processIOFV3XMLCourses(b);break;default:rg2.utils.showWarningDialog("XML file error","Invalid IOF file format. Version "+c+" not supported.")}},getVersion:function(a){var b,c;return c="",b=a.getElementsByTagName("IOFVersion"),b.length>0&&(c=b[0].getAttribute("version")),""===c&&(b=a.getElementsByTagName("CourseData"),b.length>0&&(c=b[0].getAttribute("iofVersion").trim(),this.setCreator(b[0].getAttribute("creator").trim()))),c},setCreator:function(a){a.indexOf("Condes")>-1&&(this.fromCondes=!0)},processIOFV3XMLCourses:function(a){var b,c,d,e,f;for(b=a.getElementsByTagName("Control"),e={x:0,y:0},c=0;c<b.length;c+=1)"RaceCourseData"===b[c].parentNode.nodeName&&(d=b[c].getElementsByTagName("Id")[0].textContent,f=b[c].getElementsByTagName("Position"),this.localWorldfile.valid&&f.length>0?(e=this.getXYFromLatLng(f),this.coursesGeoreferenced=!0):e=this.getXYFromMapPosition(b[c].getElementsByTagName("MapPosition")),"CrossingPoint"!==b[c].getAttribute("type")&&this.newcontrols.addControl(d.trim(),e.x,e.y));b=a.getElementsByTagName("Course"),this.extractV3Courses(b)},getXYFromLatLng:function(a){var b,c,d;return d={x:0,y:0},b=parseFloat(a[0].getAttribute("lat")),c=parseFloat(a[0].getAttribute("lng")),this.fromCondes?(d.x=this.localWorldfile.getX(c,b),d.y=this.localWorldfile.getY(c,b)):(d.x=this.worldfile.getX(c,b),d.y=this.worldfile.getY(c,b)),d},processIOFV2XMLCourses:function(a){var b,c,d;if(this.extractV2Controls(a.getElementsByTagName("StartPoint"),"StartPointCode"),this.extractV2Controls(a.getElementsByTagName("Control"),"ControlCode"),this.coursesGeoreferenced=this.extractV2Controls(a.getElementsByTagName("FinishPoint"),"FinishPointCode"),this.coursesGeoreferenced&&this.localWorldfile.valid)for(b=0;b<this.newcontrols.controls.length;b+=1)c=this.newcontrols.controls[b].x,d=this.newcontrols.controls[b].y,this.newcontrols.controls[b].x=this.localWorldfile.getX(c,d),this.newcontrols.controls[b].y=this.localWorldfile.getY(c,d);this.extractV2Courses(a.getElementsByTagName("Course"))},extractV2Courses:function(a){var b,c,d,e,f;for(b=0;b<a.length;b+=1)d=[],e=[],f=[],c=a[b].getElementsByTagName("CourseName")[0].textContent.trim(),d=this.extractCodesFromControlList(a[b],"ControlCode"),d.unshift(a[b].getElementsByTagName("StartPointCode")[0].textContent.trim()),d.push(a[b].getElementsByTagName("FinishPointCode")[0].textContent.trim()),this.courses.push({courseid:0,x:e,y:f,codes:d,name:c});$("#rg2-select-course-file").addClass("valid")},extractV3Courses:function(a){var b,c,d,e,f;for(b=0;b<a.length;b+=1)d=[],e=[],f=[],c=a[b].getElementsByTagName("Name")[0].textContent.trim(),d=this.extractCodesFromControlList(a[b],"Control"),this.courses.push({courseid:0,x:e,y:f,codes:d,name:c});$("#rg2-select-course-file").addClass("valid")},extractCodesFromControlList:function(a,b){var c,d,e,f;for(f=a.getElementsByTagName("CourseControl"),e=[],c=0;c<f.length;c+=1)d=f[c].getElementsByTagName(b)[0].textContent.trim(),this.validControlCode(d)&&e.push(d);return e},extractV2Controls:function(a,b){var c,d,e,f,g;for(g=!1,d={x:0,y:0},c=0;c<a.length;c+=1)e=a[c].getElementsByTagName(b)[0].textContent,f=a[c].getElementsByTagName("ControlPosition"),f.length>0&&this.localWorldfile.valid?(d.x=parseFloat(f[0].getAttribute("x")),d.y=parseFloat(f[0].getAttribute("y")),g=!0):d=this.getXYFromMapPosition(a[c].getElementsByTagName("MapPosition")),this.newcontrols.addControl(e.trim(),d.x,d.y);return g},getXYFromMapPosition:function(a){return{x:a[0].getAttribute("x").replace(",","."),y:a[0].getAttribute("y").replace(",",".")}},validControlCode:function(a){var b,c;for(c=this.newcontrols.controls,b=0;b<c.length;b+=1)if(c[b].code===a)return!0;return!1}},rg2.CourseParser=a}(),function(){function a(){this.courses=[],this.totaltracks=0,this.numberofcourses=0,this.highestControlNumber=0}a.prototype={Constructor:a,getCourseName:function(a){return this.courses[a].name},getCoursesForEvent:function(){var a,b,c;for(c=[],a=0;a<this.courses.length;a+=1)void 0!==this.courses[a]&&(b={},b.id=this.courses[a].courseid,b.name=this.courses[a].name,b.results=this.courses[a].resultcount,c.push(b));return c},getHighestControlNumber:function(){return this.highestControlNumber},getCourseDetails:function(a){return this.courses[a]},incrementTracksCount:function(a){this.courses[a].incrementTracksCount(),this.totaltracks+=1
},addCourse:function(a){this.courses[a.courseid]=a,this.numberofcourses+=1,void 0!==this.courses[a.courseid].codes&&this.courses[a.courseid].codes.length>this.highestControlNumber&&(this.highestControlNumber=this.courses[a.courseid].codes.length-1,this.updateControlDropdown())},updateCourseDropdown:function(){$("#rg2-course-select").empty();var a,b;for(b=document.getElementById("rg2-course-select"),b.options.add(rg2.utils.generateOption(null,rg2.t("Select course"))),a=0;a<this.courses.length;a+=1)void 0!==this.courses[a]&&b.options.add(rg2.utils.generateOption(a,this.courses[a].name))},updateControlDropdown:function(){var a,b;for(b=document.getElementById("rg2-control-select"),$("#rg2-control-select").empty(),b.options.add(rg2.utils.generateOption(0,"S")),a=0;a<this.highestControlNumber;a+=1)b.options.add(rg2.utils.generateOption(a,a));b.options.add(rg2.utils.generateOption(rg2.config.MASS_START_BY_CONTROL,"By control"))},deleteAllCourses:function(){this.courses.length=0,this.numberofcourses=0,this.totaltracks=0,this.highestControlNumber=0},drawCourses:function(a){var b;for(b=0;b<this.courses.length;b+=1)void 0!==this.courses[b]&&this.courses[b].drawCourse(a)},putOnDisplay:function(a){void 0!==this.courses[a]&&(this.courses[a].display=!0)},putAllOnDisplay:function(){this.setDisplayAllCourses(!0)},removeAllFromDisplay:function(){this.setDisplayAllCourses(!1)},setDisplayAllCourses:function(a){var b;for(b=0;b<this.courses.length;b+=1)void 0!==this.courses[b]&&(this.courses[b].display=a)},removeFromDisplay:function(a){this.courses[a].display=!1},getCoursesOnDisplay:function(){var a,b;for(b=[],a=0;a<this.courses.length;a+=1)void 0!==this.courses[a]&&this.courses[a].display&&b.push(a);return b},getNumberOfCourses:function(){return this.numberofcourses},generateControlList:function(a){var b,c,d,e,f;for(e=0;e<this.courses.length;e+=1)if(void 0!==this.courses[e]&&(b=this.courses[e].codes,c=this.courses[e].x,d=this.courses[e].y,void 0!==b))for(f=0;f<b.length;f+=1)a.addControl(b[f],c[f],d[f])},updateScoreCourse:function(a,b,c,d){var e;for(e=0;e<this.courses.length;e+=1)if(void 0!==this.courses[e]&&this.courses[e].courseid===a){this.courses[e].codes=b,this.courses[e].x=c,this.courses[e].y=d,this.courses[e].setAngles();break}},setResultsCount:function(){var a;for(a=0;a<this.courses.length;a+=1)void 0!==this.courses[a]&&(this.courses[a].resultcount=rg2.results.countResultsByCourseID(a))},formatCoursesAsTable:function(){var a,b;return b="<table class='coursemenutable'><tr><th>"+rg2.t("Course")+"</th><th><i class='fa fa-eye'></i></th>",b+="<th>"+rg2.t("Runners")+"</th><th>"+rg2.t("Routes")+"</th><th><i class='fa fa-eye'></i></th></tr>",a=this.formatCourseDetails(),b+=a.html+"<tr class='allitemsrow'><td>"+rg2.t("All")+"</td>",b+="<td><input class='allcourses' id="+a.coursecount+" type=checkbox name=course></input></td>",b+="<td>"+a.res+"</td><td>"+this.totaltracks+"</td><td>",this.totaltracks>0&&(b+="<input id="+a.coursecount+" class='alltracks' type=checkbox name=track></input>"),b+="</td></tr></table>"},formatCourseDetails:function(){var a,b;for(b={html:"",res:0},a=0;a<this.courses.length;a+=1)void 0!==this.courses[a]&&(b.html+="<tr><td>"+this.courses[a].name+"</td><td><input class='courselist' id="+a+" type=checkbox name=course></input></td>",b.html+="<td>"+this.courses[a].resultcount+"</td><td>"+this.courses[a].trackcount+"</td><td>",b.res+=this.courses[a].resultcount,this.courses[a].trackcount>0&&(b.html+="<input id="+a+" class='tracklist' type=checkbox name=track></input>"),b.html+="</td></tr>");return b.coursecount=a,b},drawLinesBetweenControls:function(a,b,c,d){this.courses[c].drawLinesBetweenControls(a,b,d)}},rg2.Courses=a}(),function(){function a(){this.trackColor="#ff0000",this.hasResults=!1,this.initialiseDrawing()}a.prototype={Constructor:a,gpsFileLoaded:function(){return this.gpstrack.fileLoaded},autofitGPSTrack:function(){this.gpstrack.autofitTrack()},adjustOffset:function(a){this.gpstrack.adjustOffset(a)},uploadGPS:function(a){this.gpstrack.uploadGPS(a)},getControlXY:function(){return{x:this.controlx,y:this.controly}},mouseUp:function(a,b,c){var d,e,f,g,h,i;if(i=$("#rg2-info-panel").tabs("option","active"),g=3,i===rg2.config.TAB_DRAW)if(e=this.gpstrack,e.fileLoaded){if(h=e.handles.getHandleClicked({x:a,y:b}),void 0!==h)c===rg2.config.RIGHT_CLICK&&0!==h.index&&h.index!==e.handles.length?h.locked?e.handles.unlockHandle(h.index):e.handles.deleteHandle(h.index):h.locked?e.handles.unlockHandle(h.index):e.handles.lockHandle(h.index);else for(f=e.baseX.length,d=0;f>d;d+=1)if(e.baseX[d]+g>=a&&e.baseX[d]-g<=a&&e.baseY[d]+g>=b&&e.baseY[d]-g<=b){e.handles.addHandle(a,b,d);break}}else null!==e.routeData.resultid&&null!==e.routeData.courseid?this.addNewPoint(a,b):rg2.utils.showWarningDialog("No course/name","Please select course, name and time before you start drawing a route or upload a file.")},dragEnded:function(){var a;this.gpstrack.fileLoaded&&(a=this.gpstrack,a.savedBaseX=a.baseX.slice(0),a.savedBaseY=a.baseY.slice(0),a.baseX=a.routeData.x.slice(0),a.baseY=a.routeData.y.slice(0),a.handles.saveForUndo(),a.handles.rebaselineXY(),$("#btn-undo-gps-adjust").button("enable"))},initialiseDrawing:function(){this.gpstrack=new rg2.GPSTrack,this.gpstrack.routeData=new rg2.RouteData,this.pendingCourseID=null,this.controlx=[],this.controly=[],this.nextControl=0,this.isScoreCourse=!1,this.gpstrack.initialiseGPS(),this.hasResults=rg2.events.hasResults(),this.initialiseUI(),rg2.redraw(!1)},initialiseUI:function(){this.hasResults?($("#rg2-select-name").show(),$("#rg2-enter-name").hide()):($("#rg2-select-name").hide(),$("#rg2-enter-name").show()),$("#rg2-name-select").prop("disabled",!0),$("#rg2-undo").prop("disabled",!0),$("#btn-reset-drawing").button("enable"),rg2.utils.setButtonState("disable",["#btn-save-route","#btn-save-gps-route","#btn-undo","#btn-three-seconds","#rg2-load-gps-file","#rg2-autofit-gps"]),$("#rg2-name-select").empty(),$("#rg2-new-comments").empty().val(rg2.t(rg2.config.DEFAULT_NEW_COMMENT)),$("#rg2-event-comments").empty().val(rg2.t(rg2.config.DEFAULT_EVENT_COMMENT)),$("#btn-move-all").prop("checked",!1),$("#rg2-name-entry").empty().val(""),$("#rg2-time-entry").empty().val(""),$("#rg2-name").removeClass("valid"),$("#rg2-time").removeClass("valid")},setCourse:function(a){isNaN(a)||(null!==this.gpstrack.routeData.courseid?this.gpstrack.routeData.x.length>1?(this.pendingCourseid=a,this.confirmCourseChange()):(null!==this.gpstrack.routeData.resultid&&rg2.results.putScoreCourseOnDisplay(this.gpstrack.routeData.resultid,!1),rg2.courses.removeFromDisplay(this.gpstrack.routeData.courseid),this.initialiseCourse(a)):this.initialiseCourse(a))},initialiseCourse:function(a){var b;this.gpstrack.routeData.eventid=rg2.events.getKartatEventID(),this.gpstrack.routeData.courseid=a,b=rg2.courses.getCourseDetails(a),this.isScoreCourse=b.isScoreCourse,this.isScoreCourse||(rg2.courses.putOnDisplay(a),this.gpstrack.routeData.coursename=b.name,this.controlx=b.x,this.controly=b.y,this.gpstrack.routeData.x.length=0,this.gpstrack.routeData.y.length=0,this.gpstrack.routeData.x[0]=this.controlx[0],this.gpstrack.routeData.y[0]=this.controly[0],this.gpstrack.routeData.controlx=this.controlx,this.gpstrack.routeData.controly=this.controly,this.nextControl=1),rg2.results.createNameDropdown(a),$("#rg2-name-select").prop("disabled",!1),$("#btn-undo-gps-adjust").button("disable"),rg2.redraw(!1)},doDrawingReset:function(){$("#rg2-drawing-reset-dialog").dialog("destroy"),rg2.courses.removeFromDisplay(this.gpstrack.routeData.courseid),null!==this.gpstrack.routeData.resultid&&rg2.results.putScoreCourseOnDisplay(this.gpstrack.routeData.resultid,!1),this.pendingCourseid=null,this.initialiseDrawing()},doCancelDrawingReset:function(){$("#rg2-drawing-reset-dialog").dialog("destroy")},confirmCourseChange:function(){var a;a={},a.selector="<div id='rg2-course-change-dialog'>The route you have started to draw will be discarded. Are you sure you want to change the course?</div>",a.title="Confirm course change",a.classes="rg2-confirm-change-course",a.doText="Change course",a.onDo=this.doChangeCourse.bind(this),a.onCancel=this.doCancelChangeCourse.bind(this),rg2.utils.createModalDialog(a)},resetDrawing:function(){var a;a={},a.selector="<div id='rg2-drawing-reset-dialog'>All information you have entered will be removed. Are you sure you want to reset?</div>",a.title="Confirm reset",a.classes="rg2-confirm-drawing-reset",a.doText="Reset",a.onDo=this.doDrawingReset.bind(this),a.onCancel=this.doCancelDrawingReset.bind(this),rg2.utils.createModalDialog(a)},doChangeCourse:function(){$("#rg2-course-change-dialog").dialog("destroy"),rg2.courses.removeFromDisplay(this.gpstrack.routeData.courseid),null!==this.gpstrack.routeData.resultid&&rg2.results.putScoreCourseOnDisplay(this.gpstrack.routeData.resultid,!1),this.doDrawingReset(),this.initialiseCourse(this.pendingCourseid)},doCancelChangeCourse:function(){$("#rg2-course-select").val(this.gpstrack.routeData.courseid),this.pendingCourseid=null,$("#rg2-course-change-dialog").dialog("destroy")},showCourseInProgress:function(){null!==this.gpstrack.routeData.courseid&&(this.isScoreCourse?rg2.results.putScoreCourseOnDisplay(this.gpstrack.routeData.resultid,!0):rg2.courses.putOnDisplay(this.gpstrack.routeData.courseid))},setName:function(a){var b,c;isNaN(a)||(b=rg2.results.getFullResult(a),b.hasValidTrack&&(c=rg2.t("If you draw a new route it will overwrite the old route for this runner.")+" "+rg2.t("GPS routes are saved separately and will not be overwritten."),rg2.utils.showWarningDialog(rg2.t("Route already drawn"),c)),null!==this.gpstrack.routeData.resultid&&rg2.results.putScoreCourseOnDisplay(this.gpstrack.routeData.resultid,!1),this.gpstrack.routeData.resultid=b.resultid,this.gpstrack.routeData.name=b.name,this.gpstrack.routeData.splits=b.splits,this.isScoreCourse&&(rg2.results.putScoreCourseOnDisplay(b.resultid,!0),this.controlx=b.scorex,this.controly=b.scorey,this.gpstrack.routeData.x.length=0,this.gpstrack.routeData.y.length=0,this.gpstrack.routeData.x[0]=this.controlx[0],this.gpstrack.routeData.y[0]=this.controly[0],this.nextControl=1,rg2.redraw(!1)),this.startDrawing())},setNameAndTime:function(){var a,b;b=$("#rg2-name-entry").val(),b?$("#rg2-name").addClass("valid"):$("#rg2-name").removeClass("valid"),a=$("#rg2-time-entry").val(),a.match(/\d+[:.][0-5]\d$/)?$("#rg2-time").addClass("valid"):($("#rg2-time").removeClass("valid"),a=null),b&&a&&(a=a.replace(".",":"),this.gpstrack.routeData.name=b,this.gpstrack.routeData.resultid=0,this.gpstrack.routeData.totaltime=a,this.gpstrack.routeData.startsecs=0,this.gpstrack.routeData.time[0]=rg2.utils.getSecsFromHHMMSS(a),this.gpstrack.routeData.totalsecs=rg2.utils.getSecsFromHHMMSS(a),this.startDrawing())},startDrawing:function(){$("#btn-three-seconds").button("enable"),$("#rg2-load-gps-file").button("enable")},addNewPoint:function(a,b){this.closeEnough(a,b)?(this.addRouteDataPoint(this.controlx[this.nextControl],this.controly[this.nextControl]),this.nextControl+=1,this.nextControl===this.controlx.length&&$("#btn-save-route").button("enable")):this.addRouteDataPoint(Math.round(a),Math.round(b)),$("#btn-undo").button("enable"),rg2.redraw(!1)},addRouteDataPoint:function(a,b){this.gpstrack.routeData.x.push(a),this.gpstrack.routeData.y.push(b)},undoGPSAdjust:function(){var a;a=this.gpstrack,a.baseX=a.savedBaseX.slice(0),a.baseY=a.savedBaseY.slice(0),a.routeData.x=a.savedBaseX.slice(0),a.routeData.y=a.savedBaseY.slice(0),a.handles.undo(),$("#btn-undo-gps-adjust").button("disable"),rg2.redraw(!1)},undoLastPoint:function(){var a=this.gpstrack.routeData.x.length;a>1&&(this.controlx[this.nextControl-1]===this.gpstrack.routeData.x[a-1]&&this.controly[this.nextControl-1]===this.gpstrack.routeData.y[a-1]&&(this.nextControl===this.controlx.length&&$("#btn-save-route").button("disable"),this.nextControl>1&&(this.nextControl-=1)),this.gpstrack.routeData.x.pop(),this.gpstrack.routeData.y.pop()),$("#btn-undo").button(this.gpstrack.routeData.x.length>1?"enable":"disable"),rg2.redraw(!1)},saveGPSRoute:function(){var a,b,c,d,e;for(c=this.gpstrack.routeData.time[this.gpstrack.routeData.time.length-1]-this.gpstrack.routeData.time[0],this.gpstrack.routeData.totaltime=rg2.utils.formatSecsAsMMSS(c),d=new Date,e=60*d.getTimezoneOffset(),this.gpstrack.routeData.startsecs=this.gpstrack.routeData.time[0]-e,b=this.gpstrack.routeData.x.length,a=0;b>a;a+=1)this.gpstrack.routeData.x[a]=Math.round(this.gpstrack.routeData.x[a]),this.gpstrack.routeData.y[a]=Math.round(this.gpstrack.routeData.y[a]),this.gpstrack.routeData.time[a]-=this.gpstrack.routeData.startsecs;for(this.gpstrack.routeData.resultid+=rg2.config.GPS_RESULT_OFFSET;rg2.results.resultIDExists(this.gpstrack.routeData.resultid);)this.gpstrack.routeData.resultid+=rg2.config.GPS_RESULT_OFFSET,this.gpstrack.routeData.name+="*";this.gpstrack.routeData.comments=$("#rg2-new-comments").val(),$("#btn-undo-gps-adjust").button("disable"),this.postRoute()},saveRoute:function(){this.gpstrack.routeData.comments=$("#rg2-new-comments").val(),this.gpstrack.routeData.controlx=this.controlx,this.gpstrack.routeData.controly=this.controly,this.gpstrack.routeData.controlx.splice(0,1),this.gpstrack.routeData.controly.splice(0,1),this.postRoute()},postRoute:function(){var a,b,c;a=rg2Config.json_url+"?type=addroute&id="+this.gpstrack.routeData.eventid,b=JSON.stringify(this.gpstrack.routeData),c=this,$.ajax({data:b,type:"POST",url:a,dataType:"json",success:function(a){a.ok?c.routeSaved(a.status_msg):rg2.utils.showWarningDialog(c.gpstrack.routeData.name,rg2.t("Your route was not saved. Please try again"))},error:function(){rg2.utils.showWarningDialog(c.gpstrack.routeData.name,rg2.t("Your route was not saved. Please try again"))}})},routeSaved:function(){rg2.utils.showWarningDialog(this.gpstrack.routeData.name,rg2.t("Your route has been saved")+"."),rg2.loadEvent(rg2.events.getActiveEventID())},waitThreeSeconds:function(){this.addRouteDataPoint(this.gpstrack.routeData.x[this.gpstrack.routeData.x.length-1],this.gpstrack.routeData.y[this.gpstrack.routeData.y.length-1]),rg2.redraw(!1)},closeEnough:function(a,b){var c;return c=rg2.options.snap?8:2,Math.abs(a-this.controlx[this.nextControl])<c&&Math.abs(b-this.controly[this.nextControl])<c?!0:!1},adjustTrack:function(a,b,c){var d,e,f,g;if($("#btn-move-all").prop("checked")||c===rg2.config.RIGHT_CLICK)rg2.ctx.translate(b.x-a.x,b.y-a.y);else if(d=this.gpstrack,d.handles.handlesLocked()>0)if(1===d.handles.handlesLocked())this.scaleRotateAroundSingleLockedPoint(a,b,d.handles.getSingleLockedHandle(),d.handles.getStartHandle().time,d.handles.getFinishHandle().time);else{if(e=d.handles.getHandleClicked(a),void 0===e)return;if(e.locked)return;f=d.handles.getEarliestLockedHandle(),g=d.handles.getLatestLockedHandle(),f.time>=e.time?this.scaleRotateAroundSingleLockedPoint(a,b,f,d.handles.getStartHandle().time,f.time):g.time<e.time?this.scaleRotateAroundSingleLockedPoint(a,b,g,g.time,d.handles.getFinishHandle().time):this.scaleRotateBetweenTwoLockedPoints(a,b,e)}else this.dragTrack(b.x-a.x,b.y-a.y)},scaleRotateBetweenTwoLockedPoints:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;if(p=this.gpstrack,e=p.handles.getPreviousLockedHandle(c),f=p.handles.getNextLockedHandle(c),i=rg2.utils.getAngle(e.basex,e.basey,f.basex,f.basey),h=2*Math.PI-i,n=rg2.utils.rotatePoint(a.x-e.basex,a.y-e.basey,h),o=rg2.utils.rotatePoint(b.x-e.basex,b.y-e.basey,h),j=(o.x-n.x)/n.y,g=o.y/n.y,isFinite(j)&&isFinite(g)){for(d=e.time+1;d<f.time;d+=1)m=rg2.utils.rotatePoint(p.baseX[d]-e.basex,p.baseY[d]-e.basey,h),k=m.x,l=m.y,m=rg2.utils.rotatePoint(k+l*j,l*g,i),p.routeData.x[d]=m.x+e.basex,p.routeData.y[d]=m.y+e.basey;p.handles.scaleAndRotateBetweenLockedPoints(e,j,g,h,i,e.time,f.time)}},scaleRotateAroundSingleLockedPoint:function(a,b,c,d,e){var f,g,h,i;for(g=rg2.utils.getDistanceBetweenPoints(b.x,b.y,c.basex,c.basey)/rg2.utils.getDistanceBetweenPoints(a.x,a.y,c.basex,c.basey),h=rg2.utils.getAngle(b.x,b.y,c.basex,c.basey)-rg2.utils.getAngle(a.x,a.y,c.basex,c.basey),f=d;e>=f;f+=1)i=rg2.utils.rotatePoint(this.gpstrack.baseX[f]-c.basex,this.gpstrack.baseY[f]-c.basey,h),this.gpstrack.routeData.x[f]=i.x*g+c.basex,this.gpstrack.routeData.y[f]=i.y*g+c.basey;this.gpstrack.handles.scaleAndRotate(c,g,h,d,e)},dragTrack:function(a,b){var c,d;for(d=this.gpstrack,c=0;c<d.baseX.length;c+=1)d.routeData.x[c]=d.baseX[c]+a,d.routeData.y[c]=d.baseY[c]+b;d.handles.dragHandles(a,b)},drawNewTrack:function(){var a;a=rg2.getOverprintDetails(),rg2.ctx.lineWidth=a.overprintWidth,rg2.ctx.strokeStyle=rg2.config.RED,rg2.ctx.fillStyle=rg2.config.RED_30,this.nextControl>0&&!this.gpstrack.fileLoaded&&(rg2.ctx.beginPath(),this.nextControl<this.controlx.length-1?this.drawCircle(a.controlRadius):(this.drawCircle(a.finishInnerRadius),rg2.ctx.stroke(),rg2.ctx.beginPath(),this.drawCircle(a.finishOuterRadius)),rg2.ctx.fillRect(this.controlx[this.nextControl]-1,this.controly[this.nextControl]-1,3,3),rg2.ctx.stroke()),rg2.ctx.strokeStyle=this.trackColor,rg2.ctx.fillStyle=this.trackColour,rg2.ctx.font="10pt Arial",rg2.ctx.textAlign="left",rg2.ctx.globalAlpha=.6,this.drawRoute(),this.gpstrack.handles.drawHandles()},drawCircle:function(a){rg2.ctx.arc(this.controlx[this.nextControl],this.controly[this.nextControl],a,0,2*Math.PI,!1),rg2.ctx.fill()},drawRoute:function(){var a,b;if(this.gpstrack.routeData.x.length>1){for(rg2.ctx.beginPath(),rg2.ctx.moveTo(this.gpstrack.routeData.x[0],this.gpstrack.routeData.y[0]),b=this.gpstrack.routeData.x.length,a=1;b>a;a+=1)rg2.ctx.lineTo(this.gpstrack.routeData.x[a],this.gpstrack.routeData.y[a]);rg2.ctx.stroke()}}},rg2.Draw=a}(),function(){function a(a){switch(this.kartatid=a.id,this.mapid=a.mapid,this.format=a.format,this.name=a.name,this.date=a.date,this.club=a.club,this.rawtype=a.type,a.type){case"I":this.type="International event";break;case"N":this.type="National event";break;case"R":this.type="Regional event";break;case"L":this.type="Local event";break;case"T":this.type="Training event";break;default:this.type="Unknown"}this.comment=a.comment,this.courses=0,this.setMapDetails(a)}a.prototype={Constructor:a,setMapDetails:function(a){this.mapfilename=void 0===a.suffix?this.mapid+".jpg":this.mapid+"."+a.suffix,this.worldfile=new rg2.Worldfile(a)}},rg2.Event=a}(),function(){function a(){this.events=[],this.activeEventID=null}a.prototype={Constructor:a,deleteAllEvents:function(){this.events.length=0,this.activeEventID=null},addEvent:function(a){this.events.push(a)},getEventInfo:function(a){var b,c;return a=a||this.getKartatEventID(),b=this.getEventIDForKartatID(a),c=this.events[b],c.id=b,c.controls=rg2.controls.getControlCount(),c},getKartatEventID:function(){return this.events[this.activeEventID].kartatid},getActiveMapID:function(){return this.events[this.activeEventID].mapid},getMapFileName:function(){return this.events[this.activeEventID].mapfilename},setActiveEventID:function(a){this.activeEventID=parseInt(a,10)},getActiveEventID:function(){return this.activeEventID},getEventIDForKartatID:function(a){var b;for(b=0;b<this.events.length;b+=1)if(this.events[b].kartatid===a)return b;return void 0},getActiveEventDate:function(){return null!==this.activeEventID?this.events[this.activeEventID].date:""},getActiveEventName:function(){return null!==this.activeEventID?this.events[this.activeEventID].name:"Routegadget 2"},getEventEditDropdown:function(a){var b;for(a.options.add(rg2.utils.generateOption(null,"No event selected")),b=this.events.length-1;b>-1;b-=1)a.options.add(rg2.utils.generateOption(this.events[b].kartatid,this.events[b].kartatid+": "+this.events[b].date+": "+rg2.he.decode(this.events[b].name)));return a},isScoreEvent:function(){return this.events[this.activeEventID].format===rg2.config.SCORE_EVENT},hasResults:function(){return null!==this.activeEventID?this.events[this.activeEventID].format!==rg2.config.EVENT_WITHOUT_RESULTS:!0},mapIsGeoreferenced:function(){return null===this.activeEventID?!1:this.events[this.activeEventID].worldfile.valid},getMetresPerPixel:function(){var a,b,c,d,e,f,g;return null!==this.activeEventID&&this.mapIsGeoreferenced()?(e=rg2.getMapSize(),f=rg2.utils.getDistanceBetweenPoints(0,0,e.width,e.height),g=this.events[this.activeEventID].worldfile,c=g.C,a=g.F,d=g.A*e.width+g.B*e.height+g.C,b=g.D*e.width+g.E*e.height+g.F,{metresPerPixel:rg2.utils.getLatLonDistance(a,c,b,d)/f,units:"metres"}):{metresPerPixel:1,units:"pixels"}},getWorldFile:function(){return this.events[this.activeEventID].worldfile},formatEventsAsMenu:function(){var a,b,c;for(b="",c=this.events.length-1;c>=0;c-=1)a=rg2.t(this.events[c].type)+": "+this.events[c].date,this.events[c].worldfile.valid&&(a+=": "+rg2.t("Map is georeferenced")),""!==this.events[c].comment&&(a+=": "+this.events[c].comment),b+='<li title="'+a+'" id='+c+"><a href='#"+this.events[c].kartatid+"'>",""!==this.events[c].comment&&(b+="<i class='fa fa-info-circle event-info-icon' id='info-"+c+"'></i>"),this.events[c].worldfile.valid&&(b+="<i class='fa fa-globe event-info-icon' id='info-"+c+"'>&nbsp</i>"),b+=this.events[c].date+": "+this.events[c].name+"</a></li>";return b}},rg2.Events=a}(),function(){function a(){this.lat=[],this.lon=[],this.startOffset=0,this.baseX=[],this.baseY=[],this.handles=new rg2.Handles,this.savedBaseX=[],this.savedBaseY=[],this.fileLoaded=!1,this.fileName="",this.fileType="",this.routeData=new rg2.RouteData,this.xml="",this.autofitOffset=null}a.prototype={Constructor:a,initialiseGPS:function(){this.lat.length=0,this.lon.length=0,this.startOffset=0,this.baseX.length=0,this.baseY.length=0,this.handles.deleteAllHandles(),this.savedBaseX.length=0,this.savedBaseY.length=0,this.fileLoaded=!1,this.routeData.x.length=0,this.routeData.y.length=0,this.routeData.time.length=0},uploadGPS:function(a){var b,c;b=new FileReader,this.fileName=a.target.files[0].name,b.onerror=function(){rg2.utils.showWarningDialog("GPS file problem","Unable to open GPS file.")},c=this,b.onload=function(a){try{if(c.fileType=c.fileName.slice(-3).toLowerCase(),"gpx"!==c.fileType&&"tcx"!==c.fileType)return void rg2.utils.showWarningDialog("GPS file problem","File type not recognised. Please check you have selected the correct file.");$("#rg2-load-gps-file").button("disable"),c.xml=$.parseXML(a.target.result),c.processGPSFile()}catch(b){return void rg2.utils.showWarningDialog("GPS file problem","File is not valid XML. Please check you have selected the correct file.")}},b.readAsText(a.target.files[0])},processGPSFile:function(){this.initialiseGPS(),"gpx"===this.fileType?this.processGPX():this.processTCX(),this.processGPSTrack()},processGPX:function(){var a,b,c,d;for(a=this.xml.getElementsByTagName("trkseg"),c=0;c<a.length;c+=1)for(b=a[c].getElementsByTagName("trkpt"),this.startOffset=this.getStartOffset(b[0].getElementsByTagName("time")[0].textContent),d=0;d<b.length;d+=1)this.lat.push(b[d].getAttribute("lat")),this.lon.push(b[d].getAttribute("lon")),this.routeData.time.push(this.getSecsFromTrackpoint(b[d].getElementsByTagName("time")[0].textContent))},processTCX:function(){var a,b,c,d,e;for(a=this.xml.getElementsByTagName("Track"),c=0;c<a.length;c+=1)for(b=a[c].getElementsByTagName("Trackpoint"),this.startOffset=this.getStartOffset(b[0].getElementsByTagName("Time")[0].textContent),d=0;d<b.length;d+=1)b[d].getElementsByTagName("Position").length>0&&(e=b[d].getElementsByTagName("Position"),this.lat.push(e[0].getElementsByTagName("LatitudeDegrees")[0].textContent),this.lon.push(e[0].getElementsByTagName("LongitudeDegrees")[0].textContent),this.routeData.time.push(this.getSecsFromTrackpoint(b[d].getElementsByTagName("Time")[0].textContent)))},getStartOffset:function(a){var b;return b=parseInt(Date.parse(a.substr(0,11)+"00:00:00Z")/1e3,10),isNaN(b)?0:b},getSecsFromTrackpoint:function(a){var b;return b=parseInt(Date.parse(a)/1e3,10),isNaN(b)?0:b-this.startOffset},processGPSTrack:function(){rg2.events.mapIsGeoreferenced()?(this.applyWorldFile(),this.trackMatchesMapCoordinates()?$("#btn-move-all").prop("checked",!0):(rg2.utils.showWarningDialog("GPS file problem","Your GPS file does not match the map co-ordinates. Please check you have selected the correct file."),this.fitTrackInsideCourse())):this.fitTrackInsideCourse(),this.lat.length=0,this.lon.length=0,this.expandToOneSecondInterval(),this.baseX=this.routeData.x.slice(0),this.baseY=this.routeData.y.slice(0),this.addStartAndFinishHandles(),this.fileLoaded=!0,this.routeData.splits.length>0&&$("#btn-autofit-gps").button("enable"),$("#btn-save-gps-route").button("enable"),rg2.redraw(!1)},adjustOffset:function(a){this.autofitOffset=a,this.processGPSFile(),this.autofitTrack()},expandToOneSecondInterval:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(b=[],c=[],d=[],l=this.routeData,e=l.time[0],g=l.x[0],h=l.y[0],b[0]=g,c[0]=h,d[0]=l.time[0],f=d[0]+1,a=1;a<l.x.length;a+=1)if(i=l.time[a]-e,i>0){for(j=(l.x[a]-g)/i,k=(l.y[a]-h)/i,m=1;i>=m;)b.push(g+j*m),c.push(h+k*m),d.push(f),f+=1,m+=1;g=l.x[a],h=l.y[a],e=f-1}this.routeData.x=b.slice(0),this.routeData.y=c.slice(0),this.routeData.time=d.slice(0)},autofitTrack:function(){var a,b;for($("#btn-move-all").prop("checked",!1),this.handles.deleteAllHandles(),this.addStartAndFinishHandles(),null===this.autofitOffset&&(this.autofitOffset=this.getOffset(),rg2.ui.setAutofitSpinner(this.autofitOffset)),a=1;a<this.routeData.splits.length-1;a+=1)b=this.routeData.splits[a]+this.autofitOffset,b<this.baseX.length&&b>=0&&(this.handles.addHandle(this.routeData.x[b],this.routeData.y[b],b),rg2.drawing.adjustTrack({x:this.routeData.x[b],y:this.routeData.y[b]},{x:this.routeData.controlx[a],y:this.routeData.controly[a]}),this.handles.lockHandleByTime(b),this.baseX=this.routeData.x.slice(0),this.baseY=this.routeData.y.slice(0),this.handles.rebaselineXY());$("#btn-autofit-gps").button("disable"),$("#btn-undo-gps-adjust").button("disable"),rg2.redraw(!1)},getOffset:function(){var a,b,c,d,e,f,g,h,i;for(d=this.getSpeedAverage(),e=[],g=10,a=0;2*g>=a;a+=1)e[a]=0;for(a=1;a<this.routeData.splits.length-1;a+=1)if(c=this.routeData.splits[a],c>=g&&c+g<d.length)for(f=d.slice(c-g,c+g+1),b=0;2*g>=b;b+=1)e[b]+=f[b];for(h=0,a=1;a<e.length;a+=1)e[a]<e[h]&&(h=a);return i=h-g,console.log("Offset = "+i),i},getSpeedAverage:function(){var a,b,c;for(b=[],c=[],b[0]=0,a=1;a<this.routeData.x.length;a+=1)b[a]=rg2.utils.getDistanceBetweenPoints(this.routeData.x[a],this.routeData.y[a],this.routeData.x[a-1],this.routeData.y[a-1]);for(a=1;a<this.routeData.x.length-1;a+=1)c[a]=(b[a-1]+b[a]+b[a+1])/3;return c[0]=b[0],c[this.routeData.x.length-1]=b[this.routeData.x.length-1],c},trackMatchesMapCoordinates:function(){var a,b,c,d,e;return a=Math.min.apply(Math,this.routeData.x),b=Math.max.apply(Math,this.routeData.x),c=Math.min.apply(Math,this.routeData.y),d=Math.max.apply(Math,this.routeData.y),e=rg2.getMapSize(),b>0&&a<e.width&&c<e.height&&d>0},applyWorldFile:function(){var a,b;for(b=rg2.events.getWorldFile(),a=0;a<this.lat.length;a+=1)this.routeData.x[a]=Math.round((b.E*this.lon[a]-b.B*this.lat[a]+b.xCorrection)/b.AEDB),this.routeData.y[a]=Math.round((-1*b.D*this.lon[a]+b.A*this.lat[a]+b.yCorrection)/b.AEDB)},addStartAndFinishHandles:function(){this.handles.addHandle(this.baseX[0],this.baseY[0],0),this.handles.addHandle(this.baseX[this.baseX.length-1],this.baseY[this.baseY.length-1],this.baseY.length-1)},fitTrackInsideCourse:function(){var a,b,c,d,e,f,g;for(b=this.getLatLonInfo(),c=this.getControlInfo(),d=(c.maxX-c.minX)/(b.maxLon-b.minLon),e=(c.maxY-c.minY)/(b.maxLat-b.minLat),d>e?e=d*b.latCorrection/b.lonCorrection:d=e*b.lonCorrection/b.latCorrection,this.routeData.x[0]=(this.lon[0]-b.minLon)*d+c.minX,this.routeData.y[0]=-1*(this.lat[0]-b.maxLat)*e+c.minY,f=c.minX-(this.routeData.x[0]-c.x[0]),g=c.minY-(this.routeData.y[0]-c.y[0]),a=0;a<this.lat.length;a+=1)this.routeData.x[a]=(this.lon[a]-b.minLon)*d+f,this.routeData.y[a]=-1*(this.lat[a]-b.maxLat)*e+g},getLatLonInfo:function(){var a;return a={},a.maxLat=Math.max.apply(Math,this.lat),a.maxLon=Math.max.apply(Math,this.lon),a.minLat=Math.min.apply(Math,this.lat),a.minLon=Math.min.apply(Math,this.lon),a.lonCorrection=rg2.utils.getLatLonDistance(a.minLat,a.maxLon,a.minLat,a.minLon)/(a.maxLon-a.minLon),a.latCorrection=rg2.utils.getLatLonDistance(a.minLat,a.minLon,a.maxLat,a.minLon)/(a.maxLat-a.minLat),a},getControlInfo:function(){var a,b;return a=rg2.drawing.getControlXY(),a.minX=Math.min.apply(Math,a.x),a.maxX=Math.max.apply(Math,a.x),a.minY=Math.min.apply(Math,a.y),a.maxY=Math.max.apply(Math,a.y),(a.maxY-a.minY<100||a.maxX-a.minX<100)&&(a.minX=0,a.minY=0,b=rg2.getMapSize(),a.maxX=b.width,a.maxY=b.height),a}},rg2.GPSTrack=a}(),function(){function a(a,b,c,d){this.x=a,this.y=b,this.basex=a,this.basey=b,this.undox=a,this.undoy=b,this.locked=!1,this.time=c,this.index=d}function b(){this.handles=[]}b.prototype={Constructor:b,addHandle:function(b,c,d){this.handles.push(new a(b,c,d,this.handles.length)),this.handles.sort(function(a,b){return a.time-b.time}),this.renumberHandles()},deleteHandle:function(a){0!==a&&a!==this.handles.length-1&&(this.handles.splice(a,1),this.renumberHandles())},renumberHandles:function(){var a;for(a=0;a<this.handles.length;a+=1)this.handles[a].index=a},lockHandle:function(a){this.handles[a].locked=!0},lockHandleByTime:function(a){var b;for(b=0;b<this.handles.length;b+=1)this.handles[b].time===a&&(this.handles[b].locked=!0)},unlockAllHandles:function(){var a;for(a=0;a<this.handles.length;a+=1)this.handles[a].locked=!1},unlockHandle:function(a){this.handles[a].locked=!1},handlesLocked:function(){var a,b;for(b=0,a=0;a<this.handles.length;a+=1)this.handles[a].locked&&(b+=1);return b},deleteAllHandles:function(){this.handles.length=0},rebaselineXY:function(){this.copyHandleFields("","base")},saveForUndo:function(){this.copyHandleFields("base","undo")},undo:function(){this.copyHandleFields("undo","base"),this.copyHandleFields("undo","")},copyHandleFields:function(a,b){var c;for(c=0;c<this.handles.length;c+=1)this.handles[c][b+"x"]=this.handles[c][a+"x"],this.handles[c][b+"y"]=this.handles[c][a+"y"]},getStartHandle:function(){return this.handles[0]},getFinishHandle:function(){return this.handles[this.handles.length-1]},getHandleClicked:function(a){var b,c;for(b=0;b<this.handles.length;b+=1)if(c=rg2.utils.getDistanceBetweenPoints(a.x,a.y,this.handles[b].basex,this.handles[b].basey),c<=rg2.config.HANDLE_DOT_RADIUS)return this.handles[b];return void 0},getEarliestLockedHandle:function(){var a;for(a=0;a<this.handles.length;a+=1)if(this.handles[a].locked)return this.handles[a]},getLatestLockedHandle:function(){var a;for(a=this.handles.length-1;a>0;a-=1)if(this.handles[a].locked)return this.handles[a]},getPreviousLockedHandle:function(a){var b;for(b=a.index-1;b>=0;b-=1)if(this.handles[b].locked)return this.handles[b]},getNextLockedHandle:function(a){var b;for(b=a.index+1;b<this.handles.length;b+=1)if(this.handles[b].locked)return this.handles[b]},getSingleLockedHandle:function(){return this.getEarliestLockedHandle()},dragHandles:function(a,b){var c;for(c=0;c<this.handles.length;c+=1)this.handles[c].x=this.handles[c].basex+a,this.handles[c].y=this.handles[c].basey+b},drawHandles:function(){var a;for(a=0;a<this.handles.length;a+=1)rg2.ctx.lineWidth=1,this.handles[a].locked===!0?(rg2.ctx.fillStyle=rg2.config.RED_30,rg2.ctx.strokeStyle=rg2.config.RED):(rg2.ctx.fillStyle=rg2.config.GREEN_30,rg2.ctx.strokeStyle=rg2.config.GREEN),rg2.ctx.beginPath(),rg2.ctx.arc(this.handles[a].x,this.handles[a].y,rg2.config.HANDLE_DOT_RADIUS,0,2*Math.PI,!1),rg2.ctx.fill(),rg2.ctx.stroke()},adjustThisHandle:function(a,b,c){return!a.locked&&a.time>=b&&a.time<=c?!0:!1},scaleAndRotate:function(a,b,c,d,e){var f,g;for(f=0;f<this.handles.length;f+=1)this.adjustThisHandle(this.handles[f],d,e)&&(g=rg2.utils.rotatePoint(this.handles[f].basex-a.basex,this.handles[f].basey-a.basey,c),this.handles[f].x=g.x*b+a.basex,this.handles[f].y=g.y*b+a.basey)},scaleAndRotateBetweenLockedPoints:function(a,b,c,d,e,f,g){var h,i,j;for(h=0;h<this.handles.length;h+=1)this.adjustThisHandle(this.handles[h],f,g)&&(i=rg2.utils.rotatePoint(this.handles[h].basex-a.basex,this.handles[h].basey-a.basey,d),j=rg2.utils.rotatePoint(i.x+i.y*b,i.y*c,e),this.handles[h].x=j.x+a.basex,this.handles[h].y=j.y+a.basey)
}},rg2.Handles=b}(),function(){function a(a,b,c){this.description=a,this.name=b,this.params=c}function b(){this.georefsystems=[],this.georefsystems.push(new a("Not georeferenced","none","")),this.georefsystems.push(new a("GB National Grid","EPSG:27700","+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs")),this.georefsystems.push(new a("Google EPSG:900913","EPSG:900913","+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs")),void 0!==rg2Config.epsg_code?(this.georefsystems.push(new a(rg2Config.epsg_code,rg2Config.epsg_code.replace(" ",""),rg2Config.epsg_params)),this.defaultGeorefVal=rg2Config.epsg_code.replace(" ","")):this.defaultGeorefVal="EPSG:27700"}function c(a){void 0===a.A?(this.valid=!1,this.A=0,this.B=0,this.C=0,this.D=0,this.E=0,this.F=0):(this.A=parseFloat(a.A),this.B=parseFloat(a.B),this.C=parseFloat(a.C),this.D=parseFloat(a.D),this.E=parseFloat(a.E),this.F=parseFloat(a.F),this.valid=!0,this.AEDB=a.A*a.E-a.D*a.B,this.xCorrection=a.B*a.F-a.E*a.C,this.yCorrection=a.D*a.C-a.A*a.F)}function d(a){void 0!==a?(this.mapid=a.mapid,this.name=a.name,this.worldfile=new c(a),this.localworldfile=new c({A:a.localA,B:a.localB,C:a.localC,D:a.localD,E:a.localE,F:a.localF}),this.mapfilename=void 0===a.mapfilename?this.mapid+".jpg":a.mapfilename):(this.mapid=0,this.name="",this.worldfile=new c(0),this.localworldfile=new c(0)),this.xpx=[],this.ypx=[],this.lat=[],this.lon=[]}b.prototype={Constructor:b,getDefault:function(){return this.defaultGeorefVal},getDropdown:function(a){var b;for(b=0;b<this.georefsystems.length;b+=1)a.options.add(rg2.utils.generateOption(this.georefsystems[b].name,this.georefsystems[b].description));return a},getParams:function(a){var b,c;for(c="",b=0;b<this.georefsystems.length;b+=1)if(this.georefsystems[b].name===a)return this.georefsystems[b].params;return c}},c.prototype={Constructor:c,getX:function(a,b){return Math.round((this.E*a-this.B*b+this.xCorrection)/this.AEDB)},getY:function(a,b){return Math.round((-1*this.D*a+this.A*b+this.yCorrection)/this.AEDB)},getLon:function(a,b){return Math.round(this.A*a+this.B*b+this.C)},getLat:function(a,b){return Math.round(this.D*a+this.E*b+this.F)}},rg2.Georefs=b,rg2.Worldfile=c,rg2.Map=d}(),function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d;)d-=1,a=c[d],e[a]||(e[a]=b)}(),function(){function a(a,b,c,d,e){this.resultid=a.resultid,this.rawid=this.resultid%rg2.config.GPS_RESULT_OFFSET,this.isScoreEvent=b,this.name=rg2.he.decode(a.name),this.initials=this.getInitials(this.name),this.starttime=a.starttime,this.time=a.time,this.position=a.position,this.status=a.status,this.comments=a.comments?rg2.he.decode(a.comments):"",this.coursename=a.coursename,""===this.coursename&&(this.coursename=a.courseid),this.courseid=a.courseid,this.splits=a.splits,this.splits.splice(0,0,0),b&&(this.scorex=d,this.scorey=e,this.scorecodes=c),this.initialiseTrack(a)}a.prototype={Constructor:a,initialiseTrack:function(a){var b;this.cumulativeDistance=[],this.legpos=[],this.hasValidTrack=!1,this.displayTrack=!1,this.displayScoreCourse=!1,this.trackColour=rg2.colours.getNextColour(),this.trackx=[],this.tracky=[],this.speedColour=[],this.xysecs=[],this.resultid>=rg2.config.GPS_RESULT_OFFSET?(this.isGPSTrack=!0,b=rg2.results.getTimeAndSplitsForID(this.rawid),this.time=b.time,this.splits=b.splits,this.time===rg2.config.TIME_NOT_FOUND&&(this.time=a.time)):this.isGPSTrack=!1},putTrackOnDisplay:function(){this.hasValidTrack&&(this.displayTrack=!0)},removeTrackFromDisplay:function(){this.hasValidTrack&&(this.displayTrack=!1)},addTrack:function(a,b){var c,d;for(this.trackx=a.x.split(",").map(function(a){return parseInt(a,10)}),this.tracky=a.y.split(",").map(function(a){return parseInt(a,10)}),c=1;c<this.trackx.length;c+=1)this.trackx[c]=this.trackx[c-1]+this.trackx[c],this.tracky[c]=this.tracky[c-1]+this.tracky[c];d=this.isGPSTrack?this.expandGPSTrack():b===rg2.config.EVENT_WITHOUT_RESULTS?this.expandTrackWithNoSplits():this.expandNormalTrack(),d&&rg2.courses.incrementTracksCount(this.courseid)},drawTrack:function(a){var b,c,d,e,f;if(this.displayTrack){for(this.isGPSTrack&&a.showGPSSpeed&&0===this.speedColour.length&&this.setSpeedColours(),rg2.ctx.lineWidth=a.routeWidth,rg2.ctx.strokeStyle=this.trackColour,rg2.ctx.globalAlpha=rg2.options.routeIntensity,rg2.ctx.fillStyle=this.trackColour,rg2.ctx.font="10pt Arial",rg2.ctx.textAlign="left",rg2.ctx.beginPath(),rg2.ctx.moveTo(this.trackx[0],this.tracky[0]),d=this.trackx[0],e=this.tracky[0],f=0,c=this.trackx.length,b=1;c>b;b+=1)rg2.ctx.lineTo(this.trackx[b],this.tracky[b]),this.trackx[b]===d&&this.tracky[b]===e?f+=1:f>0&&((!this.isGPSTrack||this.isGPSTrack&&a.showThreeSeconds)&&rg2.ctx.fillText("+"+3*f,d+5,e+5),f=0),d=this.trackx[b],e=this.tracky[b],this.isGPSTrack&&a.showGPSSpeed&&(rg2.ctx.strokeStyle=this.speedColour[b],rg2.ctx.stroke(),rg2.ctx.beginPath(),rg2.ctx.moveTo(d,e));rg2.ctx.stroke()}},drawScoreCourse:function(){var a,b,c;if(this.displayScoreCourse&&this.scorex.length>1){for(c=rg2.getOverprintDetails(),rg2.ctx.globalAlpha=rg2.config.FULL_INTENSITY,a=rg2.utils.getAngle(this.scorex[0],this.scorey[0],this.scorex[1],this.scorey[1]),rg2.controls.drawStart(this.scorex[0],this.scorey[0],"",a,c),a=[],b=0;b<this.scorex.length-1;b+=1)a[b]=rg2.utils.getAngle(this.scorex[b],this.scorey[b],this.scorex[b+1],this.scorey[b+1]);for(rg2.courses.drawLinesBetweenControls({x:this.scorex,y:this.scorey},a,this.courseid,c),b=1;b<this.scorex.length-1;b+=1)rg2.controls.drawSingleControl(this.scorex[b],this.scorey[b],b,.25*Math.PI,c);rg2.controls.drawFinish(this.scorex[this.scorex.length-1],this.scorey[this.scorey.length-1],"",c)}},expandNormalTrack:function(){var a;return this.xysecs.length=0,this.cumulativeDistance.length=0,this.xysecs[0]=0,this.cumulativeDistance[0]=0,a={},this.isScoreEvent?(a.x=this.scorex,a.y=this.scorey):(a.x=rg2.courses.getCourseDetails(this.courseid).x,a.y=rg2.courses.getCourseDetails(this.courseid).y),this.calculateTrackTimes(a),this.isScoreEvent&&(this.hasValidTrack=!0),this.hasValidTrack},calculateTrackTimes:function(a){var b,c,d,e,f,g,h,i,j,k;for(b=1,c=a.x[b],d=a.y[b],e=0,f=this.trackx[0],g=this.tracky[0],i=0,j=0,k=0,h=1;h<this.trackx.length;h+=1)if(i=this.trackx[h],j=this.tracky[h],e+=rg2.utils.getDistanceBetweenPoints(i,j,f,g),this.cumulativeDistance[h]=Math.round(e),f=i,g=j,c===i&&d===j){if(this.xysecs[h]=this.splits[b],this.addInterpolatedTimes(k,h),k=h,b+=1,b===a.x.length){this.hasValidTrack=!0;break}c=a.x[b],d=a.y[b]}},expandTrackWithNoSplits:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(this.xysecs.length=0,this.cumulativeDistance.length=0,a=this.splits[1],b=0,this.xysecs[0]=0,this.cumulativeDistance[0]=0,c={},c.x=rg2.courses.getCourseDetails(this.courseid).x,c.y=rg2.courses.getCourseDetails(this.courseid).y,d=1,e=c.x[d],f=c.y[d],g=c.x[c.x.length-1],h=c.y[c.y.length-1],this.trackx.push(g),this.tracky.push(h),n=0,m=0,o=this.calculateTotalTrackLength(),j=0,k=0,l=!1,p=this.trackx[0],q=this.tracky[0],i=1;i<this.trackx.length;i+=1)if(j=this.trackx[i],k=this.tracky[i],(j!==this.trackx[0]||k!==this.tracky[0])&&(l=!0),n+=rg2.utils.getDistanceBetweenPoints(j,k,p,q),this.cumulativeDistance[i]=Math.round(n),p=j,q=k,e===j&&f===k&&l){if(b=parseInt(n/o*a,10),this.xysecs[i]=b,this.splits[d]=b,this.addInterpolatedTimes(m,i),m=i,d+=1,d===c.x.length){this.hasValidTrack=!0;break}e=c.x[d],f=c.y[d]}return this.hasValidTrack},calculateTotalTrackLength:function(){var a,b,c,d;for(d=0,b=this.trackx[0],c=this.tracky[0],a=1;a<this.trackx.length;a+=1)d+=rg2.utils.getDistanceBetweenPoints(this.trackx[a],this.tracky[a],b,c),b=this.trackx[a],c=this.tracky[a];return d},addInterpolatedTimes:function(a,b){var c,d,e,f,g;for(c=this.xysecs[a],d=this.xysecs[b]-c,e=this.cumulativeDistance[a],f=this.cumulativeDistance[b]-e,g=a;b>=g;g+=1)this.xysecs[g]=c+Math.round((this.cumulativeDistance[g]-e)*d/f)},expandGPSTrack:function(){var a,b,c,d,e,f;for(b=0,c=this.trackx[0],d=this.tracky[0],f=this.trackx.length,a=0;f>a;a+=1)this.xysecs[a]=3*a,e=rg2.utils.getDistanceBetweenPoints(this.trackx[a],this.tracky[a],c,d),b+=e,this.cumulativeDistance[a]=Math.round(b),c=this.trackx[a],d=this.tracky[a];return this.setSpeedColours.length=0,this.hasValidTrack=!0,this.hasValidTrack},setSpeedColours:function(){var a,b,c,d,e,f,g,h;for(b=this.trackx[0],c=this.tracky[0],e=0,f=0,h=this.trackx.length,a=0;h>a;a+=1)d=rg2.utils.getDistanceBetweenPoints(this.trackx[a],this.tracky[a],b,c),g=d+f,g>e&&(e=g),this.speedColour[a]=g,b=this.trackx[a],c=this.tracky[a],f=d;this.mapSpeedColours(e)},mapSpeedColours:function(a){var b,c,d,e;for(e=a/2,b=1;b<this.speedColour.length;b+=1)this.speedColour[b]>e?(c=Math.round(255*(this.speedColour[b]-e)/e),d=255):(d=Math.round(255*this.speedColour[b]/e),c=255),this.speedColour[b]="#",16>c&&(this.speedColour[b]+="0"),this.speedColour[b]+=c.toString(16),16>d&&(this.speedColour[b]+="0"),this.speedColour[b]+=d.toString(16)+"00"},getInitials:function(a){var b,c,d,e;if(null===a)return"??";for(a=a.trim().replace(/GPS/g,"*"),d=a.length,e="",c=!0,b=0;d>b;b+=1)c&&(e+=a.substr(b,1),c=!1)," "===a.charAt(b)&&(c=!0);return e}},rg2.Result=a}(),function(){function a(a,b){var c;return this.results=[],this.resultCourses=[],this.valid=!0,c=this.processResults(a,b),this.results=c.results,this.valid=c.valid,this.getCoursesFromResults(),{results:this.results,resultCourses:this.resultCourses,valid:this.valid}}a.prototype={Constructor:a,processResults:function(a,b){switch(b){case"CSV":return new rg2.ResultParserCSV(a.target.result);case"XML":return this.processResultsXML(a.target.result);default:return rg2.utils.showWarningDialog("File type error","Results file type is not recognised. Please select a valid file."),{results:[],valid:!1}}},getCoursesFromResults:function(){var a,b,c;for(a=0;a<this.results.length;a+=1){for(c=!1,b=0;b<this.resultCourses.length;b+=1)if(this.resultCourses[b].course===this.results[a].course){c=!0;break}c||this.resultCourses.push({course:this.results[a].course,courseid:rg2.config.DO_NOT_SAVE_COURSE})}},processResultsXML:function(a){var b,c,d;c="";try{if(b=$.parseXML(a),d=b.getElementsByTagName("ResultList"),0===d.length)return rg2.utils.showWarningDialog("XML file error","File is not a valid XML results file. ResultList element missing."),{results:[],valid:!1};c=rg2.utils.extractAttributeZero(b.getElementsByTagName("IOFVersion"),"version",""),""===c&&(c=rg2.utils.extractAttributeZero(b.getElementsByTagName("ResultList"),"iofVersion",""))}catch(e){return rg2.utils.showWarningDialog("XML file error","File is not a valid XML results file."),{results:[],valid:!1}}switch(c){case"2.0.3":return new rg2.ResultParserIOFV2(b);case"3.0":return new rg2.ResultParserIOFV3(b);default:return rg2.utils.showWarningDialog("XML file error","Invalid IOF file format. Version "+c+" not supported."),{results:[],valid:!1}}}},rg2.ResultParser=a}(),function(){function a(a){return this.results=[],this.CSVFormat={},this.separator="",this.valid=!0,this.processResultsCSV(a),{results:this.results,valid:this.valid}}a.prototype={Constructor:a,processResultsCSV:function(a){var b,c,d;b=a.split(/[\r\n|\n]+/),c=b[0].split(",").length-1,d=b[0].split(";").length-1,this.separator=c>d?",":";",2===b[0].split(this.separator).length?this.processSpklasseCSVResults(b):(this.getCSVFormat(b[0]),this.processCSVResults(b))},processCSVResults:function(a){var b,c;for(b=1;b<a.length;b+=1)c=a[b].split(this.separator),c.length>=this.CSVFormat.FIRST_SPLIT_IDX&&this.results.push(this.extractSingleCSVResult(c))},getPosition:function(a){var b;return b=parseInt(a[this.CSVFormat.POSITION_IDX],10),isNaN(b)&&(b=""),b},extractSingleCSVResult:function(a){var b,c;return b={},b.chipid=a[this.CSVFormat.CHIP_IDX],b.name=(a[this.CSVFormat.FIRST_NAME_IDX]+" "+a[this.CSVFormat.SURNAME_IDX]).trim().replace(/\"/g,""),b.dbid=(a[this.CSVFormat.DB_IDX]+"__"+b.name).replace(/\"/g,""),b.starttime=rg2.utils.getSecsFromHHMMSS(a[this.CSVFormat.START_TIME_IDX]),b.time=a[this.CSVFormat.TOTAL_TIME_IDX],b.position=this.getPosition(a),b.status=this.getSICSVStatus(a[this.CSVFormat.NC_IDX],a[this.CSVFormat.CLASSIFIER_IDX]),b.club=a[this.CSVFormat.CLUB_IDX].trim().replace(/\"/g,""),b.course=a[this.CSVFormat.COURSE_IDX],b.controls=parseInt(a[this.CSVFormat.NUM_CONTROLS_IDX],10),c=this.extractSISplits(a,b.controls),b.splits=c.splits,""!==b.splits&&(b.splits+=";"),b.splits+=rg2.utils.getSecsFromHHMMSS(b.time),b.codes=c.codes,b},extractSISplits:function(a,b){var c,d,e,f;for(f=this.CSVFormat.FIRST_SPLIT_IDX,e=this.CSVFormat.FIRST_CODE_IDX,d={},d.splits="",d.codes=[],c=0;b>c;c+=1)a[e]&&(c>0&&(d.splits+=";"),d.codes[c]=a[e],d.splits+=rg2.utils.getSecsFromHHMMSS(a[f])),f+=this.CSVFormat.STEP,e+=this.CSVFormat.STEP;return{splits:d.splits,codes:d.codes}},getCSVFormat:function(a){var b,c,d,e,f,g;for(b=["SI card","Database Id","Surname","First name","nc","Start","Time","Classifier","City","Short","Course","Course controls","Pl","Start punch","Control1","Punch1","Control2"],c=[],d=a.split(this.separator),e=0;e<b.length;e+=1){for(g=!1,f=0;f<d.length;f+=1){if(d[f]===b[e]){c[e]=f,g=!0;break}if("SI card"===b[e]&&("Chipno"===d[f]||"SIcard"===d[f]||"Database Id"===d[f])){c[e]=f,g=!0;break}if("nc"===b[e]&&"Classifier"===d[f]){c[e]=f,g=!0;break}if("City"===b[e]&&"Club"===d[f]){c[e]=f,g=!0;break}if("Pl"===b[e]&&"Place"===d[f]){c[e]=f,g=!0;break}}if(!g)break}g||(c=[1,2,3,4,8,9,11,12,15,18,39,42,43,44,46,47,2]),this.setCSVFormat(c)},setCSVFormat:function(a){this.CSVFormat.CHIP_IDX=a[0],this.CSVFormat.DB_IDX=a[1],this.CSVFormat.SURNAME_IDX=a[2],this.CSVFormat.FIRST_NAME_IDX=a[3],this.CSVFormat.NC_IDX=a[4],this.CSVFormat.START_TIME_IDX=a[5],this.CSVFormat.TOTAL_TIME_IDX=a[6],this.CSVFormat.CLASSIFIER_IDX=a[7],this.CSVFormat.CLUB_IDX=a[8],this.CSVFormat.CLASS_IDX=a[9],this.CSVFormat.COURSE_IDX=a[10],this.CSVFormat.NUM_CONTROLS_IDX=a[11],this.CSVFormat.POSITION_IDX=a[12],this.CSVFormat.START_PUNCH_IDX=a[13],this.CSVFormat.FIRST_CODE_IDX=a[14],this.CSVFormat.FIRST_SPLIT_IDX=a[15],this.CSVFormat.STEP=a[16]-a[14]},getSICSVStatus:function(a,b){return"0"===a||""===a||"N"===a?""===b||"0"===b?"ok":"nok":"nc"},processSpklasseCSVResults:function(a){var b,c,d,e,f=0,g=1;for(e=[],b="",c=0,d=0;d<a.length;d+=1)e=a[d].split(this.separator),2===e.length?(b=e[f],c=parseInt(e[g],10)):this.extractResult(e,b,c)},extractResult:function(a,b,c){var d,e,f=0,g=1,h=2,i=3;d={},d.chipid=0,d.name=(a[f]+" "+a[g]+" "+a[h]).trim(),d.dbid=d.chipid+"__"+d.name,d.starttime=rg2.utils.getSecsFromHHMM(a[i]),d.club=a[h],d.course=b,d.controls=c,e=this.extractSpklasseSplits(a),d.splits=e.splits,d.codes=e.codes,d.time=rg2.utils.formatSecsAsMMSS(e.totaltime),this.results.push(d)},extractSpklasseSplits:function(a){var b,c,d,e,f,g=4;for(c="",d=[],f=a.length-g,e=0,b=0;f>b;b+=1)b>0&&(c+=";"),d[b]="X",e+=rg2.utils.getSecsFromHHMMSS(a[b+g]),c+=e;return{splits:c,codes:d,totaltime:e}}},rg2.ResultParserCSV=a}(),function(){function a(a){return this.results=[],this.valid=!0,this.processIOFV2Results(a),{results:this.results,valid:this.valid}}a.prototype={Constructor:a,getDBID:function(a,b){return a=a.replace(/[\n\r]/g,"").trim(),a?a:b},getName:function(a){var b;return b=a.getElementsByTagName("Given")[0].textContent+" "+a.getElementsByTagName("Family")[0].textContent,b.replace(/[\n\r]/g,"").trim()},processIOFV2Results:function(a){var b,c,d,e,f,g,h;try{for(b=a.getElementsByTagName("ClassResult"),e=0;e<b.length;e+=1)for(h=b[e].getElementsByTagName("ClassShortName")[0].textContent,c=b[e].getElementsByTagName("PersonResult"),f=0;f<c.length&&(g={},g.course=h,g.name=this.getName(c[f]),g.dbid=this.getDBID(c[f].getElementsByTagName("PersonId")[0].textContent,g.name),g.club=rg2.utils.extractTextContentZero(c[f].getElementsByTagName("ShortName"),""),d=c[f].getElementsByTagName("Result"),this.extractIOFV2Results(d,g),"DidNotStart"!==g.status);f+=1)this.results.push(g)}catch(i){return this.valid=!1,void rg2.utils.showWarningDialog("XML parse error","Error processing XML file. Error is : "+i.message)}},getStartFinishTimeAsSecs:function(a){var b;return a.length>0?(b=a[0].getElementsByTagName("Clock")[0].textContent,rg2.utils.getSecsFromHHMMSS(b)):0},getPosition:function(a){return a.length>0?parseInt(a[0].textContent,10):""},getTime:function(a){return a.length>0?a[0].textContent.replace(/[\n\r]/g,""):""},extractIOFV2Results:function(a,b){var c,d,e;for(c=0;c<a.length;c+=1)b.status=rg2.utils.extractAttributeZero(a[c].getElementsByTagName("CompetitorStatus"),"value",""),b.position=this.getPosition(a[c].getElementsByTagName("ResultPosition")),b.chipid=rg2.utils.extractTextContentZero(a[c].getElementsByTagName("CCardId"),0),b.time=this.getTime(a[c].getElementsByTagName("Time")),b.starttime=this.getStartFinishTimeAsSecs(a[c].getElementsByTagName("StartTime")),b.splits="",b.codes=[],e=a[c].getElementsByTagName("SplitTime"),b.controls=e.length,this.extractIOFV2Splits(e,b),d=this.getStartFinishTimeAsSecs(a[c].getElementsByTagName("FinishTime")),b.splits+=Math.max(d-b.starttime,0)},extractIOFV2Splits:function(a,b){var c,d;for(c=0;c<a.length;c+=1)c>0&&(b.splits+=";"),d=a[c].getElementsByTagName("Time"),d.length>0?(b.splits+=rg2.utils.getSecsFromHHMMSS(d[0].textContent),b.codes[c]=rg2.utils.extractTextContentZero(a[c].getElementsByTagName("ControlCode"),"")):(b.splits+=0,b.codes[c]="");b.splits+=";"}},rg2.ResultParserIOFV2=a}(),function(){function a(a){return this.results=[],this.valid=!0,this.processIOFV3Results(a),{results:this.results,valid:this.valid}}a.prototype={Constructor:a,getID:function(a,b){var c;return a.length>0?(c=a[0].textContent,c.replace(/[\n\r]/g,""),c.trim()+"__"+b):this.results.length+"__"+b},getClub:function(a){return a.length>0?a[0].getElementsByTagName("Name")[0].textContent:""},processIOFV3Results:function(a){var b,c,d,e,f,g,h,i;try{for(b=a.getElementsByTagName("ClassResult"),e=0;e<b.length;e+=1)for(i=b[e].getElementsByTagName("Class"),h=i[0].getElementsByTagName("Name")[0].textContent,c=b[e].getElementsByTagName("PersonResult"),f=0;f<c.length;f+=1)g={},g.course=h,i=c[f].getElementsByTagName("Given")[0].textContent+" "+c[f].getElementsByTagName("Family")[0].textContent,g.name=i.replace(/[\n\r]/g,"").trim(),g.dbid=this.getID(c[f].getElementsByTagName("Id"),g.name),g.club=this.getClub(c[f].getElementsByTagName("Organisation")),d=c[f].getElementsByTagName("Result"),this.extractIOFV3Results(d,g),this.results.push(g)}catch(j){return this.valid=!1,void rg2.utils.showWarningDialog("XML parse error","Error processing XML file. Error is : "+j.message)}},getStartFinishTimeAsSeconds:function(a){return a.length>=19?rg2.utils.getSecsFromHHMMSS(a.substr(11,8)):0},getTotalTimeAsSeconds:function(a){return a.length>0?rg2.utils.formatSecsAsMMSS(parseInt(a[0].textContent,10)):0},extractIOFV3Results:function(a,b){var c,d,e;for(c=0;c<a.length;c+=1)b.chipid=rg2.utils.extractTextContentZero(a[c].getElementsByTagName("ControlCard"),0),b.position=rg2.utils.extractTextContentZero(a[c].getElementsByTagName("Position"),""),b.status=rg2.utils.extractTextContentZero(a[c].getElementsByTagName("Status"),""),b.time=this.getTotalTimeAsSeconds(a[c].getElementsByTagName("Time")),b.starttime=this.getStartFinishTimeAsSeconds(rg2.utils.extractTextContentZero(a[c].getElementsByTagName("StartTime"),0)),b.splits="",b.codes=[],e=a[c].getElementsByTagName("SplitTime"),b.controls=e.length,this.extractIOFV3Splits(e,b),d=this.getStartFinishTimeAsSeconds(rg2.utils.extractTextContentZero(a[c].getElementsByTagName("FinishTime"),0)),b.splits+=d-b.starttime},extractIOFV3Splits:function(a,b){var c;for(c=0;c<a.length;c+=1)c>0&&(b.splits+=";"),b.splits+=rg2.utils.extractTextContentZero(a[c].getElementsByTagName("Time"),0),b.codes[c]=rg2.utils.extractTextContentZero(a[c].getElementsByTagName("ControlCode"),"X"+c);b.splits+=";"}},rg2.ResultParserIOFV3=a}(),function(){function a(){this.results=[]}a.prototype={Constructor:a,addResults:function(a,b){var c,d,e,f,g,h,i;if(d=a.length,b)for(g=[],h=[],i=[],c=0;d>c;c+=1)f=a[c].variant,void 0===g[f]&&(g[f]=a[c].scorecodes,h[f]=a[c].scorex,i[f]=a[c].scorey);for(c=0;d>c;c+=1)b?(f=a[c].variant,e=new rg2.Result(a[c],b,g[f],h[f],i[f])):e=new rg2.Result(a[c],b),this.results.push(e);this.setScoreCourseInfo(),this.generateLegPositions()},setScoreCourseInfo:function(){var a,b;for(a=0;a<this.results.length;a+=1)this.results[a].resultid>=rg2.config.GPS_RESULT_OFFSET&&(b=this.getFullResultForRawID(this.results[a].rawid),void 0!==b&&void 0!==b.scorex&&(this.results[a].scorex=b.scorex,this.results[a].scorey=b.scorey,this.results[a].scorecodes=b.scorecodes))},getAllRunnersForCourse:function(a){var b,c;for(c=[],b=0;b<this.results.length;b+=1)this.results[b].courseid===a&&c.push(b);return c},generateScoreCourses:function(){var a,b,c,d,e,f,g,h;for(d=[],e=[],f=[],g=[],a=0;a<this.results.length;a+=1)if(c=this.results[a],c.resultid<rg2.config.GPS_RESULT_OFFSET)for(h=c.courseid,-1===d.indexOf(h)&&(d.push(h),e[h]=[],f[h]=[],g[h]=[]),b=0;b<c.scorecodes.length;b+=1)-1===e[h].indexOf(c.scorecodes[b])&&(e[h].push(c.scorecodes[b]),f[h].push(c.scorex[b]),g[h].push(c.scorey[b]));for(a=0;a<d.length;a+=1)h=d[a],rg2.courses.updateScoreCourse(h,e[h],f[h],g[h])},generateLegPositions:function(){var a,b,c,d,e;for(d=this.getCoursesAndControls(),e=[],a=0;a<d.courses.length;a+=1)for(c=1;c<d.controls[a];c+=1){for(e.length=0,b=0;b<this.results.length;b+=1)this.results[b].courseid===d.courses[a]&&e.push({time:this.results[b].splits[c],id:b});for(e.sort(this.sortTimes),b=0;b<e.length;b+=1)this.results[e[b].id].legpos[c]=b+1}},getCoursesAndControls:function(){var a,b,c;for(b=[],c=[],a=0;a<this.results.length;a+=1)-1===b.indexOf(this.results[a].courseid)&&(b.push(this.results[a].courseid),c.push(this.results[a].splits.length));return{courses:b,controls:c}},putScoreCourseOnDisplay:function(a,b){var c;for(c=0;c<this.results.length;c+=1)this.results[c].resultid===a&&(this.results[c].displayScoreCourse=b)},displayScoreCourse:function(a,b){this.results[a].displayScoreCourse=b},sortTimes:function(a,b){return a.time-b.time},countResultsByCourseID:function(a){var b,c,d;for(d=rg2.events.getEventInfo(),c=0,b=0;b<this.results.length;b+=1)this.results[b].courseid===a&&(this.results[b].resultid<rg2.config.GPS_RESULT_OFFSET||d.format===rg2.config.EVENT_WITHOUT_RESULTS)&&(c+=1);return c},getRoutesForEvent:function(){var a,b,c;for(b=[],c=0;c<this.results.length;c+=1)this.results[c].hasValidTrack&&(a={},a.id=c,a.resultid=this.results[c].resultid,a.name=this.results[c].name,a.time=this.results[c].time,a.coursename=this.results[c].coursename,b.push(a));return b},getResultsInfo:function(){var a,b,c;for(b={},b.results=0,b.drawnroutes=0,b.gpsroutes=0,b.secs=0,a=0;a<this.results.length;a+=1)c=this.results[a],c.resultid<rg2.config.GPS_RESULT_OFFSET&&(b.results+=1,c.time&&(b.secs+=c.splits[c.splits.length-1])),c.hasValidTrack&&(c.resultid<rg2.config.GPS_RESULT_OFFSET?b.drawnroutes+=1:b.gpsroutes+=1);return b.totalroutes=b.drawnroutes+b.gpsroutes,b.percent=b.results>0?(100*b.totalroutes/b.results).toFixed(1):0,b.time=this.formatTotalRunningTime(b.secs),b},formatTotalRunningTime:function(a){var b;return b=Math.floor(a/86400)+" days ",a-=86400*Math.floor(a/86400),b+=Math.floor(a/3600)+" hours ",a-=3600*Math.floor(a/3600),b+=Math.floor(a/60)+" minutes ",b+=a-60*Math.floor(a/60)+" seconds"},getFullResult:function(a){return this.results[a]},getFullResultForRawID:function(a){var b;for(b=0;b<this.results.length;b+=1)if(this.results[b].resultid===a)return this.results[b];return void 0},drawTracks:function(){var a,b;for(b=rg2.getReplayDetails(),a=0;a<this.results.length;a+=1)this.results[a].drawTrack(b),this.results[a].drawScoreCourse()},updateTrackNames:function(){var a;$("#rg2-track-names").empty(),a=this.getDisplayedTrackNames(),""!==a?$("#rg2-track-names").append(a).show():$("#rg2-track-names").hide()},getTracksOnDisplay:function(){var a,b;for(b=[],a=0;a<this.results.length;a+=1)this.results[a].displayTrack&&b.push(a);return b},putOneTrackOnDisplay:function(a){this.results[a].putTrackOnDisplay(),this.updateTrackNames()},removeOneTrackFromDisplay:function(a){this.results[a].removeTrackFromDisplay(),this.updateTrackNames()},updateTrackDisplay:function(a,b){var c;for(c=0;c<this.results.length;c+=1)(this.results[c].courseid===a||rg2.config.DISPLAY_ALL_COURSES===a)&&(b?this.results[c].putTrackOnDisplay():this.results[c].removeTrackFromDisplay());this.updateTrackNames()},getDisplayedTrackNames:function(){var a,b;for(b="",a=0;a<this.results.length;a+=1)this.results[a].displayTrack&&(b+="<p style='color:"+this.results[a].trackColour+";'>"+rg2.courses.getCourseName(this.results[a].courseid),b+=": "+this.results[a].name+"</p>");return b},resultIDExists:function(a){var b;for(b=0;b<this.results.length;b+=1)if(a===this.results[b].resultid)return!0;return!1},getTimeAndSplitsForID:function(a){var b;for(b=0;b<this.results.length;b+=1)if(a===this.results[b].resultid)return{time:this.results[b].time,splits:this.results[b].splits};return{time:rg2.config.TIME_NOT_FOUND,splits:[]}},addTracks:function(a){var b,c,d,e,f;for(f=rg2.events.getEventInfo(),e=a.length,c=0;e>c;c+=1)for(b=a[c].id,d=0;d<this.results.length;){if(b===this.results[d].resultid){this.results[d].addTrack(a[c],f.format);break}d+=1}},deleteAllResults:function(){this.results.length=0},sortByCourseIDThenResultID:function(a,b){return a.courseid>b.courseid?1:b.courseid>a.courseid?-1:a.rawid===b.rawid?a.resultid-b.resultid:a.rawid-b.rawid},formatResultListAsAccordion:function(){var a,b,c,d,e,f;if(0===this.results.length)return"<p>"+rg2.t("No results available")+"</p>";for(a="",c=!0,d=0,f=0,this.results.sort(this.sortByCourseIDThenResultID),e=0;e<this.results.length;e+=1)b=this.results[e],b.courseid!==d&&(c?c=!1:a+=this.getBottomRow(f,d)+"</table></div>",f=0,a+=this.getCourseHeader(b),d=b.courseid),a+="<tr><td>"+b.position+"</td>",a+=""!==b.comments?'<td><a href="#" title="'+b.comments+'">'+this.getNameHTML(b,e)+"</a></td><td>"+b.time+"</td>":"<td>"+this.getNameHTML(b,e)+"</td><td>"+b.time+"</td>",b.hasValidTrack?(f+=1,a+="<td><input class='showtrack showtrack-"+d+"' id="+e+" type=checkbox name=result></input></td>"):a+="<td></td>",a+="<td><input class='showreplay showreplay-"+d+"' id="+e+" type=checkbox name=replay></input></td></tr>";return a+=this.getBottomRow(f,d)+"</table></div></div>"},getNameHTML:function(a,b){var c;return c=a.rawid===a.resultid?a.name:"<i>"+a.name+"</i>",a.isScoreEvent&&(c="<input class='showscorecourse showscorecourse-"+b+"' id="+b+" type=checkbox name=scorecourse></input> "+c),"<div>"+c+"</div>"},getCourseHeader:function(a){var b;return b="<h3>"+a.coursename+"<input class='showcourse' id="+a.courseid+" type=checkbox name=course title='Show course'></input></h3><div>",b+="<table class='resulttable'><tr><th></th><th>"+rg2.t("Name")+"</th><th>"+rg2.t("Time")+"</th><th><i class='fa fa-pencil'></i></th><th><i class='fa fa-play'></i></th></tr>"},getBottomRow:function(a,b){var c;return c="<tr class='allitemsrow'><td></td><td>"+rg2.t("All")+"</td><td></td>",c+=a>0?"<td><input class='allcoursetracks' id="+b+" type=checkbox name=track></input></td>":"<td></td>",c+="<td><input class='allcoursereplay' id="+b+" type=checkbox name=replay></input></td></tr>"},getComments:function(){var a,b;for(b="",a=0;a<this.results.length;a+=1)""!==this.results[a].comments&&(b+="<p><strong>"+this.results[a].name+"</strong>: "+this.results[a].coursename+": "+this.results[a].comments+"</p>");return b},createNameDropdown:function(a){var b,c;for($("#rg2-name-select").empty(),c=document.getElementById("rg2-name-select"),c.options.add(rg2.utils.generateOption(null,rg2.t("Select name"))),b=0;b<this.results.length;b+=1)this.results[b].courseid===a&&this.results[b].resultid<rg2.config.GPS_RESULT_OFFSET&&c.options.add(rg2.utils.generateOption(b,this.results[b].name))}},rg2.Results=a}(),function(){function a(a){$("#rg2-load-progress").hide(),$("#rg2-map-load-progress").hide(),$("body").css("cursor","auto"),rg2.utils.showWarningDialog("Configuration error",a)}function b(){var b;$.getJSON(rg2Config.json_url,{type:"events",cache:!1}).done(function(a){console.log("Events: "+a.data.events.length),rg2.events.deleteAllEvents(),$.each(a.data.events,function(){rg2.events.addEvent(new rg2.Event(this))}),rg2.ui.createEventMenu(),rg2.requestedHash.getID()&&(b=rg2.events.getEventIDForKartatID(rg2.requestedHash.getID()),void 0!==b&&rg2.loadEvent(b)),rg2.config.managing&&rg2.manager.eventListLoaded()}).fail(function(b,c,d){a("Events request failed: "+d)})}function c(){$("#rg2-load-progress-label").text(rg2.t("Loading routes")),$.getJSON(rg2Config.json_url,{id:rg2.events.getKartatEventID(),type:"tracks",cache:!1}).done(function(a){var b,c,d,e,f;if($("#rg2-load-progress-label").text(rg2.t("Saving routes")),console.log("Tracks: "+a.data.routes.length),rg2.courses.getNumberOfCourses()>0&&rg2.results.addTracks(a.data.routes),rg2.ui.createCourseMenu(),rg2.ui.createResultMenu(),rg2.animation.updateAnimationDetails(),$("body").css("cursor","auto"),rg2.config.managing)rg2.manager.eventFinishedLoading();else{for($("#rg2-info-panel").tabs("enable",rg2.config.TAB_COURSES),$("#rg2-info-panel").tabs("enable",rg2.config.TAB_RESULTS),$("#rg2-info-panel").tabs("enable",rg2.config.TAB_DRAW),b=$("#rg2-info-panel").tabs("option","active"),b!==rg2.config.TAB_DRAW&&$("#rg2-info-panel").tabs("option","active",rg2.requestedHash.getTab()),$("#rg2-info-panel").tabs("refresh"),$("#btn-show-splits").show(),rg2Config.enable_splitsbrowser&&rg2.events.hasResults()?$("#rg2-splitsbrowser").off().click(function(){window.open(rg2Config.json_url+"?type=splitsbrowser&id="+rg2.events.getKartatEventID())}).show():$("#rg2-splitsbrowser").off().hide(),d=$.Event("click"),d.target={},d.target.checked=!0,e=rg2.requestedHash.getRoutes(),c=0;c<e.length;c+=1)d.target.id=e[c],$(".showtrack").filter("#"+e[c]).trigger(d).prop("checked",!0);for(f=rg2.requestedHash.getCourses(),c=0;c<f.length;c+=1)d.target.id=f[c],$(".showcourse").filter("#"+f[c]).trigger(d).prop("checked",!0)}$("#rg2-load-progress-label").text(""),$("#rg2-load-progress").hide(),rg2.redraw(!1)}).fail(function(b,c,d){a("Routes request failed for event "+rg2.events.getKartatEventID()+": "+d)})}function d(){var b;$("#rg2-load-progress-label").text(rg2.t("Loading results")),$.getJSON(rg2Config.json_url,{id:rg2.events.getKartatEventID(),type:"results",cache:!1}).done(function(a){console.log("Results: "+a.data.results.length),$("#rg2-load-progress-label").text(rg2.t("Saving results")),b=rg2.events.isScoreEvent(),rg2.courses.getNumberOfCourses()>0&&rg2.results.addResults(a.data.results,b),rg2.courses.setResultsCount(),b&&(rg2.controls.deleteAllControls(),rg2.results.generateScoreCourses(),rg2.courses.generateControlList(rg2.controls)),$("#rg2-result-list").accordion("refresh"),c()}).fail(function(b,c,d){a("Results request failed for event "+rg2.events.getKartatEventID()+": "+d)})}function e(){$.getJSON(rg2Config.json_url,{id:rg2.events.getKartatEventID(),type:"courses",cache:!1}).done(function(a){$("#rg2-load-progress-label").text(rg2.t("Saving courses")),console.log("Courses: "+a.data.courses.length),$.each(a.data.courses,function(){rg2.courses.addCourse(new rg2.Course(this,rg2.events.isScoreEvent()))}),rg2.courses.updateCourseDropdown(),rg2.courses.generateControlList(rg2.controls),$("#btn-toggle-controls").show(),$("#btn-toggle-names").show(),d()}).fail(function(b,c,d){a("Courses request failed for event "+rg2.events.getKartatEventID()+": "+d)})}function f(b){$.getJSON(rg2Config.json_url,{id:b,type:"lang",cache:!1}).done(function(a){rg2.ui.setNewLanguage(a.data.dict)}).fail(function(b,c,d){a("Language request failed: "+d)})}rg2.getEvents=b,rg2.getCourses=e,rg2.getResults=d,rg2.getGPSTracks=c,rg2.getNewLanguage=f}(),function(){function a(a){m.dragStart=rg2.ctx.transformedPoint(m.lastX,m.lastY),m.dragged=!1,m.whichButton=a.which
}function b(){var a;m.dragStart&&(a=rg2.ctx.transformedPoint(m.lastX,m.lastY),Math.round(a.x),Math.round(a.y),Math.abs(a.x-m.dragStart.x)+Math.abs(a.y-m.dragStart.y)>5&&(rg2.drawing.gpsFileLoaded()?rg2.drawing.adjustTrack({x:Math.round(m.dragStart.x),y:Math.round(m.dragStart.y)},a,m.whichButton):$("#rg2-info-panel").tabs("option","active")===rg2.config.TAB_CREATE?rg2.manager.adjustControls({x:Math.round(m.dragStart.x),y:Math.round(m.dragStart.y)},a,m.whichButton):rg2.ctx.translate(a.x-m.dragStart.x,a.y-m.dragStart.y),m.dragged=!0,rg2.redraw(!1)))}function c(a){var b=$("#rg2-info-panel").tabs("option","active");m.dragged?b===rg2.config.TAB_CREATE?rg2.manager.dragEnded():rg2.drawing.dragEnded():b===rg2.config.TAB_CREATE?rg2.manager.mouseUp(Math.round(m.dragStart.x),Math.round(m.dragStart.y)):rg2.drawing.mouseUp(Math.round(m.dragStart.x),Math.round(m.dragStart.y),a.which),m.dragStart=null,rg2.redraw(!1)}function d(a){m.pinchStart0=rg2.ctx.transformedPoint(a.touches[0].pageX,a.touches[0].pageY),m.pinchStart1=rg2.ctx.transformedPoint(a.touches[1].pageX,a.touches[1].pageY),m.pinched=!0}function e(b){b.preventDefault(),b.touches.length>1&&d(b),m.lastX=b.touches[0].pageX,m.lastY=b.touches[0].pageY,a(b)}function f(a){var c,e;a.touches.length>1?m.pinched||d(a):m.pinched=!1,m.pinched&&a.touches.length>1?(m.pinchEnd0=rg2.ctx.transformedPoint(a.touches[0].pageX,a.touches[0].pageY),m.pinchEnd1=rg2.ctx.transformedPoint(a.touches[1].pageX,a.touches[1].pageY),c=rg2.utils.getDistanceBetweenPoints(m.pinchStart0.x,m.pinchStart0.y,m.pinchStart1.x,m.pinchStart1.y),e=rg2.utils.getDistanceBetweenPoints(m.pinchEnd0.x,m.pinchEnd0.y,m.pinchEnd1.x,m.pinchEnd1.y),c/e>1.1?(rg2.zoom(-1),m.pinchStart0=m.pinchEnd0,m.pinchStart1=m.pinchEnd1):.9>c/e&&(rg2.zoom(1),m.pinchStart0=m.pinchEnd0,m.pinchStart1=m.pinchEnd1)):(m.lastX=a.touches[0].pageX,m.lastY=a.touches[0].pageY,b(a))}function g(a){c(a),m.pinched=!1}function h(a){var b=a.wheelDelta?a.wheelDelta/40:a.detail?-a.detail:0;return b&&rg2.zoom(b),a.stopPropagation(),a.preventDefault()&&!1}function i(a){m.lastX=a.offsetX||a.layerX-rg2.canvas.offsetLeft,m.lastY=a.offsetY||a.layerY-rg2.canvas.offsetTop}function j(b){return i(b),a(b),b.stopPropagation(),b.preventDefault()&&!1}function k(a){return i(a),b(a),a.stopPropagation(),a.preventDefault()&&!1}function l(a){return c(a),a.stopPropagation(),a.preventDefault()&&!1}var m={dragStart:null,dragged:!0,infoPanelMaximised:!0,scaleFactor:1.1};rg2.input=m,rg2.handleMouseDown=j,rg2.handleMouseUp=l,rg2.handleMouseMove=k,rg2.handleTouchEnd=g,rg2.handleTouchStart=e,rg2.handleTouchMove=f,rg2.handleScroll=h}(),function(){var a={setTitleBar:function(){var a;window.innerWidth>=rg2.config.BIG_SCREEN_BREAK_POINT?(a=rg2.events.getActiveEventName()+" "+rg2.events.getActiveEventDate(),$("#rg2-event-title").html(a).show()):window.innerWidth>rg2.config.SMALL_SCREEN_BREAK_POINT?(a=rg2.events.getActiveEventName(),$("#rg2-event-title").html(a).show()):$("#rg2-event-title").hide(),rg2.events.mapIsGeoreferenced()?$("#rg2-event-title-icon").addClass("fa fa-globe"):$("#rg2-event-title-icon").removeClass("fa fa-globe")},setNewLanguage:function(a){var b;$("#rg2-event-list").menu("destroy"),rg2.setDictionary(a),this.createEventMenu(),b=rg2.events.getActiveEventID(),null!==b&&(rg2.courses.removeAllFromDisplay(),rg2.results.updateTrackDisplay(rg2.config.DISPLAY_ALL_COURSES,!1),rg2.animation.resetAnimation(),rg2.drawing.initialiseDrawing(rg2.events.hasResults(b)),this.createCourseMenu(),this.createResultMenu()),$("#rg2-info-panel").tabs("refresh"),rg2.redraw(!1)},tabActivated:function(){var a=$("#rg2-info-panel").tabs("option","active");switch(a){case rg2.config.TAB_DRAW:rg2.courses.removeAllFromDisplay(),rg2.drawing.showCourseInProgress()}rg2.redraw(!1)},displayAboutDialog:function(){$("#rg2-event-stats").empty().html(rg2.getEventStats()),$("#rg2-about-dialog").dialog({width:Math.min(1e3,.8*rg2.canvas.width),maxHeight:Math.min(1e3,.9*rg2.canvas.height),title:"RG2 Version "+rg2.config.RG2VERSION,dialogClass:"rg2-about-dialog",resizable:!1,buttons:{Ok:function(){$(this).dialog("close")}}})},displayOptionsDialog:function(){$("#rg2-option-controls").dialog({minWidth:400,title:rg2.t("Configuration options"),dialogClass:"rg2-options-dialog",close:function(){rg2.saveConfigOptions()}})},initialiseButtons:function(){var a;a=this,$("#btn-about").click(function(){a.displayAboutDialog()}),$("#btn-faster").click(function(){rg2.animation.goFaster()}),$("#btn-full-tails").prop("checked",!1).click(function(a){a.target.checked?(rg2.animation.setFullTails(!0),$("#spn-tail-length").spinner("disable")):(rg2.animation.setFullTails(!1),$("#spn-tail-length").spinner("enable"))}),$("#btn-mass-start").addClass("active").click(function(){rg2.animation.setReplayType(rg2.config.MASS_START_REPLAY)}),$("#btn-move-all").prop("checked",!1),$("#btn-options").click(function(){a.displayOptionsDialog()}),$("#btn-real-time").removeClass("active").click(function(){rg2.animation.setReplayType(rg2.config.REAL_TIME_REPLAY)}),$("#btn-reset").click(function(){rg2.resetMapState()}),$("#btn-reset-drawing").button().button("disable").click(function(){rg2.drawing.resetDrawing()}),$("#btn-save-gps-route").button().button("disable").click(function(){rg2.drawing.saveGPSRoute()}),$("#btn-save-route").button().button("disable").click(function(){rg2.drawing.saveRoute()}),$("#btn-show-splits").click(function(){$("#rg2-splits-table").empty().append(rg2.animation.getSplitsTable()).dialog({width:"auto",dialogClass:"rg2-splits-table",buttons:{Ok:function(){$("#rg2-splits-table").dialog("close")}}})}).hide(),$("#btn-slower").click(function(){rg2.animation.goSlower()}),$("#btn-start-stop").click(function(){rg2.animation.toggleAnimation()}),$("#btn-three-seconds").button().click(function(){rg2.drawing.waitThreeSeconds()}).button("disable"),$("#btn-toggle-controls").click(function(){rg2.controls.toggleControlDisplay(),rg2.redraw(!1)}).hide(),$("#btn-toggle-names").click(function(){rg2.animation.toggleNameDisplay(),rg2.redraw(!1)}).hide(),$("#btn-undo").button().button("disable").click(function(){rg2.drawing.undoLastPoint()}),$("#btn-undo-gps-adjust").button().button("disable").click(function(){rg2.drawing.undoGPSAdjust()}),$("#btn-autofit-gps").button().button("disable").click(function(){rg2.drawing.autofitGPSTrack()}),$("#btn-zoom-in").click(function(){rg2.zoom(1)}),$("#btn-zoom-out").click(function(){rg2.zoom(-1)}),$("#rg2-load-gps-file").button().button("disable")},setResultCheckboxes:function(){$(".showcourse").click(function(a){var b;a.stopPropagation(),b=a.target.id,a.target.checked?(rg2.courses.putOnDisplay(b),$(".courselist").filter("#"+b).prop("checked",!0)):(rg2.courses.removeFromDisplay(b),$(".courselist").filter("#"+b).prop("checked",!1),$(".allcourses").prop("checked",!1)),rg2.requestedHash.setCourses(),rg2.redraw(!1)}),$(".showscorecourse").click(function(a){rg2.results.displayScoreCourse(parseInt(a.target.id,10),a.target.checked),rg2.redraw(!1)}),$(".showtrack").click(function(a){a.target.checked?rg2.results.putOneTrackOnDisplay(a.target.id):rg2.results.removeOneTrackFromDisplay(a.target.id),rg2.requestedHash.setRoutes(),rg2.redraw(!1)}),$(".showreplay").click(function(a){a.target.checked?rg2.animation.addRunner(new rg2.Runner(parseInt(a.target.id,10)),!0):rg2.animation.removeRunner(parseInt(a.target.id,10),!0),rg2.redraw(!1)}),$(".allcoursetracks").click(function(a){var b,c,d;for(b=rg2.results.getAllRunnersForCourse(parseInt(a.target.id,10)),d=0;d<b.length;d+=1)a.target.checked?rg2.results.putOneTrackOnDisplay(b[d]):rg2.results.removeOneTrackFromDisplay(b[d]);c=".showtrack-"+a.target.id,a.target.checked?$(c).prop("checked",!0):$(c).prop("checked",!1),rg2.requestedHash.setRoutes(),rg2.redraw(!1)}),$(".allcoursereplay").click(function(a){var b,c;b=rg2.results.getAllRunnersForCourse(parseInt(a.target.id,10)),rg2.animation.animateRunners(b,a.target.checked),c=".showreplay-"+a.target.id,a.target.checked?$(c).prop("checked",!0):$(c).prop("checked",!1),rg2.redraw(!1)})},createResultMenu:function(){var a=rg2.results.formatResultListAsAccordion();a=a.replace(/&amp;/g,"&"),$("#rg2-result-list").empty().append(a),$("#rg2-result-list").accordion("refresh"),$("#rg2-info-panel").tabs("refresh"),this.setResultCheckboxes(),0===rg2.courses.getHighestControlNumber()?$("#rg2-control-select").prop("disabled",!0):$("#rg2-control-select").prop("disabled",!1)},createCourseMenu:function(){$("#rg2-course-table").empty().append(rg2.courses.formatCoursesAsTable()),$(".courselist").click(function(a){var b=parseInt(a.currentTarget.id,10);a.target.checked?(rg2.courses.putOnDisplay(b),$(".showcourse").filter("#"+b).prop("checked",!0)):(rg2.courses.removeFromDisplay(b),$(".allcourses").prop("checked",!1),$(".showcourse").filter("#"+b).prop("checked",!1)),rg2.requestedHash.setCourses(),rg2.redraw(!1)}),$(".allcourses").click(function(a){a.target.checked?(rg2.courses.putAllOnDisplay(),$(".courselist").prop("checked",!0),$(".showcourse").prop("checked",!0)):(rg2.courses.removeAllFromDisplay(),$(".courselist").prop("checked",!1),$(".showcourse").prop("checked",!1)),rg2.requestedHash.setCourses(),rg2.redraw(!1)}),$(".tracklist").click(function(a){var b=a.target.id;a.target.checked?rg2.results.updateTrackDisplay(parseInt(b,10),!0):(rg2.results.updateTrackDisplay(parseInt(b,10),!1),$(".alltracks").prop("checked",!1)),rg2.requestedHash.setRoutes(),rg2.redraw(!1)}),$(".alltracks").click(function(a){a.target.checked?(rg2.results.updateTrackDisplay(rg2.config.DISPLAY_ALL_COURSES,!0),$(".tracklist").prop("checked",!0)):(rg2.results.updateTrackDisplay(rg2.config.DISPLAY_ALL_COURSES,!1),$(".tracklist").prop("checked",!1)),rg2.requestedHash.setRoutes(),rg2.redraw(!1)})},initialiseSpinners:function(){$("#spn-control-circle").spinner({max:50,min:3,step:1,spin:function(a,b){rg2.setConfigOption("circleSize",b.value),rg2.redraw(!1)}}).val(rg2.options.circleSize),$("#spn-course-width").spinner({max:10,min:1,step:.5,spin:function(a,b){rg2.setConfigOption("courseWidth",b.value),rg2.redraw(!1)}}).val(rg2.options.courseWidth),$("#spn-map-intensity").spinner({max:100,min:0,step:10,numberFormat:"n",spin:function(a,b){rg2.setConfigOption("mapIntensity",b.value/100),rg2.redraw(!1)}}).val(100*rg2.options.mapIntensity),$("#spn-name-font-size").spinner({max:30,min:5,step:1,numberFormat:"n",spin:function(a,b){rg2.setConfigOption("replayFontSize",b.value),rg2.redraw(!1)}}).val(rg2.options.replayFontSize),$("#spn-route-intensity").spinner({max:100,min:0,step:10,numberFormat:"n",spin:function(a,b){rg2.setConfigOption("routeIntensity",b.value/100),rg2.redraw(!1)}}).val(100*rg2.options.routeIntensity),$("#spn-route-width").spinner({max:10,min:1,step:.5,spin:function(a,b){rg2.setConfigOption("routeWidth",b.value),rg2.redraw(!1)}}).val(rg2.options.routeWidth),$("#spn-tail-length").spinner({max:600,min:0,spin:function(a,b){rg2.animation.setTailLength(b.value)}}).val(0),$("#spn-offset").spinner({max:600,min:-600,disabled:!0,spin:function(a,b){rg2.drawing.adjustOffset(b.value)}}).val(0)},setAutofitSpinner:function(a){$("#spn-offset").spinner("value",a).spinner("enable")},createEventMenu:function(){var a=rg2.events.formatEventsAsMenu();$("#rg2-event-list").empty().append(a).menu({select:function(a,b){rg2.loadEvent(b.item[0].id),rg2.requestedHash.setNewEvent(rg2.events.getKartatEventID())}})},setUIEventHandlers:function(){var a,b,c;c=this,$("#rg2-resize-info").click(function(){rg2.resizeInfoDisplay()}),$("#rg2-hide-info-panel-control").click(function(){rg2.resizeInfoDisplay()}),$("#rg2-control-select").prop("disabled",!0).change(function(){rg2.animation.setStartControl($("#rg2-control-select").val())}),$("#rg2-name-select").prop("disabled",!0).change(function(){rg2.drawing.setName(parseInt($("#rg2-name-select").val(),10))}),$("#rg2-course-select").change(function(){rg2.drawing.setCourse(parseInt($("#rg2-course-select").val(),10))}),$("#rg2-enter-name").click(function(){rg2.drawing.setNameAndTime()}).keyup(function(){rg2.drawing.setNameAndTime()}),$("#rg2-new-comments").focus(function(){a=$("#rg2-new-comments").val(),a===rg2.t(rg2.config.DEFAULT_NEW_COMMENT)&&$("#rg2-new-comments").val("")}),$("#chk-snap-toggle").prop("checked",rg2.options.snap).click(function(a){rg2.options.snap=a.target.checked?!0:!1}),$("#chk-show-three-seconds").prop("checked",rg2.options.showThreeSeconds).click(function(){rg2.redraw(!1)}),$("#chk-show-GPS-speed").prop("checked",rg2.options.showGPSSpeed).click(function(){rg2.redraw(!1)}),$("#rg2-select-language").click(function(){b=$("#rg2-select-language").val(),b!==rg2.getDictionaryCode()&&("en"===b?c.setNewLanguage({code:"en"}):rg2.getNewLanguage(b))}),$("#rg2-load-gps-file").change(function(a){rg2.drawing.uploadGPS(a)})},configureUI:function(){$(document).bind("contextmenu",function(a){a.preventDefault()});var a;a=this,$("#rg2-info-panel").tabs({disabled:[rg2.config.TAB_COURSES,rg2.config.TAB_RESULTS,rg2.config.TAB_DRAW],active:rg2.config.TAB_EVENTS,heightStyle:"content",activate:function(){a.tabActivated()}}),$("#rg2-result-list").accordion({collapsible:!0,heightStyle:"content"}),$("#rg2-clock").text("00:00:00"),$("#rg2-clock-slider").slider({slide:function(a,b){rg2.animation.clockSliderMoved(b.value)}}),$("#rg2-header-container").css("color",rg2Config.header_text_colour).css("background",rg2Config.header_colour),$("#rg2-about-dialog").hide(),$("#rg2-splits-display").hide(),$("#rg2-track-names").hide(),$("#rg2-add-new-event").hide(),$("#rg2-load-progress-bar").progressbar({value:!1}),$("#rg2-load-progress-label").text(""),$("#rg2-load-progress").hide(),$("#rg2-map-load-progress-bar").progressbar({value:!1}),$("#rg2-map-load-progress-label").text(""),$("#rg2-map-load-progress").hide(),$("#rg2-option-controls").hide(),$("#rg2-animation-controls").hide(),$("#rg2-splitsbrowser").hide(),this.setUIEventHandlers(),this.initialiseButtons(),this.initialiseSpinners()}};rg2.ui=a}(),function(){function a(a){var b,c;b=rg2.results.getFullResult(a),this.name=b.name,this.initials=b.initials,this.runnerid=a,this.starttime=b.starttime,this.splits=b.splits,this.legpos=b.legpos,this.colour=b.trackColour,b.isScoreEvent?(c={},c.name=b.coursename,c.x=b.scorex,c.y=b.scorey,c.codes=b.scorecodes):c=rg2.courses.getCourseDetails(b.courseid),this.coursename=c.name,this.nextStopTime=rg2.config.VERY_HIGH_TIME_IN_SECS,this.x=[],this.y=[],this.legTrackDistance=[],this.cumulativeTrackDistance=[],this.cumulativeDistance=[],this.cumulativeDistance[0]=0,this.legTrackDistance[0]=0,this.cumulativeTrackDistance[0]=0,b.hasValidTrack?this.expandTrack(b.trackx,b.tracky,b.xysecs):this.expandTrack(c.x,c.y,b.splits),this.addTrackDistances(c,b),b=0,c=0}a.prototype={Constructor:a,addTrackDistances:function(a,b){var c,d,e;if(e=this.cumulativeDistance.length-1,void 0!==a.codes)if(b.splits.length>1)for(c=1;c<a.codes.length;c+=1)d=b.splits[c]<=e?b.splits[c]:e,this.cumulativeTrackDistance[c]=Math.round(this.cumulativeDistance[d]),this.legTrackDistance[c]=this.cumulativeTrackDistance[c]-this.cumulativeTrackDistance[c-1];else this.legTrackDistance[1]=Math.round(this.cumulativeDistance[e]),this.cumulativeTrackDistance[1]=Math.round(this.cumulativeDistance[e])},expandTrack:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(m=0,n=0,o=a[0],p=b[0],q=0,l=0,this.x[0]=a[0],this.y[0]=b[0],d=1;d<c.length;d+=1){for(j=a[d],k=b[d],e=j-o,f=k-p,l+=rg2.utils.getDistanceBetweenPoints(j,k,o,p),i=l-q,n=c[d],g=n-m,h=m+1;n>h;h+=1)this.x[h]=Math.round(o+(h-m)*e/g),this.y[h]=Math.round(p+(h-m)*f/g),this.cumulativeDistance[h]=Math.round(q+(h-m)*i/g);this.x[n]=j,this.y[n]=k,this.cumulativeDistance[n]=l,o=j,p=k,q=l,m=n}}},rg2.Runner=a}(),function(){function a(){this.colours=["#ff0000","#ff8000","#ff00ff","#ff0080","#008080","#008000","#0080ff","#0000ff","#8000ff","#808080"],this.colourIndex=0}function b(a){this.x="",this.y=a,this.name=null,this.password=null}function c(){this.courseid=null,this.coursename=null,this.resultid=null,this.isScoreCourse=!1,this.eventid=null,this.name=null,this.comments=null,this.x=[],this.y=[],this.controlx=[],this.controly=[],this.time=[],this.startsecs=0,this.totaltime=0,this.splits=[]}function d(){this.id=0,this.courses=[],this.routes=[]}var e={rotatePoint:function(a,b,c){var d={};return d.x=Math.cos(c)*a-Math.sin(c)*b,d.y=Math.sin(c)*a+Math.cos(c)*b,d},getDistanceBetweenPoints:function(a,b,c,d){return Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2))},getAngle:function(a,b,c,d){var e=Math.atan2(d-b,c-a);return 0>e&&(e+=2*Math.PI),e},getLatLonDistance:function(a,b,c,d){var e,f,g;return e=(c-a).toRad(),f=(d-b).toRad(),g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(a.toRad())*Math.cos(c.toRad())*Math.sin(f/2)*Math.sin(f/2),12742018*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))},getSecsFromHHMMSS:function(a){var b,c;return a?(c=0,b=a.replace(/\./g,":").split(":"),2===b.length?c=60*parseInt(b[0],10)+parseInt(b[1],10):3===b.length&&(c=3600*parseInt(b[0],10)+60*parseInt(b[1],10)+parseInt(b[2],10)),isNaN(c)?0:c):0},getSecsFromHHMM:function(a){var b,c;return a?(c=0,b=a.split(":"),c=3600*parseInt(b[0],10)+60*parseInt(b[1],10),isNaN(c)?0:c):0},formatSecsAsMMSS:function(a){var b,c,d;return c=Math.floor(a/60),b=c,d=a-60*c,b+=10>d?":0"+d:":"+d},formatSecsAsHHMMSS:function(a){var b,c,d;return c=Math.floor(a/3600),b=10>c?"0"+c+":":c+":",a-=3600*c,d=Math.floor(a/60),b+=10>d?"0"+d:d,a-=60*d,b+=10>a?":0"+a:":"+a},showWarningDialog:function(a,b){var c="<div id=rg2-warning-dialog>"+b+"</div>";$(c).dialog({title:a,dialogClass:"rg2-warning-dialog",close:function(){$("#rg2-warning-dialog").dialog("destroy").remove()}})},setButtonState:function(a,b){var c;for(c=0;c<b.length;c+=1)$(b[c]).button(a)},generateOption:function(a,b,c){var d;return d=document.createElement("option"),d.value=a,d.text=b,c&&(d.selected=!0),d},extractAttributeZero:function(a,b,c){return a.length>0?a[0].getAttribute(b).trim():c},extractTextContentZero:function(a,b){return a.length>0?a[0].textContent.trim():b},createModalDialog:function(a){var b;b=this,b.onDo=a.onDo,b.onCancel=a.onCancel,$(a.selector).dialog({title:a.title,modal:!0,dialogClass:"no-close "+a.classes,closeOnEscape:!1,buttons:[{text:a.doText,click:function(){b.onDo()}},{text:"Cancel",click:function(){b.onCancel()}}]})}};Number.prototype.toRad=function(){return this*Math.PI/180},a.prototype={Constructor:a,getNextColour:function(){return this.colourIndex=(this.colourIndex+1)%this.colours.length,this.colours[this.colourIndex]}},b.prototype={Constructor:b,setDetails:function(a,b){return a.length>4&&b.length>4?(this.name=a,this.password=b,!0):!1},alterString:function(a,b){var c,d;for(d="",c=0;c<a.length;c+=1)d+=a.charAt(c)+b.charAt(c);return d},encodeUser:function(){return{x:this.alterString(this.name+this.password,this.y),y:this.y}}},d.prototype={Constructor:d,parseHash:function(a){var b,c;for(b=a.split("&"),c=0;c<b.length;c+=1)b[c]=b[c].toLowerCase(),-1!==b[c].search("#")&&(this.id=parseInt(b[c].replace("#",""),10)),-1!==b[c].search("course=")&&(this.courses=b[c].replace("course=","").split(",")),-1!==b[c].search("route=")&&(this.routes=b[c].replace("route=","").split(","));this.courses=this.courses.map(Number),this.routes=this.routes.map(Number),isNaN(this.id)&&(this.id=0,this.courses.length=0,this.routes.length=0)},getRoutes:function(){return this.routes},getCourses:function(){return this.courses},getID:function(){return this.id},getTab:function(){return this.routes.length>0?rg2.config.TAB_RESULTS:rg2.config.TAB_COURSES},setCourses:function(){this.courses=rg2.courses.getCoursesOnDisplay(),window.history.pushState("","",this.getHash())},setRoutes:function(){this.routes=rg2.results.getTracksOnDisplay(),window.history.pushState("","",this.getHash())},setNewEvent:function(a){this.id=a,this.courses.length=0,this.routes.length=0,window.history.pushState("","",this.getHash())},getHash:function(){var a;return 0===this.id?"#0":(a="#"+this.id,a+=this.extractItems(this.courses,"&course="),a+=this.extractItems(this.routes,"&route="))},extractItems:function(a,b){var c,d;if(d="",a.length>0)for(d+=b,c=0;c<a.length;c+=1)c>0&&(d+=","),d+=a[c];return d}},rg2.utils=e,rg2.RouteData=c,rg2.RequestedHash=d,rg2.Colours=a,rg2.User=b}(),function(){var a=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,b=/[\x01-\x7F]/g,c=/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,d=/<\u20D2|=\u20E5|>\u20D2|\u205F\u200A|\u219D\u0338|\u2202\u0338|\u2220\u20D2|\u2229\uFE00|\u222A\uFE00|\u223C\u20D2|\u223D\u0331|\u223E\u0333|\u2242\u0338|\u224B\u0338|\u224D\u20D2|\u224E\u0338|\u224F\u0338|\u2250\u0338|\u2261\u20E5|\u2264\u20D2|\u2265\u20D2|\u2266\u0338|\u2267\u0338|\u2268\uFE00|\u2269\uFE00|\u226A\u0338|\u226A\u20D2|\u226B\u0338|\u226B\u20D2|\u227F\u0338|\u2282\u20D2|\u2283\u20D2|\u228A\uFE00|\u228B\uFE00|\u228F\u0338|\u2290\u0338|\u2293\uFE00|\u2294\uFE00|\u22B4\u20D2|\u22B5\u20D2|\u22D8\u0338|\u22D9\u0338|\u22DA\uFE00|\u22DB\uFE00|\u22F5\u0338|\u22F9\u0338|\u2933\u0338|\u29CF\u0338|\u29D0\u0338|\u2A6D\u0338|\u2A70\u0338|\u2A7D\u0338|\u2A7E\u0338|\u2AA1\u0338|\u2AA2\u0338|\u2AAC\uFE00|\u2AAD\uFE00|\u2AAF\u0338|\u2AB0\u0338|\u2AC5\u0338|\u2AC6\u0338|\u2ACB\uFE00|\u2ACC\uFE00|\u2AFD\u20E5|[\xA0-\u0113\u0116-\u0122\u0124-\u012B\u012E-\u014D\u0150-\u017E\u0192\u01B5\u01F5\u0237\u02C6\u02C7\u02D8-\u02DD\u0311\u0391-\u03A1\u03A3-\u03A9\u03B1-\u03C9\u03D1\u03D2\u03D5\u03D6\u03DC\u03DD\u03F0\u03F1\u03F5\u03F6\u0401-\u040C\u040E-\u044F\u0451-\u045C\u045E\u045F\u2002-\u2005\u2007-\u2010\u2013-\u2016\u2018-\u201A\u201C-\u201E\u2020-\u2022\u2025\u2026\u2030-\u2035\u2039\u203A\u203E\u2041\u2043\u2044\u204F\u2057\u205F-\u2063\u20AC\u20DB\u20DC\u2102\u2105\u210A-\u2113\u2115-\u211E\u2122\u2124\u2127-\u2129\u212C\u212D\u212F-\u2131\u2133-\u2138\u2145-\u2148\u2153-\u215E\u2190-\u219B\u219D-\u21A7\u21A9-\u21AE\u21B0-\u21B3\u21B5-\u21B7\u21BA-\u21DB\u21DD\u21E4\u21E5\u21F5\u21FD-\u2205\u2207-\u2209\u220B\u220C\u220F-\u2214\u2216-\u2218\u221A\u221D-\u2238\u223A-\u2257\u2259\u225A\u225C\u225F-\u2262\u2264-\u228B\u228D-\u229B\u229D-\u22A5\u22A7-\u22B0\u22B2-\u22BB\u22BD-\u22DB\u22DE-\u22E3\u22E6-\u22F7\u22F9-\u22FE\u2305\u2306\u2308-\u2310\u2312\u2313\u2315\u2316\u231C-\u231F\u2322\u2323\u232D\u232E\u2336\u233D\u233F\u237C\u23B0\u23B1\u23B4-\u23B6\u23DC-\u23DF\u23E2\u23E7\u2423\u24C8\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2550-\u256C\u2580\u2584\u2588\u2591-\u2593\u25A1\u25AA\u25AB\u25AD\u25AE\u25B1\u25B3-\u25B5\u25B8\u25B9\u25BD-\u25BF\u25C2\u25C3\u25CA\u25CB\u25EC\u25EF\u25F8-\u25FC\u2605\u2606\u260E\u2640\u2642\u2660\u2663\u2665\u2666\u266A\u266D-\u266F\u2713\u2717\u2720\u2736\u2758\u2772\u2773\u27C8\u27C9\u27E6-\u27ED\u27F5-\u27FA\u27FC\u27FF\u2902-\u2905\u290C-\u2913\u2916\u2919-\u2920\u2923-\u292A\u2933\u2935-\u2939\u293C\u293D\u2945\u2948-\u294B\u294E-\u2976\u2978\u2979\u297B-\u297F\u2985\u2986\u298B-\u2996\u299A\u299C\u299D\u29A4-\u29B7\u29B9\u29BB\u29BC\u29BE-\u29C5\u29C9\u29CD-\u29D0\u29DC-\u29DE\u29E3-\u29E5\u29EB\u29F4\u29F6\u2A00-\u2A02\u2A04\u2A06\u2A0C\u2A0D\u2A10-\u2A17\u2A22-\u2A27\u2A29\u2A2A\u2A2D-\u2A31\u2A33-\u2A3C\u2A3F\u2A40\u2A42-\u2A4D\u2A50\u2A53-\u2A58\u2A5A-\u2A5D\u2A5F\u2A66\u2A6A\u2A6D-\u2A75\u2A77-\u2A9A\u2A9D-\u2AA2\u2AA4-\u2AB0\u2AB3-\u2AC8\u2ACB\u2ACC\u2ACF-\u2ADB\u2AE4\u2AE6-\u2AE9\u2AEB-\u2AF3\u2AFD\uFB00-\uFB04]|\uD835[\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDD6B]/g,e={"":"Aacute","":"aacute","":"Abreve","":"abreve","":"ac","":"acd","":"acE","":"Acirc","":"acirc","":"acute","":"Acy","":"acy","":"AElig","":"aelig","":"af","":"Afr","":"afr","":"Agrave","":"agrave","":"aleph","":"Alpha","":"alpha","":"Amacr","":"amacr","":"amalg","&":"amp","":"andand","":"And","":"and","":"andd","":"andslope","":"andv","":"ang","":"ange","":"angmsdaa","":"angmsdab","":"angmsdac","":"angmsdad","":"angmsdae","":"angmsdaf","":"angmsdag","":"angmsdah","":"angmsd","":"angrt","":"angrtvb","":"angrtvbd","":"angsph","":"angst","":"angzarr","":"Aogon","":"aogon","":"Aopf","":"aopf","":"apacir","":"ap","":"apE","":"ape","":"apid","'":"apos","":"aring","":"Ascr","":"ascr","":"colone","*":"ast","":"CupCap","":"Atilde","":"atilde","":"Auml","":"auml","":"awconint","":"awint","":"bcong","":"bepsi","":"bprime","":"bsim","":"bsime","":"setmn","":"Barv","":"barvee","":"barwed","":"Barwed","":"bbrk","":"bbrktbrk","":"Bcy","":"bcy","":"bdquo","":"becaus","":"bemptyv","":"Bscr","":"Beta","":"beta","":"beth","":"twixt","":"Bfr","":"bfr","":"xcap","":"xcirc","":"xcup","":"xodot","":"xoplus","":"xotime","":"xsqcup","":"starf","":"xdtri","":"xutri","":"xuplus","":"Vee","":"Wedge","":"rbarr","":"lozf","":"squf","":"utrif","":"dtrif","":"ltrif","":"rtrif","":"blank","":"blk12","":"blk14","":"blk34","":"block","=":"bne","":"bnequiv","":"bNot","":"bnot","":"Bopf","":"bopf","":"bot","":"bowtie","":"boxbox","":"boxdl","":"boxdL","":"boxDl","":"boxDL","":"boxdr","":"boxdR","":"boxDr","":"boxDR","":"boxh","":"boxH","":"boxhd","":"boxHd","":"boxhD","":"boxHD","":"boxhu","":"boxHu","":"boxhU","":"boxHU","":"minusb","":"plusb","":"timesb","":"boxul","":"boxuL","":"boxUl","":"boxUL","":"boxur","":"boxuR","":"boxUr","":"boxUR","":"boxv","":"boxV","":"boxvh","":"boxvH","":"boxVh","":"boxVH","":"boxvl","":"boxvL","":"boxVl","":"boxVL","":"boxvr","":"boxvR","":"boxVr","":"boxVR","":"breve","":"brvbar","":"bscr","":"bsemi","":"bsolb","\\":"bsol","":"bsolhsub","":"bull","":"bump","":"bumpE","":"bumpe","":"Cacute","":"cacute","":"capand","":"capbrcup","":"capcap","":"cap","":"Cap","":"capcup","":"capdot","":"DD","":"caps","":"caret","":"caron","":"Cfr","":"ccaps","":"Ccaron","":"ccaron","":"Ccedil","":"ccedil","":"Ccirc","":"ccirc","":"Cconint","":"ccups","":"ccupssm","":"Cdot","":"cdot","":"cedil","":"cemptyv","":"cent","":"middot","":"cfr","":"CHcy","":"chcy","":"check","":"Chi","":"chi","":"circ","":"cire","":"olarr","":"orarr","":"oast","":"ocir","":"odash","":"odot","":"reg","":"oS","":"ominus","":"oplus","":"otimes","":"cir","":"cirE","":"cirfnint","":"cirmid","":"cirscir","":"cwconint","":"rdquo","":"rsquo","":"clubs",":":"colon","":"Colon","":"Colone",",":"comma","@":"commat","":"comp","":"compfn","":"Copf","":"cong","":"congdot","":"equiv","":"oint","":"Conint","":"copf","":"coprod","":"copy","":"copysr","":"crarr","":"cross","":"Cross","":"Cscr","":"cscr","":"csub","":"csube","":"csup","":"csupe","":"ctdot","":"cudarrl","":"cudarrr","":"cuepr","":"cuesc","":"cularr","":"cularrp","":"cupbrcap","":"cupcap","":"cup","":"Cup","":"cupcup","":"cupdot","":"cupor","":"cups","":"curarr","":"curarrm","":"cuvee","":"cuwed","":"curren","":"cwint","":"cylcty","":"dagger","":"Dagger","":"daleth","":"darr","":"Darr","":"dArr","":"dash","":"Dashv","":"dashv","":"rBarr","":"dblac","":"Dcaron","":"dcaron","":"Dcy","":"dcy","":"ddarr","":"dd","":"DDotrahd","":"eDDot","":"deg","":"Del","":"Delta","":"delta","":"demptyv","":"dfisht","":"Dfr","":"dfr","":"dHar","":"dharl","":"dharr","":"dot","`":"grave","":"tilde","":"diam","":"diams","":"die","":"gammad","":"disin","":"div","":"divonx","":"DJcy","":"djcy","":"dlcorn","":"dlcrop",$:"dollar","":"Dopf","":"dopf","":"DotDot","":"doteq","":"eDot","":"minusd","":"plusdo","":"sdotb","":"lArr","":"iff","":"xlArr","":"xhArr","":"xrArr","":"rArr","":"vDash","":"uArr","":"vArr","":"par","":"DownArrowBar","":"duarr","":"DownBreve","":"DownLeftRightVector","":"DownLeftTeeVector","":"DownLeftVectorBar","":"lhard","":"DownRightTeeVector","":"DownRightVectorBar","":"rhard","":"mapstodown","":"top","":"RBarr","":"drcorn","":"drcrop","":"Dscr","":"dscr","":"DScy","":"dscy","":"dsol","":"Dstrok","":"dstrok","":"dtdot","":"dtri","":"duhar","":"dwangle","":"DZcy","":"dzcy","":"dzigrarr","":"Eacute","":"eacute","":"easter","":"Ecaron","":"ecaron","":"Ecirc","":"ecirc","":"ecir","":"ecolon","":"Ecy","":"ecy","":"Edot","":"edot","":"ee","":"efDot","":"Efr","":"efr","":"eg","":"Egrave","":"egrave","":"egs","":"egsdot","":"el","":"in","":"elinters","":"ell","":"els","":"elsdot","":"Emacr","":"emacr","":"empty","":"EmptySmallSquare","":"EmptyVerySmallSquare","":"emsp13","":"emsp14","":"emsp","":"ENG","":"eng","":"ensp","":"Eogon","":"eogon","":"Eopf","":"eopf","":"epar","":"eparsl","":"eplus","":"epsi","":"Epsilon","":"epsiv","":"esim","":"Equal","=":"equals","":"equest","":"rlhar","":"equivDD","":"eqvparsl","":"erarr","":"erDot","":"escr","":"Escr","":"Esim","":"Eta","":"eta","":"ETH","":"eth","":"Euml","":"euml","":"euro","!":"excl","":"exist","":"Fcy","":"fcy","":"female","":"ffilig","":"fflig","":"ffllig","":"Ffr","":"ffr","":"filig","":"FilledSmallSquare",fj:"fjlig","":"flat","":"fllig","":"fltns","":"fnof","":"Fopf","":"fopf","":"forall","":"fork","":"forkv","":"Fscr","":"fpartint","":"half","":"frac13","":"frac14","":"frac15","":"frac16","":"frac18","":"frac23","":"frac25","":"frac34","":"frac35","":"frac38","":"frac45","":"frac56","":"frac58","":"frac78","":"frasl","":"frown","":"fscr","":"gacute","":"Gamma","":"gamma","":"Gammad","":"gap","":"Gbreve","":"gbreve","":"Gcedil","":"Gcirc","":"gcirc","":"Gcy","":"gcy","":"Gdot","":"gdot","":"ge","":"gE","":"gEl","":"gel","":"ges","":"gescc","":"gesdot","":"gesdoto","":"gesdotol","":"gesl","":"gesles","":"Gfr","":"gfr","":"gg","":"Gg","":"gimel","":"GJcy","":"gjcy","":"gla","":"gl","":"glE","":"glj","":"gnap","":"gne","":"gnE","":"gnsim","":"Gopf","":"gopf","":"GreaterGreater","":"gsim","":"Gscr","":"gscr","":"gsime","":"gsiml","":"gtcc","":"gtcir",">":"gt","":"gtdot","":"gtlPar","":"gtquest","":"gtrarr","":"gvnE","":"hairsp","":"Hscr","":"HARDcy","":"hardcy","":"harrcir","":"harr","":"harrw","^":"Hat","":"hbar","":"Hcirc","":"hcirc","":"hearts","":"mldr","":"hercon","":"hfr","":"Hfr","":"searhk","":"swarhk","":"hoarr","":"homtht","":"larrhk","":"rarrhk","":"hopf","":"Hopf","":"horbar","":"hscr","":"Hstrok","":"hstrok","":"hybull","":"Iacute","":"iacute","":"ic","":"Icirc","":"icirc","":"Icy","":"icy","":"Idot","":"IEcy","":"iecy","":"iexcl","":"ifr","":"Im","":"Igrave","":"igrave","":"ii","":"qint","":"tint","":"iinfin","":"iiota","":"IJlig","":"ijlig","":"Imacr","":"imacr","":"Iscr","":"imath","":"imof","":"imped","":"incare","":"infin","":"infintie","":"intcal","":"int","":"Int","":"Zopf","":"intlarhk","":"iprod","":"it","":"IOcy","":"iocy","":"Iogon","":"iogon","":"Iopf","":"iopf","":"Iota","":"iota","":"iquest","":"iscr","":"isindot","":"isinE","":"isins","":"isinsv","":"Itilde","":"itilde","":"Iukcy","":"iukcy","":"Iuml","":"iuml","":"Jcirc","":"jcirc","":"Jcy","":"jcy","":"Jfr","":"jfr","":"jmath","":"Jopf","":"jopf","":"Jscr","":"jscr","":"Jsercy","":"jsercy","":"Jukcy","":"jukcy","":"Kappa","":"kappa","":"kappav","":"Kcedil","":"kcedil","":"Kcy","":"kcy","":"Kfr","":"kfr","":"kgreen","":"KHcy","":"khcy","":"KJcy","":"kjcy","":"Kopf","":"kopf","":"Kscr","":"kscr","":"lAarr","":"Lacute","":"lacute","":"laemptyv","":"Lscr","":"Lambda","":"lambda","":"lang","":"Lang","":"langd","":"lap","":"laquo","":"larrb","":"larrbfs","":"larr","":"Larr","":"larrfs","":"larrlp","":"larrpl","":"larrsim","":"larrtl","":"latail","":"lAtail","":"lat","":"late","":"lates","":"lbarr","":"lBarr","":"lbbrk","{":"lcub","[":"lsqb","":"lbrke","":"lbrksld","":"lbrkslu","":"Lcaron","":"lcaron","":"Lcedil","":"lcedil","":"lceil","":"Lcy","":"lcy","":"ldca","":"ldquo","":"ldrdhar","":"ldrushar","":"ldsh","":"le","":"lE","":"lrarr","":"lobrk","":"LeftDownTeeVector","":"LeftDownVectorBar","":"lfloor","":"lharu","":"llarr","":"lrhar","":"LeftRightVector","":"mapstoleft","":"LeftTeeVector","":"lthree","":"LeftTriangleBar","":"vltri","":"ltrie","":"LeftUpDownVector","":"LeftUpTeeVector","":"LeftUpVectorBar","":"uharl","":"LeftVectorBar","":"lEg","":"leg","":"les","":"lescc","":"lesdot","":"lesdoto","":"lesdotor","":"lesg","":"lesges","":"ltdot","":"lg","":"LessLess","":"lsim","":"lfisht","":"Lfr","":"lfr","":"lgE","":"lHar","":"lharul","":"lhblk","":"LJcy","":"ljcy","":"ll","":"Ll","":"llhard","":"lltri","":"Lmidot","":"lmidot","":"lmoust","":"lnap","":"lne","":"lnE","":"lnsim","":"loang","":"loarr","":"xlarr","":"xharr","":"xmap","":"xrarr","":"rarrlp","":"lopar","":"Lopf","":"lopf","":"loplus","":"lotimes","":"lowast",_:"lowbar","":"swarr","":"searr","":"loz","(":"lpar","":"lparlt","":"lrhard","":"lrm","":"lrtri","":"lsaquo","":"lscr","":"lsh","":"lsime","":"lsimg","":"lsquo","":"sbquo","":"Lstrok","":"lstrok","":"ltcc","":"ltcir","<":"lt","":"ltimes","":"ltlarr","":"ltquest","":"ltri","":"ltrPar","":"lurdshar","":"luruhar","":"lvnE","":"macr","":"male","":"malt","":"Map","":"map","":"mapstoup","":"marker","":"mcomma","":"Mcy","":"mcy","":"mdash","":"mDDot","":"MediumSpace","":"Mscr","":"Mfr","":"mfr","":"mho","":"micro","":"midcir","":"mid","":"minus","":"minusdu","":"mp","":"mlcp","":"models","":"Mopf","":"mopf","":"mscr","":"Mu","":"mu","":"mumap","":"Nacute","":"nacute","":"nang","":"nap","":"napE","":"napid","":"napos","":"natur","":"Nopf","":"nbsp","":"nbump","":"nbumpe","":"ncap","":"Ncaron","":"ncaron","":"Ncedil","":"ncedil","":"ncong","":"ncongdot","":"ncup","":"Ncy","":"ncy","":"ndash","":"nearhk","":"nearr","":"neArr","":"ne","":"nedot","":"ZeroWidthSpace","":"nequiv","":"toea","":"nesim","\n":"NewLine","":"nexist","":"Nfr","":"nfr","":"ngE","":"nge","":"nges","":"nGg","":"ngsim","":"nGt","":"ngt","":"nGtv","":"nharr","":"nhArr","":"nhpar","":"ni","":"nis","":"nisd","":"NJcy","":"njcy","":"nlarr","":"nlArr","":"nldr","":"nlE","":"nle","":"nles","":"nlt","":"nLl","":"nlsim","":"nLt","":"nltri","":"nltrie","":"nLtv","":"nmid","":"NoBreak","":"nopf","":"Not","":"not","":"NotCupCap","":"npar","":"notin","":"ntgl","":"notindot","":"notinE","":"notinvb","":"notinvc","":"NotLeftTriangleBar","":"ntlg","":"NotNestedGreaterGreater","":"NotNestedLessLess","":"notni","":"notnivb","":"notnivc","":"npr","":"npre","":"nprcue","":"NotRightTriangleBar","":"nrtri","":"nrtrie","":"NotSquareSubset","":"nsqsube","":"NotSquareSuperset","":"nsqsupe","":"vnsub","":"nsube","":"nsc","":"nsce","":"nsccue","":"NotSucceedsTilde","":"vnsup","":"nsupe","":"nsim","":"nsime","":"nparsl","":"npart","":"npolint","":"nrarrc","":"nrarr","":"nrArr","":"nrarrw","":"Nscr","":"nscr","":"nsub","":"nsubE","":"nsup","":"nsupE","":"Ntilde","":"ntilde","":"Nu","":"nu","#":"num","":"numero","":"numsp","":"nvap","":"nvdash","":"nvDash","":"nVdash","":"nVDash","":"nvge",">":"nvgt","":"nvHarr","":"nvinfin","":"nvlArr","":"nvle","<":"nvlt","":"nvltrie","":"nvrArr","":"nvrtrie","":"nvsim","":"nwarhk","":"nwarr","":"nwArr","":"nwnear","":"Oacute","":"oacute","":"Ocirc","":"ocirc","":"Ocy","":"ocy","":"Odblac","":"odblac","":"odiv","":"odsold","":"OElig","":"oelig","":"ofcir","":"Ofr","":"ofr","":"ogon","":"Ograve","":"ograve","":"ogt","":"ohbar","":"ohm","":"olcir","":"olcross","":"oline","":"olt","":"Omacr","":"omacr","":"omega","":"Omicron","":"omicron","":"omid","":"Oopf","":"oopf","":"opar","":"operp","":"Or","":"or","":"ord","":"oscr","":"ordf","":"ordm","":"origof","":"oror","":"orslope","":"orv","":"Oscr","":"Oslash","":"oslash","":"osol","":"Otilde","":"otilde","":"otimesas","":"Otimes","":"Ouml","":"ouml","":"ovbar","":"OverBrace","":"tbrk","":"OverParenthesis","":"para","":"parsim","":"parsl","":"part","":"Pcy","":"pcy","%":"percnt",".":"period","":"permil","":"pertenk","":"Pfr","":"pfr","":"Phi","":"phi","":"phiv","":"phone","":"Pi","":"pi","":"piv","":"planckh","":"plusacir","":"pluscir","+":"plus","":"plusdu","":"pluse","":"pm","":"plussim","":"plustwo","":"pointint","":"popf","":"Popf","":"pound","":"prap","":"Pr","":"pr","":"prcue","":"pre","":"prsim","":"prnap","":"prnE","":"prnsim","":"prE","":"prime","":"Prime","":"prod","":"profalar","":"profline","":"profsurf","":"prop","":"prurel","":"Pscr","":"pscr","":"Psi","":"psi","":"puncsp","":"Qfr","":"qfr","":"qopf","":"Qopf","":"qprime","":"Qscr","":"qscr","":"quatint","?":"quest",'"':"quot","":"rAarr","":"race","":"Racute","":"racute","":"Sqrt","":"raemptyv","":"rang","":"Rang","":"rangd","":"range","":"raquo","":"rarrap","":"rarrb","":"rarrbfs","":"rarrc","":"rarr","":"Rarr","":"rarrfs","":"rarrpl","":"rarrsim","":"Rarrtl","":"rarrtl","":"rarrw","":"ratail","":"rAtail","":"ratio","":"rbbrk","}":"rcub","]":"rsqb","":"rbrke","":"rbrksld","":"rbrkslu","":"Rcaron","":"rcaron","":"Rcedil","":"rcedil","":"rceil","":"Rcy","":"rcy","":"rdca","":"rdldhar","":"rdsh","":"Re","":"Rscr","":"Ropf","":"rect","":"rfisht","":"rfloor","":"rfr","":"rHar","":"rharu","":"rharul","":"Rho","":"rho","":"rhov","":"rlarr","":"robrk","":"RightDownTeeVector","":"RightDownVectorBar","":"rrarr","":"vdash","":"RightTeeVector","":"rthree","":"RightTriangleBar","":"vrtri","":"rtrie","":"RightUpDownVector","":"RightUpTeeVector","":"RightUpVectorBar","":"uharr","":"RightVectorBar","":"ring","":"rlm","":"rmoust","":"rnmid","":"roang","":"roarr","":"ropar","":"ropf","":"roplus","":"rotimes","":"RoundImplies",")":"rpar","":"rpargt","":"rppolint","":"rsaquo","":"rscr","":"rsh","":"rtimes","":"rtri","":"rtriltri","":"RuleDelayed","":"ruluhar","":"rx","":"Sacute","":"sacute","":"scap","":"Scaron","":"scaron","":"Sc","":"sc","":"sccue","":"sce","":"scE","":"Scedil","":"scedil","":"Scirc","":"scirc","":"scnap","":"scnE","":"scnsim","":"scpolint","":"scsim","":"Scy","":"scy","":"sdot","":"sdote","":"seArr","":"sect",";":"semi","":"tosa","":"sext","":"Sfr","":"sfr","":"sharp","":"SHCHcy","":"shchcy","":"SHcy","":"shcy","":"uarr","":"shy","":"Sigma","":"sigma","":"sigmaf","":"sim","":"simdot","":"sime","":"simg","":"simgE","":"siml","":"simlE","":"simne","":"simplus","":"simrarr","":"smashp","":"smeparsl","":"smile","":"smt","":"smte","":"smtes","":"SOFTcy","":"softcy","":"solbar","":"solb","/":"sol","":"Sopf","":"sopf","":"spades","":"sqcap","":"sqcaps","":"sqcup","":"sqcups","":"sqsub","":"sqsube","":"sqsup","":"sqsupe","":"squ","":"Sscr","":"sscr","":"Star","":"star","":"sub","":"Sub","":"subdot","":"subE","":"sube","":"subedot","":"submult","":"subnE","":"subne","":"subplus","":"subrarr","":"subsim","":"subsub","":"subsup","":"sum","":"sung","":"sup1","":"sup2","":"sup3","":"sup","":"Sup","":"supdot","":"supdsub","":"supE","":"supe","":"supedot","":"suphsol","":"suphsub","":"suplarr","":"supmult","":"supnE","":"supne","":"supplus","":"supsim","":"supsub","":"supsup","":"swArr","":"swnwar","":"szlig","	":"Tab","":"target","":"Tau","":"tau","":"Tcaron","":"tcaron","":"Tcedil","":"tcedil","":"Tcy","":"tcy","":"tdot","":"telrec","":"Tfr","":"tfr","":"there4","":"Theta","":"theta","":"thetav","":"ThickSpace","":"thinsp","":"THORN","":"thorn","":"timesbar","":"times","":"timesd","":"topbot","":"topcir","":"Topf","":"topf","":"topfork","":"tprime","":"trade","":"utri","":"trie","":"tridot","":"triminus","":"triplus","":"trisb","":"tritime","":"trpezium","":"Tscr","":"tscr","":"TScy","":"tscy","":"TSHcy","":"tshcy","":"Tstrok","":"tstrok","":"Uacute","":"uacute","":"Uarr","":"Uarrocir","":"Ubrcy","":"ubrcy","":"Ubreve","":"ubreve","":"Ucirc","":"ucirc","":"Ucy","":"ucy","":"udarr","":"Udblac","":"udblac","":"udhar","":"ufisht","":"Ufr","":"ufr","":"Ugrave","":"ugrave","":"uHar","":"uhblk","":"ulcorn","":"ulcrop","":"ultri","":"Umacr","":"umacr","":"UnderBrace","":"UnderParenthesis","":"uplus","":"Uogon","":"uogon","":"Uopf","":"uopf","":"UpArrowBar","":"varr","":"upsi","":"Upsi","":"Upsilon","":"uuarr","":"urcorn","":"urcrop","":"Uring","":"uring","":"urtri","":"Uscr","":"uscr","":"utdot","":"Utilde","":"utilde","":"Uuml","":"uuml","":"uwangle","":"vangrt","":"vsubne","":"vsubnE","":"vsupne","":"vsupnE","":"vBar","":"Vbar","":"vBarv","":"Vcy","":"vcy","":"Vdash","":"VDash","":"Vdashl","":"veebar","":"veeeq","":"vellip","|":"vert","":"Vert","":"VerticalSeparator","":"wr","":"Vfr","":"vfr","":"Vopf","":"vopf","":"Vscr","":"vscr","":"Vvdash","":"vzigzag","":"Wcirc","":"wcirc","":"wedbar","":"wedgeq","":"wp","":"Wfr","":"wfr","":"Wopf","":"wopf","":"Wscr","":"wscr","":"Xfr","":"xfr","":"Xi","":"xi","":"xnis","":"Xopf","":"xopf","":"Xscr","":"xscr","":"Yacute","":"yacute","":"YAcy","":"yacy","":"Ycirc","":"ycirc","":"Ycy","":"ycy","":"yen","":"Yfr","":"yfr","":"YIcy","":"yicy","":"Yopf","":"yopf","":"Yscr","":"yscr","":"YUcy","":"yucy","":"yuml","":"Yuml","":"Zacute","":"zacute","":"Zcaron","":"zcaron","":"Zcy","":"zcy","":"Zdot","":"zdot","":"Zfr","":"Zeta","":"zeta","":"zfr","":"ZHcy","":"zhcy","":"zigrarr","":"zopf","":"Zscr","":"zscr","":"zwj","":"zwnj"},f=/["&'<>`]/g,g={'"':"&quot;","&":"&amp;","'":"&#x27;","<":"&lt;",">":"&gt;","`":"&#x60;"},h=/&#(?:[xX][^a-fA-F0-9]|[^0-9xX])/,i=/[\0-\x08\x0B\x0E-\x1F\x7F-\x9F\uFDD0-\uFDEF\uFFFE\uFFFF]|[\uD83F\uD87F\uD8BF\uD8FF\uD93F\uD97F\uD9BF\uD9FF\uDA3F\uDA7F\uDABF\uDAFF\uDB3F\uDB7F\uDBBF\uDBFF][\uDFFE\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,j=/&#([0-9]+)(;?)|&#[xX]([a-fA-F0-9]+)(;?)|&([0-9a-zA-Z]+);|&(Aacute|iacute|Uacute|plusmn|otilde|Otilde|Agrave|agrave|yacute|Yacute|oslash|Oslash|Atilde|atilde|brvbar|Ccedil|ccedil|ograve|curren|divide|Eacute|eacute|Ograve|oacute|Egrave|egrave|ugrave|frac12|frac14|frac34|Ugrave|Oacute|Iacute|ntilde|Ntilde|uacute|middot|Igrave|igrave|iquest|aacute|laquo|THORN|micro|iexcl|icirc|Icirc|Acirc|ucirc|ecirc|Ocirc|ocirc|Ecirc|Ucirc|aring|Aring|aelig|AElig|acute|pound|raquo|acirc|times|thorn|szlig|cedil|COPY|Auml|ordf|ordm|uuml|macr|Uuml|auml|Ouml|ouml|para|nbsp|Euml|quot|QUOT|euml|yuml|cent|sect|copy|sup1|sup2|sup3|Iuml|iuml|shy|eth|reg|not|yen|amp|AMP|REG|uml|ETH|deg|gt|GT|LT|lt)([=a-zA-Z0-9])?/g,k={Aacute:"",aacute:"",Abreve:"",abreve:"",ac:"",acd:"",acE:"",Acirc:"",acirc:"",acute:"",Acy:"",acy:"",AElig:"",aelig:"",af:"",Afr:"",afr:"",Agrave:"",agrave:"",alefsym:"",aleph:"",Alpha:"",alpha:"",Amacr:"",amacr:"",amalg:"",amp:"&",AMP:"&",andand:"",And:"",and:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angmsd:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",Aogon:"",aogon:"",Aopf:"",aopf:"",apacir:"",ap:"",apE:"",ape:"",apid:"",apos:"'",ApplyFunction:"",approx:"",approxeq:"",Aring:"",aring:"",Ascr:"",ascr:"",Assign:"",ast:"*",asymp:"",asympeq:"",Atilde:"",atilde:"",Auml:"",auml:"",awconint:"",awint:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",Backslash:"",Barv:"",barvee:"",barwed:"",Barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",Bcy:"",bcy:"",bdquo:"",becaus:"",because:"",Because:"",bemptyv:"",bepsi:"",bernou:"",Bernoullis:"",Beta:"",beta:"",beth:"",between:"",Bfr:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bNot:"",bnot:"",Bopf:"",bopf:"",bot:"",bottom:"",bowtie:"",boxbox:"",boxdl:"",boxdL:"",boxDl:"",boxDL:"",boxdr:"",boxdR:"",boxDr:"",boxDR:"",boxh:"",boxH:"",boxhd:"",boxHd:"",boxhD:"",boxHD:"",boxhu:"",boxHu:"",boxhU:"",boxHU:"",boxminus:"",boxplus:"",boxtimes:"",boxul:"",boxuL:"",boxUl:"",boxUL:"",boxur:"",boxuR:"",boxUr:"",boxUR:"",boxv:"",boxV:"",boxvh:"",boxvH:"",boxVh:"",boxVH:"",boxvl:"",boxvL:"",boxVl:"",boxVL:"",boxvr:"",boxvR:"",boxVr:"",boxVR:"",bprime:"",breve:"",Breve:"",brvbar:"",bscr:"",Bscr:"",bsemi:"",bsim:"",bsime:"",bsolb:"",bsol:"\\",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",Bumpeq:"",bumpeq:"",Cacute:"",cacute:"",capand:"",capbrcup:"",capcap:"",cap:"",Cap:"",capcup:"",capdot:"",CapitalDifferentialD:"",caps:"",caret:"",caron:"",Cayleys:"",ccaps:"",Ccaron:"",ccaron:"",Ccedil:"",ccedil:"",Ccirc:"",ccirc:"",Cconint:"",ccups:"",ccupssm:"",Cdot:"",cdot:"",cedil:"",Cedilla:"",cemptyv:"",cent:"",centerdot:"",CenterDot:"",cfr:"",Cfr:"",CHcy:"",chcy:"",check:"",checkmark:"",Chi:"",chi:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledast:"",circledcirc:"",circleddash:"",CircleDot:"",circledR:"",circledS:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",cir:"",cirE:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",clubs:"",clubsuit:"",colon:":",Colon:"",Colone:"",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",Congruent:"",conint:"",Conint:"",ContourIntegral:"",copf:"",Copf:"",coprod:"",Coproduct:"",copy:"",COPY:"",copysr:"",CounterClockwiseContourIntegral:"",crarr:"",cross:"",Cross:"",Cscr:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cupbrcap:"",cupcap:"",CupCap:"",cup:"",Cup:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dagger:"",Dagger:"",daleth:"",darr:"",Darr:"",dArr:"",dash:"",Dashv:"",dashv:"",dbkarow:"",dblac:"",Dcaron:"",dcaron:"",Dcy:"",dcy:"",ddagger:"",ddarr:"",DD:"",dd:"",DDotrahd:"",ddotseq:"",deg:"",Del:"",Delta:"",delta:"",demptyv:"",dfisht:"",Dfr:"",dfr:"",dHar:"",dharl:"",dharr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",diam:"",diamond:"",Diamond:"",diamondsuit:"",diams:"",die:"",DifferentialD:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",DJcy:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",Dopf:"",dopf:"",Dot:"",dot:"",DotDot:"",doteq:"",doteqdot:"",DotEqual:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrowBar:"",downarrow:"",DownArrow:"",Downarrow:"",DownArrowUpArrow:"",DownBreve:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVectorBar:"",DownLeftVector:"",DownRightTeeVector:"",DownRightVectorBar:"",DownRightVector:"",DownTeeArrow:"",DownTee:"",drbkarow:"",drcorn:"",drcrop:"",Dscr:"",dscr:"",DScy:"",dscy:"",dsol:"",Dstrok:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",DZcy:"",dzcy:"",dzigrarr:"",Eacute:"",eacute:"",easter:"",Ecaron:"",ecaron:"",Ecirc:"",ecirc:"",ecir:"",ecolon:"",Ecy:"",ecy:"",eDDot:"",Edot:"",edot:"",eDot:"",ee:"",efDot:"",Efr:"",efr:"",eg:"",Egrave:"",egrave:"",egs:"",egsdot:"",el:"",Element:"",elinters:"",ell:"",els:"",elsdot:"",Emacr:"",emacr:"",empty:"",emptyset:"",EmptySmallSquare:"",emptyv:"",EmptyVerySmallSquare:"",emsp13:"",emsp14:"",emsp:"",ENG:"",eng:"",ensp:"",Eogon:"",eogon:"",Eopf:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",Epsilon:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",Equal:"",equals:"=",EqualTilde:"",equest:"",Equilibrium:"",equiv:"",equivDD:"",eqvparsl:"",erarr:"",erDot:"",escr:"",Escr:"",esdot:"",Esim:"",esim:"",Eta:"",eta:"",ETH:"",eth:"",Euml:"",euml:"",euro:"",excl:"!",exist:"",Exists:"",expectation:"",exponentiale:"",ExponentialE:"",fallingdotseq:"",Fcy:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",Ffr:"",ffr:"",filig:"",FilledSmallSquare:"",FilledVerySmallSquare:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",Fopf:"",fopf:"",forall:"",ForAll:"",fork:"",forkv:"",Fouriertrf:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",Fscr:"",gacute:"",Gamma:"",gamma:"",Gammad:"",gammad:"",gap:"",Gbreve:"",gbreve:"",Gcedil:"",Gcirc:"",gcirc:"",Gcy:"",gcy:"",Gdot:"",gdot:"",ge:"",gE:"",gEl:"",gel:"",geq:"",geqq:"",geqslant:"",gescc:"",ges:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",Gfr:"",gfr:"",gg:"",Gg:"",ggg:"",gimel:"",GJcy:"",gjcy:"",gla:"",gl:"",glE:"",glj:"",gnap:"",gnapprox:"",gne:"",gnE:"",gneq:"",gneqq:"",gnsim:"",Gopf:"",gopf:"",grave:"`",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",gscr:"",gsim:"",gsime:"",gsiml:"",gtcc:"",gtcir:"",gt:">",GT:">",Gt:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",Hacek:"",hairsp:"",half:"",hamilt:"",HARDcy:"",hardcy:"",harrcir:"",harr:"",hArr:"",harrw:"",Hat:"^",hbar:"",Hcirc:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",Hfr:"",HilbertSpace:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",Hopf:"",horbar:"",HorizontalLine:"",hscr:"",Hscr:"",hslash:"",Hstrok:"",hstrok:"",HumpDownHump:"",HumpEqual:"",hybull:"",hyphen:"",Iacute:"",iacute:"",ic:"",Icirc:"",icirc:"",Icy:"",icy:"",Idot:"",IEcy:"",iecy:"",iexcl:"",iff:"",ifr:"",Ifr:"",Igrave:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",IJlig:"",ijlig:"",Imacr:"",imacr:"",image:"",ImaginaryI:"",imagline:"",imagpart:"",imath:"",Im:"",imof:"",imped:"",Implies:"",incare:"","in":"",infin:"",infintie:"",inodot:"",intcal:"","int":"",Int:"",integers:"",Integral:"",intercal:"",Intersection:"",intlarhk:"",intprod:"",InvisibleComma:"",InvisibleTimes:"",IOcy:"",iocy:"",Iogon:"",iogon:"",Iopf:"",iopf:"",Iota:"",iota:"",iprod:"",iquest:"",iscr:"",Iscr:"",isin:"",isindot:"",isinE:"",isins:"",isinsv:"",isinv:"",it:"",Itilde:"",itilde:"",Iukcy:"",iukcy:"",Iuml:"",iuml:"",Jcirc:"",jcirc:"",Jcy:"",jcy:"",Jfr:"",jfr:"",jmath:"",Jopf:"",jopf:"",Jscr:"",jscr:"",Jsercy:"",jsercy:"",Jukcy:"",jukcy:"",Kappa:"",kappa:"",kappav:"",Kcedil:"",kcedil:"",Kcy:"",kcy:"",Kfr:"",kfr:"",kgreen:"",KHcy:"",khcy:"",KJcy:"",kjcy:"",Kopf:"",kopf:"",Kscr:"",kscr:"",lAarr:"",Lacute:"",lacute:"",laemptyv:"",lagran:"",Lambda:"",lambda:"",lang:"",Lang:"",langd:"",langle:"",lap:"",Laplacetrf:"",laquo:"",larrb:"",larrbfs:"",larr:"",Larr:"",lArr:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",latail:"",lAtail:"",lat:"",late:"",lates:"",lbarr:"",lBarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",Lcaron:"",lcaron:"",Lcedil:"",lcedil:"",lceil:"",lcub:"{",Lcy:"",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",lE:"",LeftAngleBracket:"",LeftArrowBar:"",leftarrow:"",LeftArrow:"",Leftarrow:"",LeftArrowRightArrow:"",leftarrowtail:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVectorBar:"",LeftDownVector:"",LeftFloor:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",LeftRightArrow:"",Leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",LeftRightVector:"",LeftTeeArrow:"",LeftTee:"",LeftTeeVector:"",leftthreetimes:"",LeftTriangleBar:"",LeftTriangle:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVectorBar:"",LeftUpVector:"",LeftVectorBar:"",LeftVector:"",lEg:"",leg:"",leq:"",leqq:"",leqslant:"",lescc:"",les:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",lessgtr:"",LessLess:"",lesssim:"",LessSlantEqual:"",LessTilde:"",lfisht:"",lfloor:"",Lfr:"",lfr:"",lg:"",lgE:"",lHar:"",lhard:"",lharu:"",lharul:"",lhblk:"",LJcy:"",ljcy:"",llarr:"",ll:"",Ll:"",llcorner:"",Lleftarrow:"",llhard:"",lltri:"",Lmidot:"",lmidot:"",lmoustache:"",lmoust:"",lnap:"",lnapprox:"",lne:"",lnE:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",LongLeftArrow:"",Longleftarrow:"",longleftrightarrow:"",LongLeftRightArrow:"",Longleftrightarrow:"",longmapsto:"",longrightarrow:"",LongRightArrow:"",Longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",Lopf:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",LowerLeftArrow:"",LowerRightArrow:"",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",Lscr:"",lsh:"",Lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",Lstrok:"",lstrok:"",ltcc:"",ltcir:"",lt:"<",LT:"<",Lt:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltri:"",ltrie:"",ltrif:"",ltrPar:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",macr:"",male:"",malt:"",maltese:"",Map:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",Mcy:"",mcy:"",mdash:"",mDDot:"",measuredangle:"",MediumSpace:"",Mellintrf:"",Mfr:"",mfr:"",mho:"",micro:"",midast:"*",midcir:"",mid:"",middot:"",minusb:"",minus:"",minusd:"",minusdu:"",MinusPlus:"",mlcp:"",mldr:"",mnplus:"",models:"",Mopf:"",mopf:"",mp:"",mscr:"",Mscr:"",mstpos:"",Mu:"",mu:"",multimap:"",mumap:"",nabla:"",Nacute:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natural:"",naturals:"",natur:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",Ncaron:"",ncaron:"",Ncedil:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",Ncy:"",ncy:"",ndash:"",nearhk:"",nearr:"",neArr:"",nearrow:"",ne:"",nedot:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",nequiv:"",nesear:"",nesim:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",nexist:"",nexists:"",Nfr:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",nGg:"",ngsim:"",nGt:"",ngt:"",ngtr:"",nGtv:"",nharr:"",nhArr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",NJcy:"",njcy:"",nlarr:"",nlArr:"",nldr:"",nlE:"",nle:"",nleftarrow:"",nLeftarrow:"",nleftrightarrow:"",nLeftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nLl:"",nlsim:"",nLt:"",nlt:"",nltri:"",nltrie:"",nLtv:"",nmid:"",NoBreak:"",NonBreakingSpace:"",nopf:"",Nopf:"",Not:"",not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",notin:"",notindot:"",notinE:"",notinva:"",notinvb:"",notinvc:"",NotLeftTriangleBar:"",NotLeftTriangle:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",notni:"",notniva:"",notnivb:"",notnivc:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangleBar:"",NotRightTriangle:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",nparallel:"",npar:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",nprec:"",npreceq:"",npre:"",nrarrc:"",nrarr:"",nrArr:"",nrarrw:"",nrightarrow:"",nRightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",Nscr:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",Ntilde:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",Nu:"",nu:"",num:"#",numero:"",numsp:"",nvap:"",nvdash:"",nvDash:"",nVdash:"",nVDash:"",nvge:"",nvgt:">",nvHarr:"",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwarhk:"",nwarr:"",nwArr:"",nwarrow:"",nwnear:"",Oacute:"",oacute:"",oast:"",Ocirc:"",ocirc:"",ocir:"",Ocy:"",ocy:"",odash:"",Odblac:"",odblac:"",odiv:"",odot:"",odsold:"",OElig:"",oelig:"",ofcir:"",Ofr:"",ofr:"",ogon:"",Ograve:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",Omacr:"",omacr:"",Omega:"",omega:"",Omicron:"",omicron:"",omid:"",ominus:"",Oopf:"",oopf:"",opar:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",operp:"",oplus:"",orarr:"",Or:"",or:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oS:"",Oscr:"",oscr:"",Oslash:"",oslash:"",osol:"",Otilde:"",otilde:"",otimesas:"",Otimes:"",otimes:"",Ouml:"",ouml:"",ovbar:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",para:"",parallel:"",par:"",parsim:"",parsl:"",part:"",PartialD:"",Pcy:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",Pfr:"",pfr:"",Phi:"",phi:"",phiv:"",phmmat:"",phone:"",Pi:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plusacir:"",plusb:"",pluscir:"",plus:"+",plusdo:"",plusdu:"",pluse:"",PlusMinus:"",plusmn:"",plussim:"",plustwo:"",pm:"",Poincareplane:"",pointint:"",popf:"",Popf:"",pound:"",prap:"",Pr:"",pr:"",prcue:"",precapprox:"",prec:"",preccurlyeq:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",pre:"",prE:"",precsim:"",prime:"",Prime:"",primes:"",prnap:"",prnE:"",prnsim:"",prod:"",Product:"",profalar:"",profline:"",profsurf:"",prop:"",Proportional:"",Proportion:"",propto:"",prsim:"",prurel:"",Pscr:"",pscr:"",Psi:"",psi:"",puncsp:"",Qfr:"",qfr:"",qint:"",qopf:"",Qopf:"",qprime:"",Qscr:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',QUOT:'"',rAarr:"",race:"",Racute:"",racute:"",radic:"",raemptyv:"",rang:"",Rang:"",rangd:"",range:"",rangle:"",raquo:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarr:"",Rarr:"",rArr:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",Rarrtl:"",rarrtl:"",rarrw:"",ratail:"",rAtail:"",ratio:"",rationals:"",rbarr:"",rBarr:"",RBarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",Rcaron:"",rcaron:"",Rcedil:"",rcedil:"",rceil:"",rcub:"}",Rcy:"",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",Re:"",rect:"",reg:"",REG:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",rfisht:"",rfloor:"",rfr:"",Rfr:"",rHar:"",rhard:"",rharu:"",rharul:"",Rho:"",rho:"",rhov:"",RightAngleBracket:"",RightArrowBar:"",rightarrow:"",RightArrow:"",Rightarrow:"",RightArrowLeftArrow:"",rightarrowtail:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVectorBar:"",RightDownVector:"",RightFloor:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",RightTeeArrow:"",RightTee:"",RightTeeVector:"",rightthreetimes:"",RightTriangleBar:"",RightTriangle:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVectorBar:"",RightUpVector:"",RightVectorBar:"",RightVector:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoustache:"",rmoust:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",Ropf:"",roplus:"",rotimes:"",RoundImplies:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",Rrightarrow:"",rsaquo:"",rscr:"",Rscr:"",rsh:"",Rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",RuleDelayed:"",ruluhar:"",rx:"",Sacute:"",sacute:"",sbquo:"",scap:"",Scaron:"",scaron:"",Sc:"",sc:"",sccue:"",sce:"",scE:"",Scedil:"",scedil:"",Scirc:"",scirc:"",scnap:"",scnE:"",scnsim:"",scpolint:"",scsim:"",Scy:"",scy:"",sdotb:"",sdot:"",sdote:"",searhk:"",searr:"",seArr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",Sfr:"",sfr:"",sfrown:"",sharp:"",SHCHcy:"",shchcy:"",SHcy:"",shcy:"",ShortDownArrow:"",ShortLeftArrow:"",shortmid:"",shortparallel:"",ShortRightArrow:"",ShortUpArrow:"",shy:"",Sigma:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",SmallCircle:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",SOFTcy:"",softcy:"",solbar:"",solb:"",sol:"/",Sopf:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",Sqrt:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",square:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",squarf:"",squ:"",squf:"",srarr:"",Sscr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",Star:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",Sub:"",subdot:"",subE:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",Subset:"",subseteq:"",subseteqq:"",SubsetEqual:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succapprox:"",succ:"",succcurlyeq:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",SuchThat:"",sum:"",Sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",Sup:"",supdot:"",supdsub:"",supE:"",supe:"",supedot:"",Superset:"",SupersetEqual:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",Supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swarhk:"",swarr:"",swArr:"",swarrow:"",swnwar:"",szlig:"",Tab:"	",target:"",Tau:"",tau:"",tbrk:"",Tcaron:"",tcaron:"",Tcedil:"",tcedil:"",Tcy:"",tcy:"",tdot:"",telrec:"",Tfr:"",tfr:"",there4:"",therefore:"",Therefore:"",Theta:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",ThickSpace:"",ThinSpace:"",thinsp:"",thkap:"",thksim:"",THORN:"",thorn:"",tilde:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",timesbar:"",timesb:"",times:"",timesd:"",tint:"",toea:"",topbot:"",topcir:"",top:"",Topf:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",TRADE:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",TripleDot:"",triplus:"",trisb:"",tritime:"",trpezium:"",Tscr:"",tscr:"",TScy:"",tscy:"",TSHcy:"",tshcy:"",Tstrok:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",Uacute:"",uacute:"",uarr:"",Uarr:"",uArr:"",Uarrocir:"",Ubrcy:"",ubrcy:"",Ubreve:"",ubreve:"",Ucirc:"",ucirc:"",Ucy:"",ucy:"",udarr:"",Udblac:"",udblac:"",udhar:"",ufisht:"",Ufr:"",ufr:"",Ugrave:"",ugrave:"",uHar:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",Umacr:"",umacr:"",uml:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",uogon:"",Uopf:"",uopf:"",UpArrowBar:"",uparrow:"",UpArrow:"",Uparrow:"",UpArrowDownArrow:"",updownarrow:"",UpDownArrow:"",Updownarrow:"",UpEquilibrium:"",upharpoonleft:"",upharpoonright:"",uplus:"",UpperLeftArrow:"",UpperRightArrow:"",upsi:"",Upsi:"",upsih:"",Upsilon:"",upsilon:"",UpTeeArrow:"",UpTee:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",Uring:"",uring:"",urtri:"",Uscr:"",uscr:"",utdot:"",Utilde:"",utilde:"",utri:"",utrif:"",uuarr:"",Uuml:"",uuml:"",uwangle:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",vArr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vBar:"",Vbar:"",vBarv:"",Vcy:"",vcy:"",vdash:"",vDash:"",Vdash:"",VDash:"",Vdashl:"",veebar:"",vee:"",Vee:"",veeeq:"",vellip:"",verbar:"|",Verbar:"",vert:"|",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",vfr:"",vltri:"",vnsub:"",vnsup:"",Vopf:"",vopf:"",vprop:"",vrtri:"",Vscr:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",Vvdash:"",vzigzag:"",Wcirc:"",wcirc:"",wedbar:"",wedge:"",Wedge:"",wedgeq:"",weierp:"",Wfr:"",wfr:"",Wopf:"",wopf:"",wp:"",wr:"",wreath:"",Wscr:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",Xfr:"",xfr:"",xharr:"",xhArr:"",Xi:"",xi:"",xlarr:"",xlArr:"",xmap:"",xnis:"",xodot:"",Xopf:"",xopf:"",xoplus:"",xotime:"",xrarr:"",xrArr:"",Xscr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",Yacute:"",yacute:"",YAcy:"",yacy:"",Ycirc:"",ycirc:"",Ycy:"",ycy:"",yen:"",Yfr:"",yfr:"",YIcy:"",yicy:"",Yopf:"",yopf:"",Yscr:"",yscr:"",YUcy:"",yucy:"",yuml:"",Yuml:"",Zacute:"",zacute:"",Zcaron:"",zcaron:"",Zcy:"",zcy:"",Zdot:"",zdot:"",zeetrf:"",ZeroWidthSpace:"",Zeta:"",zeta:"",zfr:"",Zfr:"",ZHcy:"",zhcy:"",zigrarr:"",zopf:"",Zopf:"",Zscr:"",zscr:"",zwj:"",zwnj:""},l={Aacute:"",aacute:"",Acirc:"",acirc:"",acute:"",AElig:"",aelig:"",Agrave:"",agrave:"",amp:"&",AMP:"&",Aring:"",aring:"",Atilde:"",atilde:"",Auml:"",auml:"",brvbar:"",Ccedil:"",ccedil:"",cedil:"",cent:"",copy:"",COPY:"",curren:"",deg:"",divide:"",Eacute:"",eacute:"",Ecirc:"",ecirc:"",Egrave:"",egrave:"",ETH:"",eth:"",Euml:"",euml:"",frac12:"",frac14:"",frac34:"",gt:">",GT:">",Iacute:"",iacute:"",Icirc:"",icirc:"",iexcl:"",Igrave:"",igrave:"",iquest:"",Iuml:"",iuml:"",laquo:"",lt:"<",LT:"<",macr:"",micro:"",middot:"",nbsp:"",not:"",Ntilde:"",ntilde:"",Oacute:"",oacute:"",Ocirc:"",ocirc:"",Ograve:"",ograve:"",ordf:"",ordm:"",Oslash:"",oslash:"",Otilde:"",otilde:"",Ouml:"",ouml:"",para:"",plusmn:"",pound:"",quot:'"',QUOT:'"',raquo:"",reg:"",REG:"",sect:"",shy:"",sup1:"",sup2:"",sup3:"",szlig:"",THORN:"",thorn:"",times:"",Uacute:"",uacute:"",Ucirc:"",ucirc:"",Ugrave:"",ugrave:"",uml:"",Uuml:"",uuml:"",Yacute:"",yacute:"",yen:"",yuml:""},m={0:"",128:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",142:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",158:"",159:""},n=[1,2,3,4,5,6,7,8,11,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,64976,64977,64978,64979,64980,64981,64982,64983,64984,64985,64986,64987,64988,64989,64990,64991,64992,64993,64994,64995,64996,64997,64998,64999,65e3,65001,65002,65003,65004,65005,65006,65007,65534,65535,131070,131071,196606,196607,262142,262143,327678,327679,393214,393215,458750,458751,524286,524287,589822,589823,655358,655359,720894,720895,786430,786431,851966,851967,917502,917503,983038,983039,1048574,1048575,1114110,1114111],o=String.fromCharCode,p={},q=p.hasOwnProperty,r=function(a,b){return q.call(a,b)
},s=function(a,b){for(var c=-1,d=a.length;++c<d;)if(a[c]==b)return!0;return!1},t=function(a,b){if(!a)return b;var c,d={};for(c in b)d[c]=r(a,c)?a[c]:b[c];return d},u=function(a,b){var c="";return a>=55296&&57343>=a||a>1114111?(b&&w("character reference outside the permissible Unicode range"),""):r(m,a)?(b&&w("disallowed character reference"),m[a]):(b&&s(n,a)&&w("disallowed character reference"),a>65535&&(a-=65536,c+=o(a>>>10&1023|55296),a=56320|1023&a),c+=o(a))},v=function(a){return"&#x"+a.charCodeAt(0).toString(16).toUpperCase()+";"},w=function(a){throw Error("Parse error: "+a)},x=function(g,h){h=t(h,x.options);var j=h.strict;j&&i.test(g)&&w("forbidden code point");var k=h.encodeEverything,l=h.useNamedReferences,m=h.allowUnsafeSymbols;return k?(g=g.replace(b,function(a){return l&&r(e,a)?"&"+e[a]+";":v(a)}),l&&(g=g.replace(/&gt;\u20D2/g,"&nvgt;").replace(/&lt;\u20D2/g,"&nvlt;").replace(/&#x66;&#x6A;/g,"&fjlig;")),l&&(g=g.replace(d,function(a){return"&"+e[a]+";"}))):l?(m||(g=g.replace(f,function(a){return"&"+e[a]+";"})),g=g.replace(/&gt;\u20D2/g,"&nvgt;").replace(/&lt;\u20D2/g,"&nvlt;"),g=g.replace(d,function(a){return"&"+e[a]+";"})):m||(g=g.replace(f,v)),g.replace(a,function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=1024*(b-55296)+c-56320+65536;return"&#x"+d.toString(16).toUpperCase()+";"}).replace(c,v)};x.options={allowUnsafeSymbols:!1,encodeEverything:!1,strict:!1,useNamedReferences:!1};var y=function(a,b){b=t(b,y.options);var c=b.strict;return c&&h.test(a)&&w("malformed character reference"),a.replace(j,function(a,d,e,f,g,h,i,j){var m,n,o,p,q;return d?(m=d,n=e,c&&!n&&w("character reference was not terminated by a semicolon"),u(m,c)):f?(o=f,n=g,c&&!n&&w("character reference was not terminated by a semicolon"),m=parseInt(o,16),u(m,c)):h?(p=h,r(k,p)?k[p]:(c&&w("named character reference was not terminated by a semicolon"),a)):(p=i,q=j,q&&b.isAttributeValue?(c&&"="==q&&w("`&` did not start a character reference"),a):(c&&w("named character reference was not terminated by a semicolon"),l[p]+(q||"")))})};y.options={isAttributeValue:!1,strict:!1};var z=function(a){return a.replace(f,function(a){return g[a]})},A={version:"0.5.0",encode:x,decode:y,escape:z,unescape:y};rg2.he=A}();