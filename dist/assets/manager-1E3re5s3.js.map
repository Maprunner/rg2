{"version":3,"file":"manager-1E3re5s3.js","sources":["../../src/js/courseparser.js","../../src/js/resultparsercsv.js","../../src/js/resultparseriofv2.js","../../src/js/resultparseriofv3.js","../../src/js/resultparser.js","../../src/js/manager.js"],"sourcesContent":["import { Controls } from \"./controls\"\r\nimport { showWarningDialog } from \"./utils\"\r\n\r\nexport class CourseParser {\r\n  constructor(e, worldfile, localWorldfile) {\r\n    this.courses = []\r\n    this.courseClassMapping = []\r\n    this.newcontrols = new Controls()\r\n    this.courses.length = 0\r\n    this.courseClassMapping.length = 0\r\n    this.fromOldCondes = false\r\n    this.coursesGeoreferenced = false\r\n    this.newcontrols.deleteAllControls()\r\n    // holding copies of worldfiles: not ideal but it works\r\n    this.localWorldfile = localWorldfile\r\n    this.worldfile = worldfile\r\n    this.processCoursesXML(e.target.result)\r\n    this.addControlCount()\r\n    return {\r\n      courses: this.courses,\r\n      newcontrols: this.newcontrols,\r\n      mapping: this.courseClassMapping,\r\n      georeferenced: this.coursesGeoreferenced\r\n    }\r\n  }\r\n\r\n  processCoursesXML(rawXML) {\r\n    let xml = null\r\n    try {\r\n      xml = new DOMParser().parseFromString(rawXML, \"text/xml\")\r\n    } catch (err) {\r\n      showWarningDialog(\"XML file error\", \"File is not a valid XML course file.\")\r\n      return\r\n    }\r\n    const nodelist = xml.getElementsByTagName(\"CourseData\")\r\n    if (nodelist.length === 0) {\r\n      if (xml.documentElement.nodeName === \"kml\") {\r\n        this.processKMLCourses(xml)\r\n      } else {\r\n        showWarningDialog(\"XML file error\", \"File is not a valid XML course file. CourseData element missing.\")\r\n      }\r\n      return\r\n    }\r\n    const version = this.getVersion(xml)\r\n    switch (version) {\r\n      case \"2.0.3\":\r\n        this.processIOFV2XMLCourses(xml)\r\n        break\r\n      case \"3.0\":\r\n        this.processIOFV3XMLCourses(xml)\r\n        break\r\n      default:\r\n        showWarningDialog(\"XML file error\", \"Invalid IOF file format. Version \" + version + \" not supported.\")\r\n    }\r\n  }\r\n\r\n  getVersion(xml) {\r\n    let version = \"\"\r\n    // test for IOF Version 2\r\n    let nodelist = xml.getElementsByTagName(\"IOFVersion\")\r\n    if (nodelist.length > 0) {\r\n      version = nodelist[0].getAttribute(\"version\")\r\n    }\r\n    if (version === \"\") {\r\n      // test for IOF Version 3\r\n      nodelist = xml.getElementsByTagName(\"CourseData\")\r\n      if (nodelist.length > 0) {\r\n        version = nodelist[0].getAttribute(\"iofVersion\").trim()\r\n        this.setCreator(nodelist[0].getAttribute(\"creator\").trim())\r\n      }\r\n    }\r\n    return version\r\n  }\r\n\r\n  setCreator(text) {\r\n    // creator looks like \"Condes version 10.1.1\": need to extract version number\r\n    const introLength = 15\r\n    // allow handling of files from Condes before v10.1 which use original worldfile rather than WGS-84 as expected by IOF scheme\r\n    if (text.indexOf(\"Condes\") > -1) {\r\n      if (text.length > introLength) {\r\n        // parseFloat ignores everything from second decimal poin if it finds one\r\n        // so we will get something like 10.1 from 10.1.1\r\n        const version = parseFloat(text.substring(introLength))\r\n        if (version < 10.1) {\r\n          this.fromOldCondes = true\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  processIOFV3XMLCourses(xml) {\r\n    // extract all controls\r\n    let nodelist = xml.getElementsByTagName(\"Control\")\r\n    // only need first-level Controls\r\n    let pt = { x: 0, y: 0 }\r\n    let controls = []\r\n    for (let i = 0; i < nodelist.length; i += 1) {\r\n      if (nodelist[i].parentNode.nodeName === \"RaceCourseData\") {\r\n        const code = nodelist[i].getElementsByTagName(\"Id\")[0].textContent\r\n        const latlng = nodelist[i].getElementsByTagName(\"Position\")\r\n        if (this.localWorldfile.valid && latlng.length > 0) {\r\n          pt = this.getXYFromLatLng(latlng)\r\n          this.coursesGeoreferenced = true\r\n        } else {\r\n          // only works if all controls have lat/lon or none do: surely a safe assumption...\r\n          pt = this.getXYFromMapPosition(nodelist[i].getElementsByTagName(\"MapPosition\"))\r\n        }\r\n        let control = {}\r\n        // don't want to save crossing points\r\n        if (nodelist[i].getAttribute(\"type\") !== \"CrossingPoint\") {\r\n          this.newcontrols.addControl(code.trim(), pt.x, pt.y)\r\n          control.id = i\r\n          if (latlng.length > 0) {\r\n            control.lat = parseFloat(latlng[0].getAttribute(\"lat\"))\r\n            control.lng = parseFloat(latlng[0].getAttribute(\"lng\"))\r\n          } else {\r\n            control.lat = 0\r\n            control.lng = 0\r\n          }\r\n          control.x = pt.x\r\n          control.y = pt.y\r\n          controls.push(control)\r\n        }\r\n      }\r\n    }\r\n    // extract all courses\r\n    nodelist = xml.getElementsByTagName(\"Course\")\r\n    this.extractV3Courses(nodelist)\r\n    // extract all course/class mappings\r\n    nodelist = xml.getElementsByTagName(\"ClassCourseAssignment\")\r\n    this.extractV3CourseClassMapping(nodelist)\r\n  }\r\n\r\n  processKMLCourses(xml) {\r\n    // reads OOM KML files: assumes we have a WGS-84 georeferenced map...\r\n    // extract all controls\r\n    let controls = []\r\n    this.coursesGeoreferenced = true\r\n    const places = xml.getElementsByTagName(\"Placemark\")\r\n    for (let i = 0; i < places.length; i = i + 1) {\r\n      let pt = {}\r\n      const code = places[i].getElementsByTagName(\"name\")[0].childNodes[0].nodeValue.trim()\r\n      const point = places[i].getElementsByTagName(\"Point\")[0]\r\n      const coords = point.getElementsByTagName(\"coordinates\")[0].childNodes[0].nodeValue.trim().split(\",\")\r\n      const lat = +coords[1]\r\n      const lng = +coords[0]\r\n      pt.x = this.worldfile.getX(lng, lat)\r\n      pt.y = this.worldfile.getY(lng, lat)\r\n      this.newcontrols.addControl(code.trim(), pt.x, pt.y)\r\n      let control = {}\r\n      control.id = i + 1\r\n      control.lat = lat\r\n      control.lng = lng\r\n      control.x = pt.x\r\n      control.y = pt.y\r\n      controls.push(control)\r\n    }\r\n    // set up dummy score course\r\n    let codes = []\r\n    const courseName = \"Course 1\"\r\n    const className = \"Course 1\"\r\n    codes = this.newcontrols.controls.map(function (control) {\r\n      return control.code\r\n    })\r\n    // courseid 0 for now: set when result mapping is known\r\n    this.courses.push({\r\n      courseid: 0,\r\n      x: [],\r\n      y: [],\r\n      codes: codes,\r\n      name: courseName\r\n    })\r\n    this.courseClassMapping.push({ course: courseName, className: className })\r\n    document.getElementById(\"rg2-select-course-file\").classList.add(\"is-valid\")\r\n  }\r\n\r\n  getXYFromLatLng(latLng) {\r\n    let pt = { x: 0, y: 0 }\r\n    const lat = parseFloat(latLng[0].getAttribute(\"lat\"))\r\n    const lng = parseFloat(latLng[0].getAttribute(\"lng\"))\r\n    // handle old Condes-specific georeferencing\r\n    if (this.fromOldCondes) {\r\n      // use original map worldfile\r\n      pt.x = this.localWorldfile.getX(lng, lat)\r\n      pt.y = this.localWorldfile.getY(lng, lat)\r\n    } else {\r\n      // use WGS-84 worldfile as expected (?) by IOF V3 schema\r\n      pt.x = this.worldfile.getX(lng, lat)\r\n      pt.y = this.worldfile.getY(lng, lat)\r\n    }\r\n    return pt\r\n  }\r\n\r\n  processIOFV2XMLCourses(xml) {\r\n    // extract all start controls\r\n    this.extractV2Controls(xml.getElementsByTagName(\"StartPoint\"), \"StartPointCode\")\r\n    // extract all normal controls\r\n    this.extractV2Controls(xml.getElementsByTagName(\"Control\"), \"ControlCode\")\r\n    // extract all finish controls\r\n    this.coursesGeoreferenced = this.extractV2Controls(xml.getElementsByTagName(\"FinishPoint\"), \"FinishPointCode\")\r\n    if (this.coursesGeoreferenced) {\r\n      if (this.localWorldfile.valid) {\r\n        for (let i = 0; i < this.newcontrols.controls.length; i += 1) {\r\n          const x = this.newcontrols.controls[i].x\r\n          const y = this.newcontrols.controls[i].y\r\n          this.newcontrols.controls[i].x = this.localWorldfile.getX(x, y)\r\n          this.newcontrols.controls[i].y = this.localWorldfile.getY(x, y)\r\n        }\r\n      }\r\n    }\r\n    // extract all courses\r\n    this.extractV2Courses(xml.getElementsByTagName(\"Course\"))\r\n  }\r\n\r\n  extractV2Courses(nodelist) {\r\n    for (let i = 0; i < nodelist.length; i += 1) {\r\n      let codes = []\r\n      let x = []\r\n      let y = []\r\n      const name = nodelist[i].getElementsByTagName(\"CourseName\")[0].textContent.trim()\r\n      codes = this.extractCodesFromControlList(nodelist[i], \"ControlCode\")\r\n      // add start code at beginning of array\r\n      codes.unshift(nodelist[i].getElementsByTagName(\"StartPointCode\")[0].textContent.trim())\r\n      codes.push(nodelist[i].getElementsByTagName(\"FinishPointCode\")[0].textContent.trim())\r\n      // courseid 0 for now: set when result mapping is known\r\n      this.courses.push({ courseid: 0, x: x, y: y, codes: codes, name: name })\r\n    }\r\n    document.getElementById(\"rg2-select-course-file\").classList.add(\"is-valid\")\r\n  }\r\n\r\n  extractV3Courses(nodelist) {\r\n    for (let i = 0; i < nodelist.length; i += 1) {\r\n      let codes = []\r\n      let x = []\r\n      let y = []\r\n      const name = nodelist[i].getElementsByTagName(\"Name\")[0].textContent.trim()\r\n      codes = this.extractCodesFromControlList(nodelist[i], \"Control\")\r\n      // courseid 0 for now: set when result mapping is known\r\n      this.courses.push({ courseid: 0, x: x, y: y, codes: codes, name: name })\r\n    }\r\n    document.getElementById(\"rg2-select-course-file\").classList.add(\"is-valid\")\r\n  }\r\n\r\n  extractV3CourseClassMapping(nodelist) {\r\n    for (let i = 0; i < nodelist.length; i += 1) {\r\n      const course = nodelist[i].getElementsByTagName(\"CourseName\")[0].textContent.trim()\r\n      const className = nodelist[i].getElementsByTagName(\"ClassName\")[0].textContent.trim()\r\n      this.courseClassMapping.push({ course: course, className: className })\r\n    }\r\n    document.getElementById(\"rg2-select-course-file\").classList.add(\"is-valid\")\r\n  }\r\n\r\n  extractCodesFromControlList(nodeList, tagName) {\r\n    // tagName depends on IOF version being parsed\r\n    const controlList = nodeList.getElementsByTagName(\"CourseControl\")\r\n    let codes = []\r\n    for (let i = 0; i < controlList.length; i += 1) {\r\n      // OCAD course files add a \"Start\" control at map changes which shows\r\n      // shows up as a spurious control unless we ignore it here\r\n      if (i === 0 || controlList[i].getAttribute(\"type\") !== \"Start\") {\r\n        const code = controlList[i].getElementsByTagName(tagName)[0].textContent.trim();\r\n        // if control code doesn't exist it was a crossing point so we don't need it\r\n        if (this.validControlCode(code)) {\r\n          codes.push(code);\r\n        }\r\n      }\r\n    }\r\n    return codes\r\n  }\r\n\r\n  // returns true if controls are georeferenced\r\n  extractV2Controls(nodelist, type) {\r\n    let isGeoref = false\r\n    let pt = { x: 0, y: 0 }\r\n    for (let i = 0; i < nodelist.length; i += 1) {\r\n      const code = nodelist[i].getElementsByTagName(type)[0].textContent\r\n      const geopos = nodelist[i].getElementsByTagName(\"ControlPosition\")\r\n      // subtle bug and a half #190\r\n      // if you have an IOF XML V2 file which has georeferenced controls AND\r\n      // the map file itself isn't georeferenced\r\n      // then you need to use X, Y and not the georeferenced co-ordinates\r\n      if (geopos.length > 0 && this.localWorldfile.valid) {\r\n        pt.x = parseFloat(geopos[0].getAttribute(\"x\"))\r\n        pt.y = parseFloat(geopos[0].getAttribute(\"y\"))\r\n        isGeoref = true\r\n      } else {\r\n        pt = this.getXYFromMapPosition(nodelist[i].getElementsByTagName(\"MapPosition\"))\r\n      }\r\n      this.newcontrols.addControl(code.trim(), pt.x, pt.y)\r\n    }\r\n    return isGeoref\r\n  }\r\n\r\n  getXYFromMapPosition(mapPosition) {\r\n    // #269 allow for getting a comma instead of a decimal point\r\n    return {\r\n      x: mapPosition[0].getAttribute(\"x\").replace(\",\", \".\"),\r\n      y: mapPosition[0].getAttribute(\"y\").replace(\",\", \".\")\r\n    }\r\n  }\r\n\r\n  // check if a given control code is in the list of known controls\r\n  validControlCode(code) {\r\n    const controls = this.newcontrols.controls\r\n    for (let i = 0; i < controls.length; i += 1) {\r\n      if (controls[i].code === code) {\r\n        return true\r\n      }\r\n    }\r\n    return false\r\n  }\r\n\r\n  addControlCount() {\r\n    for (let i = 0; i < this.courses.length; i += 1) {\r\n      // codes include S and F so need to subtract 2 from length\r\n      this.courses[i].controlcount = this.courses[i].codes.length - 2\r\n    }\r\n  }\r\n}\r\n","import { formatSecsAsMMSS, getSecsFromHHMM, getSecsFromHHMMSS } from \"./utils\"\r\n\r\nexport class ResultParserCSV {\r\n  constructor(rawCSV) {\r\n    this.results = []\r\n    this.CSVFormat = {}\r\n    this.separator = \"\"\r\n    this.valid = true\r\n    this.processResultsCSV(rawCSV)\r\n    return { results: this.results, valid: this.valid }\r\n  }\r\n\r\n  extractResult(fields, course, controls) {\r\n    const FIRST_NAME_IDX = 0\r\n    const SURNAME_IDX = 1\r\n    const CLUB_IDX = 2\r\n    const START_TIME_IDX = 3\r\n    let result = {}\r\n    result.chipid = 0\r\n    result.name = (fields[FIRST_NAME_IDX] + \" \" + fields[SURNAME_IDX] + \" \" + fields[CLUB_IDX]).trim()\r\n    result.dbid = result.chipid + \"__\" + result.name\r\n    result.starttime = getSecsFromHHMM(fields[START_TIME_IDX])\r\n    result.club = fields[CLUB_IDX]\r\n    result.course = course\r\n    result.controls = controls\r\n    const info = this.extractSpklasseSplits(fields)\r\n    result.splits = info.splits\r\n    result.codes = info.codes\r\n    result.time = formatSecsAsMMSS(info.totaltime)\r\n    this.results.push(result)\r\n  }\r\n\r\n  extractSingleCSVResult(fields) {\r\n    let result = {}\r\n    result.valid = true\r\n    result.chipid = fields[this.CSVFormat.CHIP_IDX]\r\n    // delete quotes from CSV file: output from MERCS\r\n    result.name = (fields[this.CSVFormat.FIRST_NAME_IDX] + \" \" + fields[this.CSVFormat.SURNAME_IDX])\r\n      .trim()\r\n      .replace(/\"/g, \"\")\r\n    result.dbid = fields[this.CSVFormat.DB_IDX]\r\n    result.starttime = getSecsFromHHMMSS(fields[this.CSVFormat.START_TIME_IDX])\r\n    result.time = fields[this.CSVFormat.TOTAL_TIME_IDX]\r\n    result.position = this.getPosition(fields)\r\n    result.status = this.getSICSVStatus(fields[this.CSVFormat.NC_IDX], fields[this.CSVFormat.CLASSIFIER_IDX])\r\n    result.club = fields[this.CSVFormat.CLUB_IDX].trim().replace(/\"/g, \"\")\r\n    result.course = fields[this.CSVFormat.COURSE_IDX]\r\n    if (result.course === \"\") {\r\n      result.valid = false\r\n    }\r\n    result.controls = parseInt(fields[this.CSVFormat.NUM_CONTROLS_IDX], 10)\r\n    const info = this.extractSISplits(fields, result.controls)\r\n    result.splits = info.splits\r\n    // add finish split\r\n    if (result.splits !== \"\") {\r\n      result.splits += \";\"\r\n    }\r\n    result.splits += getSecsFromHHMMSS(result.time)\r\n    result.codes = info.codes\r\n    return result\r\n  }\r\n\r\n  extractSISplits(fields, controls) {\r\n    let nextsplit = this.CSVFormat.FIRST_SPLIT_IDX\r\n    let nextcode = this.CSVFormat.FIRST_CODE_IDX\r\n    let result = {}\r\n    result.splits = \"\"\r\n    result.codes = []\r\n    for (let i = 0; i < controls; i += 1) {\r\n      if (fields[nextcode]) {\r\n        if (i > 0) {\r\n          result.splits += \";\"\r\n        }\r\n        result.codes[i] = fields[nextcode]\r\n        result.splits += getSecsFromHHMMSS(fields[nextsplit])\r\n      }\r\n      nextsplit += this.CSVFormat.STEP\r\n      nextcode += this.CSVFormat.STEP\r\n    }\r\n    return { splits: result.splits, codes: result.codes }\r\n  }\r\n\r\n  extractSpklasseSplits(fields) {\r\n    const FIRST_SPLIT_IDX = 4\r\n    let splits = \"\"\r\n    let codes = []\r\n    let totaltime = 0\r\n    for (let i = 0; i < fields.length - FIRST_SPLIT_IDX; i += 1) {\r\n      if (i > 0) {\r\n        splits += \";\"\r\n      }\r\n      codes[i] = \"X\"\r\n      totaltime += getSecsFromHHMMSS(fields[i + FIRST_SPLIT_IDX])\r\n      splits += totaltime\r\n    }\r\n    return { splits: splits, codes: codes, totaltime: totaltime }\r\n  }\r\n\r\n  getCSVFormat(headers) {\r\n    // not a pretty function but it should allow some non-standard CSV formats to be processed such as OEScore output\r\n    const titles = [\r\n      \"si card\",\r\n      \"database id\",\r\n      \"surname\",\r\n      \"first name\",\r\n      \"nc\",\r\n      \"start\",\r\n      \"time\",\r\n      \"classifier\",\r\n      \"city\",\r\n      \"short\",\r\n      \"course\",\r\n      \"course controls\",\r\n      \"pl\",\r\n      \"start punch\",\r\n      \"control1\",\r\n      \"punch1\",\r\n      \"control2\"\r\n    ]\r\n    let values = []\r\n    const fields = headers.split(this.separator).map(function (str) {\r\n      return str.toLowerCase()\r\n    })\r\n    let found = false\r\n    for (let i = 0; i < titles.length; i += 1) {\r\n      found = false\r\n      for (let j = 0; j < fields.length; j += 1) {\r\n        if (fields[j] === titles[i]) {\r\n          values[i] = j\r\n          found = true\r\n          break\r\n        }\r\n        // horrid hacks to handle semi-compliant files\r\n        if (\"si card\" === titles[i]) {\r\n          if (\"chipno\" === fields[j] || \"sicard\" === fields[j] || \"database id\" === fields[j]) {\r\n            values[i] = j\r\n            found = true\r\n            break\r\n          }\r\n        }\r\n        if (\"nc\" === titles[i]) {\r\n          if (\"classifier\" === fields[j]) {\r\n            values[i] = j\r\n            found = true\r\n            break\r\n          }\r\n        }\r\n        if (\"city\" === titles[i]) {\r\n          if (\"club\" === fields[j]) {\r\n            values[i] = j\r\n            found = true\r\n            break\r\n          }\r\n        }\r\n        if (\"pl\" === titles[i]) {\r\n          if (\"place\" === fields[j]) {\r\n            values[i] = j\r\n            found = true\r\n            break\r\n          }\r\n        }\r\n      }\r\n      if (!found) {\r\n        // stop if we didn't find what we needed\r\n        break\r\n      }\r\n    }\r\n\r\n    if (!found) {\r\n      // default to BOF CSV format\r\n      //not sure of this is really a good idea but it has always been like this...\r\n      values = [1, 2, 3, 4, 8, 9, 11, 12, 15, 18, 39, 42, 43, 44, 46, 47, 48]\r\n    }\r\n    this.setCSVFormat(values)\r\n  }\r\n\r\n  getPosition(fields) {\r\n    let position = parseInt(fields[this.CSVFormat.POSITION_IDX], 10)\r\n    if (isNaN(position)) {\r\n      position = \"\"\r\n    }\r\n    return position\r\n  }\r\n\r\n  getSICSVStatus(nc, classifier) {\r\n    if (nc === \"0\" || nc === \"\" || nc === \"N\" || nc === \"n\") {\r\n      if (classifier === \"\" || classifier === \"0\") {\r\n        return \"ok\"\r\n      }\r\n      return \"nok\"\r\n    }\r\n    return \"nc\"\r\n  }\r\n\r\n  // rows: array of raw lines from SI results csv file\r\n  processCSVResults(rows) {\r\n    // extract what we need: first row is headers so ignore\r\n    for (let i = 1; i < rows.length; i += 1) {\r\n      const fields = rows[i].split(this.separator)\r\n      // need at least this many fields...\r\n      if (fields.length >= this.CSVFormat.FIRST_SPLIT_IDX) {\r\n        let newResult = this.extractSingleCSVResult(fields)\r\n        if (newResult.valid) {\r\n          // don't need this field any more\r\n          delete newResult.valid\r\n          this.results.push(newResult)\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  processResultsCSV(rawCSV) {\r\n    const rows = rawCSV.split(/[\\r\\n|\\n]+/)\r\n    // try and work out what the separator is\r\n    const commas = rows[0].split(\",\").length - 1\r\n    const semicolons = rows[0].split(\";\").length - 1\r\n    if (commas > semicolons) {\r\n      this.separator = \",\"\r\n    } else {\r\n      this.separator = \";\"\r\n    }\r\n    // Spklasse has two items on first row, SI CSV has a lot more...\r\n    if (rows[0].split(this.separator).length === 2) {\r\n      this.processSpklasseCSVResults(rows)\r\n    } else {\r\n      this.getCSVFormat(rows[0])\r\n      this.processCSVResults(rows)\r\n    }\r\n  }\r\n\r\n  // rows: array of raw lines from Spklasse results csv file\r\n  processSpklasseCSVResults(rows) {\r\n    // fields in course row\r\n    const COURSE_IDX = 0\r\n    const NUM_CONTROLS_IDX = 1\r\n    let fields = []\r\n    let course = \"\"\r\n    let controls = 0\r\n    // read through all rows\r\n    for (let i = 0; i < rows.length; i += 1) {\r\n      fields = rows[i].split(this.separator)\r\n      // check for new course\r\n      if (fields.length === 2) {\r\n        course = fields[COURSE_IDX]\r\n        controls = parseInt(fields[NUM_CONTROLS_IDX], 10)\r\n      } else {\r\n        this.extractResult(fields, course, controls)\r\n      }\r\n    }\r\n  }\r\n\r\n  setCSVFormat(values) {\r\n    this.CSVFormat.CHIP_IDX = values[0]\r\n    this.CSVFormat.DB_IDX = values[1]\r\n    this.CSVFormat.SURNAME_IDX = values[2]\r\n    this.CSVFormat.FIRST_NAME_IDX = values[3]\r\n    this.CSVFormat.NC_IDX = values[4]\r\n    this.CSVFormat.START_TIME_IDX = values[5]\r\n    this.CSVFormat.TOTAL_TIME_IDX = values[6]\r\n    this.CSVFormat.CLASSIFIER_IDX = values[7]\r\n    this.CSVFormat.CLUB_IDX = values[8]\r\n    this.CSVFormat.CLASS_IDX = values[9]\r\n    this.CSVFormat.COURSE_IDX = values[10]\r\n    this.CSVFormat.NUM_CONTROLS_IDX = values[11]\r\n    this.CSVFormat.POSITION_IDX = values[12]\r\n    this.CSVFormat.START_PUNCH_IDX = values[13]\r\n    this.CSVFormat.FIRST_CODE_IDX = values[14]\r\n    this.CSVFormat.FIRST_SPLIT_IDX = values[15]\r\n    this.CSVFormat.STEP = values[16] - values[14]\r\n  }\r\n}\r\n","import { extractAttributeZero, extractTextContentZero, getSecsFromHHMMSS, showWarningDialog } from \"./utils\"\r\n\r\nexport class ResultParserIOFV2 {\r\n  constructor(xml) {\r\n    this.results = []\r\n    this.valid = true\r\n    this.processIOFV2Results(xml)\r\n    return { results: this.results, valid: this.valid }\r\n  }\r\n\r\n  extractIOFV2Results(resultlist, result) {\r\n    for (let i = 0; i < resultlist.length; i += 1) {\r\n      result.status = extractAttributeZero(resultlist[i].getElementsByTagName(\"CompetitorStatus\"), \"value\", \"\")\r\n      result.position = this.getPosition(resultlist[i].getElementsByTagName(\"ResultPosition\"))\r\n      result.chipid = extractTextContentZero(resultlist[i].getElementsByTagName(\"CCardId\"), 0)\r\n      // assuming first <Time> is the total time...\r\n      result.time = this.getTime(resultlist[i].getElementsByTagName(\"Time\"))\r\n      result.starttime = this.getStartFinishTimeAsSecs(resultlist[i].getElementsByTagName(\"StartTime\"))\r\n      result.splits = \"\"\r\n      result.codes = []\r\n      const splitlist = resultlist[i].getElementsByTagName(\"SplitTime\")\r\n      result.controls = splitlist.length\r\n      this.extractIOFV2Splits(splitlist, result)\r\n      const finishtime = this.getStartFinishTimeAsSecs(resultlist[i].getElementsByTagName(\"FinishTime\"))\r\n      result.splits += Math.max(finishtime - result.starttime, 0)\r\n    }\r\n  }\r\n\r\n  extractIOFV2Splits(splitlist, result) {\r\n    for (let l = 0; l < splitlist.length; l += 1) {\r\n      if (l > 0) {\r\n        result.splits += \";\"\r\n      }\r\n      const temp = splitlist[l].getElementsByTagName(\"Time\")\r\n      if (temp.length > 0) {\r\n        // previously read timeFormat but some files lied!\r\n        // allow for XML files that don't tell you what is going on\r\n        // getSecsFromHHMMSS copes with MM:SS as well\r\n        result.splits += getSecsFromHHMMSS(temp[0].textContent)\r\n        result.codes[l] = extractTextContentZero(splitlist[l].getElementsByTagName(\"ControlCode\"), \"\")\r\n      } else {\r\n        result.splits += 0\r\n        result.codes[l] = \"\"\r\n      }\r\n    }\r\n    // add finish split\r\n    result.splits += \";\"\r\n  }\r\n\r\n  getDBID(element, index) {\r\n    if (element.length === 0) {\r\n      return index\r\n    }\r\n    // remove new lines from empty <PersonId> tags\r\n    element = element[0].textContent.replace(/[\\n\\r]/g, \"\").trim()\r\n    if (element) {\r\n      return element\r\n    }\r\n    return index\r\n  }\r\n\r\n  getName(personlist) {\r\n    const temp =\r\n      personlist.getElementsByTagName(\"Given\")[0].textContent +\r\n      \" \" +\r\n      personlist.getElementsByTagName(\"Family\")[0].textContent\r\n    // remove new lines from empty <Given> and <Family> tags\r\n    return temp.replace(/[\\n\\r]/g, \"\").trim()\r\n  }\r\n\r\n  getPosition(element) {\r\n    if (element.length > 0) {\r\n      return parseInt(element[0].textContent, 10)\r\n    }\r\n    return \"\"\r\n  }\r\n\r\n  getStartFinishTimeAsSecs(element) {\r\n    if (element.length > 0) {\r\n      const time = element[0].getElementsByTagName(\"Clock\")[0].textContent\r\n      return getSecsFromHHMMSS(time)\r\n    }\r\n    return 0\r\n  }\r\n\r\n  getTime(element) {\r\n    if (element.length > 0) {\r\n      return element[0].textContent.replace(/[\\n\\r]/g, \"\")\r\n    }\r\n    return \"\"\r\n  }\r\n\r\n  processIOFV2Results(xml) {\r\n    try {\r\n      const classlist = xml.getElementsByTagName(\"ClassResult\")\r\n      for (let i = 0; i < classlist.length; i += 1) {\r\n        const course = classlist[i].getElementsByTagName(\"ClassShortName\")[0].textContent\r\n        const personlist = classlist[i].getElementsByTagName(\"PersonResult\")\r\n        for (let j = 0; j < personlist.length; j += 1) {\r\n          let result = {}\r\n          result.course = course\r\n          result.name = this.getName(personlist[j])\r\n          result.dbid = this.getDBID(personlist[j].getElementsByTagName(\"PersonId\"), j)\r\n          result.club = extractTextContentZero(personlist[j].getElementsByTagName(\"ShortName\"), \"\")\r\n          const resultlist = personlist[j].getElementsByTagName(\"Result\")\r\n          this.extractIOFV2Results(resultlist, result)\r\n          if (result.status !== \"DidNotStart\") {\r\n            this.results.push(result)\r\n          }\r\n        }\r\n      }\r\n    } catch (err) {\r\n      this.valid = false\r\n      showWarningDialog(\"XML parse error\", \"Error processing XML file. Error is : \" + err.message)\r\n      return\r\n    }\r\n  }\r\n}\r\n","import { extractTextContentZero, formatSecsAsMMSS, getSecsFromHHMMSS, showWarningDialog } from \"./utils\"\r\n\r\nexport class ResultParserIOFV3 {\r\n  constructor(xml) {\r\n    this.results = []\r\n    this.valid = true\r\n    this.processIOFV3Results(xml)\r\n    return { results: this.results, valid: this.valid }\r\n  }\r\n\r\n  extractIOFV3Results(resultlist, result) {\r\n    for (let k = 0; k < resultlist.length; k += 1) {\r\n      result.chipid = extractTextContentZero(resultlist[k].getElementsByTagName(\"ControlCard\"), 0)\r\n      result.position = extractTextContentZero(resultlist[k].getElementsByTagName(\"Position\"), \"\")\r\n      if (result.position === \"0\") {\r\n        result.position = \"\"\r\n      }\r\n      result.status = extractTextContentZero(resultlist[k].getElementsByTagName(\"Status\"), \"\")\r\n      // assuming first <Time> is the total time...\r\n      // this one is in seconds and might even have tenths...\r\n      result.time = this.getTotalTimeAsSeconds(resultlist[k].getElementsByTagName(\"Time\"))\r\n      result.starttime = this.getStartFinishTimeAsSeconds(\r\n        extractTextContentZero(resultlist[k].getElementsByTagName(\"StartTime\"), 0)\r\n      )\r\n      result.splits = \"\"\r\n      result.codes = []\r\n      const splitlist = resultlist[k].getElementsByTagName(\"SplitTime\")\r\n      this.extractIOFV3Splits(splitlist, result)\r\n      const finishtime = this.getStartFinishTimeAsSeconds(\r\n        extractTextContentZero(resultlist[k].getElementsByTagName(\"FinishTime\"), 0)\r\n      )\r\n      if (finishtime > 0) {\r\n        result.splits += finishtime - result.starttime\r\n      } else {\r\n        result.splits += 0\r\n      }\r\n    }\r\n  }\r\n\r\n  extractIOFV3Splits(splitlist, result) {\r\n    let codes = []\r\n    for (let x = 0; x < splitlist.length; x += 1) {\r\n      // no attributes means just a standard split with time and control code\r\n      if (splitlist[x].attributes.length === 0) {\r\n        result.splits += extractTextContentZero(splitlist[x].getElementsByTagName(\"Time\"), 0)\r\n        codes.push(extractTextContentZero(splitlist[x].getElementsByTagName(\"ControlCode\"), \"X\" + x))\r\n        result.splits += \";\"\r\n      } else {\r\n        // possible status attributes are \"Missing\" and \"Additional\"\r\n        // need to insert a dummy 0 time for missing splits\r\n        if (splitlist[x].getAttribute(\"status\") === \"Missing\") {\r\n          result.splits += \"0\"\r\n          codes.push(extractTextContentZero(splitlist[x].getElementsByTagName(\"ControlCode\"), \"X\" + x))\r\n          result.splits += \";\"\r\n        }\r\n      }\r\n    }\r\n    result.codes = codes\r\n    result.controls = result.codes.length\r\n  }\r\n\r\n  getClub(element) {\r\n    if (element.length > 0) {\r\n      if (element[0].getElementsByTagName(\"Name\")[0]) {\r\n        return element[0].getElementsByTagName(\"Name\")[0].textContent\r\n      }\r\n    }\r\n    return \"\"\r\n  }\r\n\r\n  getID(element, index) {\r\n    if (element.length > 0) {\r\n      let text = element[0].textContent\r\n      // remove new lines from empty <Id> tags\r\n      text.replace(/[\\n\\r]/g, \"\")\r\n      return text.trim()\r\n    }\r\n    // no id defined so just use result index\r\n    return index\r\n  }\r\n\r\n  getStartFinishTimeAsSeconds(time) {\r\n    if (time.length >= 19) {\r\n      // format is yyyy-mm-ddThh:mm:ss and might have extra Z or +nn\r\n      return getSecsFromHHMMSS(time.substr(11, 8))\r\n    }\r\n    return 0\r\n  }\r\n\r\n  getTotalTimeAsSeconds(time) {\r\n    if (time.length > 0 && time[0].textContent) {\r\n      const timeInt = parseInt(time[0].textContent, 10)\r\n      return formatSecsAsMMSS(timeInt)\r\n    }\r\n    return \"00:00\"\r\n  }\r\n\r\n  processIOFV3Results(xml) {\r\n    try {\r\n      const classlist = xml.getElementsByTagName(\"ClassResult\")\r\n      for (let i = 0; i < classlist.length; i += 1) {\r\n        const classes = classlist[i].getElementsByTagName(\"Class\")\r\n        const course = classes[0].getElementsByTagName(\"Name\")[0].textContent\r\n        const personlist = classlist[i].getElementsByTagName(\"PersonResult\")\r\n        for (let j = 0; j < personlist.length; j += 1) {\r\n          let result = {}\r\n          result.course = course\r\n          const temp =\r\n            personlist[j].getElementsByTagName(\"Given\")[0].textContent +\r\n            \" \" +\r\n            personlist[j].getElementsByTagName(\"Family\")[0].textContent\r\n          // remove new lines from empty <Given> and <Family> tags\r\n          result.name = temp.replace(/[\\n\\r]/g, \"\").trim()\r\n          result.dbid = this.getID(personlist[j].getElementsByTagName(\"Id\"), j)\r\n          result.club = this.getClub(personlist[j].getElementsByTagName(\"Organisation\"))\r\n          const resultlist = personlist[j].getElementsByTagName(\"Result\")\r\n          this.extractIOFV3Results(resultlist, result)\r\n          if (result.status !== \"DidNotStart\") {\r\n            this.results.push(result)\r\n          }\r\n        }\r\n      }\r\n    } catch (err) {\r\n      this.valid = false\r\n      showWarningDialog(\"XML parse error\", \"Error processing XML file. Error is : \" + err.message)\r\n      return\r\n    }\r\n  }\r\n}\r\n","import { config } from \"./config\"\r\nimport { ResultParserCSV } from \"./resultparsercsv\"\r\nimport { ResultParserIOFV2 } from \"./resultparseriofv2\"\r\nimport { ResultParserIOFV3 } from \"./resultparseriofv3\"\r\nimport { extractAttributeZero, showWarningDialog } from \"./utils\"\r\n\r\nexport class ResultParser {\r\n  constructor(e, fileFormat) {\r\n    this.results = []\r\n    this.resultCourses = []\r\n    this.valid = true\r\n    const parsedResults = this.processResults(e, fileFormat)\r\n    this.results = parsedResults.results\r\n    this.valid = parsedResults.valid\r\n    this.getCoursesFromResults()\r\n    return {\r\n      results: this.results,\r\n      resultCourses: this.resultCourses,\r\n      valid: this.valid\r\n    }\r\n  }\r\n\r\n  getCoursesFromResults() {\r\n    // creates an array of all course names in the results file\r\n    for (let i = 0; i < this.results.length; i += 1) {\r\n      // have we already found this course?\r\n      let found = false\r\n      for (let j = 0; j < this.resultCourses.length; j += 1) {\r\n        if (this.resultCourses[j].course === this.results[i].course) {\r\n          found = true\r\n          break\r\n        }\r\n      }\r\n      if (!found) {\r\n        // courseid is set later when mapping is known\r\n        this.resultCourses.push({\r\n          course: this.results[i].course,\r\n          courseid: config.DO_NOT_SAVE_COURSE\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  processResults(e, fileFormat) {\r\n    switch (fileFormat) {\r\n      case \"CSV\":\r\n        return new ResultParserCSV(e.target.result)\r\n      case \"XML\":\r\n        return this.processResultsXML(e.target.result)\r\n      default:\r\n        // shouldn't ever get here but...\r\n        showWarningDialog(\"File type error\", \"Results file type is not recognised. Please select a valid file.\")\r\n        return { results: [], valid: false }\r\n    }\r\n  }\r\n\r\n  processResultsXML(rawXML) {\r\n    let version = \"\"\r\n    let xml = undefined\r\n    try {\r\n      xml = new DOMParser().parseFromString(rawXML, \"text/xml\")\r\n      const nodelist = xml.getElementsByTagName(\"ResultList\")\r\n      if (nodelist.length === 0) {\r\n        showWarningDialog(\"XML file error\", \"File is not a valid XML results file. ResultList element missing.\")\r\n        return { results: [], valid: false }\r\n      }\r\n      // test for IOF Version 2\r\n      version = extractAttributeZero(xml.getElementsByTagName(\"IOFVersion\"), \"version\", \"\")\r\n      if (version === \"\") {\r\n        // test for IOF Version 3\r\n        version = extractAttributeZero(xml.getElementsByTagName(\"ResultList\"), \"iofVersion\", \"\")\r\n      }\r\n    } catch (err) {\r\n      showWarningDialog(\"XML file error\", \"File is not a valid XML results file.\")\r\n      return { results: [], valid: false }\r\n    }\r\n\r\n    switch (version) {\r\n      case \"2.0.3\":\r\n        return new ResultParserIOFV2(xml)\r\n      case \"3.0\":\r\n        return new ResultParserIOFV3(xml)\r\n      default:\r\n        showWarningDialog(\"XML file error\", \"Invalid IOF file format. Version \" + version + \" not supported.\")\r\n        return { results: [], valid: false }\r\n    }\r\n  }\r\n}\r\n","// eslint-disable-next-line no-unused-vars\r\nimport * as bootstrap from \"bootstrap\"\r\nimport { getApi, postApi } from \"./api\"\r\nimport { ctx, getMapSize, loadNewMap, redraw } from \"./canvas\"\r\nimport { config, getOverprintDetails } from \"./config\"\r\nimport { Controls } from \"./controls\"\r\nimport { CourseParser } from \"./courseparser\"\r\nimport {\r\n  doGetEvents,\r\n  isScoreEvent,\r\n  getEventInfoForKartatID,\r\n  loadEventByKartatID,\r\n  mapIDIsInUse,\r\n  setActiveEventIDByKartatID,\r\n  setEventTitleBar\r\n} from \"./events\"\r\nimport { Georefs } from \"./georefs\"\r\nimport { decode } from \"html-entities\"\r\nimport { MapData } from \"./mapdata\"\r\nimport proj4 from \"proj4\"\r\nimport { ResultParser } from \"./resultparser\"\r\nimport { getRoutesForEvent } from \"./results\"\r\nimport { t } from \"./translate\"\r\nimport { User } from \"./user\"\r\nimport { createModalDialog, generateSelectOption, showWarningDialog, validateValue } from \"./utils\"\r\nimport { Datepicker } from \"vanillajs-datepicker\"\r\nimport { Worldfile } from \"./worldfile\"\r\nimport L from \"leaflet\"\r\n// TODO import css somewhere else?\r\nimport \"leaflet/dist/leaflet.css\"\r\n\r\nlet user = null\r\nlet newMap = new MapData()\r\nlet georefsystems = new Georefs()\r\nlet mapIndex = null\r\nlet format = null\r\nlet newEventIsScoreEvent = false\r\nlet hasResults = true\r\nlet newcontrols = null\r\nlet courses = []\r\nlet mapping = []\r\nlet isEnrichCourseNames = false\r\nlet mapLoaded = false\r\nlet coursesGeoreferenced = false\r\nlet controlsAdjusted = false\r\nlet drawingCourses = false\r\nlet drawnCourse = {}\r\nlet results = []\r\nlet variants = []\r\nlet resultCourses = []\r\nlet mapFile = undefined\r\nlet resultsOrCourseFile = undefined\r\nlet resultsFileFormat = \"\"\r\n// list of possible encodings from results or course file: just add new ones to the array if needed\r\nconst encodings = [\"UTF-8\", \"ISO-8859-1\", \"windows-1251\"]\r\n// count of errors when parsing each encoding type\r\nlet errorCount = []\r\n// current index into encodings\r\nlet encodingIndex = 0\r\n// state flag showing we have found the least worst encoding so use anyway\r\nlet useThisEncoding = false\r\nlet backgroundLocked = false\r\nlet sortResults = false\r\nlet handle = { x: null, y: null }\r\nlet maps = []\r\nlet mapSize = { height: 0, width: 0 }\r\nlet localworldfile = new Worldfile(0)\r\nlet worldfile = new Worldfile(0)\r\nlet georefmap = null\r\nlet unusedMaps = []\r\nlet eventSelectDatePicker = null\r\nlet eventEditDatePicker = null\r\nconst defaultExcludedText = \"e.g. 1|1|6,60|15,60\"\r\n\r\nfunction addNewControl(x, y) {\r\n  // add new control: generate a code for it\r\n  let code\r\n  if (newcontrols.controls.length === 0) {\r\n    code = \"S\" + (newcontrols.controls.length + 1)\r\n  } else {\r\n    code = \"X\" + (newcontrols.controls.length + 1)\r\n  }\r\n  newcontrols.addControl(code, x, y)\r\n  newcontrols.displayAllControls()\r\n  drawnCourse.codes.push(code)\r\n  drawnCourse.x.push(x)\r\n  drawnCourse.y.push(y)\r\n}\r\n\r\n// based on adjustTrack from draw.js\r\nexport function adjustManagerControls(p1, p2, button) {\r\n  // console.log (p1.x, p1.y, p2.x, p2.y, handle.x, handle.y, button)\r\n  if (backgroundLocked || button === config.RIGHT_CLICK) {\r\n    // drag track and background\r\n    ctx.translate(p2.x - p1.x, p2.y - p1.y)\r\n  } else {\r\n    controlsAdjusted = true\r\n    if (handle.x !== null) {\r\n      // scale controls\r\n      const scaleX = (p2.x - handle.x) / (p1.x - handle.x)\r\n      const scaleY = (p2.y - handle.y) / (p1.y - handle.y)\r\n      // don't rotate: we are assuming controls and map are already rotated the same\r\n      // console.log (p1.x, p1.y, p2.x, p2.y, handle.x, handle.y, scaleX, scaleY)\r\n      if (isFinite(scaleX) && isFinite(scaleY)) {\r\n        // just ignore very small moves\r\n        for (let i = 0; i < newcontrols.controls.length; i += 1) {\r\n          const x = newcontrols.controls[i].oldX - handle.x\r\n          const y = newcontrols.controls[i].oldY - handle.y\r\n          newcontrols.controls[i].x = x * scaleX + handle.x\r\n          newcontrols.controls[i].y = y * scaleY + handle.y\r\n        }\r\n      }\r\n    } else {\r\n      // drag controls\r\n      const dx = p2.x - p1.x\r\n      const dy = p2.y - p1.y\r\n      for (let i = 0; i < newcontrols.controls.length; i += 1) {\r\n        newcontrols.controls[i].x = newcontrols.controls[i].oldX + dx\r\n        newcontrols.controls[i].y = newcontrols.controls[i].oldY + dy\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction checkResultsFileEncoding(e) {\r\n  // not pretty but it works\r\n  // need to use the array of possible encodings that we want to try if the file is not UTF-8\r\n  // might be better to use a synchronous read, but that needs a worker thread\r\n  const errors = testForInvalidCharacters(e.target.result)\r\n  // if this encoding is clean, or we have tried everything so this is the least worst case\r\n  if (errors === 0 || useThisEncoding) {\r\n    // use this version of the results\r\n    processResultFile(e)\r\n    return\r\n  }\r\n  errorCount[encodingIndex] = errors\r\n  encodingIndex += 1\r\n  // have we tried all the encodings?\r\n  if (encodingIndex === encodings.length) {\r\n    let lowest = 99999\r\n    // no clean encodings found, since we would have escaped by now, so find least worst\r\n    for (let i = 0; i < encodings.length; i += 1) {\r\n      if (lowest > errorCount[i]) {\r\n        encodingIndex = i\r\n        lowest = errorCount[i]\r\n      }\r\n    }\r\n    // force this one to be used next time we get back here\r\n    useThisEncoding = true\r\n  }\r\n  // try a new encoding\r\n  readResults()\r\n}\r\n\r\nfunction confirmAddMap() {\r\n  let dlg = {}\r\n  dlg.body = \"Are you sure you want to add this map?\"\r\n  dlg.title = \"Confirm new map\"\r\n  dlg.classes = \"rg2-confirm-add-map-dialog\"\r\n  dlg.doText = \"Add map\"\r\n  dlg.onDo = doUploadMapFile\r\n  createModalDialog(dlg)\r\n}\r\n\r\nfunction confirmCreateEvent(e) {\r\n  e.preventDefault()\r\n  const valid = validateData()\r\n  if (valid !== \"OK\") {\r\n    showWarningDialog(\r\n      \"Event set-up incomplete\",\r\n      valid + \" Please enter all necessary information and make sure controls are aligned before creating the event.\"\r\n    )\r\n    return\r\n  }\r\n  let dlg = {}\r\n  dlg.body = \"Are you sure you want to create this event?\"\r\n  dlg.title = \"Confirm event creation\"\r\n  dlg.classes = \"rg2-confirm-create-event-dialog\"\r\n  dlg.doText = \"Create event\"\r\n  dlg.onDo = doCreateEvent\r\n  createModalDialog(dlg)\r\n}\r\n\r\nfunction confirmDeleteEvent() {\r\n  const id = document.getElementById(\"rg2-edit-event-selected\").value\r\n  let dlg = {}\r\n  dlg.body = \"Event \" + id + \" will be deleted. Are you sure?\"\r\n  dlg.title = \"Confirm event delete\"\r\n  dlg.classes = \"rg2-confirm-delete-event-dialog\"\r\n  dlg.doText = \"Delete event\"\r\n  dlg.onDo = doDeleteEvent\r\n  createModalDialog(dlg)\r\n}\r\n\r\nfunction confirmDeleteRoute() {\r\n  let dlg = {}\r\n  dlg.body = \"This route will be permanently deleted. Are you sure?\"\r\n  dlg.title = \"Confirm route delete\"\r\n  dlg.classes = \"rg2-confirm-route-delete-dialog\"\r\n  dlg.doText = \"Delete route\"\r\n  dlg.onDo = doDeleteRoute\r\n  createModalDialog(dlg)\r\n}\r\n\r\nfunction confirmDeleteUnusedMaps() {\r\n  const boxes = document.querySelectorAll(\".unused-map input[type=checkbox]:checked\")\r\n  let checked = []\r\n  for (let box of boxes) {\r\n    if (box.checked) {\r\n      checked.push(parseInt(box.dataset.mapId, 10))\r\n    }\r\n    for (let i = 0; i < unusedMaps.length; i += 1) {\r\n      if (checked.indexOf(unusedMaps[i].mapid) > -1) {\r\n        unusedMaps[i].delete = true\r\n      } else {\r\n        unusedMaps[i].delete = false\r\n      }\r\n    }\r\n  }\r\n  if (checked.length === 0) {\r\n    showWarningDialog(\"Warning\", \"No maps selected.\")\r\n    return\r\n  }\r\n  const dlg = {}\r\n  dlg.body = \"Selected maps will be deleted. Are you sure?\"\r\n  dlg.title = \"Confirm map deletion\"\r\n  dlg.doText = \"Delete maps\"\r\n  dlg.onDo = doDeleteUnusedMaps\r\n  createModalDialog(dlg)\r\n}\r\n\r\nfunction confirmUpdateEvent() {\r\n  let dlg = {}\r\n  dlg.body = `Are you sure you want to update ${document.getElementById(\"rg2-edit-event-name\").value}?`\r\n  dlg.title = \"Confirm event update\"\r\n  dlg.doText = \"Update event\"\r\n  dlg.onDo = doUpdateEvent\r\n  createModalDialog(dlg)\r\n}\r\n\r\nfunction convertWorldFile(value) {\r\n  // takes in a World file for the map image and translates it to WGS84 (GPS)\r\n  try {\r\n    const system = georefsystems.getGeorefSystem(value)\r\n    //console.log(system)\r\n    mapSize = getMapSize()\r\n    if (!localworldfile.valid || mapSize.width === 0 || system.name === \"none\") {\r\n      // no map or world file loaded or user selected do not georef\r\n      throw \"Do not georeference\"\r\n    }\r\n    // set up source which is how map was originally georeferenced\r\n    proj4.defs(system.name, system.params)\r\n    const source = new proj4.Proj(system.name)\r\n    // dest is WGS84 as used by GPS: included by default in proj4.defs\r\n    const dest = new proj4.Proj(\"EPSG:4326\")\r\n    // calculation based on fixed points on map\r\n    // x0, y0 is top left, x1, y1 is bottom right, x2, y2 is top right, x3, y3 is bottom left\r\n    // 0, 1 and 2 are saved by the API, and must have these settings\r\n    // 4 is just used here\r\n    // save pixel values of these locations for map image\r\n    const xpx = [0, mapSize.width, mapSize.width, 0]\r\n    const ypx = [0, mapSize.height, 0, mapSize.height]\r\n\r\n    // calculate the same locations using worldfile for the map\r\n    let xsrc = []\r\n    let ysrc = []\r\n    for (let i = 0; i < 4; i += 1) {\r\n      xsrc[i] = localworldfile.getLon(xpx[i], ypx[i])\r\n      ysrc[i] = localworldfile.getLat(xpx[i], ypx[i])\r\n    }\r\n\r\n    newMap.xpx.length = 0\r\n    newMap.ypx.length = 0\r\n    newMap.lat.length = 0\r\n    newMap.lon.length = 0\r\n    // translate source georef to WGS84 (as in GPS file) and store with newMap details\r\n    // Careful: p[] has x = lon and y = lat\r\n    let p = []\r\n    for (let i = 0; i < 4; i += 1) {\r\n      let pt = {}\r\n      pt.x = xsrc[i]\r\n      pt.y = ysrc[i]\r\n      p.push(pt)\r\n      const transformed = proj4(source, dest, p[i])\r\n      newMap.xpx.push(xpx[i])\r\n      newMap.ypx.push(ypx[i])\r\n      newMap.lat.push(transformed.y)\r\n      newMap.lon.push(transformed.x)\r\n    }\r\n\r\n    let wf = {}\r\n    // X = Ax + By + C, Y = Dx + Ey + F\r\n    // C = X - Ax - By, where x and y are 0\r\n    wf.C = p[0].x\r\n    // F = Y - Dx - Ey, where X and Y are 0\r\n    wf.F = p[0].y\r\n    // A = (X - By - C) / x where y = 0\r\n    wf.A = (p[2].x - wf.C) / xpx[2]\r\n    // B = (X - Ax - C) / y where x = 0\r\n    wf.B = (p[3].x - wf.C) / ypx[3]\r\n    // D = (Y - Ey - F) / x where y = 0\r\n    wf.D = (p[2].y - wf.F) / xpx[2]\r\n    // E = (Y - Dx - F) / y where x = 0\r\n    wf.E = (p[3].y - wf.F) / ypx[3]\r\n    //console.log(\"Calculated lon diff = \" + (((wf.A * xpx[1]) + (wf.B * ypx[1]) + wf.C) - p[1].x))\r\n    //console.log(\"Calculated lat diff = \" + (((wf.D * xpx[1]) + (wf.E * ypx[1]) + wf.F) - p[1].y))\r\n    newMap.worldfile = new Worldfile(wf)\r\n    updateGeorefMap()\r\n  } catch (err) {\r\n    newMap.worldfile = new Worldfile(0)\r\n    updateGeorefMap()\r\n    return\r\n  }\r\n}\r\n\r\nfunction copyXYToOldXY() {\r\n  // rebaseline control locations\r\n  for (let i = 0; i < newcontrols.controls.length; i += 1) {\r\n    newcontrols.controls[i].oldX = newcontrols.controls[i].x\r\n    newcontrols.controls[i].oldY = newcontrols.controls[i].y\r\n  }\r\n}\r\n\r\nfunction createCourseDropdown(course, courseidx) {\r\n  let idx = -1\r\n  // check against list of course names first to default to results by course\r\n  // do known courses include this course name?\r\n  // This covers \"Brown\" results mapping to a \"Brown\" course\r\n  for (let i = 0; i < courses.length; i += 1) {\r\n    if (courses[i].name === course) {\r\n      idx = i\r\n      break\r\n    }\r\n  }\r\n  // If we didn't match a course name then try a class name\r\n  // This covers M50 results mapping to course 3 as defined in the course XML\r\n  if (idx === -1 && mapping.length > 0) {\r\n    for (let i = 0; i < mapping.length; i += 1) {\r\n      if (mapping[i].className === course) {\r\n        // now have course name so look it up to get index\r\n        for (let j = 0; j < courses.length; j += 1) {\r\n          if (courses[j].name === mapping[i].course) {\r\n            idx = j\r\n            break\r\n          }\r\n        }\r\n        break\r\n      }\r\n    }\r\n  }\r\n  let html = `<select id='rg2-alloc-${courseidx}' class=\"form-control form-control-sm\">`\r\n  html += `<option value=\"${config.DO_NOT_SAVE_COURSE}\"${idx === -1 ? \" selected\" : \"\"}>Do not save</option>`\r\n  for (let i = 0; i < courses.length; i += 1) {\r\n    html += `<option value=\"${i}\"${idx === i ? \" selected\" : \"\"}>${enrichCourseName(courses[i].name)}</option>`\r\n  }\r\n  html += `</select >`\r\n  return html\r\n}\r\n\r\nfunction createResultCourseMapping() {\r\n  // create a dummy result-course mapping\r\n  // to allow display of courses with no results\r\n  if (!hasResults) {\r\n    resultCourses.length = 0\r\n    for (let i = 0; i < courses.length; i += 1) {\r\n      resultCourses.push({\r\n        courseid: courses[i].courseid,\r\n        course: courses[i].name\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nfunction displayCourseAllocations() {\r\n  let html = \"\"\r\n  if (courses.length && resultCourses.length) {\r\n    html = `<div class=\"fw-bold\">Results</div><div class=\"fw-bold\">Course</div>`\r\n    for (let i = 0; i < resultCourses.length; i += 1) {\r\n      html += `<div>${resultCourses[i].course}</div>`\r\n      html += `<div>${createCourseDropdown(resultCourses[i].course, i)}</div>`\r\n    }\r\n    document.getElementById(\"rg2-course-allocations\").innerHTML = html\r\n  }\r\n}\r\n\r\nfunction displayInfoDialog(title, info) {\r\n  let dlg = {}\r\n  dlg.body = info\r\n  dlg.title = title\r\n  dlg.doText = \"Ok\"\r\n  // do nothing on close\r\n  dlg.onDo = () => {}\r\n  // false removes cancel button\r\n  createModalDialog(dlg, false)\r\n}\r\n\r\nfunction displayUnusedMaps(maps) {\r\n  let html = \"<div class='title'>ID</div><div class='title'>Name</div><div><i class='bi-trash'></i></div>\"\r\n  if (maps.length === 0) {\r\n    html += \"<div></div><div>None found.</div><div></div>\"\r\n    document.getElementById(\"btn-delete-unused-maps\").setAttribute(\"disabled\", \"\")\r\n  } else {\r\n    for (let i = 0; i < maps.length; i += 1) {\r\n      html += \"<div>\" + maps[i].mapid + \"</div>\"\r\n      html += \"<div>\" + maps[i].name + \"</div>\"\r\n      html += \"<div class='unused-map'><input type='checkbox' data-map-id=\" + maps[i].mapid + \"></div>\"\r\n    }\r\n    document.getElementById(\"btn-delete-unused-maps\").removeAttribute(\"disabled\")\r\n  }\r\n  document.getElementById(\"rg2-unused-maps\").innerHTML = html\r\n}\r\n\r\nfunction doAddMap() {\r\n  const params = { type: \"addmap\" }\r\n  newMap.localworldfile = localworldfile\r\n  const data = { ...newMap, ...user.encodeUser() }\r\n  postApi(JSON.stringify(data), params, handleMapAdded, \"Map save failed\", handleKeksi)\r\n}\r\n\r\nfunction doCreateEvent() {\r\n  const data = { ...generateNewEventData(), ...user.encodeUser() }\r\n  const params = { type: \"createevent\" }\r\n  postApi(JSON.stringify(data), params, handleEventAdded, \"Event creation failed\", handleKeksi)\r\n}\r\n\r\nfunction doDeleteEvent() {\r\n  const id = document.getElementById(\"rg2-edit-event-selected\").value\r\n  const params = { type: \"deleteevent\", id: id }\r\n  postApi(JSON.stringify(user.encodeUser()), params, handleEventDeleted(id), \"Event deletion failed\", handleKeksi)\r\n}\r\n\r\nfunction doDeleteRoute() {\r\n  const id = document.getElementById(\"rg2-edit-event-selected\").value\r\n  const routeid = document.getElementById(\"rg2-route-selected\").value\r\n  const params = { type: \"deleteroute\", id: id, routeid: routeid }\r\n  postApi(JSON.stringify(user.encodeUser()), params, handleRouteDeleted(routeid), \"Route delete failed\", handleKeksi)\r\n}\r\n\r\nfunction doDeleteUnusedMaps() {\r\n  let data = user.encodeUser()\r\n  data.maps = unusedMaps.filter((map) => map.delete === true).map((map) => map.mapid)\r\n  const params = { type: \"deleteunusedmaps\" }\r\n  postApi(JSON.stringify(data), params, handleUnusedMapsDeleted, \"Map deletion failed\", handleKeksi)\r\n}\r\n\r\nexport function doGetMaps() {\r\n  const params = { type: \"maps\" }\r\n  getApi(params, handleMapsLoaded, \"Events request failed\")\r\n}\r\n\r\nfunction doLogin() {\r\n  const params = { type: \"login\" }\r\n  postApi(JSON.stringify(user.encodeUser()), params, handleLoginResponse, \"Login failed\", handleKeksi)\r\n}\r\n\r\nfunction doUpdateEvent() {\r\n  const id = document.getElementById(\"rg2-edit-event-selected\").value\r\n  let data = user.encodeUser()\r\n  data.comments = document.getElementById(\"rg2-edit-event-comments\").value\r\n  data.locked = document.getElementById(\"chk-edit-read-only\").checked\r\n  data.name = document.getElementById(\"rg2-edit-event-name\").value\r\n  data.type = document.getElementById(\"rg2-edit-event-level\").value\r\n  data.eventdate = eventEditDatePicker.getDate(\"yyyy-mm-dd\")\r\n  data.club = document.getElementById(\"rg2-edit-club-name\").value\r\n  let exclude = document.getElementById(\"rg2-edit-exclude\").value.trim()\r\n  if (exclude === defaultExcludedText) {\r\n    exclude = \"\"\r\n  }\r\n  data.exclude = exclude\r\n  const params = { type: \"editevent\", id: id }\r\n  postApi(JSON.stringify(data), params, handleEventUpdated(id), \"Event update failed\", handleKeksi)\r\n}\r\n\r\nfunction doUploadMapFile() {\r\n  const details = user.encodeUser()\r\n  let formData = new FormData()\r\n  formData.append(mapFile.name, mapFile)\r\n  formData.append(\"name\", mapFile.name)\r\n  formData.append(\"x\", details.x)\r\n  formData.append(\"y\", details.y)\r\n\r\n  const params = {\r\n    type: \"uploadmapfile\",\r\n    headers: {\r\n      \"Content-Type\": \"multipart/form-data\"\r\n    }\r\n  }\r\n  postApi(formData, params, handleMapUploaded, \"Map upload failed\", handleKeksi)\r\n}\r\n\r\nexport function drawManagerControls() {\r\n  if (mapLoaded && newcontrols.controls.length > 0) {\r\n    newcontrols.drawControls(true)\r\n    const opt = getOverprintDetails()\r\n    // locked point for control edit\r\n    if (handle.x !== null) {\r\n      ctx.lineWidth = opt.overprintWidth\r\n      ctx.strokeStyle = config.HANDLE_COLOUR\r\n      ctx.fillStyle = config.HANDLE_COLOUR\r\n      ctx.globalAlpha = 1.0\r\n\r\n      ctx.beginPath()\r\n      ctx.arc(handle.x, handle.y, config.HANDLE_DOT_RADIUS, 0, 2 * Math.PI, false)\r\n      ctx.fill()\r\n      ctx.beginPath()\r\n      ctx.arc(handle.x, handle.y, 2 * config.HANDLE_DOT_RADIUS, 0, 2 * Math.PI, false)\r\n      ctx.stroke()\r\n    }\r\n  }\r\n}\r\n\r\nexport function enableManager() {\r\n  // login tab no longer required so remove it: it is first <li>\r\n  document.querySelector(\"#rg2-info-panel-tab-headers li\").remove()\r\n  document.querySelector(\"#rg2-manage-login-tab-body\").remove()\r\n\r\n  document.getElementById(config.TAB_CREATE).classList.remove(\"d-none\")\r\n  document.getElementById(config.TAB_CREATE).click()\r\n  document.getElementById(config.TAB_EDIT).classList.remove(\"d-none\")\r\n  document.getElementById(config.TAB_MAP).classList.remove(\"d-none\")\r\n  document.getElementById(config.TAB_DELETE_MAP).classList.remove(\"d-none\")\r\n\r\n  doGetMaps()\r\n  setButtons()\r\n  document.getElementById(\"rg2-select-event-level\").innerHTML = getEventLevelDropdown()\r\n  document.getElementById(\"rg2-edit-event-level\").innerHTML = getEventLevelDropdown()\r\n  document.getElementById(\"rg2-georef-type\").innerHTML = georefsystems.getGeorefDropdown()\r\n  document.getElementById(\"rg2-select-map\").addEventListener(\"change\", (e) => {\r\n    mapIndex = parseInt(e.target.value, 10)\r\n    if (mapIndex !== config.INVALID_MAP_ID) {\r\n      loadNewMap(rg2Config.maps_url + \"/\" + maps[mapIndex].mapfilename)\r\n    } else {\r\n      mapLoaded = false\r\n      mapSize.width = 0\r\n      mapSize.height = 0\r\n    }\r\n  })\r\n\r\n  eventSelectDatePicker = new Datepicker(document.getElementById(\"rg2-select-event-date\"), {\r\n    buttonClass: \"btn\",\r\n    autohide: true,\r\n    format: \"yyyy-mm-dd\"\r\n  })\r\n\r\n  eventEditDatePicker = new Datepicker(document.getElementById(\"rg2-edit-event-date\"), {\r\n    buttonClass: \"btn\",\r\n    autohide: true,\r\n    format: \"yyyy-mm-dd\"\r\n  })\r\n\r\n  document.getElementById(\"rg2-map-name\").addEventListener(\"change\", function () {\r\n    setMapName()\r\n  })\r\n  document.getElementById(\"rg2-new-course-name\").addEventListener(\"change\", function () {\r\n    setCourseName()\r\n  })\r\n  document.getElementById(\"rg2-edit-event-selected\").addEventListener(\"change\", (e) => {\r\n    setEvent(parseInt(e.target.value, 10))\r\n  })\r\n  document.getElementById(\"rg2-georef-type\").addEventListener(\"change\", (e) => {\r\n    setGeoref(parseInt(e.target.value, 10))\r\n  })\r\n}\r\n\r\nfunction enrichCourseName(course_name) {\r\n  let classes = \"\"\r\n  if (mapping && mapping.length > 0 && isEnrichCourseNames) {\r\n    for (let j = 0; j < mapping.length; j += 1) {\r\n      const course = mapping[j].course\r\n      let class_name = \"\"\r\n      if (course === course_name) {\r\n        if (classes !== \"\") {\r\n          classes += \", \"\r\n        }\r\n        class_name = mapping[j].className\r\n        class_name = class_name.replace(/ /g, \"\")\r\n        class_name = class_name.replace(/-/g, \"\")\r\n        classes += class_name\r\n      }\r\n    }\r\n  }\r\n\r\n  if (classes !== \"\") {\r\n    return course_name + \": \" + classes\r\n  }\r\n  return course_name\r\n}\r\n\r\nfunction enrichCourseNames() {\r\n  if (!isEnrichCourseNames) {\r\n    return\r\n  }\r\n  for (let i = 0; i < courses.length; i += 1) {\r\n    courses[i].name = enrichCourseName(courses[i].name)\r\n  }\r\n}\r\n\r\nexport function eventFinishedLoading() {\r\n  const kartatid = parseInt(document.getElementById(\"rg2-edit-event-selected\").value, 10)\r\n  const event = getEventInfoForKartatID(kartatid)\r\n  // called once the requested event has loaded\r\n  document.getElementById(\"rg2-edit-event-name\").value = decode(event.name)\r\n  document.getElementById(\"rg2-edit-club-name\").value = decode(event.club)\r\n  eventEditDatePicker.setDate(event.date)\r\n  document.getElementById(\"rg2-edit-event-level\").value = event.rawtype\r\n  document.getElementById(\"rg2-edit-event-comments\").value = decode(event.comment)\r\n  if (isScoreEvent()) {\r\n    document.getElementById(\"rg2-exclude-info\").classList.add(\"d-none\")\r\n  } else {\r\n    document.getElementById(\"rg2-edit-exclude\").value = event.exclude\r\n    document.getElementById(\"rg2-exclude-info\").classList.remove(\"d-none\")\r\n  }\r\n  document.getElementById(\"chk-edit-read-only\").checked = event.locked\r\n  //setButtonState(\"enable\", [\"#btn-delete-event\", \"#btn-update-event\", \"#btn-delete-route\"])\r\n  document.getElementById(\"rg2-route-selected\").innerHTML = getRouteDeleteDropdown(event.id)\r\n}\r\n\r\nexport function eventListLoaded(events) {\r\n  // called after event list has been updated\r\n  document.getElementById(\"rg2-edit-event-selected\").innerHTML = getEventEditDropdown(events)\r\n  // unused maps get set initially when maps are loaded by the manager\r\n  // need to avoid race condition where events load before manager is initialised\r\n  // this bit is needed to deal with maps changing state when events are created or deleted\r\n  if (maps.length > 0) {\r\n    findUnusedMaps(maps)\r\n    displayUnusedMaps(unusedMaps)\r\n  }\r\n}\r\n\r\nfunction extractVariants() {\r\n  // called when saving score/relay courses\r\n  // creates all course variants once courseid has been set\r\n  variants.length = 0\r\n  let course = undefined\r\n  for (let i = 0; i < results.length; i += 1) {\r\n    // codes here are just controls so need to add start and finish\r\n    let codes = results[i].codes\r\n    // courseid - 1 gives courses array index given how we created the array\r\n    for (let j = 0; j < courses.length; j += 1) {\r\n      if (courses[j].courseid === results[i].courseid) {\r\n        course = courses[j]\r\n        break\r\n      }\r\n    }\r\n    // add start code at start\r\n    codes.unshift(course.codes[0])\r\n    // add finish code at end\r\n    codes.push(course.codes[course.codes.length - 1])\r\n\r\n    results[i].variantid = getVariantID(results[i].codes, results[i].courseid)\r\n  }\r\n}\r\n\r\nfunction findUnusedMaps(maps) {\r\n  unusedMaps.length = 0\r\n  for (let i = 0; i < maps.length; i += 1) {\r\n    if (!mapIDIsInUse(maps[i].mapid)) {\r\n      const map = {}\r\n      map.mapid = maps[i].mapid\r\n      map.name = maps[i].name\r\n      if (map.name === \"\") {\r\n        map.name = \"(None)\"\r\n      }\r\n      map.delete = false\r\n      unusedMaps.push(map)\r\n    }\r\n  }\r\n}\r\n\r\nfunction fitControlsToMap() {\r\n  let georefOK = false\r\n  if (mapLoaded && newcontrols.controls.length > 0) {\r\n    const box = getBoundingBox()\r\n    if (coursesGeoreferenced) {\r\n      // check we are somewhere on the map\r\n      if (box.maxX < 0 || box.minX > mapSize.width || box.minY > mapSize.height || box.maxY < 0) {\r\n        // warn and fit to track\r\n        showWarningDialog(\r\n          \"Course file problem\",\r\n          \"Your course file does not match the map co-ordinates. Please check you have selected the correct file.\"\r\n        )\r\n      } else {\r\n        georefOK = true\r\n      }\r\n    }\r\n    if (georefOK) {\r\n      // lock background to prevent accidentally moving the aligned controls\r\n      // user can always unlock and adjust\r\n      backgroundLocked = true\r\n      controlsAdjusted = true\r\n      document.getElementById(\"chk-move-map-and-controls\").checked = true\r\n    } else {\r\n      // fit within the map since this is probably needed anyway\r\n      let scale = 0.8\r\n      for (let i = 0; i < newcontrols.controls.length; i += 1) {\r\n        newcontrols.controls[i].x =\r\n          (newcontrols.controls[i].x - box.minX) * (mapSize.width / box.xRange) * scale +\r\n          mapSize.width * (1 - scale) * 0.5\r\n        newcontrols.controls[i].y =\r\n          mapSize.height -\r\n          (newcontrols.controls[i].y - box.minY) * (mapSize.height / box.yRange) * scale -\r\n          mapSize.height * (1 - scale) * 0.5\r\n      }\r\n    }\r\n    copyXYToOldXY()\r\n    newcontrols.displayAllControls()\r\n  }\r\n}\r\n\r\nfunction generateNewEventData() {\r\n  let data = user.encodeUser()\r\n  data.name = document.getElementById(\"rg2-event-name\").value\r\n  data.mapid = maps[mapIndex].mapid\r\n  data.eventdate = eventSelectDatePicker.getDate(\"yyyy-mm-dd\")\r\n  data.comments = document.getElementById(\"rg2-enter-event-comments\").value\r\n  data.locked = document.getElementById(\"chk-read-only\").checked\r\n  data.club = document.getElementById(\"rg2-select-club-name\").value\r\n  if (hasResults) {\r\n    if (newEventIsScoreEvent) {\r\n      data.format = config.FORMAT_SCORE_EVENT\r\n    } else {\r\n      data.format = config.FORMAT_NORMAL\r\n    }\r\n  } else {\r\n    if (newEventIsScoreEvent) {\r\n      data.format = config.FORMAT_SCORE_EVENT_NO_RESULTS\r\n    } else {\r\n      data.format = config.FORMAT_NORMAL_NO_RESULTS\r\n    }\r\n  }\r\n  data.level = document.getElementById(\"rg2-select-event-level\").value\r\n  if (drawingCourses) {\r\n    courses.push(drawnCourse)\r\n    createResultCourseMapping()\r\n  }\r\n  setControlLocations()\r\n  mapResultsToCourses()\r\n  enrichCourseNames()\r\n  renumberResults()\r\n  if (newEventIsScoreEvent) {\r\n    extractVariants()\r\n    data.variants = variants.slice(0)\r\n  }\r\n  data.courses = courses.slice(0)\r\n  if (sortResults) {\r\n    data.results = results.slice(0).sort(sortResultItems)\r\n  } else {\r\n    data.results = results.slice(0)\r\n  }\r\n  // #485 tidy up for results files that have a finish time in the splits list\r\n  // not pretty but it will catch most of the issues\r\n  if (data.format === config.FORMAT_NORMAL) {\r\n    for (let i = 0; i < data.results.length; i += 1) {\r\n      const splits = (data.results[i].splits.match(/;/g) || []).length\r\n      // if we have one too many splits\r\n      if (splits === getControlCount(data.courses, data.results[i].courseid) + 1) {\r\n        // remove last ; and everything after it\r\n        data.results[i].splits = data.results[i].splits.substring(0, data.results[i].splits.lastIndexOf(\";\"))\r\n      }\r\n    }\r\n  }\r\n  // #386 remove unused data: partial solution to problems with POST size\r\n  for (let i = 0; i < data.results.length; i += 1) {\r\n    delete data.results[i].codes\r\n    delete data.results[i].chipid\r\n    delete data.results[i].club\r\n  }\r\n  return data\r\n}\r\n\r\nfunction getBoundingBox() {\r\n  // find bounding box for controls\r\n  let box = {}\r\n  box.minX = newcontrols.controls[0].x\r\n  box.maxX = newcontrols.controls[0].x\r\n  box.minY = newcontrols.controls[0].y\r\n  box.maxY = newcontrols.controls[0].y\r\n  for (let i = 1; i < newcontrols.controls.length; i += 1) {\r\n    box.maxX = Math.max(box.maxX, newcontrols.controls[i].x)\r\n    box.maxY = Math.max(box.maxY, newcontrols.controls[i].y)\r\n    box.minX = Math.min(box.minX, newcontrols.controls[i].x)\r\n    box.minY = Math.min(box.minY, newcontrols.controls[i].y)\r\n  }\r\n  box.xRange = box.maxX - box.minX\r\n  box.yRange = box.maxY - box.minY\r\n  return box\r\n}\r\n\r\nfunction getControlCount(courses, courseid) {\r\n  for (let i = 0; i < courses.length; i += 1) {\r\n    if (courses[i].courseid === courseid) {\r\n      return courses[i].controlcount\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\nfunction getControlXY(code) {\r\n  let c = { x: 0, y: 0 }\r\n  for (let i = 0; i < newcontrols.controls.length; i += 1) {\r\n    if (newcontrols.controls[i].code === code) {\r\n      c.x = Math.round(newcontrols.controls[i].x)\r\n      c.y = Math.round(newcontrols.controls[i].y)\r\n      return c\r\n    }\r\n  }\r\n  return c\r\n}\r\n\r\nfunction getCourseIDForResult(course) {\r\n  for (let i = 0; i < resultCourses.length; i += 1) {\r\n    if (resultCourses[i].course === course) {\r\n      return resultCourses[i].courseid\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\nfunction getCourseInfoAsHTML() {\r\n  let html = `<div class=\"new-courses-table\">`\r\n  if (courses.length) {\r\n    html += `<div>${t(\"Course\")}</div><div>${t(\"Name\")}</div><div>${t(\"Controls\")}</div>`\r\n    for (let i = 0; i < courses.length; i += 1) {\r\n      html += `<div>${i + 1}</div><div>${courses[i].name}</div><div>${courses[i].codes.length - 2}</div>`\r\n    }\r\n  }\r\n  html += \"</div>\"\r\n  return html\r\n}\r\n\r\nfunction getCourseName(id) {\r\n  for (let i = 0; i < courses.length; i += 1) {\r\n    if (courses[i].courseid === id) {\r\n      return courses[i].name\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\nfunction getEventEditDropdown(events) {\r\n  let html = generateSelectOption(null, \"No event selected\", true)\r\n  // loop backwards so most recent event is first in list\r\n  for (let i = events.length - 1; i > -1; i -= 1) {\r\n    html += generateSelectOption(\r\n      events[i].kartatid,\r\n      events[i].kartatid + \": \" + events[i].date + \": \" + decode(events[i].name)\r\n    )\r\n  }\r\n  return html\r\n}\r\n\r\nfunction getEventLevelDropdown() {\r\n  let html = \"\"\r\n  const text = [\"Select level\", \"Training\", \"Local\", \"Regional\", \"National\", \"International\"]\r\n  const values = [\"X\", \"T\", \"L\", \"R\", \"N\", \"I\"]\r\n  for (let i = 0; i < text.length; i += 1) {\r\n    html += generateSelectOption(values[i], text[i], i === 0)\r\n  }\r\n  return html\r\n}\r\n\r\nfunction getMapDropdown(maps) {\r\n  let html = generateSelectOption(config.INVALID_MAP_ID, \"Select map\", true)\r\n  // loop backwards so most recent map is first in list\r\n  for (let i = maps.length - 1; i > -1; i -= 1) {\r\n    html += generateSelectOption(i, maps[i].mapid + \": \" + decode(maps[i].name))\r\n  }\r\n  return html\r\n}\r\n\r\nfunction getResultInfoAsHTML() {\r\n  let html = \"\"\r\n  if (results.length) {\r\n    html = `<div class=\"new-results-table\">`\r\n    let runners = 0\r\n    let oldcourse = null\r\n    for (let i = 0; i < results.length; i += 1) {\r\n      if (results[i].course !== oldcourse) {\r\n        if (oldcourse !== null) {\r\n          html += `<div>${runners}</div>`\r\n          runners = 0\r\n        }\r\n        html += `<div>${results[i].course}</div><div>${results[i].name}</div><div>${results[i].time}</div>`\r\n        oldcourse = results[i].course\r\n      }\r\n      runners += 1\r\n    }\r\n    html += `<div>${runners}</div></div>`\r\n  } else {\r\n    html = \"No valid results found.\"\r\n  }\r\n  return html\r\n}\r\n\r\nfunction getRouteDeleteDropdown(id) {\r\n  const routes = getRoutesForEvent(id)\r\n  let html = generateSelectOption(\"undefined\", \"Select route\")\r\n  for (let i = 0; i < routes.length; i += 1) {\r\n    html += generateSelectOption(\r\n      routes[i].resultid,\r\n      routes[i].resultid + \": \" + decode(routes[i].name) + \" on \" + decode(routes[i].coursename)\r\n    )\r\n  }\r\n  return html\r\n}\r\n\r\nfunction getVariantID(codes, courseid) {\r\n  // checks if a variant array of codes already exists\r\n  // adds it if it doesn't\r\n  // returns variantid\r\n  let x = []\r\n  let y = []\r\n  let id = 0\r\n  for (let i = 0; i < variants.length; i += 1) {\r\n    if (variants[i].codes.length === codes.length) {\r\n      let match = true\r\n      for (let j = 0; j < codes.length; j += 1) {\r\n        if (variants[i].codes[j] !== codes[j]) {\r\n          match = false\r\n          break\r\n        }\r\n      }\r\n      if (match) {\r\n        id = i + 1\r\n        break\r\n      }\r\n    }\r\n  }\r\n  if (id === 0) {\r\n    // didn't find a match so add a new variant\r\n    id = variants.length + 1\r\n    for (let i = 0; i < codes.length; i += 1) {\r\n      const c = getControlXY(codes[i])\r\n      x.push(c.x)\r\n      y.push(c.y)\r\n    }\r\n    variants.push({\r\n      x: x,\r\n      y: y,\r\n      id: id,\r\n      courseid: courseid,\r\n      name: \"Variant \" + id,\r\n      codes: codes\r\n    })\r\n  }\r\n\r\n  return id\r\n}\r\n\r\nfunction handleEventAdded(response) {\r\n  if (response.ok) {\r\n    showWarningDialog(\r\n      \"Event created\",\r\n      document.getElementById(\"rg2-event-name\").value + \" has been added with id \" + response.newid + \".\"\r\n    )\r\n    // open newly created event in a separate window\r\n    window.open(rg2Config.api_url.replace(\"rg2api.php\", \"\") + \"#\" + response.newid)\r\n    doGetEvents()\r\n    setEvent()\r\n    // unused map data gets reset in eventListLoaded callback\r\n  } else {\r\n    showWarningDialog(\"Save failed\", response.status_msg + \" Failed to create event. Please try again.\")\r\n  }\r\n}\r\n\r\nconst handleEventDeleted = (id) => (response) => {\r\n  if (response.ok) {\r\n    showWarningDialog(\"Event deleted\", \"Event \" + id + \"has been deleted.\")\r\n    doGetEvents()\r\n    setEvent()\r\n    // unused map data gets reset in eventListLoaded callback\r\n    document.getElementById(\"rg2-edit-event-selected\").replaceChildren()\r\n  } else {\r\n    showWarningDialog(\"Delete failed\", response.status_msg + \". Event \" + id + \" delete failed. Please try again.\")\r\n  }\r\n}\r\n\r\nconst handleEventUpdated = (kartatid) => (response) => {\r\n  if (response.ok) {\r\n    showWarningDialog(\"Event updated\", \"Event \" + kartatid + \" has been updated.\")\r\n    setActiveEventIDByKartatID(null)\r\n    setEventTitleBar()\r\n    doGetEvents()\r\n    setEvent()\r\n  } else {\r\n    showWarningDialog(\"Update failed\", response.status_msg + \". Event update failed. Please try again.\")\r\n  }\r\n}\r\n\r\nfunction handleKeksi(keksi) {\r\n  user.y = keksi\r\n}\r\n\r\nfunction handleLoginResponse(response) {\r\n  if (response.ok) {\r\n    enableManager()\r\n  } else {\r\n    showWarningDialog(\"Login failed\", \"User name or password incorrect. Please try again.\")\r\n  }\r\n}\r\n\r\nfunction handleMapAdded(response) {\r\n  if (response.ok) {\r\n    showWarningDialog(\"Map added\", response.name + \" has been added with id \" + response.newid + \".\")\r\n    // update map dropdown\r\n    doGetMaps()\r\n  } else {\r\n    showWarningDialog(\"Save failed\", response.status_msg + \". Failed to save map. Please try again.\")\r\n  }\r\n}\r\n\r\nfunction handleMapUploaded(response) {\r\n  if (response.ok) {\r\n    doAddMap()\r\n  } else {\r\n    showWarningDialog(\"Upload failed\", response.status_msg + \". Failed to upload map. Please try again.\")\r\n  }\r\n}\r\n\r\nfunction handleMapsLoaded(response) {\r\n  maps.length = 0\r\n  for (let i = 0; i < response.maps.length; i += 1) {\r\n    maps.push(new MapData(response.maps[i]))\r\n  }\r\n  document.getElementById(\"rg2-select-map\").innerHTML = getMapDropdown(maps)\r\n  findUnusedMaps(maps)\r\n  displayUnusedMaps(unusedMaps)\r\n}\r\n\r\nconst handleRouteDeleted = (routeid) => (response) => {\r\n  if (response.ok) {\r\n    showWarningDialog(\"Route deleted\", \"Route \" + routeid + \" has been deleted.\")\r\n    setActiveEventIDByKartatID(null)\r\n    setEventTitleBar()\r\n    doGetEvents()\r\n    setEvent()\r\n  } else {\r\n    showWarningDialog(\r\n      \"Delete failed\",\r\n      response.status_msg + \". Delete failed for route \" + routeid + \". Please try again.\"\r\n    )\r\n  }\r\n}\r\n\r\nfunction handleUnusedMapsDeleted(response) {\r\n  if (response.ok) {\r\n    showWarningDialog(\"Maps deleted\", \"Selected maps have been deleted.\")\r\n  } else {\r\n    showWarningDialog(\"Delete failed\", response.status_msg + \". Delete failed. Please try again.\")\r\n  }\r\n  doGetMaps()\r\n}\r\n\r\nfunction hasZeroTime(time) {\r\n  if (time === 0 || time === \"0\" || time === \"0:00\" || time === \"00:00\") {\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nfunction initialiseData() {\r\n  newcontrols = new Controls()\r\n  mapIndex = config.INVALID_MAP_ID\r\n  format = config.FORMAT_NORMAL\r\n  newEventIsScoreEvent = false\r\n  hasResults = true\r\n  courses = []\r\n  mapping = []\r\n  isEnrichCourseNames = false\r\n  mapLoaded = false\r\n  coursesGeoreferenced = false\r\n  controlsAdjusted = false\r\n  drawingCourses = false\r\n  drawnCourse = {}\r\n  results = []\r\n  variants = []\r\n  resultCourses = []\r\n  mapSize = { height: 0, width: 0 }\r\n  resultsOrCourseFile = undefined\r\n  resultsFileFormat = \"\"\r\n  backgroundLocked = false\r\n  sortResults = false\r\n  handle = { x: null, y: null }\r\n}\r\n\r\nfunction initialiseEncodings() {\r\n  encodingIndex = 0\r\n  errorCount = []\r\n  useThisEncoding = false\r\n}\r\n\r\nexport function initialiseManager(keksi) {\r\n  user = new User(keksi)\r\n  georefmap = L.map(\"rg2-world-file-map\")\r\n  initialiseData()\r\n  initialiseLocationMap()\r\n  document.getElementById(\"rg2-manager-login-form\").addEventListener(\"submit\", (e) => {\r\n    // submission handled here so don't need default form handling\r\n    e.preventDefault()\r\n    const validUser = user.setDetails(\"rg2-user-name\", \"rg2-password\")\r\n    if (validUser) {\r\n      doLogin()\r\n    } else {\r\n      showWarningDialog(\"Login failed\", \"Please enter user name and password of at least five characters\")\r\n    }\r\n  })\r\n}\r\n\r\nfunction initialiseLocationMap() {\r\n  L.tileLayer(\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\", {\r\n    maxZoom: 19,\r\n    attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\r\n  }).addTo(georefmap)\r\n  document.getElementById(\"rg2-world-file-map-container\").classList.remove(\"d-none\")\r\n}\r\n\r\nexport function managerDragEnded() {\r\n  // console.log(\"Drag ended\")\r\n  if (mapLoaded && newcontrols.controls.length > 0) {\r\n    // rebaseline control locations\r\n    copyXYToOldXY()\r\n  }\r\n}\r\n\r\nexport function managerMapLoadCallback() {\r\n  //callback when map image is loaded\r\n  mapLoaded = true\r\n  if (mapIndex !== config.INVALID_MAP_ID) {\r\n    localworldfile = maps[mapIndex].localworldfile\r\n    worldfile = maps[mapIndex].worldfile\r\n  }\r\n  mapSize = getMapSize()\r\n  fitControlsToMap()\r\n  redraw()\r\n}\r\n\r\nexport function managerMouseUp(x, y) {\r\n  // console.log(\"Mouse up \",x, y)\r\n  if (drawingCourses) {\r\n    addNewControl(x, y)\r\n    controlsAdjusted = true\r\n    return\r\n  }\r\n  if (mapLoaded && newcontrols.controls.length > 0) {\r\n    // adjusting the track\r\n    if (handle.x === null) {\r\n      handle = { x: x, y: y }\r\n    } else {\r\n      handle = { x: null, y: null }\r\n    }\r\n  }\r\n}\r\n\r\nfunction mapResultsToCourses() {\r\n  // read through dropdowns and allocate courseid for each required course\r\n  // also delete unwanted courses\r\n  let newCourses = []\r\n  // courseid historically starts at 1 just to cause endless indexing problems\r\n  let courseid = 1\r\n  for (let i = 0; i < resultCourses.length; i += 1) {\r\n    let id = undefined\r\n    if (drawingCourses) {\r\n      // only handles one course at present, so it is always 0\r\n      id = 0\r\n    } else {\r\n      const selector = document.getElementById(\"rg2-alloc-\" + i)\r\n      if (selector) {\r\n        id = parseInt(selector.value, 10)\r\n      }\r\n    }\r\n    if (id !== undefined && id !== config.DO_NOT_SAVE_COURSE) {\r\n      // check we haven't already saved this course\r\n      if (courses[id].courseid === 0) {\r\n        courses[id].courseid = courseid\r\n        newCourses.push(courses[id])\r\n        resultCourses[i].courseid = courseid\r\n        courseid += 1\r\n      } else {\r\n        resultCourses[i].courseid = courses[id].courseid\r\n      }\r\n    }\r\n  }\r\n  courses = newCourses\r\n}\r\n\r\nfunction processCourseFile(e) {\r\n  coursesGeoreferenced = false\r\n  backgroundLocked = false\r\n  document.getElementById(\"chk-move-map-and-controls\").checked = false\r\n  handle = { x: null, y: null }\r\n  newcontrols.deleteAllControls()\r\n  const parsedCourses = new CourseParser(e, worldfile, localworldfile)\r\n  courses = parsedCourses.courses\r\n  if (courses.length > 0) {\r\n    newcontrols = parsedCourses.newcontrols\r\n    mapping = parsedCourses.mapping\r\n    if (mapping.length > 0) {\r\n      document.getElementById(\"chk-enrich-course-names\").classList.remove(\"d-none\")\r\n    } else {\r\n      document.getElementById(\"chk-enrich-course-names\").classList.add(\"d-none\")\r\n    }\r\n    coursesGeoreferenced = parsedCourses.georeferenced\r\n    displayInfoDialog(\"Course details\", getCourseInfoAsHTML())\r\n    createResultCourseMapping()\r\n    displayCourseAllocations()\r\n    fitControlsToMap()\r\n  }\r\n  redraw()\r\n}\r\n\r\nfunction processMap(e) {\r\n  // called to load a new map locally rather than from server when creating a new map\r\n  loadNewMap(e.target.result, true)\r\n  document.getElementById(\"rg2-load-map-file\").classList.add(\"is-valid\")\r\n  mapLoaded = true\r\n  mapSize = getMapSize()\r\n  fitControlsToMap()\r\n  redraw()\r\n  document.getElementById(\"btn-add-map\").removeAttribute(\"disabled\")\r\n}\r\n\r\nfunction processResultFile(e) {\r\n  const parsedResults = new ResultParser(e, resultsFileFormat)\r\n  results = parsedResults.results\r\n  if (results.length > 0) {\r\n    resultCourses = parsedResults.resultCourses\r\n    displayInfoDialog(\"Result details\", getResultInfoAsHTML())\r\n    displayCourseAllocations()\r\n  }\r\n}\r\n\r\nfunction readCourses(e) {\r\n  let reader = new FileReader()\r\n  reader.onerror = function () {\r\n    showWarningDialog(\"Course file error\", \"The selected course file could not be read.\")\r\n  }\r\n\r\n  reader.onload = function (e) {\r\n    processCourseFile(e)\r\n  }\r\n  //\r\n  // TODO: input charset should be set based on RG_FILE_ENCODING variable\r\n  // reader.readAsText(e.target.files[0], 'ISO-8859-1')\r\n  reader.readAsText(e.target.files[0])\r\n}\r\n\r\nfunction readGeorefFile(e) {\r\n  const reader = new FileReader()\r\n  try {\r\n    reader.readAsText(e.target.files[0])\r\n  } catch (err) {\r\n    showWarningDialog(\"File read error\", \"Failed to open selected world file.\")\r\n    return\r\n  }\r\n  reader.onerror = function () {\r\n    showWarningDialog(\"World file error\", \"The selected world file could not be read.\")\r\n  }\r\n  reader.onload = function (e) {\r\n    // see http://en.wikipedia.org/wiki/World_file\r\n    const txt = e.target.result\r\n    const args = txt.split(/[\\r\\n]+/g)\r\n    localworldfile = new Worldfile({\r\n      A: args[0],\r\n      B: args[2],\r\n      C: args[4],\r\n      D: args[1],\r\n      E: args[3],\r\n      F: args[5]\r\n    })\r\n    const defaultGeorefValue = georefsystems.getDefaultValue()\r\n    document.getElementById(\"rg2-georef-type\").value = defaultGeorefValue\r\n    convertWorldFile(defaultGeorefValue)\r\n  }\r\n}\r\n\r\nfunction readMapFile(e) {\r\n  const reader = new FileReader()\r\n  reader.onload = function (e) {\r\n    processMap(e)\r\n  }\r\n  const format = e.target.files[0].name.substr(-3, 3).toUpperCase()\r\n  if (format === \"JPG\" || format === \"GIF\") {\r\n    mapFile = e.target.files[0]\r\n    reader.readAsDataURL(e.target.files[0])\r\n  } else {\r\n    showWarningDialog(\r\n      \"File type error\",\r\n      e.target.files[0].name + \" is not recognised. Only .jpg and .gif files are supported at present.\"\r\n    )\r\n  }\r\n}\r\n\r\nfunction readResults() {\r\n  let reader = new FileReader()\r\n\r\n  reader.onerror = function () {\r\n    showWarningDialog(\"Results file error\", \"The selected results file could not be read.\")\r\n  }\r\n  reader.onload = function (e) {\r\n    checkResultsFileEncoding(e)\r\n  }\r\n  format = resultsOrCourseFile.name.substr(-3, 3).toUpperCase()\r\n  if (format === \"XML\" || format === \"CSV\") {\r\n    resultsFileFormat = format\r\n    reader.readAsText(resultsOrCourseFile, encodings[encodingIndex])\r\n  } else {\r\n    showWarningDialog(\"File type error\", \"Results file type is not recognised. Please select a valid file.\")\r\n  }\r\n}\r\n\r\nfunction renumberResults() {\r\n  // updates the course id and name when we know the mapping\r\n  // and deletes results for courses not required\r\n  let newResults = []\r\n  for (let i = 0; i < results.length; i += 1) {\r\n    const id = getCourseIDForResult(results[i].course)\r\n    if (id !== config.DO_NOT_SAVE_COURSE) {\r\n      results[i].courseid = id\r\n      results[i].course = getCourseName(id)\r\n      // set null here: overwritten later in extractVariants if this is a variant\r\n      results[i].variantid = \"\"\r\n      newResults.push(results[i])\r\n    }\r\n  }\r\n  results = newResults\r\n}\r\n\r\nfunction setButtons() {\r\n  document.getElementById(\"btn-create-event\").addEventListener(\"click\", (e) => {\r\n    confirmCreateEvent(e)\r\n  })\r\n  document.getElementById(\"btn-update-event\").addEventListener(\"click\", (e) => {\r\n    confirmUpdateEvent(e)\r\n  })\r\n\r\n  document.getElementById(\"btn-delete-route\").addEventListener(\"click\", (e) => {\r\n    confirmDeleteRoute(e)\r\n  })\r\n  document.getElementById(\"btn-delete-event\").addEventListener(\"click\", (e) => {\r\n    confirmDeleteEvent(e)\r\n  })\r\n  document.getElementById(\"btn-add-map\").addEventListener(\"click\", (e) => {\r\n    confirmAddMap(e)\r\n  })\r\n  document.getElementById(\"btn-delete-unused-maps\").addEventListener(\"click\", (e) => {\r\n    confirmDeleteUnusedMaps(e)\r\n  })\r\n  document.getElementById(\"btn-draw-courses\").addEventListener(\"click\", (e) => {\r\n    startDrawingCourses(e)\r\n  })\r\n  document.getElementById(\"rg2-load-georef-file\").addEventListener(\"input\", (e) => {\r\n    readGeorefFile(e)\r\n  })\r\n  document.getElementById(\"rg2-load-map-file\").addEventListener(\"input\", (e) => {\r\n    validateMapUpload(e.target.files[0])\r\n    readMapFile(e)\r\n  })\r\n  const loadResults = document.getElementById(\"rg2-load-results-file\")\r\n  loadResults.addEventListener(\"click\", (e) => {\r\n    if (!mapLoaded) {\r\n      showWarningDialog(\"No map loaded\", \"Please load a map file before adding results.\")\r\n      e.preventDefault()\r\n    }\r\n  })\r\n  loadResults.addEventListener(\"change\", (e) => {\r\n    resultsOrCourseFile = e.target.files[0]\r\n    initialiseEncodings()\r\n    readResults()\r\n  })\r\n  document.getElementById(\"chk-move-map-and-controls\").addEventListener(\"click\", (e) => {\r\n    toggleMoveAll(e.target.checked)\r\n  })\r\n  document.getElementById(\"chk-no-results\").addEventListener(\"click\", (e) => {\r\n    toggleResultsRequired(e.target.checked)\r\n  })\r\n  document.getElementById(\"chk-score-event\").addEventListener(\"click\", (e) => {\r\n    toggleScoreEvent(e.target.checked)\r\n  })\r\n  document.getElementById(\"chk-enrich-course-names\").addEventListener(\"click\", (e) => {\r\n    toggleEnrichCourseNames(e.target.checked)\r\n  })\r\n  document.getElementById(\"chk-sort-results\").addEventListener(\"click\", (e) => {\r\n    toggleSortResults(e.target.checked)\r\n  })\r\n  const load = document.getElementById(\"rg2-load-course-file\")\r\n  load.addEventListener(\"click\", (e) => {\r\n    if (!mapLoaded) {\r\n      showWarningDialog(\"No map loaded\", \"Please load a map file before adding courses.\")\r\n      e.preventDefault()\r\n    }\r\n  })\r\n  load.addEventListener(\"change\", (e) => {\r\n    readCourses(e)\r\n  })\r\n}\r\n\r\nfunction setControlLocations() {\r\n  // called when saving courses\r\n  // reads control locations and updates course details\r\n  for (let i = 0; i < courses.length; i += 1) {\r\n    for (let j = 0; j < courses[i].codes.length; j += 1) {\r\n      const c = getControlXY(courses[i].codes[j])\r\n      courses[i].x[j] = c.x\r\n      courses[i].y[j] = c.y\r\n    }\r\n  }\r\n}\r\n\r\nfunction setCourseName() {\r\n  const course = document.getElementById(\"rg2-new-course-name\").value\r\n  if (course) {\r\n    drawnCourse.name = course\r\n  }\r\n}\r\n\r\nfunction setEvent(kartatid) {\r\n  if (kartatid) {\r\n    loadEventByKartatID(kartatid)\r\n  } else {\r\n    // no event selected so initialise everything\r\n    initialiseData()\r\n    document.getElementById(\"rg2-edit-event-name\").value = \"\"\r\n    document.getElementById(\"rg2-edit-club-name\").value = \"\"\r\n    eventEditDatePicker.setDate(\"\")\r\n    document.getElementById(\"rg2-edit-event-level\").value = \"\"\r\n    document.getElementById(\"rg2-edit-event-comments\").value = \"\"\r\n    document.getElementById(\"rg2-edit-exclude\").value = defaultExcludedText\r\n    document.getElementById(\"rg2-route-selected\").replaceChildren()\r\n    document.getElementById(\"chk-edit-read-only\").checked = false\r\n    document.getElementById(\"rg2-course-allocations\").innerHTML = \"\"\r\n  }\r\n}\r\n\r\nfunction setGeoref(optionValue) {\r\n  if (optionValue !== 0) {\r\n    convertWorldFile(optionValue)\r\n  }\r\n}\r\n\r\nfunction setMapName() {\r\n  newMap.name = document.getElementById(\"rg2-map-name\").value\r\n  validateValue(\"rg2-map-name\", (value) => {\r\n    // at least one character\r\n    return /./.test(value)\r\n  })\r\n}\r\n\r\nfunction sortResultItems(a, b) {\r\n  // called after final courseids allocated so this is safe\r\n  if (a.courseid !== b.courseid) {\r\n    return a.courseid - b.courseid\r\n  }\r\n  if (a.position !== \"\" && b.position !== \"\") {\r\n    // sort by position, if available\r\n    return a.position - b.position\r\n  }\r\n  if (a.position === \"\" && b.position !== \"\") {\r\n    return 1\r\n  }\r\n  if (a.position !== \"\" && b.position === \"\") {\r\n    return -1\r\n  }\r\n  // sort by time, if available\r\n  if (hasZeroTime(a.time) && hasZeroTime(b.time)) {\r\n    // sort by name, when no time\r\n    return a.name - b.name\r\n  }\r\n  return a.time - b.time\r\n}\r\n\r\nfunction startDrawingCourses() {\r\n  if (mapLoaded) {\r\n    drawingCourses = true\r\n    courses.length = 0\r\n    newcontrols.deleteAllControls()\r\n    drawnCourse.name = \"Course\"\r\n    drawnCourse.x = []\r\n    drawnCourse.y = []\r\n    drawnCourse.codes = []\r\n    drawnCourse.courseid = 0\r\n    document.getElementById(\"rg2-new-course-name\").value\r\n    document.getElementById(\"rg2-draw-courses\").classList.remove(\"d-none\")\r\n  } else {\r\n    showWarningDialog(\"No map selected\", \"Please load a map before drawing courses\")\r\n  }\r\n}\r\n\r\nfunction testForInvalidCharacters(rawtext) {\r\n  // takes in text read from a results file and checks it has converted to UTF-8 correctly\r\n  let count = 0\r\n  for (let i = 0; i < rawtext.length; i += 1) {\r\n    // Unicode U+FFFD (65533) is the replacement character used to replace an incoming character whose value is unknown or unrepresentable\r\n    // see http://www.fileformat.info/info/unicode/char/0fffd/index.htm\r\n    if (rawtext.charCodeAt(i) === 65533) {\r\n      count += 1\r\n    }\r\n  }\r\n  return count\r\n}\r\n\r\nfunction toggleEnrichCourseNames(checked) {\r\n  isEnrichCourseNames = checked\r\n  displayCourseAllocations()\r\n}\r\n\r\n// locks or unlocks background when adjusting map\r\nfunction toggleMoveAll(checkedState) {\r\n  backgroundLocked = checkedState\r\n}\r\n\r\nfunction toggleResultsRequired(checked) {\r\n  // check box checked means event does not have results\r\n  hasResults = !checked\r\n  createResultCourseMapping()\r\n  displayCourseAllocations()\r\n}\r\n\r\nfunction toggleScoreEvent(checked) {\r\n  newEventIsScoreEvent = checked\r\n}\r\n\r\nfunction toggleSortResults(checkedState) {\r\n  sortResults = checkedState\r\n}\r\n\r\nfunction updateGeorefMap() {\r\n  // Plot a polygon and recentre the map on the polygon\r\n  const lon = newMap.lon\r\n  const lat = newMap.lat\r\n  //console.log(newMap)\r\n  let poly_coords = []\r\n  // For some reason this is the order the coordinates are stored in.\r\n  const indices = [3, 1, 2, 0]\r\n  indices.forEach(function (i) {\r\n    poly_coords.push([lat[i], lon[i]])\r\n  })\r\n  const poly = L.polygon(poly_coords, { color: \"red\" })\r\n  poly.addTo(georefmap)\r\n  document.getElementById(\"rg2-world-file-map-container\").classList.remove(\"d-none\")\r\n  georefmap.invalidateSize()\r\n  georefmap.fitBounds(poly.getBounds())\r\n}\r\n\r\nfunction validateData() {\r\n  if (document.getElementById(\"rg2-event-name\").value === \"\") {\r\n    return \"Event name is not valid.\"\r\n  }\r\n  if (mapIndex === config.INVALID_MAP_ID) {\r\n    return \"No map selected.\"\r\n  }\r\n  if (document.getElementById(\"rg2-select-club-name\").value === \"\") {\r\n    return \"Club name is not valid.\"\r\n  }\r\n  if (eventSelectDatePicker.getDate(\"yyyy-mm-dd\") === undefined) {\r\n    return \"Date is not valid.\"\r\n  }\r\n  if (document.getElementById(\"rg2-select-event-level\").value === \"X\") {\r\n    return \"Event level is not valid.\"\r\n  }\r\n  if (!format) {\r\n    return \"Event format is not valid.\"\r\n  }\r\n  if (courses.length === 0) {\r\n    if (!drawingCourses) {\r\n      return \"No course information. Check your course XML file.\"\r\n    }\r\n  }\r\n  if (results.length === 0) {\r\n    if (hasResults) {\r\n      return \"No results information. Check your results file.\"\r\n    }\r\n  }\r\n  if (!controlsAdjusted) {\r\n    return \"Controls have not been adjusted on the map.\"\r\n  }\r\n  return \"OK\"\r\n}\r\n\r\nfunction validateMapUpload(upload) {\r\n  let reader = new FileReader()\r\n  reader.onload = function (e) {\r\n    let image = new Image()\r\n    image.src = e.target.result\r\n    image.onload = function () {\r\n      const size = Math.round(upload.size / 1024 / 1024)\r\n      if (\r\n        size > config.FILE_SIZE_WARNING ||\r\n        image.height > config.PIXEL_SIZE_WARNING ||\r\n        image.width > config.PIXEL_SIZE_WARNING\r\n      ) {\r\n        let msg = \"The uploaded map file is \" + size + \"MB (\" + image.width\r\n        msg += \" x \" + image.height + \"px). It is recommended that you use maps under \" + config.FILE_SIZE_WARNING\r\n        msg += \"MB with a maximum dimension of \" + config.PIXEL_SIZE_WARNING + \"px. Please see the \"\r\n        msg += \"<a href='https://github.com/Maprunner/rg2/wiki/Map-files'>RG2 wiki</a> for \"\r\n        msg += \"guidance on how to create map files.\"\r\n        showWarningDialog(\"Oversized map upload\", msg)\r\n      }\r\n    }\r\n  }\r\n  reader.readAsDataURL(upload)\r\n}\r\n"],"names":["CourseParser","worldfile","localWorldfile","Controls","rawXML","xml","showWarningDialog","version","nodelist","text","pt","i","code","latlng","control","places","coords","lat","lng","codes","courseName","className","latLng","x","y","name","course","nodeList","tagName","controlList","type","isGeoref","geopos","mapPosition","controls","ResultParserCSV","rawCSV","fields","result","getSecsFromHHMM","info","formatSecsAsMMSS","getSecsFromHHMMSS","nextsplit","nextcode","splits","totaltime","headers","titles","values","str","found","j","position","nc","classifier","rows","newResult","commas","semicolons","ResultParserIOFV2","resultlist","extractAttributeZero","extractTextContentZero","splitlist","finishtime","l","temp","element","index","personlist","time","classlist","err","ResultParserIOFV3","k","timeInt","ResultParser","fileFormat","parsedResults","config","user","newMap","MapData","georefsystems","Georefs","mapIndex","format","newEventIsScoreEvent","hasResults","newcontrols","courses","mapping","isEnrichCourseNames","mapLoaded","coursesGeoreferenced","controlsAdjusted","drawingCourses","drawnCourse","results","variants","resultCourses","mapFile","resultsOrCourseFile","resultsFileFormat","encodings","errorCount","encodingIndex","useThisEncoding","backgroundLocked","sortResults","handle","maps","mapSize","localworldfile","Worldfile","georefmap","unusedMaps","eventSelectDatePicker","eventEditDatePicker","defaultExcludedText","addNewControl","adjustManagerControls","p1","p2","button","ctx","scaleX","scaleY","dx","dy","checkResultsFileEncoding","e","errors","testForInvalidCharacters","processResultFile","lowest","readResults","confirmAddMap","dlg","doUploadMapFile","createModalDialog","confirmCreateEvent","valid","validateData","doCreateEvent","confirmDeleteEvent","id","doDeleteEvent","confirmDeleteRoute","doDeleteRoute","confirmDeleteUnusedMaps","boxes","checked","box","doDeleteUnusedMaps","confirmUpdateEvent","doUpdateEvent","convertWorldFile","value","system","getMapSize","proj4","source","dest","xpx","ypx","xsrc","ysrc","p","transformed","wf","updateGeorefMap","copyXYToOldXY","createCourseDropdown","courseidx","idx","html","enrichCourseName","createResultCourseMapping","displayCourseAllocations","displayInfoDialog","title","displayUnusedMaps","doAddMap","params","data","postApi","handleMapAdded","handleKeksi","generateNewEventData","handleEventAdded","handleEventDeleted","routeid","handleRouteDeleted","map","handleUnusedMapsDeleted","doGetMaps","getApi","handleMapsLoaded","doLogin","handleLoginResponse","exclude","handleEventUpdated","details","formData","handleMapUploaded","drawManagerControls","opt","getOverprintDetails","enableManager","setButtons","getEventLevelDropdown","loadNewMap","Datepicker","setMapName","setCourseName","setEvent","setGeoref","course_name","classes","class_name","enrichCourseNames","eventFinishedLoading","kartatid","event","getEventInfoForKartatID","decode","isScoreEvent","getRouteDeleteDropdown","eventListLoaded","events","getEventEditDropdown","findUnusedMaps","extractVariants","getVariantID","mapIDIsInUse","fitControlsToMap","georefOK","getBoundingBox","scale","setControlLocations","mapResultsToCourses","renumberResults","sortResultItems","getControlCount","courseid","getControlXY","c","getCourseIDForResult","getCourseInfoAsHTML","t","getCourseName","generateSelectOption","getMapDropdown","getResultInfoAsHTML","runners","oldcourse","routes","getRoutesForEvent","match","response","doGetEvents","setActiveEventIDByKartatID","setEventTitleBar","keksi","hasZeroTime","initialiseData","initialiseEncodings","initialiseManager","User","L","initialiseLocationMap","managerDragEnded","managerMapLoadCallback","redraw","managerMouseUp","newCourses","selector","processCourseFile","parsedCourses","processMap","readCourses","reader","readGeorefFile","args","defaultGeorefValue","readMapFile","newResults","startDrawingCourses","validateMapUpload","loadResults","toggleMoveAll","toggleResultsRequired","toggleScoreEvent","toggleEnrichCourseNames","toggleSortResults","load","loadEventByKartatID","optionValue","validateValue","a","b","rawtext","count","checkedState","lon","poly_coords","poly","upload","image","size","msg"],"mappings":"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"}