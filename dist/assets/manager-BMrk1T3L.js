import{d as _}from"./node-modules-DcNSr3-7.js";import{C as Te,s as c,g as b,c as V,a as Pe,f as Be,b as M,e as le,d as S,h as g,i as C,j as Ue,G as Ge,l as xe,k as Ye,m as He,n as ae,r as de,M as Ne,v as We,o as $e,p as je,q as Ke,t as F,W as H,u as oe,w as Ze,x as ee,y as De,z as Le,U as ze}from"./main-4FAEMXio.js";import{D as ve,L as ce,p as Z}from"./manager-utils-LTpwnKd6.js";class Je{constructor(e,t,s){return this.courses=[],this.courseClassMapping=[],this.newcontrols=new Te,this.courses.length=0,this.courseClassMapping.length=0,this.fromOldCondes=!1,this.coursesGeoreferenced=!1,this.newcontrols.deleteAllControls(),this.localWorldfile=s,this.worldfile=t,this.processCoursesXML(e.target.result),this.addControlCount(),{courses:this.courses,newcontrols:this.newcontrols,mapping:this.courseClassMapping,georeferenced:this.coursesGeoreferenced}}processCoursesXML(e){let t=null;try{t=new DOMParser().parseFromString(e,"text/xml")}catch{c("XML file error","File is not a valid XML course file.");return}if(t.getElementsByTagName("CourseData").length===0){t.documentElement.nodeName==="kml"?this.processKMLCourses(t):c("XML file error","File is not a valid XML course file. CourseData element missing.");return}const o=this.getVersion(t);switch(o){case"2.0.3":this.processIOFV2XMLCourses(t);break;case"3.0":this.processIOFV3XMLCourses(t);break;default:c("XML file error","Invalid IOF file format. Version "+o+" not supported.")}}getVersion(e){let t="",s=e.getElementsByTagName("IOFVersion");return s.length>0&&(t=s[0].getAttribute("version")),t===""&&(s=e.getElementsByTagName("CourseData"),s.length>0&&(t=s[0].getAttribute("iofVersion").trim(),this.setCreator(s[0].getAttribute("creator").trim()))),t}setCreator(e){e.indexOf("Condes")>-1&&e.length>15&&parseFloat(e.substring(15))<10.1&&(this.fromOldCondes=!0)}processIOFV3XMLCourses(e){let t=e.getElementsByTagName("Control"),s={x:0,y:0};for(let o=0;o<t.length;o+=1)if(t[o].parentNode.nodeName==="RaceCourseData"){const l=t[o].getElementsByTagName("Id")[0].textContent,r=t[o].getElementsByTagName("Position");this.localWorldfile.valid&&r.length>0?(s=this.getXYFromLatLng(r),this.coursesGeoreferenced=!0):s=this.getXYFromMapPosition(t[o].getElementsByTagName("MapPosition"));let i={};t[o].getAttribute("type")!=="CrossingPoint"&&(this.newcontrols.addControl(l.trim(),s.x,s.y),i.id=o,r.length>0?(i.lat=parseFloat(r[0].getAttribute("lat")),i.lng=parseFloat(r[0].getAttribute("lng"))):(i.lat=0,i.lng=0),i.x=s.x,i.y=s.y)}t=e.getElementsByTagName("Course"),this.extractV3Courses(t),t=e.getElementsByTagName("ClassCourseAssignment"),this.extractV3CourseClassMapping(t)}processKMLCourses(e){this.coursesGeoreferenced=!0;const t=e.getElementsByTagName("Placemark");for(let r=0;r<t.length;r=r+1){let i={};const u=t[r].getElementsByTagName("name")[0].childNodes[0].nodeValue.trim(),f=t[r].getElementsByTagName("Point")[0].getElementsByTagName("coordinates")[0].childNodes[0].nodeValue.trim().split(","),R=+f[1],X=+f[0];i.x=this.worldfile.getX(X,R),i.y=this.worldfile.getY(X,R),this.newcontrols.addControl(u.trim(),i.x,i.y);let U={};U.id=r+1,U.lat=R,U.lng=X,U.x=i.x,U.y=i.y}let s=[];const o="Course 1",l="Course 1";s=this.newcontrols.controls.map(function(r){return r.code}),this.courses.push({courseid:0,x:[],y:[],codes:s,name:o}),this.courseClassMapping.push({course:o,className:l}),document.getElementById("rg2-select-course-file").classList.add("is-valid")}getXYFromLatLng(e){let t={x:0,y:0};const s=parseFloat(e[0].getAttribute("lat")),o=parseFloat(e[0].getAttribute("lng"));return this.fromOldCondes?(t.x=this.localWorldfile.getX(o,s),t.y=this.localWorldfile.getY(o,s)):(t.x=this.worldfile.getX(o,s),t.y=this.worldfile.getY(o,s)),t}processIOFV2XMLCourses(e){if(this.extractV2Controls(e.getElementsByTagName("StartPoint"),"StartPointCode"),this.extractV2Controls(e.getElementsByTagName("Control"),"ControlCode"),this.coursesGeoreferenced=this.extractV2Controls(e.getElementsByTagName("FinishPoint"),"FinishPointCode"),this.coursesGeoreferenced&&this.localWorldfile.valid)for(let t=0;t<this.newcontrols.controls.length;t+=1){const s=this.newcontrols.controls[t].x,o=this.newcontrols.controls[t].y;this.newcontrols.controls[t].x=this.localWorldfile.getX(s,o),this.newcontrols.controls[t].y=this.localWorldfile.getY(s,o)}this.extractV2Courses(e.getElementsByTagName("Course"))}extractV2Courses(e){for(let t=0;t<e.length;t+=1){let s=[],o=[],l=[];const r=e[t].getElementsByTagName("CourseName")[0].textContent.trim();s=this.extractCodesFromControlList(e[t],"ControlCode"),s.unshift(e[t].getElementsByTagName("StartPointCode")[0].textContent.trim()),s.push(e[t].getElementsByTagName("FinishPointCode")[0].textContent.trim()),this.courses.push({courseid:0,x:o,y:l,codes:s,name:r})}document.getElementById("rg2-select-course-file").classList.add("is-valid")}extractV3Courses(e){for(let t=0;t<e.length;t+=1){let s=[],o=[],l=[];const r=e[t].getElementsByTagName("Name")[0].textContent.trim();s=this.extractCodesFromControlList(e[t],"Control"),this.courses.push({courseid:0,x:o,y:l,codes:s,name:r})}document.getElementById("rg2-select-course-file").classList.add("is-valid")}extractV3CourseClassMapping(e){for(let t=0;t<e.length;t+=1){const s=e[t].getElementsByTagName("CourseName")[0].textContent.trim(),o=e[t].getElementsByTagName("ClassName")[0].textContent.trim();this.courseClassMapping.push({course:s,className:o})}document.getElementById("rg2-select-course-file").classList.add("is-valid")}extractCodesFromControlList(e,t){const s=e.getElementsByTagName("CourseControl");let o=[];for(let l=0;l<s.length;l+=1)if(l===0||s[l].getAttribute("type")!=="Start"){const r=s[l].getElementsByTagName(t)[0].textContent.trim();this.validControlCode(r)&&o.push(r)}return o}extractV2Controls(e,t){let s=!1,o={x:0,y:0};for(let l=0;l<e.length;l+=1){const r=e[l].getElementsByTagName(t)[0].textContent,i=e[l].getElementsByTagName("ControlPosition");i.length>0&&this.localWorldfile.valid?(o.x=parseFloat(i[0].getAttribute("x")),o.y=parseFloat(i[0].getAttribute("y")),s=!0):o=this.getXYFromMapPosition(e[l].getElementsByTagName("MapPosition")),this.newcontrols.addControl(r.trim(),o.x,o.y)}return s}getXYFromMapPosition(e){return{x:e[0].getAttribute("x").replace(",","."),y:e[0].getAttribute("y").replace(",",".")}}validControlCode(e){const t=this.newcontrols.controls;for(let s=0;s<t.length;s+=1)if(t[s].code===e)return!0;return!1}addControlCount(){for(let e=0;e<this.courses.length;e+=1)this.courses[e].controlcount=this.courses[e].codes.length-2}}function qe(n){const e=document.getElementById("rg2-edit-event-selected").value;let t={};t.body="Event "+e+" will be deleted. Are you sure?",t.title="Confirm event delete",t.classes="rg2-confirm-delete-event-dialog",t.doText="Delete event",t.onDo=n,V(t)}function Qe(n){const e=document.getElementById("rg2-route-selected").value;if(e==="undefined"){c("Warning","No route selected.");return}let t={};t.body="Route "+e+" will be permanently deleted. Are you sure?",t.title="Confirm route delete",t.classes="rg2-confirm-route-delete-dialog",t.doText="Delete route",t.onDo=n,V(t)}function et(n,e){const t=document.querySelectorAll(".unused-map input[type=checkbox]:checked");let s=[];for(let l of t){l.checked&&s.push(parseInt(l.dataset.mapId,10));for(let r=0;r<n.length;r+=1)s.indexOf(n[r].mapid)>-1?n[r].delete=!0:n[r].delete=!1}if(s.length===0)return c("Warning","No maps selected."),n;const o={};return o.body="Selected maps will be deleted. Are you sure?",o.title="Confirm map deletion",o.doText="Delete maps",o.onDo=e,V(o),n}function Fe(n){let e="<div class='title'>ID</div><div class='title'>Name</div><div><i class='bi-trash'></i></div>";if(n.length===0)e+="<div></div><div>None found.</div><div></div>",document.getElementById("btn-delete-unused-maps").setAttribute("disabled","");else{for(let t=0;t<n.length;t+=1)e+="<div>"+n[t].mapid+"</div>",e+="<div>"+n[t].name+"</div>",e+="<div class='unused-map'><input type='checkbox' data-map-id="+n[t].mapid+"></div>";document.getElementById("btn-delete-unused-maps").removeAttribute("disabled")}document.getElementById("rg2-unused-maps").innerHTML=e}function tt(n,e){let t=e?"":b(null,"No event selected",!0);for(let s=n.length-1;s>-1;s-=1)t+=b(n[s].kartatid,n[s].kartatid+": "+n[s].date+": "+_(n[s].name),e===n[s].kartatid);return t}function Ie(){let n="";const e=["Select level","Training","Local","Regional","National","International"],t=["X","T","L","R","N","I"];for(let s=0;s<e.length;s+=1)n+=b(t[s],e[s],s===0);return n}function Ce(n){return n===0||n==="0"||n==="0:00"||n==="00:00"}function nt(n,e){return n.courseid!==e.courseid?n.courseid-e.courseid:n.position!==""&&e.position!==""?n.position-e.position:n.position===""&&e.position!==""?1:n.position!==""&&e.position===""?-1:Ce(n.time)&&Ce(e.time)?n.name-e.name:n.time-e.time}function st(n){let e=0;for(let t=0;t<n.length;t+=1)n.charCodeAt(t)===65533&&(e+=1);return e}class ot{constructor(e){return this.results=[],this.CSVFormat={},this.separator="",this.valid=!0,this.processResultsCSV(e),{results:this.results,valid:this.valid}}extractResult(e,t,s){let u={};u.chipid=0,u.name=(e[0]+" "+e[1]+" "+e[2]).trim(),u.dbid=u.chipid+"__"+u.name,u.starttime=Pe(e[3]),u.club=e[2],u.course=t,u.controls=s;const p=this.extractSpklasseSplits(e);u.splits=p.splits,u.codes=p.codes,u.time=Be(p.totaltime),this.results.push(u)}extractSingleCSVResult(e){let t={};t.valid=!0,t.chipid=e[this.CSVFormat.CHIP_IDX],t.name=(e[this.CSVFormat.FIRST_NAME_IDX]+" "+e[this.CSVFormat.SURNAME_IDX]).trim().replace(/"/g,""),t.dbid=e[this.CSVFormat.DB_IDX],t.starttime=M(e[this.CSVFormat.START_TIME_IDX]),t.time=e[this.CSVFormat.TOTAL_TIME_IDX],t.position=this.getPosition(e),t.status=this.getSICSVStatus(e[this.CSVFormat.NC_IDX],e[this.CSVFormat.CLASSIFIER_IDX]),t.club=e[this.CSVFormat.CLUB_IDX].trim().replace(/"/g,""),t.course=e[this.CSVFormat.COURSE_IDX],t.course===""&&(t.valid=!1),t.controls=parseInt(e[this.CSVFormat.NUM_CONTROLS_IDX],10);const s=this.extractSISplits(e,t.controls);return t.splits=s.splits,t.splits!==""&&(t.splits+=";"),t.splits+=M(t.time),t.codes=s.codes,t}extractSISplits(e,t){let s=this.CSVFormat.FIRST_SPLIT_IDX,o=this.CSVFormat.FIRST_CODE_IDX,l={};l.splits="",l.codes=[];for(let r=0;r<t;r+=1)e[o]&&(r>0&&(l.splits+=";"),l.codes[r]=e[o],l.splits+=M(e[s])),s+=this.CSVFormat.STEP,o+=this.CSVFormat.STEP;return{splits:l.splits,codes:l.codes}}extractSpklasseSplits(e){let s="",o=[],l=0;for(let r=0;r<e.length-4;r+=1)r>0&&(s+=";"),o[r]="X",l+=M(e[r+4]),s+=l;return{splits:s,codes:o,totaltime:l}}getCSVFormat(e){const t=[["si card","chipno","sicard","database id"],["database id"],["surname"],["first name"],["nc","classifier"],["start"],["time"],["classifier"],["city","club"],["short"],["course"],["course controls"],["pl","place"],["start punch"],["control1"],["punch1"],["control2"]];let s=[];const o=e.split(this.separator).map(function(r){return r.toLowerCase()});let l=!1;for(let r=0;r<t.length;r+=1){l=!1;for(let i=0;i<o.length;i+=1)if(t[r].includes(o[i])){s[r]=i,l=!0;break}if(!l)break}l?this.setCSVFormat(s):(this.valid=!1,c("CSV fields missing","CSV file does not include all the required header fields."))}getPosition(e){let t=parseInt(e[this.CSVFormat.POSITION_IDX],10);return isNaN(t)&&(t=""),t}getSICSVStatus(e,t){return e==="0"||e===""||e==="N"||e==="n"?t===""||t==="0"?"ok":"nok":"nc"}processCSVResults(e){for(let t=1;t<e.length;t+=1){const s=e[t].split(this.separator);if(s.length>=this.CSVFormat.FIRST_SPLIT_IDX){let o=this.extractSingleCSVResult(s);o.valid&&(delete o.valid,this.results.push(o))}}}processResultsCSV(e){const t=e.split(/[\r\n|\n]+/),s=t[0].split(",").length-1,o=t[0].split(";").length-1;s>o?this.separator=",":this.separator=";",t[0].split(this.separator).length===2?this.processSpklasseCSVResults(t):(this.getCSVFormat(t[0]),this.valid&&this.processCSVResults(t))}processSpklasseCSVResults(e){let o=[],l="",r=0;for(let i=0;i<e.length;i+=1)o=e[i].split(this.separator),o.length===2?(l=o[0],r=parseInt(o[1],10)):this.extractResult(o,l,r)}setCSVFormat(e){this.CSVFormat.CHIP_IDX=e[0],this.CSVFormat.DB_IDX=e[1],this.CSVFormat.SURNAME_IDX=e[2],this.CSVFormat.FIRST_NAME_IDX=e[3],this.CSVFormat.NC_IDX=e[4],this.CSVFormat.START_TIME_IDX=e[5],this.CSVFormat.TOTAL_TIME_IDX=e[6],this.CSVFormat.CLASSIFIER_IDX=e[7],this.CSVFormat.CLUB_IDX=e[8],this.CSVFormat.CLASS_IDX=e[9],this.CSVFormat.COURSE_IDX=e[10],this.CSVFormat.NUM_CONTROLS_IDX=e[11],this.CSVFormat.POSITION_IDX=e[12],this.CSVFormat.START_PUNCH_IDX=e[13],this.CSVFormat.FIRST_CODE_IDX=e[14],this.CSVFormat.FIRST_SPLIT_IDX=e[15],this.CSVFormat.STEP=e[16]-e[14]}}class lt{constructor(e){return this.results=[],this.valid=!0,this.processIOFV2Results(e),{results:this.results,valid:this.valid}}extractIOFV2Results(e,t){for(let s=0;s<e.length;s+=1){t.status=le(e[s].getElementsByTagName("CompetitorStatus"),"value",""),t.position=this.getPosition(e[s].getElementsByTagName("ResultPosition")),t.chipid=S(e[s].getElementsByTagName("CCardId"),0),t.time=this.getTime(e[s].getElementsByTagName("Time")),t.starttime=this.getStartFinishTimeAsSecs(e[s].getElementsByTagName("StartTime")),t.splits="",t.codes=[];const o=e[s].getElementsByTagName("SplitTime");t.controls=o.length,this.extractIOFV2Splits(o,t);const l=this.getStartFinishTimeAsSecs(e[s].getElementsByTagName("FinishTime"));t.splits+=Math.max(l-t.starttime,0)}}extractIOFV2Splits(e,t){for(let s=0;s<e.length;s+=1){s>0&&(t.splits+=";");const o=e[s].getElementsByTagName("Time");o.length>0?(t.splits+=M(o[0].textContent),t.codes[s]=S(e[s].getElementsByTagName("ControlCode"),"")):(t.splits+=0,t.codes[s]="")}t.splits+=";"}getDBID(e,t){return e.length===0?t:(e=e[0].textContent.replace(/[\n\r]/g,"").trim(),e||t)}getName(e){return(e.getElementsByTagName("Given")[0].textContent+" "+e.getElementsByTagName("Family")[0].textContent).replace(/[\n\r]/g,"").trim()}getPosition(e){return e.length>0?parseInt(e[0].textContent,10):""}getStartFinishTimeAsSecs(e){if(e.length>0){const t=e[0].getElementsByTagName("Clock")[0].textContent;return M(t)}return 0}getTime(e){return e.length>0?e[0].textContent.replace(/[\n\r]/g,""):""}processIOFV2Results(e){try{const t=e.getElementsByTagName("ClassResult");for(let s=0;s<t.length;s+=1){const o=t[s].getElementsByTagName("ClassShortName")[0].textContent,l=t[s].getElementsByTagName("PersonResult");for(let r=0;r<l.length;r+=1){let i={};i.course=o,i.name=this.getName(l[r]),i.dbid=this.getDBID(l[r].getElementsByTagName("PersonId"),r),i.club=S(l[r].getElementsByTagName("ShortName"),"");const u=l[r].getElementsByTagName("Result");this.extractIOFV2Results(u,i),i.status!=="DidNotStart"&&this.results.push(i)}}}catch(t){this.valid=!1,c("XML parse error","Error processing XML file. Error is : "+t.message);return}}}class rt{constructor(e){return this.results=[],this.valid=!0,this.processIOFV3Results(e),{results:this.results,valid:this.valid}}extractIOFV3Results(e,t){for(let s=0;s<e.length;s+=1){t.chipid=S(e[s].getElementsByTagName("ControlCard"),0),t.position=S(e[s].getElementsByTagName("Position"),""),t.position==="0"&&(t.position=""),t.status=S(e[s].getElementsByTagName("Status"),""),t.time=this.getTotalTimeAsMMSS(e[s].getElementsByTagName("Time")),t.starttime=this.getStartFinishTimeAsSeconds(S(e[s].getElementsByTagName("StartTime"),0)),t.splits="",t.codes=[];const o=e[s].getElementsByTagName("SplitTime");this.extractIOFV3Splits(o,t);const l=this.getStartFinishTimeAsSeconds(S(e[s].getElementsByTagName("FinishTime"),0));l>0?t.splits+=l-t.starttime:t.splits+=0}}extractIOFV3Splits(e,t){let s=[];for(let o=0;o<e.length;o+=1)e[o].attributes.length===0?(t.splits+=S(e[o].getElementsByTagName("Time"),0),s.push(S(e[o].getElementsByTagName("ControlCode"),"X"+o)),t.splits+=";"):e[o].getAttribute("status")==="Missing"&&(t.splits+="0",s.push(S(e[o].getElementsByTagName("ControlCode"),"X"+o)),t.splits+=";");t.codes=s,t.controls=t.codes.length}getClub(e){return e.length>0&&e[0].getElementsByTagName("Name")[0]?e[0].getElementsByTagName("Name")[0].textContent:""}getID(e,t){if(e.length>0){let s=e[0].textContent;return s.replace(/[\n\r]/g,""),s.trim()}return t}getStartFinishTimeAsSeconds(e){return e.length>=19?M(e.substr(11,8)):0}getTotalTimeAsMMSS(e){if(e.length>0&&e[0].textContent){const t=parseInt(e[0].textContent,10);return Be(t)}return"00:00"}processIOFV3Results(e){try{const t=e.getElementsByTagName("ClassResult");for(let s=0;s<t.length;s+=1){const l=t[s].getElementsByTagName("Class")[0].getElementsByTagName("Name")[0].textContent,r=t[s].getElementsByTagName("PersonResult");for(let i=0;i<r.length;i+=1){let u={};u.course=l;const p=r[i].getElementsByTagName("Given")[0].textContent+" "+r[i].getElementsByTagName("Family")[0].textContent;u.name=p.replace(/[\n\r]/g,"").trim(),u.dbid=this.getID(r[i].getElementsByTagName("Id"),i),u.club=this.getClub(r[i].getElementsByTagName("Organisation"));const f=r[i].getElementsByTagName("Result");this.extractIOFV3Results(f,u),u.status!=="DidNotStart"&&this.results.push(u)}}}catch(t){this.valid=!1,c("XML parse error","Error processing XML file. Error is : "+t.message);return}}}class it{constructor(e,t){this.results=[],this.resultCourses=[],this.valid=!0;const s=this.processResults(e,t);return this.results=s.results,this.valid=s.valid,this.getCoursesFromResults(),{results:this.results,resultCourses:this.resultCourses,valid:this.valid}}getCoursesFromResults(){for(let e=0;e<this.results.length;e+=1){let t=!1;for(let s=0;s<this.resultCourses.length;s+=1)if(this.resultCourses[s].course===this.results[e].course){t=!0;break}t||this.resultCourses.push({course:this.results[e].course,courseid:g.DO_NOT_SAVE_COURSE})}}processResults(e,t){switch(t){case"CSV":return new ot(e.target.result);case"XML":return this.processResultsXML(e.target.result);default:return c("File type error","Results file type is not recognised. Please select a valid file."),{results:[],valid:!1}}}processResultsXML(e){let t="",s;try{if(s=new DOMParser().parseFromString(e,"text/xml"),s.getElementsByTagName("ResultList").length===0)return c("XML file error","File is not a valid XML results file. ResultList element missing."),{results:[],valid:!1};t=le(s.getElementsByTagName("IOFVersion"),"version",""),t===""&&(t=le(s.getElementsByTagName("ResultList"),"iofVersion",""))}catch{return c("XML file error","File is not a valid XML results file."),{results:[],valid:!1}}switch(t){case"2.0.3":return new lt(s);case"3.0":return new rt(s);default:return c("XML file error","Invalid IOF file format. Version "+t+" not supported."),{results:[],valid:!1}}}}let B=null,E=new Ne,ue=new Ge,D=null,O=null,G=!1,W=!0,a=null,d=[],I=[],te=!1,x=!1,q=!1,$=!1,P=!1,T={},m=[],L=[],v=[],z,Q,me="";const re=["UTF-8","ISO-8859-1","windows-1251"];let J=[],k=0,ie=!1,j=!1,ge=!1,h={x:null,y:null},N=[],y={height:0,width:0},w=new H(0),Re=new H(0),Y=null,A=[],fe=null,ne=null,he=null;const Me="e.g. 1|1|6,60|15,60";function at(n,e){let t;a.controls.length===0?t="S"+(a.controls.length+1):t="X"+(a.controls.length+1),a.addControl(t,n,e),a.displayAllControls(),T.codes.push(t),T.x.push(n),T.y.push(e)}function En(n,e,t){if(j||t===g.RIGHT_CLICK)C.translate(e.x-n.x,e.y-n.y);else if($=!0,h.x!==null){const s=(e.x-h.x)/(n.x-h.x),o=(e.y-h.y)/(n.y-h.y);if(isFinite(s)&&isFinite(o))for(let l=0;l<a.controls.length;l+=1){const r=a.controls[l].oldX-h.x,i=a.controls[l].oldY-h.y;a.controls[l].x=r*s+h.x,a.controls[l].y=i*o+h.y}}else{const s=e.x-n.x,o=e.y-n.y;for(let l=0;l<a.controls.length;l+=1)a.controls[l].x=a.controls[l].oldX+s,a.controls[l].y=a.controls[l].oldY+o}}function dt(n){const e=st(n.target.result);if(e===0||ie){Zt(n);return}if(J[k]=e,k+=1,k===re.length){let t=99999;for(let s=0;s<re.length;s+=1)t>J[s]&&(k=s,t=J[s]);ie=!0}ke()}function ct(){let n={};n.body="Are you sure you want to add this map?",n.title="Confirm new map",n.classes="rg2-confirm-add-map-dialog",n.doText="Add map",n.onDo=Ct,V(n)}function ut(n){n.preventDefault();const e=gn();if(e!=="OK"){c("Event set-up incomplete",e+" Please enter all necessary information and make sure controls are aligned before creating the event.");return}let t={};t.body="Are you sure you want to create this event?",t.title="Confirm event creation",t.classes="rg2-confirm-create-event-dialog",t.doText="Create event",t.onDo=ht,V(t)}function mt(){let n={};n.body=`Are you sure you want to update ${document.getElementById("rg2-edit-event-name").value}?`,n.title="Confirm event update",n.doText="Update event",n.onDo=It,V(n)}function _e(n){try{const e=ue.getGeorefSystem(n);if(y=ae(),!w.valid||y.width===0||e.name==="none")throw"Do not georeference";Z.defs(e.name,e.params);const t=new Z.Proj(e.name),s=new Z.Proj("EPSG:4326"),o=[0,y.width,y.width,0],l=[0,y.height,0,y.height];let r=[],i=[];for(let f=0;f<4;f+=1)r[f]=w.getLon(o[f],l[f]),i[f]=w.getLat(o[f],l[f]);E.xpx.length=0,E.ypx.length=0,E.lat.length=0,E.lon.length=0;let u=[];for(let f=0;f<4;f+=1){let R={};R.x=r[f],R.y=i[f],u.push(R);const X=Z(t,s,u[f]);E.xpx.push(o[f]),E.ypx.push(l[f]),E.lat.push(X.y),E.lon.push(X.x)}let p={};p.C=u[0].x,p.F=u[0].y,p.A=(u[2].x-p.C)/o[2],p.B=(u[3].x-p.C)/l[3],p.D=(u[2].y-p.F)/o[2],p.E=(u[3].y-p.F)/l[3],E.worldfile=new H(p),Se()}catch{E.worldfile=new H(0),Se();return}}function we(){for(let n=0;n<a.controls.length;n+=1)a.controls[n].oldX=a.controls[n].x,a.controls[n].oldY=a.controls[n].y}function gt(n,e){let t=-1;for(let o=0;o<d.length;o+=1)if(d[o].name===n){t=o;break}if(t===-1&&I.length>0){for(let o=0;o<I.length;o+=1)if(I[o].className===n){for(let l=0;l<d.length;l+=1)if(d[l].name===I[o].course){t=l;break}break}}let s=`<select id='rg2-alloc-${e}' class="form-control form-control-sm">`;s+=`<option value="${g.DO_NOT_SAVE_COURSE}"${t===-1?" selected":""}>Do not save</option>`;for(let o=0;o<d.length;o+=1)s+=`<option value="${o}"${t===o?" selected":""}>${Ae(d[o].name)}</option>`;return s+="</select >",s}function pe(){if(!W){v.length=0;for(let n=0;n<d.length;n+=1)v.push({courseid:d[n].courseid,course:d[n].name})}}function se(){let n="";if(d.length&&v.length){n='<div class="fw-bold">Results</div><div class="fw-bold">Course</div>';for(let e=0;e<v.length;e+=1)n+=`<div>${v[e].course}</div>`,n+=`<div>${gt(v[e].course,e)}</div>`;document.getElementById("rg2-course-allocations").innerHTML=n}}function be(n,e){let t={};t.body=e,t.title=n,t.doText="Ok",t.onDo=()=>{},V(t,!1)}function ft(){const n={type:"addmap"};E.localworldfile=w;const e={...E,...B.encodeUser()};F(JSON.stringify(e),n,kt,"Map save failed")}function ht(){const n={...xt(),...B.encodeUser()},e={type:"createevent"};F(JSON.stringify(n),e,At,"Event creation failed")}function pt(){const n=document.getElementById("rg2-edit-event-selected").value,e={type:"deleteevent",id:n};F(JSON.stringify(B.encodeUser()),e,Vt(n),"Event deletion failed")}function yt(){const n=document.getElementById("rg2-edit-event-selected").value,e=document.getElementById("rg2-route-selected").value,t={type:"deleteroute",id:n,routeid:e};F(JSON.stringify(B.encodeUser()),t,Gt(n,e),"Route delete failed")}function Et(){let n=B.encodeUser();n.maps=A.filter(t=>t.delete===!0).map(t=>t.mapid);const e={type:"deleteunusedmaps"};F(JSON.stringify(n),e,Yt,"Map deletion failed")}function ye(){Ue({type:"maps"},Ut,"Events request failed")}function vt(){const n={type:"login"};F(JSON.stringify(B.encodeUser()),n,Ot,"Login failed")}function It(){const n=document.getElementById("rg2-edit-event-selected").value;let e=B.encodeUser();e.comments=document.getElementById("rg2-edit-event-comments").value,e.locked=document.getElementById("chk-edit-read-only").checked,e.name=document.getElementById("rg2-edit-event-name").value,e.type=document.getElementById("rg2-edit-event-level").value,e.eventdate=ne.getDate("yyyy-mm-dd"),e.club=document.getElementById("rg2-edit-club-name").value;let t=document.getElementById("rg2-edit-exclude").value.trim();t===Me&&(t=""),e.exclude=t;const s={type:"editevent",id:n};F(JSON.stringify(e),s,Xt(n),"Event update failed")}function Ct(){const n=B.encodeUser();let e=new FormData;e.append(z.name,z),e.append("name",z.name),e.append("x",n.x),e.append("user",n.user),F(e,{type:"uploadmapfile",headers:{"Content-Type":"multipart/form-data"}},Pt,"Map upload failed")}function vn(){if(x&&a.controls.length>0){a.drawControls(!0);const n=Ze();h.x!==null&&(C.lineWidth=n.overprintWidth,C.strokeStyle=g.HANDLE_COLOUR,C.fillStyle=g.HANDLE_COLOUR,C.globalAlpha=1,C.beginPath(),C.arc(h.x,h.y,g.HANDLE_DOT_RADIUS,0,2*Math.PI,!1),C.fill(),C.beginPath(),C.arc(h.x,h.y,2*g.HANDLE_DOT_RADIUS,0,2*Math.PI,!1),C.stroke())}}function St(){document.querySelector("#rg2-info-panel-tab-headers li").remove(),document.querySelector("#rg2-manage-login-tab-body").remove(),document.getElementById(g.TAB_CREATE).classList.remove("d-none"),document.getElementById(g.TAB_CREATE).click(),document.getElementById(g.TAB_EDIT).classList.remove("d-none"),document.getElementById(g.TAB_MAP).classList.remove("d-none"),document.getElementById(g.TAB_DELETE_MAP).classList.remove("d-none"),ye(),tn(),document.getElementById("rg2-select-event-level").innerHTML=Ie(),document.getElementById("rg2-edit-event-level").innerHTML=Ie(),document.getElementById("rg2-georef-type").innerHTML=ue.getGeorefDropdown(),document.getElementById("rg2-select-map").addEventListener("change",n=>{D=parseInt(n.target.value,10),D!==g.INVALID_MAP_ID?xe(rg2Config.maps_url+"/"+N[D].mapfilename):(x=!1,y.width=0,y.height=0)}),fe=new ve(document.getElementById("rg2-select-event-date"),{buttonClass:"btn",autohide:!0,format:"yyyy-mm-dd"}),ne=new ve(document.getElementById("rg2-edit-event-date"),{buttonClass:"btn",autohide:!0,format:"yyyy-mm-dd"}),document.getElementById("rg2-map-name").addEventListener("change",function(){ln()}),document.getElementById("rg2-new-course-name").addEventListener("change",function(){sn()}),document.getElementById("rg2-edit-event-selected").addEventListener("change",n=>{const e=parseInt(n.target.value,10);K(e),he=e}),document.getElementById("rg2-georef-type").addEventListener("change",n=>{on(parseInt(n.target.value,10))})}function Ae(n){let e="";if(I&&I.length>0&&te)for(let t=0;t<I.length;t+=1){const s=I[t].course;let o="";s===n&&(e!==""&&(e+=", "),o=I[t].className,o=o.replace(/ /g,""),o=o.replace(/-/g,""),e+=o)}return e!==""?n+": "+e:n}function Tt(){if(te)for(let n=0;n<d.length;n+=1)d[n].name=Ae(d[n].name)}function In(n){const e=Ye(n);document.getElementById("rg2-edit-event-name").value=_(e.name),document.getElementById("rg2-edit-club-name").value=_(e.club),ne.setDate(e.date),document.getElementById("rg2-edit-event-level").value=e.rawtype,document.getElementById("rg2-edit-event-comments").value=_(e.comment),He()?document.getElementById("rg2-exclude-info").classList.add("d-none"):(document.getElementById("rg2-edit-exclude").value=e.exclude,document.getElementById("rg2-exclude-info").classList.remove("d-none")),document.getElementById("chk-edit-read-only").checked=e.locked,document.getElementById("btn-delete-event").removeAttribute("disabled"),document.getElementById("btn-delete-route").removeAttribute("disabled"),document.getElementById("btn-update-event").removeAttribute("disabled"),document.getElementById("rg2-route-selected").innerHTML=wt(e.id)}function Cn(n){document.getElementById("rg2-edit-event-selected").innerHTML=tt(n,he),N.length>0&&(Ve(N),Fe(A))}function Bt(){L.length=0;let n;for(let e=0;e<m.length;e+=1){let t=m[e].codes;for(let s=0;s<d.length;s+=1)if(d[s].courseid===m[e].courseid){n=d[s];break}t.unshift(n.codes[0]),t.push(n.codes[n.codes.length-1]),m[e].variantid=bt(m[e].codes,m[e].courseid)}}function Ve(n){A.length=0;for(let e=0;e<n.length;e+=1)if(!Ke(n[e].mapid)){const t={};t.mapid=n[e].mapid,t.name=n[e].name,t.name===""&&(t.name="(None)"),t.delete=!1,A.push(t)}}function Ee(){let n=!1;if(x&&a.controls.length>0){const e=Nt();if(q&&(e.maxX<0||e.minX>y.width||e.minY>y.height||e.maxY<0?c("Course file problem","Your course file does not match the map co-ordinates. Please check you have selected the correct file."):n=!0),n)j=!0,$=!0,document.getElementById("chk-move-map-and-controls").checked=!0;else{let t=.8;for(let s=0;s<a.controls.length;s+=1)a.controls[s].x=(a.controls[s].x-e.minX)*(y.width/e.xRange)*t+y.width*(1-t)*.5,a.controls[s].y=y.height-(a.controls[s].y-e.minY)*(y.height/e.yRange)*t-y.height*(1-t)*.5}we(),a.displayAllControls()}}function xt(){let n=B.encodeUser();if(n.name=document.getElementById("rg2-event-name").value,n.mapid=N[D].mapid,n.eventdate=fe.getDate("yyyy-mm-dd"),n.comments=document.getElementById("rg2-enter-event-comments").value,n.locked=document.getElementById("chk-read-only").checked,n.club=document.getElementById("rg2-select-club-name").value,W?G?n.format=g.FORMAT_SCORE_EVENT:n.format=g.FORMAT_NORMAL:G?n.format=g.FORMAT_SCORE_EVENT_NO_RESULTS:n.format=g.FORMAT_NORMAL_NO_RESULTS,n.level=document.getElementById("rg2-select-event-level").value,P&&(d.push(T),pe()),nn(),$t(),Tt(),Qt(n.format),en(),G&&(Bt(),n.variants=L.slice(0)),n.courses=d.slice(0),ge?n.results=m.slice(0).sort(nt):n.results=m.slice(0),n.format===g.FORMAT_NORMAL)for(let e=0;e<n.results.length;e+=1)(n.results[e].splits.match(/;/g)||[]).length===Dt(n.courses,n.results[e].courseid)+1&&(n.results[e].splits=n.results[e].splits.substring(0,n.results[e].splits.lastIndexOf(";")));for(let e=0;e<n.results.length;e+=1)delete n.results[e].codes,delete n.results[e].chipid,delete n.results[e].club;return n}function Nt(){let n={};n.minX=a.controls[0].x,n.maxX=a.controls[0].x,n.minY=a.controls[0].y,n.maxY=a.controls[0].y;for(let e=1;e<a.controls.length;e+=1)n.maxX=Math.max(n.maxX,a.controls[e].x),n.maxY=Math.max(n.maxY,a.controls[e].y),n.minX=Math.min(n.minX,a.controls[e].x),n.minY=Math.min(n.minY,a.controls[e].y);return n.xRange=n.maxX-n.minX,n.yRange=n.maxY-n.minY,n}function Dt(n,e){for(let t=0;t<n.length;t+=1)if(n[t].courseid===e)return n[t].controlcount;return 0}function Xe(n){let e={x:0,y:0};for(let t=0;t<a.controls.length;t+=1)if(a.controls[t].code===n)return e.x=Math.round(a.controls[t].x),e.y=Math.round(a.controls[t].y),e;return e}function Lt(n){for(let e=0;e<v.length;e+=1)if(v[e].course===n)return v[e].courseid;return 0}function Ft(){let n='<div class="new-courses-table">';if(d.length){n+=`<div>${oe("Course")}</div><div>${oe("Name")}</div><div>${oe("Controls")}</div>`;for(let e=0;e<d.length;e+=1)n+=`<div>${e+1}</div><div>${d[e].name}</div><div>${d[e].codes.length-2}</div>`}return n+="</div>",n}function Rt(n){for(let e=0;e<d.length;e+=1)if(d[e].courseid===n)return d[e].name;return 0}function Mt(n){let e=b(g.INVALID_MAP_ID,"Select map",!0);for(let t=n.length-1;t>-1;t-=1)e+=b(t,n[t].mapid+": "+_(n[t].name));return e}function _t(){let n="";if(m.length){n='<div class="new-results-table">';let e=0,t=null;for(let s=0;s<m.length;s+=1)m[s].course!==t&&(t!==null&&(n+=`<div>${e}</div>`,e=0),n+=`<div>${m[s].course}</div><div>${m[s].name}</div><div>${m[s].time}</div>`,t=m[s].course),e+=1;n+=`<div>${e}</div></div>`}else n="No valid results found.";return n}function wt(n){const e=je();let t=b("undefined","Select route");for(let s=0;s<e.length;s+=1)t+=b(e[s].resultid,e[s].resultid+": "+_(e[s].name)+" on "+_(e[s].coursename));return t}function bt(n,e){let t=[],s=[],o=0;for(let l=0;l<L.length;l+=1)if(L[l].codes.length===n.length){let r=!0;for(let i=0;i<n.length;i+=1)if(L[l].codes[i]!==n[i]){r=!1;break}if(r){o=l+1;break}}if(o===0){o=L.length+1;for(let l=0;l<n.length;l+=1){const r=Xe(n[l]);t.push(r.x),s.push(r.y)}L.push({x:t,y:s,id:o,courseid:e,name:"Variant "+o,codes:n})}return o}function At(n){n.ok?(c("Event created",document.getElementById("rg2-event-name").value+" has been added with id "+n.newid+"."),window.open(rg2Config.api_url.replace("rg2api.php","")+"#"+n.newid),ee(),K()):c("Save failed",n.status_msg+" Failed to create event. Please try again.")}const Vt=n=>e=>{e.ok?(c("Event deleted","Event "+n+" has been deleted."),he=null,document.getElementById("btn-delete-event").setAttribute("disabled",!0),document.getElementById("btn-delete-route").setAttribute("disabled",!0),document.getElementById("btn-update-event").setAttribute("disabled",!0),ee(),K(),document.getElementById("rg2-edit-event-selected").replaceChildren()):c("Delete failed",e.status_msg+". Event "+n+" delete failed. Please try again.")},Xt=n=>e=>{e.ok?(c("Event updated","Event "+n+" has been updated."),De(n),Le(),ee(),K(n)):c("Update failed",e.status_msg+". Event update failed. Please try again.")};function Ot(n){n.ok?St():c("Login failed","User name or password incorrect. Please try again.")}function kt(n){n.ok?(c("Map added",n.name+" has been added with id "+n.newid+"."),ye()):c("Save failed",n.status_msg+". Failed to save map. Please try again.")}function Pt(n){n.ok?ft():c("Upload failed",n.status_msg+". Failed to upload map. Please try again.")}function Ut(n){N.length=0;for(let e=0;e<n.maps.length;e+=1)N.push(new Ne(n.maps[e]));document.getElementById("rg2-select-map").innerHTML=Mt(N),Ve(N),Fe(A)}const Gt=(n,e)=>t=>{t.ok?(c("Route deleted","Route "+e+" has been deleted."),De(n),Le(),ee(),K(n)):c("Delete failed",t.status_msg+". Delete failed for route "+e+". Please try again.")};function Yt(n){n.ok?c("Maps deleted","Selected maps have been deleted."):c("Delete failed",n.status_msg+". Delete failed. Please try again."),ye()}function Oe(){a=new Te,D=g.INVALID_MAP_ID,O=g.FORMAT_NORMAL,G=!1,W=!0,d=[],I=[],te=!1,x=!1,q=!1,$=!1,P=!1,T={},m=[],L=[],v=[],y={height:0,width:0},Q=void 0,me="",j=!1,ge=!1,h={x:null,y:null}}function Ht(){k=0,J=[],ie=!1}function Sn(){B=new ze,Y=ce.map("rg2-world-file-map"),Oe(),Wt(),document.getElementById("rg2-manager-login-form").addEventListener("submit",n=>{n.preventDefault(),B.setDetails("rg2-user-name","rg2-password")?vt():c("Login failed","Please enter user name and password of at least five characters")})}function Wt(){ce.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(Y),document.getElementById("rg2-world-file-map-container").classList.remove("d-none")}function Tn(){x&&a.controls.length>0&&we()}function Bn(){x=!0,D!==g.INVALID_MAP_ID&&(w=N[D].localworldfile,Re=N[D].worldfile),y=ae(),Ee(),de()}function xn(n,e){if(P){at(n,e),$=!0;return}x&&a.controls.length>0&&(h.x===null?h={x:n,y:e}:h={x:null,y:null})}function $t(){let n=[],e=1;for(let t=0;t<v.length;t+=1){let s;if(P)s=0;else{const o=document.getElementById("rg2-alloc-"+t);o&&(s=parseInt(o.value,10))}s!==void 0&&s!==g.DO_NOT_SAVE_COURSE&&(d[s].courseid===0?(d[s].courseid=e,n.push(d[s]),v[t].courseid=e,e+=1):v[t].courseid=d[s].courseid)}d=n}function jt(n){q=!1,j=!1,document.getElementById("chk-move-map-and-controls").checked=!1,h={x:null,y:null},a.deleteAllControls();const e=new Je(n,Re,w);d=e.courses,document.getElementById("rg2-manager-courses-count").innerHTML="Courses ("+d.length+")",d.length>0&&(a=e.newcontrols,I=e.mapping,I.length>0?document.getElementById("chk-enrich-course-names").classList.remove("d-none"):document.getElementById("chk-enrich-course-names").classList.add("d-none"),q=e.georeferenced,be("Course details",Ft()),pe(),se(),Ee()),de()}function Kt(n){xe(n.target.result,!0),document.getElementById("rg2-load-map-file").classList.add("is-valid"),x=!0,y=ae(),Ee(),de(),document.getElementById("btn-add-map").removeAttribute("disabled")}function Zt(n){const e=new it(n,me);m=e.results,document.getElementById("rg2-manager-results-count").innerHTML="Results ("+m.length+")",m.length>0&&(v=e.resultCourses,be("Result details",_t()),se())}function zt(n){let e=new FileReader;e.onerror=function(){c("Course file error","The selected course file could not be read.")},e.onload=function(t){jt(t)},e.readAsText(n.target.files[0])}function Jt(n){const e=new FileReader;try{e.readAsText(n.target.files[0])}catch{c("File read error","Failed to open selected world file.");return}e.onerror=function(){c("World file error","The selected world file could not be read.")},e.onload=function(t){const o=t.target.result.split(/[\r\n]+/g);w=new H({A:o[0],B:o[2],C:o[4],D:o[1],E:o[3],F:o[5]});const l=ue.getDefaultValue();document.getElementById("rg2-georef-type").value=l,_e(l)}}function qt(n){const e=new FileReader;e.onload=function(s){Kt(s)};const t=n.target.files[0].name.substr(-3,3).toUpperCase();t==="JPG"||t==="GIF"?(z=n.target.files[0],e.readAsDataURL(n.target.files[0])):c("File type error",n.target.files[0].name+" is not recognised. Only .jpg and .gif files are supported at present.")}function ke(){let n=new FileReader;n.onerror=function(){c("Results file error","The selected results file could not be read.")},n.onload=function(e){dt(e)},O=Q.name.substr(-3,3).toUpperCase(),O==="XML"||O==="CSV"?(me=O,n.readAsText(Q,re[k])):c("File type error","Results file type is not recognised. Please select a valid file.")}function Qt(n){if(n===g.FORMAT_NORMAL)for(let e=0;e<m.length;e+=1){const t=m[e].splits.split(";");t.length===2&&(m[e].splits=t[1],m.codes=[])}}function en(){let n=[];for(let e=0;e<m.length;e+=1){const t=Lt(m[e].course);t!==g.DO_NOT_SAVE_COURSE&&(m[e].courseid=t,m[e].course=Rt(t),m[e].variantid="",n.push(m[e]))}m=n}function tn(){document.getElementById("btn-create-event").addEventListener("click",t=>{ut(t)}),document.getElementById("btn-update-event").addEventListener("click",t=>{mt()}),document.getElementById("btn-delete-route").addEventListener("click",t=>{Qe(yt)}),document.getElementById("btn-delete-event").addEventListener("click",t=>{qe(pt)}),document.getElementById("btn-add-map").addEventListener("click",t=>{ct()}),document.getElementById("btn-delete-unused-maps").addEventListener("click",t=>{A=et(A.slice(0),Et)}),document.getElementById("btn-draw-courses").addEventListener("click",t=>{rn()}),document.getElementById("rg2-load-georef-file").addEventListener("input",t=>{Jt(t)}),document.getElementById("rg2-load-map-file").addEventListener("input",t=>{fn(t.target.files[0]),qt(t)});const n=document.getElementById("rg2-load-results-file");n.addEventListener("click",t=>{x||(c("No map loaded","Please load a map file before adding results."),t.preventDefault())}),n.addEventListener("change",t=>{Q=t.target.files[0],Ht(),ke()}),document.getElementById("chk-move-map-and-controls").addEventListener("click",t=>{dn(t.target.checked)}),document.getElementById("chk-no-results").addEventListener("click",t=>{cn(t.target.checked)}),document.getElementById("chk-score-event").addEventListener("click",t=>{un(t.target.checked)}),document.getElementById("chk-enrich-course-names").addEventListener("click",t=>{an(t.target.checked)}),document.getElementById("chk-sort-results").addEventListener("click",t=>{mn(t.target.checked)});const e=document.getElementById("rg2-load-course-file");e.addEventListener("click",t=>{x||(c("No map loaded","Please load a map file before adding courses."),t.preventDefault())}),e.addEventListener("change",t=>{zt(t)})}function nn(){for(let n=0;n<d.length;n+=1)for(let e=0;e<d[n].codes.length;e+=1){const t=Xe(d[n].codes[e]);d[n].x[e]=t.x,d[n].y[e]=t.y}}function sn(){const n=document.getElementById("rg2-new-course-name").value;n&&(T.name=n)}function K(n){n?$e(n):(Oe(),document.getElementById("rg2-edit-event-name").value="",document.getElementById("rg2-edit-club-name").value="",ne.setDate(""),document.getElementById("rg2-edit-event-level").value="",document.getElementById("rg2-edit-event-comments").value="",document.getElementById("rg2-edit-exclude").value=Me,document.getElementById("rg2-route-selected").replaceChildren(),document.getElementById("chk-edit-read-only").checked=!1,document.getElementById("rg2-course-allocations").innerHTML="")}function on(n){n!==0&&_e(n)}function ln(){E.name=document.getElementById("rg2-map-name").value,We("rg2-map-name",n=>/./.test(n))}function rn(){x?(P=!0,d.length=0,a.deleteAllControls(),T.name="Course",T.x=[],T.y=[],T.codes=[],T.courseid=0,document.getElementById("rg2-new-course-name").value,document.getElementById("rg2-draw-courses").classList.remove("d-none")):c("No map selected","Please load a map before drawing courses")}function an(n){te=n,se()}function dn(n){j=n}function cn(n){W=!n,pe(),se()}function un(n){G=n}function mn(n){ge=n}function Se(){const n=E.lon,e=E.lat;let t=[];[3,1,2,0].forEach(function(l){t.push([e[l],n[l]])});const o=ce.polygon(t,{color:"red"});o.addTo(Y),document.getElementById("rg2-world-file-map-container").classList.remove("d-none"),Y.invalidateSize(),Y.fitBounds(o.getBounds())}function gn(){return document.getElementById("rg2-event-name").value===""?"Event name is not valid.":D===g.INVALID_MAP_ID?"No map selected.":document.getElementById("rg2-select-club-name").value===""?"Club name is not valid.":fe.getDate("yyyy-mm-dd")===void 0?"Date is not valid.":document.getElementById("rg2-select-event-level").value==="X"?"Event level is not valid.":O?d.length===0&&!P?"No course information. Check your course XML file.":m.length===0&&W?"No results information. Check your results file.":$?"OK":"Controls have not been adjusted on the map.":"Event format is not valid."}function fn(n){let e=new FileReader;e.onload=function(t){let s=new Image;s.src=t.target.result,s.onload=function(){const o=Math.round(n.size/1024/1024);if(o>g.FILE_SIZE_WARNING||s.height>g.PIXEL_SIZE_WARNING||s.width>g.PIXEL_SIZE_WARNING){let l="The uploaded map file is "+o+"MB ("+s.width;l+=" x "+s.height+"px). It is recommended that you use maps under "+g.FILE_SIZE_WARNING,l+="MB with a maximum dimension of "+g.PIXEL_SIZE_WARNING+"px. Please see the ",l+="<a href='https://www.routegadget.co.uk/docs/2.x/manager-guide/maps#map-file-guidance' target='_blank' rel='noopener'>RG2 manager guide</a> for ",l+="guidance on how to create map files.",c("Oversized map upload",l)}}},e.readAsDataURL(n)}export{En as adjustManagerControls,ye as doGetMaps,vn as drawManagerControls,St as enableManager,In as eventFinishedLoading,Cn as eventListLoaded,Sn as initialiseManager,Tn as managerDragEnded,Bn as managerMapLoadCallback,xn as managerMouseUp};
//# sourceMappingURL=manager-BMrk1T3L.js.map
