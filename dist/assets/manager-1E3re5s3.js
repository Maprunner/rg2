import{d as A}from"./node-modules-CPWXqQ3f.js";import{C as Te,s as c,g as Pe,f as xe,a as w,e as re,b as T,c as m,G as Ue,d as S,h as Ge,l as Be,i as Ye,j as He,m as We,k as X,n as $e,o as de,r as ce,p as je,v as Ke,M as Ne,q as V,W,t as M,u as Ze,U as ze,w as te,x as De,y as Fe,z as le}from"./main-D9_pgpFN.js";import{D as ve,L as ue,p as z}from"./manager-utils-C8g2LUbf.js";class Je{constructor(e,t,s){return this.courses=[],this.courseClassMapping=[],this.newcontrols=new Te,this.courses.length=0,this.courseClassMapping.length=0,this.fromOldCondes=!1,this.coursesGeoreferenced=!1,this.newcontrols.deleteAllControls(),this.localWorldfile=s,this.worldfile=t,this.processCoursesXML(e.target.result),this.addControlCount(),{courses:this.courses,newcontrols:this.newcontrols,mapping:this.courseClassMapping,georeferenced:this.coursesGeoreferenced}}processCoursesXML(e){let t=null;try{t=new DOMParser().parseFromString(e,"text/xml")}catch{c("XML file error","File is not a valid XML course file.");return}if(t.getElementsByTagName("CourseData").length===0){t.documentElement.nodeName==="kml"?this.processKMLCourses(t):c("XML file error","File is not a valid XML course file. CourseData element missing.");return}const o=this.getVersion(t);switch(o){case"2.0.3":this.processIOFV2XMLCourses(t);break;case"3.0":this.processIOFV3XMLCourses(t);break;default:c("XML file error","Invalid IOF file format. Version "+o+" not supported.")}}getVersion(e){let t="",s=e.getElementsByTagName("IOFVersion");return s.length>0&&(t=s[0].getAttribute("version")),t===""&&(s=e.getElementsByTagName("CourseData"),s.length>0&&(t=s[0].getAttribute("iofVersion").trim(),this.setCreator(s[0].getAttribute("creator").trim()))),t}setCreator(e){e.indexOf("Condes")>-1&&e.length>15&&parseFloat(e.substring(15))<10.1&&(this.fromOldCondes=!0)}processIOFV3XMLCourses(e){let t=e.getElementsByTagName("Control"),s={x:0,y:0};for(let o=0;o<t.length;o+=1)if(t[o].parentNode.nodeName==="RaceCourseData"){const l=t[o].getElementsByTagName("Id")[0].textContent,r=t[o].getElementsByTagName("Position");this.localWorldfile.valid&&r.length>0?(s=this.getXYFromLatLng(r),this.coursesGeoreferenced=!0):s=this.getXYFromMapPosition(t[o].getElementsByTagName("MapPosition"));let i={};t[o].getAttribute("type")!=="CrossingPoint"&&(this.newcontrols.addControl(l.trim(),s.x,s.y),i.id=o,r.length>0?(i.lat=parseFloat(r[0].getAttribute("lat")),i.lng=parseFloat(r[0].getAttribute("lng"))):(i.lat=0,i.lng=0),i.x=s.x,i.y=s.y)}t=e.getElementsByTagName("Course"),this.extractV3Courses(t),t=e.getElementsByTagName("ClassCourseAssignment"),this.extractV3CourseClassMapping(t)}processKMLCourses(e){this.coursesGeoreferenced=!0;const t=e.getElementsByTagName("Placemark");for(let r=0;r<t.length;r=r+1){let i={};const u=t[r].getElementsByTagName("name")[0].childNodes[0].nodeValue.trim(),f=t[r].getElementsByTagName("Point")[0].getElementsByTagName("coordinates")[0].childNodes[0].nodeValue.trim().split(","),_=+f[1],O=+f[0];i.x=this.worldfile.getX(O,_),i.y=this.worldfile.getY(O,_),this.newcontrols.addControl(u.trim(),i.x,i.y);let G={};G.id=r+1,G.lat=_,G.lng=O,G.x=i.x,G.y=i.y}let s=[];const o="Course 1",l="Course 1";s=this.newcontrols.controls.map(function(r){return r.code}),this.courses.push({courseid:0,x:[],y:[],codes:s,name:o}),this.courseClassMapping.push({course:o,className:l}),document.getElementById("rg2-select-course-file").classList.add("is-valid")}getXYFromLatLng(e){let t={x:0,y:0};const s=parseFloat(e[0].getAttribute("lat")),o=parseFloat(e[0].getAttribute("lng"));return this.fromOldCondes?(t.x=this.localWorldfile.getX(o,s),t.y=this.localWorldfile.getY(o,s)):(t.x=this.worldfile.getX(o,s),t.y=this.worldfile.getY(o,s)),t}processIOFV2XMLCourses(e){if(this.extractV2Controls(e.getElementsByTagName("StartPoint"),"StartPointCode"),this.extractV2Controls(e.getElementsByTagName("Control"),"ControlCode"),this.coursesGeoreferenced=this.extractV2Controls(e.getElementsByTagName("FinishPoint"),"FinishPointCode"),this.coursesGeoreferenced&&this.localWorldfile.valid)for(let t=0;t<this.newcontrols.controls.length;t+=1){const s=this.newcontrols.controls[t].x,o=this.newcontrols.controls[t].y;this.newcontrols.controls[t].x=this.localWorldfile.getX(s,o),this.newcontrols.controls[t].y=this.localWorldfile.getY(s,o)}this.extractV2Courses(e.getElementsByTagName("Course"))}extractV2Courses(e){for(let t=0;t<e.length;t+=1){let s=[],o=[],l=[];const r=e[t].getElementsByTagName("CourseName")[0].textContent.trim();s=this.extractCodesFromControlList(e[t],"ControlCode"),s.unshift(e[t].getElementsByTagName("StartPointCode")[0].textContent.trim()),s.push(e[t].getElementsByTagName("FinishPointCode")[0].textContent.trim()),this.courses.push({courseid:0,x:o,y:l,codes:s,name:r})}document.getElementById("rg2-select-course-file").classList.add("is-valid")}extractV3Courses(e){for(let t=0;t<e.length;t+=1){let s=[],o=[],l=[];const r=e[t].getElementsByTagName("Name")[0].textContent.trim();s=this.extractCodesFromControlList(e[t],"Control"),this.courses.push({courseid:0,x:o,y:l,codes:s,name:r})}document.getElementById("rg2-select-course-file").classList.add("is-valid")}extractV3CourseClassMapping(e){for(let t=0;t<e.length;t+=1){const s=e[t].getElementsByTagName("CourseName")[0].textContent.trim(),o=e[t].getElementsByTagName("ClassName")[0].textContent.trim();this.courseClassMapping.push({course:s,className:o})}document.getElementById("rg2-select-course-file").classList.add("is-valid")}extractCodesFromControlList(e,t){const s=e.getElementsByTagName("CourseControl");let o=[];for(let l=0;l<s.length;l+=1)if(l===0||s[l].getAttribute("type")!=="Start"){const r=s[l].getElementsByTagName(t)[0].textContent.trim();this.validControlCode(r)&&o.push(r)}return o}extractV2Controls(e,t){let s=!1,o={x:0,y:0};for(let l=0;l<e.length;l+=1){const r=e[l].getElementsByTagName(t)[0].textContent,i=e[l].getElementsByTagName("ControlPosition");i.length>0&&this.localWorldfile.valid?(o.x=parseFloat(i[0].getAttribute("x")),o.y=parseFloat(i[0].getAttribute("y")),s=!0):o=this.getXYFromMapPosition(e[l].getElementsByTagName("MapPosition")),this.newcontrols.addControl(r.trim(),o.x,o.y)}return s}getXYFromMapPosition(e){return{x:e[0].getAttribute("x").replace(",","."),y:e[0].getAttribute("y").replace(",",".")}}validControlCode(e){const t=this.newcontrols.controls;for(let s=0;s<t.length;s+=1)if(t[s].code===e)return!0;return!1}addControlCount(){for(let e=0;e<this.courses.length;e+=1)this.courses[e].controlcount=this.courses[e].codes.length-2}}class qe{constructor(e){return this.results=[],this.CSVFormat={},this.separator="",this.valid=!0,this.processResultsCSV(e),{results:this.results,valid:this.valid}}extractResult(e,t,s){let u={};u.chipid=0,u.name=(e[0]+" "+e[1]+" "+e[2]).trim(),u.dbid=u.chipid+"__"+u.name,u.starttime=Pe(e[3]),u.club=e[2],u.course=t,u.controls=s;const p=this.extractSpklasseSplits(e);u.splits=p.splits,u.codes=p.codes,u.time=xe(p.totaltime),this.results.push(u)}extractSingleCSVResult(e){let t={};t.valid=!0,t.chipid=e[this.CSVFormat.CHIP_IDX],t.name=(e[this.CSVFormat.FIRST_NAME_IDX]+" "+e[this.CSVFormat.SURNAME_IDX]).trim().replace(/"/g,""),t.dbid=e[this.CSVFormat.DB_IDX],t.starttime=w(e[this.CSVFormat.START_TIME_IDX]),t.time=e[this.CSVFormat.TOTAL_TIME_IDX],t.position=this.getPosition(e),t.status=this.getSICSVStatus(e[this.CSVFormat.NC_IDX],e[this.CSVFormat.CLASSIFIER_IDX]),t.club=e[this.CSVFormat.CLUB_IDX].trim().replace(/"/g,""),t.course=e[this.CSVFormat.COURSE_IDX],t.course===""&&(t.valid=!1),t.controls=parseInt(e[this.CSVFormat.NUM_CONTROLS_IDX],10);const s=this.extractSISplits(e,t.controls);return t.splits=s.splits,t.splits!==""&&(t.splits+=";"),t.splits+=w(t.time),t.codes=s.codes,t}extractSISplits(e,t){let s=this.CSVFormat.FIRST_SPLIT_IDX,o=this.CSVFormat.FIRST_CODE_IDX,l={};l.splits="",l.codes=[];for(let r=0;r<t;r+=1)e[o]&&(r>0&&(l.splits+=";"),l.codes[r]=e[o],l.splits+=w(e[s])),s+=this.CSVFormat.STEP,o+=this.CSVFormat.STEP;return{splits:l.splits,codes:l.codes}}extractSpklasseSplits(e){let s="",o=[],l=0;for(let r=0;r<e.length-4;r+=1)r>0&&(s+=";"),o[r]="X",l+=w(e[r+4]),s+=l;return{splits:s,codes:o,totaltime:l}}getCSVFormat(e){const t=["si card","database id","surname","first name","nc","start","time","classifier","city","short","course","course controls","pl","start punch","control1","punch1","control2"];let s=[];const o=e.split(this.separator).map(function(r){return r.toLowerCase()});let l=!1;for(let r=0;r<t.length;r+=1){l=!1;for(let i=0;i<o.length;i+=1){if(o[i]===t[r]){s[r]=i,l=!0;break}if(t[r]==="si card"&&(o[i]==="chipno"||o[i]==="sicard"||o[i]==="database id")){s[r]=i,l=!0;break}if(t[r]==="nc"&&o[i]==="classifier"){s[r]=i,l=!0;break}if(t[r]==="city"&&o[i]==="club"){s[r]=i,l=!0;break}if(t[r]==="pl"&&o[i]==="place"){s[r]=i,l=!0;break}}if(!l)break}l||(s=[1,2,3,4,8,9,11,12,15,18,39,42,43,44,46,47,48]),this.setCSVFormat(s)}getPosition(e){let t=parseInt(e[this.CSVFormat.POSITION_IDX],10);return isNaN(t)&&(t=""),t}getSICSVStatus(e,t){return e==="0"||e===""||e==="N"||e==="n"?t===""||t==="0"?"ok":"nok":"nc"}processCSVResults(e){for(let t=1;t<e.length;t+=1){const s=e[t].split(this.separator);if(s.length>=this.CSVFormat.FIRST_SPLIT_IDX){let o=this.extractSingleCSVResult(s);o.valid&&(delete o.valid,this.results.push(o))}}}processResultsCSV(e){const t=e.split(/[\r\n|\n]+/),s=t[0].split(",").length-1,o=t[0].split(";").length-1;s>o?this.separator=",":this.separator=";",t[0].split(this.separator).length===2?this.processSpklasseCSVResults(t):(this.getCSVFormat(t[0]),this.processCSVResults(t))}processSpklasseCSVResults(e){let o=[],l="",r=0;for(let i=0;i<e.length;i+=1)o=e[i].split(this.separator),o.length===2?(l=o[0],r=parseInt(o[1],10)):this.extractResult(o,l,r)}setCSVFormat(e){this.CSVFormat.CHIP_IDX=e[0],this.CSVFormat.DB_IDX=e[1],this.CSVFormat.SURNAME_IDX=e[2],this.CSVFormat.FIRST_NAME_IDX=e[3],this.CSVFormat.NC_IDX=e[4],this.CSVFormat.START_TIME_IDX=e[5],this.CSVFormat.TOTAL_TIME_IDX=e[6],this.CSVFormat.CLASSIFIER_IDX=e[7],this.CSVFormat.CLUB_IDX=e[8],this.CSVFormat.CLASS_IDX=e[9],this.CSVFormat.COURSE_IDX=e[10],this.CSVFormat.NUM_CONTROLS_IDX=e[11],this.CSVFormat.POSITION_IDX=e[12],this.CSVFormat.START_PUNCH_IDX=e[13],this.CSVFormat.FIRST_CODE_IDX=e[14],this.CSVFormat.FIRST_SPLIT_IDX=e[15],this.CSVFormat.STEP=e[16]-e[14]}}class Qe{constructor(e){return this.results=[],this.valid=!0,this.processIOFV2Results(e),{results:this.results,valid:this.valid}}extractIOFV2Results(e,t){for(let s=0;s<e.length;s+=1){t.status=re(e[s].getElementsByTagName("CompetitorStatus"),"value",""),t.position=this.getPosition(e[s].getElementsByTagName("ResultPosition")),t.chipid=T(e[s].getElementsByTagName("CCardId"),0),t.time=this.getTime(e[s].getElementsByTagName("Time")),t.starttime=this.getStartFinishTimeAsSecs(e[s].getElementsByTagName("StartTime")),t.splits="",t.codes=[];const o=e[s].getElementsByTagName("SplitTime");t.controls=o.length,this.extractIOFV2Splits(o,t);const l=this.getStartFinishTimeAsSecs(e[s].getElementsByTagName("FinishTime"));t.splits+=Math.max(l-t.starttime,0)}}extractIOFV2Splits(e,t){for(let s=0;s<e.length;s+=1){s>0&&(t.splits+=";");const o=e[s].getElementsByTagName("Time");o.length>0?(t.splits+=w(o[0].textContent),t.codes[s]=T(e[s].getElementsByTagName("ControlCode"),"")):(t.splits+=0,t.codes[s]="")}t.splits+=";"}getDBID(e,t){return e.length===0?t:(e=e[0].textContent.replace(/[\n\r]/g,"").trim(),e||t)}getName(e){return(e.getElementsByTagName("Given")[0].textContent+" "+e.getElementsByTagName("Family")[0].textContent).replace(/[\n\r]/g,"").trim()}getPosition(e){return e.length>0?parseInt(e[0].textContent,10):""}getStartFinishTimeAsSecs(e){if(e.length>0){const t=e[0].getElementsByTagName("Clock")[0].textContent;return w(t)}return 0}getTime(e){return e.length>0?e[0].textContent.replace(/[\n\r]/g,""):""}processIOFV2Results(e){try{const t=e.getElementsByTagName("ClassResult");for(let s=0;s<t.length;s+=1){const o=t[s].getElementsByTagName("ClassShortName")[0].textContent,l=t[s].getElementsByTagName("PersonResult");for(let r=0;r<l.length;r+=1){let i={};i.course=o,i.name=this.getName(l[r]),i.dbid=this.getDBID(l[r].getElementsByTagName("PersonId"),r),i.club=T(l[r].getElementsByTagName("ShortName"),"");const u=l[r].getElementsByTagName("Result");this.extractIOFV2Results(u,i),i.status!=="DidNotStart"&&this.results.push(i)}}}catch(t){this.valid=!1,c("XML parse error","Error processing XML file. Error is : "+t.message);return}}}class et{constructor(e){return this.results=[],this.valid=!0,this.processIOFV3Results(e),{results:this.results,valid:this.valid}}extractIOFV3Results(e,t){for(let s=0;s<e.length;s+=1){t.chipid=T(e[s].getElementsByTagName("ControlCard"),0),t.position=T(e[s].getElementsByTagName("Position"),""),t.position==="0"&&(t.position=""),t.status=T(e[s].getElementsByTagName("Status"),""),t.time=this.getTotalTimeAsSeconds(e[s].getElementsByTagName("Time")),t.starttime=this.getStartFinishTimeAsSeconds(T(e[s].getElementsByTagName("StartTime"),0)),t.splits="",t.codes=[];const o=e[s].getElementsByTagName("SplitTime");this.extractIOFV3Splits(o,t);const l=this.getStartFinishTimeAsSeconds(T(e[s].getElementsByTagName("FinishTime"),0));l>0?t.splits+=l-t.starttime:t.splits+=0}}extractIOFV3Splits(e,t){let s=[];for(let o=0;o<e.length;o+=1)e[o].attributes.length===0?(t.splits+=T(e[o].getElementsByTagName("Time"),0),s.push(T(e[o].getElementsByTagName("ControlCode"),"X"+o)),t.splits+=";"):e[o].getAttribute("status")==="Missing"&&(t.splits+="0",s.push(T(e[o].getElementsByTagName("ControlCode"),"X"+o)),t.splits+=";");t.codes=s,t.controls=t.codes.length}getClub(e){return e.length>0&&e[0].getElementsByTagName("Name")[0]?e[0].getElementsByTagName("Name")[0].textContent:""}getID(e,t){if(e.length>0){let s=e[0].textContent;return s.replace(/[\n\r]/g,""),s.trim()}return t}getStartFinishTimeAsSeconds(e){return e.length>=19?w(e.substr(11,8)):0}getTotalTimeAsSeconds(e){if(e.length>0&&e[0].textContent){const t=parseInt(e[0].textContent,10);return xe(t)}return"00:00"}processIOFV3Results(e){try{const t=e.getElementsByTagName("ClassResult");for(let s=0;s<t.length;s+=1){const l=t[s].getElementsByTagName("Class")[0].getElementsByTagName("Name")[0].textContent,r=t[s].getElementsByTagName("PersonResult");for(let i=0;i<r.length;i+=1){let u={};u.course=l;const p=r[i].getElementsByTagName("Given")[0].textContent+" "+r[i].getElementsByTagName("Family")[0].textContent;u.name=p.replace(/[\n\r]/g,"").trim(),u.dbid=this.getID(r[i].getElementsByTagName("Id"),i),u.club=this.getClub(r[i].getElementsByTagName("Organisation"));const f=r[i].getElementsByTagName("Result");this.extractIOFV3Results(f,u),u.status!=="DidNotStart"&&this.results.push(u)}}}catch(t){this.valid=!1,c("XML parse error","Error processing XML file. Error is : "+t.message);return}}}class tt{constructor(e,t){this.results=[],this.resultCourses=[],this.valid=!0;const s=this.processResults(e,t);return this.results=s.results,this.valid=s.valid,this.getCoursesFromResults(),{results:this.results,resultCourses:this.resultCourses,valid:this.valid}}getCoursesFromResults(){for(let e=0;e<this.results.length;e+=1){let t=!1;for(let s=0;s<this.resultCourses.length;s+=1)if(this.resultCourses[s].course===this.results[e].course){t=!0;break}t||this.resultCourses.push({course:this.results[e].course,courseid:m.DO_NOT_SAVE_COURSE})}}processResults(e,t){switch(t){case"CSV":return new qe(e.target.result);case"XML":return this.processResultsXML(e.target.result);default:return c("File type error","Results file type is not recognised. Please select a valid file."),{results:[],valid:!1}}}processResultsXML(e){let t="",s;try{if(s=new DOMParser().parseFromString(e,"text/xml"),s.getElementsByTagName("ResultList").length===0)return c("XML file error","File is not a valid XML results file. ResultList element missing."),{results:[],valid:!1};t=re(s.getElementsByTagName("IOFVersion"),"version",""),t===""&&(t=re(s.getElementsByTagName("ResultList"),"iofVersion",""))}catch{return c("XML file error","File is not a valid XML results file."),{results:[],valid:!1}}switch(t){case"2.0.3":return new Qe(s);case"3.0":return new et(s);default:return c("XML file error","Invalid IOF file format. Version "+t+" not supported."),{results:[],valid:!1}}}}let I=null,E=new Ne,me=new Ue,F=null,k=null,Y=!1,$=!0,a=null,d=[],C=[],ne=!1,B=!1,Q=!1,j=!1,U=!1,x={},g=[],L=[],v=[],J,ee,ge="";const ie=["UTF-8","ISO-8859-1","windows-1251"];let q=[],P=0,ae=!1,K=!1,fe=!1,h={x:null,y:null},N=[],y={height:0,width:0},b=new W(0),Le=new W(0),H=null,D=[],he=null,se=null;const Me="e.g. 1|1|6,60|15,60";function nt(n,e){let t;a.controls.length===0?t="S"+(a.controls.length+1):t="X"+(a.controls.length+1),a.addControl(t,n,e),a.displayAllControls(),x.codes.push(t),x.x.push(n),x.y.push(e)}function yn(n,e,t){if(K||t===m.RIGHT_CLICK)S.translate(e.x-n.x,e.y-n.y);else if(j=!0,h.x!==null){const s=(e.x-h.x)/(n.x-h.x),o=(e.y-h.y)/(n.y-h.y);if(isFinite(s)&&isFinite(o))for(let l=0;l<a.controls.length;l+=1){const r=a.controls[l].oldX-h.x,i=a.controls[l].oldY-h.y;a.controls[l].x=r*s+h.x,a.controls[l].y=i*o+h.y}}else{const s=e.x-n.x,o=e.y-n.y;for(let l=0;l<a.controls.length;l+=1)a.controls[l].x=a.controls[l].oldX+s,a.controls[l].y=a.controls[l].oldY+o}}function st(n){const e=ln(n.target.result);if(e===0||ae){jt(n);return}if(q[P]=e,P+=1,P===ie.length){let t=99999;for(let s=0;s<ie.length;s+=1)t>q[s]&&(P=s,t=q[s]);ae=!0}ke()}function ot(){let n={};n.body="Are you sure you want to add this map?",n.title="Confirm new map",n.classes="rg2-confirm-add-map-dialog",n.doText="Add map",n.onDo=Et,V(n)}function lt(n){n.preventDefault();const e=mn();if(e!=="OK"){c("Event set-up incomplete",e+" Please enter all necessary information and make sure controls are aligned before creating the event.");return}let t={};t.body="Are you sure you want to create this event?",t.title="Confirm event creation",t.classes="rg2-confirm-create-event-dialog",t.doText="Create event",t.onDo=mt,V(t)}function rt(){const n=document.getElementById("rg2-edit-event-selected").value;let e={};e.body="Event "+n+" will be deleted. Are you sure?",e.title="Confirm event delete",e.classes="rg2-confirm-delete-event-dialog",e.doText="Delete event",e.onDo=gt,V(e)}function it(){let n={};n.body="This route will be permanently deleted. Are you sure?",n.title="Confirm route delete",n.classes="rg2-confirm-route-delete-dialog",n.doText="Delete route",n.onDo=ft,V(n)}function at(){const n=document.querySelectorAll(".unused-map input[type=checkbox]:checked");let e=[];for(let s of n){s.checked&&e.push(parseInt(s.dataset.mapId,10));for(let o=0;o<D.length;o+=1)e.indexOf(D[o].mapid)>-1?D[o].delete=!0:D[o].delete=!1}if(e.length===0){c("Warning","No maps selected.");return}const t={};t.body="Selected maps will be deleted. Are you sure?",t.title="Confirm map deletion",t.doText="Delete maps",t.onDo=ht,V(t)}function dt(){let n={};n.body=`Are you sure you want to update ${document.getElementById("rg2-edit-event-name").value}?`,n.title="Confirm event update",n.doText="Update event",n.onDo=yt,V(n)}function Re(n){try{const e=me.getGeorefSystem(n);if(y=de(),!b.valid||y.width===0||e.name==="none")throw"Do not georeference";z.defs(e.name,e.params);const t=new z.Proj(e.name),s=new z.Proj("EPSG:4326"),o=[0,y.width,y.width,0],l=[0,y.height,0,y.height];let r=[],i=[];for(let f=0;f<4;f+=1)r[f]=b.getLon(o[f],l[f]),i[f]=b.getLat(o[f],l[f]);E.xpx.length=0,E.ypx.length=0,E.lat.length=0,E.lon.length=0;let u=[];for(let f=0;f<4;f+=1){let _={};_.x=r[f],_.y=i[f],u.push(_);const O=z(t,s,u[f]);E.xpx.push(o[f]),E.ypx.push(l[f]),E.lat.push(O.y),E.lon.push(O.x)}let p={};p.C=u[0].x,p.F=u[0].y,p.A=(u[2].x-p.C)/o[2],p.B=(u[3].x-p.C)/l[3],p.D=(u[2].y-p.F)/o[2],p.E=(u[3].y-p.F)/l[3],E.worldfile=new W(p),Se()}catch{E.worldfile=new W(0),Se();return}}function _e(){for(let n=0;n<a.controls.length;n+=1)a.controls[n].oldX=a.controls[n].x,a.controls[n].oldY=a.controls[n].y}function ct(n,e){let t=-1;for(let o=0;o<d.length;o+=1)if(d[o].name===n){t=o;break}if(t===-1&&C.length>0){for(let o=0;o<C.length;o+=1)if(C[o].className===n){for(let l=0;l<d.length;l+=1)if(d[l].name===C[o].course){t=l;break}break}}let s=`<select id='rg2-alloc-${e}' class="form-control form-control-sm">`;s+=`<option value="${m.DO_NOT_SAVE_COURSE}"${t===-1?" selected":""}>Do not save</option>`;for(let o=0;o<d.length;o+=1)s+=`<option value="${o}"${t===o?" selected":""}>${be(d[o].name)}</option>`;return s+="</select >",s}function pe(){if(!$){v.length=0;for(let n=0;n<d.length;n+=1)v.push({courseid:d[n].courseid,course:d[n].name})}}function oe(){let n="";if(d.length&&v.length){n='<div class="fw-bold">Results</div><div class="fw-bold">Course</div>';for(let e=0;e<v.length;e+=1)n+=`<div>${v[e].course}</div>`,n+=`<div>${ct(v[e].course,e)}</div>`;document.getElementById("rg2-course-allocations").innerHTML=n}}function we(n,e){let t={};t.body=e,t.title=n,t.doText="Ok",t.onDo=()=>{},V(t,!1)}function Ae(n){let e="<div class='title'>ID</div><div class='title'>Name</div><div><i class='bi-trash'></i></div>";if(n.length===0)e+="<div></div><div>None found.</div><div></div>",document.getElementById("btn-delete-unused-maps").setAttribute("disabled","");else{for(let t=0;t<n.length;t+=1)e+="<div>"+n[t].mapid+"</div>",e+="<div>"+n[t].name+"</div>",e+="<div class='unused-map'><input type='checkbox' data-map-id="+n[t].mapid+"></div>";document.getElementById("btn-delete-unused-maps").removeAttribute("disabled")}document.getElementById("rg2-unused-maps").innerHTML=e}function ut(){const n={type:"addmap"};E.localworldfile=b;const e={...E,...I.encodeUser()};M(JSON.stringify(e),n,Vt,"Map save failed",R)}function mt(){const n={...St(),...I.encodeUser()},e={type:"createevent"};M(JSON.stringify(n),e,wt,"Event creation failed",R)}function gt(){const n=document.getElementById("rg2-edit-event-selected").value,e={type:"deleteevent",id:n};M(JSON.stringify(I.encodeUser()),e,At(n),"Event deletion failed",R)}function ft(){const n=document.getElementById("rg2-edit-event-selected").value,e=document.getElementById("rg2-route-selected").value,t={type:"deleteroute",id:n,routeid:e};M(JSON.stringify(I.encodeUser()),t,Pt(e),"Route delete failed",R)}function ht(){let n=I.encodeUser();n.maps=D.filter(t=>t.delete===!0).map(t=>t.mapid);const e={type:"deleteunusedmaps"};M(JSON.stringify(n),e,Ut,"Map deletion failed",R)}function ye(){Ge({type:"maps"},kt,"Events request failed")}function pt(){const n={type:"login"};M(JSON.stringify(I.encodeUser()),n,Xt,"Login failed",R)}function yt(){const n=document.getElementById("rg2-edit-event-selected").value;let e=I.encodeUser();e.comments=document.getElementById("rg2-edit-event-comments").value,e.locked=document.getElementById("chk-edit-read-only").checked,e.name=document.getElementById("rg2-edit-event-name").value,e.type=document.getElementById("rg2-edit-event-level").value,e.eventdate=se.getDate("yyyy-mm-dd"),e.club=document.getElementById("rg2-edit-club-name").value;let t=document.getElementById("rg2-edit-exclude").value.trim();t===Me&&(t=""),e.exclude=t;const s={type:"editevent",id:n};M(JSON.stringify(e),s,bt(n),"Event update failed",R)}function Et(){const n=I.encodeUser();let e=new FormData;e.append(J.name,J),e.append("name",J.name),e.append("x",n.x),e.append("y",n.y),M(e,{type:"uploadmapfile",headers:{"Content-Type":"multipart/form-data"}},Ot,"Map upload failed",R)}function En(){if(B&&a.controls.length>0){a.drawControls(!0);const n=Ze();h.x!==null&&(S.lineWidth=n.overprintWidth,S.strokeStyle=m.HANDLE_COLOUR,S.fillStyle=m.HANDLE_COLOUR,S.globalAlpha=1,S.beginPath(),S.arc(h.x,h.y,m.HANDLE_DOT_RADIUS,0,2*Math.PI,!1),S.fill(),S.beginPath(),S.arc(h.x,h.y,2*m.HANDLE_DOT_RADIUS,0,2*Math.PI,!1),S.stroke())}}function vt(){document.querySelector("#rg2-info-panel-tab-headers li").remove(),document.querySelector("#rg2-manage-login-tab-body").remove(),document.getElementById(m.TAB_CREATE).classList.remove("d-none"),document.getElementById(m.TAB_CREATE).click(),document.getElementById(m.TAB_EDIT).classList.remove("d-none"),document.getElementById(m.TAB_MAP).classList.remove("d-none"),document.getElementById(m.TAB_DELETE_MAP).classList.remove("d-none"),ye(),qt(),document.getElementById("rg2-select-event-level").innerHTML=Ce(),document.getElementById("rg2-edit-event-level").innerHTML=Ce(),document.getElementById("rg2-georef-type").innerHTML=me.getGeorefDropdown(),document.getElementById("rg2-select-map").addEventListener("change",n=>{F=parseInt(n.target.value,10),F!==m.INVALID_MAP_ID?Be(rg2Config.maps_url+"/"+N[F].mapfilename):(B=!1,y.width=0,y.height=0)}),he=new ve(document.getElementById("rg2-select-event-date"),{buttonClass:"btn",autohide:!0,format:"yyyy-mm-dd"}),se=new ve(document.getElementById("rg2-edit-event-date"),{buttonClass:"btn",autohide:!0,format:"yyyy-mm-dd"}),document.getElementById("rg2-map-name").addEventListener("change",function(){nn()}),document.getElementById("rg2-new-course-name").addEventListener("change",function(){en()}),document.getElementById("rg2-edit-event-selected").addEventListener("change",n=>{Z(parseInt(n.target.value,10))}),document.getElementById("rg2-georef-type").addEventListener("change",n=>{tn(parseInt(n.target.value,10))})}function be(n){let e="";if(C&&C.length>0&&ne)for(let t=0;t<C.length;t+=1){const s=C[t].course;let o="";s===n&&(e!==""&&(e+=", "),o=C[t].className,o=o.replace(/ /g,""),o=o.replace(/-/g,""),e+=o)}return e!==""?n+": "+e:n}function Ct(){if(ne)for(let n=0;n<d.length;n+=1)d[n].name=be(d[n].name)}function vn(){const n=parseInt(document.getElementById("rg2-edit-event-selected").value,10),e=Ye(n);document.getElementById("rg2-edit-event-name").value=A(e.name),document.getElementById("rg2-edit-club-name").value=A(e.club),se.setDate(e.date),document.getElementById("rg2-edit-event-level").value=e.rawtype,document.getElementById("rg2-edit-event-comments").value=A(e.comment),He()?document.getElementById("rg2-exclude-info").classList.add("d-none"):(document.getElementById("rg2-edit-exclude").value=e.exclude,document.getElementById("rg2-exclude-info").classList.remove("d-none")),document.getElementById("chk-edit-read-only").checked=e.locked,document.getElementById("rg2-route-selected").innerHTML=Rt(e.id)}function Cn(n){document.getElementById("rg2-edit-event-selected").innerHTML=Ft(n),N.length>0&&(Xe(N),Ae(D))}function It(){L.length=0;let n;for(let e=0;e<g.length;e+=1){let t=g[e].codes;for(let s=0;s<d.length;s+=1)if(d[s].courseid===g[e].courseid){n=d[s];break}t.unshift(n.codes[0]),t.push(n.codes[n.codes.length-1]),g[e].variantid=_t(g[e].codes,g[e].courseid)}}function Xe(n){D.length=0;for(let e=0;e<n.length;e+=1)if(!We(n[e].mapid)){const t={};t.mapid=n[e].mapid,t.name=n[e].name,t.name===""&&(t.name="(None)"),t.delete=!1,D.push(t)}}function Ee(){let n=!1;if(B&&a.controls.length>0){const e=Tt();if(Q&&(e.maxX<0||e.minX>y.width||e.minY>y.height||e.maxY<0?c("Course file problem","Your course file does not match the map co-ordinates. Please check you have selected the correct file."):n=!0),n)K=!0,j=!0,document.getElementById("chk-move-map-and-controls").checked=!0;else{let t=.8;for(let s=0;s<a.controls.length;s+=1)a.controls[s].x=(a.controls[s].x-e.minX)*(y.width/e.xRange)*t+y.width*(1-t)*.5,a.controls[s].y=y.height-(a.controls[s].y-e.minY)*(y.height/e.yRange)*t-y.height*(1-t)*.5}_e(),a.displayAllControls()}}function St(){let n=I.encodeUser();if(n.name=document.getElementById("rg2-event-name").value,n.mapid=N[F].mapid,n.eventdate=he.getDate("yyyy-mm-dd"),n.comments=document.getElementById("rg2-enter-event-comments").value,n.locked=document.getElementById("chk-read-only").checked,n.club=document.getElementById("rg2-select-club-name").value,$?Y?n.format=m.FORMAT_SCORE_EVENT:n.format=m.FORMAT_NORMAL:Y?n.format=m.FORMAT_SCORE_EVENT_NO_RESULTS:n.format=m.FORMAT_NORMAL_NO_RESULTS,n.level=document.getElementById("rg2-select-event-level").value,U&&(d.push(x),pe()),Qt(),Ht(),Ct(),Jt(),Y&&(It(),n.variants=L.slice(0)),n.courses=d.slice(0),fe?n.results=g.slice(0).sort(sn):n.results=g.slice(0),n.format===m.FORMAT_NORMAL)for(let e=0;e<n.results.length;e+=1)(n.results[e].splits.match(/;/g)||[]).length===xt(n.courses,n.results[e].courseid)+1&&(n.results[e].splits=n.results[e].splits.substring(0,n.results[e].splits.lastIndexOf(";")));for(let e=0;e<n.results.length;e+=1)delete n.results[e].codes,delete n.results[e].chipid,delete n.results[e].club;return n}function Tt(){let n={};n.minX=a.controls[0].x,n.maxX=a.controls[0].x,n.minY=a.controls[0].y,n.maxY=a.controls[0].y;for(let e=1;e<a.controls.length;e+=1)n.maxX=Math.max(n.maxX,a.controls[e].x),n.maxY=Math.max(n.maxY,a.controls[e].y),n.minX=Math.min(n.minX,a.controls[e].x),n.minY=Math.min(n.minY,a.controls[e].y);return n.xRange=n.maxX-n.minX,n.yRange=n.maxY-n.minY,n}function xt(n,e){for(let t=0;t<n.length;t+=1)if(n[t].courseid===e)return n[t].controlcount;return 0}function Ve(n){let e={x:0,y:0};for(let t=0;t<a.controls.length;t+=1)if(a.controls[t].code===n)return e.x=Math.round(a.controls[t].x),e.y=Math.round(a.controls[t].y),e;return e}function Bt(n){for(let e=0;e<v.length;e+=1)if(v[e].course===n)return v[e].courseid;return 0}function Nt(){let n='<div class="new-courses-table">';if(d.length){n+=`<div>${le("Course")}</div><div>${le("Name")}</div><div>${le("Controls")}</div>`;for(let e=0;e<d.length;e+=1)n+=`<div>${e+1}</div><div>${d[e].name}</div><div>${d[e].codes.length-2}</div>`}return n+="</div>",n}function Dt(n){for(let e=0;e<d.length;e+=1)if(d[e].courseid===n)return d[e].name;return 0}function Ft(n){let e=X(null,"No event selected",!0);for(let t=n.length-1;t>-1;t-=1)e+=X(n[t].kartatid,n[t].kartatid+": "+n[t].date+": "+A(n[t].name));return e}function Ce(){let n="";const e=["Select level","Training","Local","Regional","National","International"],t=["X","T","L","R","N","I"];for(let s=0;s<e.length;s+=1)n+=X(t[s],e[s],s===0);return n}function Lt(n){let e=X(m.INVALID_MAP_ID,"Select map",!0);for(let t=n.length-1;t>-1;t-=1)e+=X(t,n[t].mapid+": "+A(n[t].name));return e}function Mt(){let n="";if(g.length){n='<div class="new-results-table">';let e=0,t=null;for(let s=0;s<g.length;s+=1)g[s].course!==t&&(t!==null&&(n+=`<div>${e}</div>`,e=0),n+=`<div>${g[s].course}</div><div>${g[s].name}</div><div>${g[s].time}</div>`,t=g[s].course),e+=1;n+=`<div>${e}</div></div>`}else n="No valid results found.";return n}function Rt(n){const e=$e();let t=X("undefined","Select route");for(let s=0;s<e.length;s+=1)t+=X(e[s].resultid,e[s].resultid+": "+A(e[s].name)+" on "+A(e[s].coursename));return t}function _t(n,e){let t=[],s=[],o=0;for(let l=0;l<L.length;l+=1)if(L[l].codes.length===n.length){let r=!0;for(let i=0;i<n.length;i+=1)if(L[l].codes[i]!==n[i]){r=!1;break}if(r){o=l+1;break}}if(o===0){o=L.length+1;for(let l=0;l<n.length;l+=1){const r=Ve(n[l]);t.push(r.x),s.push(r.y)}L.push({x:t,y:s,id:o,courseid:e,name:"Variant "+o,codes:n})}return o}function wt(n){n.ok?(c("Event created",document.getElementById("rg2-event-name").value+" has been added with id "+n.newid+"."),window.open(rg2Config.api_url.replace("rg2api.php","")+"#"+n.newid),te(),Z()):c("Save failed",n.status_msg+" Failed to create event. Please try again.")}const At=n=>e=>{e.ok?(c("Event deleted","Event "+n+"has been deleted."),te(),Z(),document.getElementById("rg2-edit-event-selected").replaceChildren()):c("Delete failed",e.status_msg+". Event "+n+" delete failed. Please try again.")},bt=n=>e=>{e.ok?(c("Event updated","Event "+n+" has been updated."),De(null),Fe(),te(),Z()):c("Update failed",e.status_msg+". Event update failed. Please try again.")};function R(n){I.y=n}function Xt(n){n.ok?vt():c("Login failed","User name or password incorrect. Please try again.")}function Vt(n){n.ok?(c("Map added",n.name+" has been added with id "+n.newid+"."),ye()):c("Save failed",n.status_msg+". Failed to save map. Please try again.")}function Ot(n){n.ok?ut():c("Upload failed",n.status_msg+". Failed to upload map. Please try again.")}function kt(n){N.length=0;for(let e=0;e<n.maps.length;e+=1)N.push(new Ne(n.maps[e]));document.getElementById("rg2-select-map").innerHTML=Lt(N),Xe(N),Ae(D)}const Pt=n=>e=>{e.ok?(c("Route deleted","Route "+n+" has been deleted."),De(null),Fe(),te(),Z()):c("Delete failed",e.status_msg+". Delete failed for route "+n+". Please try again.")};function Ut(n){n.ok?c("Maps deleted","Selected maps have been deleted."):c("Delete failed",n.status_msg+". Delete failed. Please try again."),ye()}function Ie(n){return n===0||n==="0"||n==="0:00"||n==="00:00"}function Oe(){a=new Te,F=m.INVALID_MAP_ID,k=m.FORMAT_NORMAL,Y=!1,$=!0,d=[],C=[],ne=!1,B=!1,Q=!1,j=!1,U=!1,x={},g=[],L=[],v=[],y={height:0,width:0},ee=void 0,ge="",K=!1,fe=!1,h={x:null,y:null}}function Gt(){P=0,q=[],ae=!1}function In(n){I=new ze(n),H=ue.map("rg2-world-file-map"),Oe(),Yt(),document.getElementById("rg2-manager-login-form").addEventListener("submit",e=>{e.preventDefault(),I.setDetails("rg2-user-name","rg2-password")?pt():c("Login failed","Please enter user name and password of at least five characters")})}function Yt(){ue.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(H),document.getElementById("rg2-world-file-map-container").classList.remove("d-none")}function Sn(){B&&a.controls.length>0&&_e()}function Tn(){B=!0,F!==m.INVALID_MAP_ID&&(b=N[F].localworldfile,Le=N[F].worldfile),y=de(),Ee(),ce()}function xn(n,e){if(U){nt(n,e),j=!0;return}B&&a.controls.length>0&&(h.x===null?h={x:n,y:e}:h={x:null,y:null})}function Ht(){let n=[],e=1;for(let t=0;t<v.length;t+=1){let s;if(U)s=0;else{const o=document.getElementById("rg2-alloc-"+t);o&&(s=parseInt(o.value,10))}s!==void 0&&s!==m.DO_NOT_SAVE_COURSE&&(d[s].courseid===0?(d[s].courseid=e,n.push(d[s]),v[t].courseid=e,e+=1):v[t].courseid=d[s].courseid)}d=n}function Wt(n){Q=!1,K=!1,document.getElementById("chk-move-map-and-controls").checked=!1,h={x:null,y:null},a.deleteAllControls();const e=new Je(n,Le,b);d=e.courses,d.length>0&&(a=e.newcontrols,C=e.mapping,C.length>0?document.getElementById("chk-enrich-course-names").classList.remove("d-none"):document.getElementById("chk-enrich-course-names").classList.add("d-none"),Q=e.georeferenced,we("Course details",Nt()),pe(),oe(),Ee()),ce()}function $t(n){Be(n.target.result,!0),document.getElementById("rg2-load-map-file").classList.add("is-valid"),B=!0,y=de(),Ee(),ce(),document.getElementById("btn-add-map").removeAttribute("disabled")}function jt(n){const e=new tt(n,ge);g=e.results,g.length>0&&(v=e.resultCourses,we("Result details",Mt()),oe())}function Kt(n){let e=new FileReader;e.onerror=function(){c("Course file error","The selected course file could not be read.")},e.onload=function(t){Wt(t)},e.readAsText(n.target.files[0])}function Zt(n){const e=new FileReader;try{e.readAsText(n.target.files[0])}catch{c("File read error","Failed to open selected world file.");return}e.onerror=function(){c("World file error","The selected world file could not be read.")},e.onload=function(t){const o=t.target.result.split(/[\r\n]+/g);b=new W({A:o[0],B:o[2],C:o[4],D:o[1],E:o[3],F:o[5]});const l=me.getDefaultValue();document.getElementById("rg2-georef-type").value=l,Re(l)}}function zt(n){const e=new FileReader;e.onload=function(s){$t(s)};const t=n.target.files[0].name.substr(-3,3).toUpperCase();t==="JPG"||t==="GIF"?(J=n.target.files[0],e.readAsDataURL(n.target.files[0])):c("File type error",n.target.files[0].name+" is not recognised. Only .jpg and .gif files are supported at present.")}function ke(){let n=new FileReader;n.onerror=function(){c("Results file error","The selected results file could not be read.")},n.onload=function(e){st(e)},k=ee.name.substr(-3,3).toUpperCase(),k==="XML"||k==="CSV"?(ge=k,n.readAsText(ee,ie[P])):c("File type error","Results file type is not recognised. Please select a valid file.")}function Jt(){let n=[];for(let e=0;e<g.length;e+=1){const t=Bt(g[e].course);t!==m.DO_NOT_SAVE_COURSE&&(g[e].courseid=t,g[e].course=Dt(t),g[e].variantid="",n.push(g[e]))}g=n}function qt(){document.getElementById("btn-create-event").addEventListener("click",t=>{lt(t)}),document.getElementById("btn-update-event").addEventListener("click",t=>{dt()}),document.getElementById("btn-delete-route").addEventListener("click",t=>{it()}),document.getElementById("btn-delete-event").addEventListener("click",t=>{rt()}),document.getElementById("btn-add-map").addEventListener("click",t=>{ot()}),document.getElementById("btn-delete-unused-maps").addEventListener("click",t=>{at()}),document.getElementById("btn-draw-courses").addEventListener("click",t=>{on()}),document.getElementById("rg2-load-georef-file").addEventListener("input",t=>{Zt(t)}),document.getElementById("rg2-load-map-file").addEventListener("input",t=>{gn(t.target.files[0]),zt(t)});const n=document.getElementById("rg2-load-results-file");n.addEventListener("click",t=>{B||(c("No map loaded","Please load a map file before adding results."),t.preventDefault())}),n.addEventListener("change",t=>{ee=t.target.files[0],Gt(),ke()}),document.getElementById("chk-move-map-and-controls").addEventListener("click",t=>{an(t.target.checked)}),document.getElementById("chk-no-results").addEventListener("click",t=>{dn(t.target.checked)}),document.getElementById("chk-score-event").addEventListener("click",t=>{cn(t.target.checked)}),document.getElementById("chk-enrich-course-names").addEventListener("click",t=>{rn(t.target.checked)}),document.getElementById("chk-sort-results").addEventListener("click",t=>{un(t.target.checked)});const e=document.getElementById("rg2-load-course-file");e.addEventListener("click",t=>{B||(c("No map loaded","Please load a map file before adding courses."),t.preventDefault())}),e.addEventListener("change",t=>{Kt(t)})}function Qt(){for(let n=0;n<d.length;n+=1)for(let e=0;e<d[n].codes.length;e+=1){const t=Ve(d[n].codes[e]);d[n].x[e]=t.x,d[n].y[e]=t.y}}function en(){const n=document.getElementById("rg2-new-course-name").value;n&&(x.name=n)}function Z(n){n?je(n):(Oe(),document.getElementById("rg2-edit-event-name").value="",document.getElementById("rg2-edit-club-name").value="",se.setDate(""),document.getElementById("rg2-edit-event-level").value="",document.getElementById("rg2-edit-event-comments").value="",document.getElementById("rg2-edit-exclude").value=Me,document.getElementById("rg2-route-selected").replaceChildren(),document.getElementById("chk-edit-read-only").checked=!1,document.getElementById("rg2-course-allocations").innerHTML="")}function tn(n){n!==0&&Re(n)}function nn(){E.name=document.getElementById("rg2-map-name").value,Ke("rg2-map-name",n=>/./.test(n))}function sn(n,e){return n.courseid!==e.courseid?n.courseid-e.courseid:n.position!==""&&e.position!==""?n.position-e.position:n.position===""&&e.position!==""?1:n.position!==""&&e.position===""?-1:Ie(n.time)&&Ie(e.time)?n.name-e.name:n.time-e.time}function on(){B?(U=!0,d.length=0,a.deleteAllControls(),x.name="Course",x.x=[],x.y=[],x.codes=[],x.courseid=0,document.getElementById("rg2-new-course-name").value,document.getElementById("rg2-draw-courses").classList.remove("d-none")):c("No map selected","Please load a map before drawing courses")}function ln(n){let e=0;for(let t=0;t<n.length;t+=1)n.charCodeAt(t)===65533&&(e+=1);return e}function rn(n){ne=n,oe()}function an(n){K=n}function dn(n){$=!n,pe(),oe()}function cn(n){Y=n}function un(n){fe=n}function Se(){const n=E.lon,e=E.lat;let t=[];[3,1,2,0].forEach(function(l){t.push([e[l],n[l]])});const o=ue.polygon(t,{color:"red"});o.addTo(H),document.getElementById("rg2-world-file-map-container").classList.remove("d-none"),H.invalidateSize(),H.fitBounds(o.getBounds())}function mn(){return document.getElementById("rg2-event-name").value===""?"Event name is not valid.":F===m.INVALID_MAP_ID?"No map selected.":document.getElementById("rg2-select-club-name").value===""?"Club name is not valid.":he.getDate("yyyy-mm-dd")===void 0?"Date is not valid.":document.getElementById("rg2-select-event-level").value==="X"?"Event level is not valid.":k?d.length===0&&!U?"No course information. Check your course XML file.":g.length===0&&$?"No results information. Check your results file.":j?"OK":"Controls have not been adjusted on the map.":"Event format is not valid."}function gn(n){let e=new FileReader;e.onload=function(t){let s=new Image;s.src=t.target.result,s.onload=function(){const o=Math.round(n.size/1024/1024);if(o>m.FILE_SIZE_WARNING||s.height>m.PIXEL_SIZE_WARNING||s.width>m.PIXEL_SIZE_WARNING){let l="The uploaded map file is "+o+"MB ("+s.width;l+=" x "+s.height+"px). It is recommended that you use maps under "+m.FILE_SIZE_WARNING,l+="MB with a maximum dimension of "+m.PIXEL_SIZE_WARNING+"px. Please see the ",l+="<a href='https://github.com/Maprunner/rg2/wiki/Map-files'>RG2 wiki</a> for ",l+="guidance on how to create map files.",c("Oversized map upload",l)}}},e.readAsDataURL(n)}export{yn as adjustManagerControls,ye as doGetMaps,En as drawManagerControls,vt as enableManager,vn as eventFinishedLoading,Cn as eventListLoaded,In as initialiseManager,Sn as managerDragEnded,Tn as managerMapLoadCallback,xn as managerMouseUp};
//# sourceMappingURL=manager-1E3re5s3.js.map
